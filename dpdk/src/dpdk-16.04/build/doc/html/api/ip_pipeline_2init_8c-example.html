<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/init.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/init.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2016 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__cycles_8h.html">rte_cycles.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ethdev_8h.html">rte_ethdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ether_8h.html">rte_ether.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ip_8h.html">rte_ip.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__eal_8h.html">rte_eal.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;app.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_common_fe.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_master.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_passthrough.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_firewall.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_flow_classification.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_flow_actions.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_routing.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;thread_fe.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define APP_NAME_SIZE   32</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_core_map(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing CPU core map ...&quot;</span>);</div>
<div class="line">    app-&gt;core_map = cpu_core_map_init(4, 32, 4, 0);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app-&gt;core_map == NULL)</div>
<div class="line">        <a name="a0"></a><a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Cannot create CPU core map\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app-&gt;log_level &gt;= APP_LOG_LEVEL_LOW)</div>
<div class="line">        cpu_core_map_print(app-&gt;core_map);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_core_mask(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint64_t mask = 0;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_pipelines; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_params *p = &amp;app-&gt;pipeline_params[i];</div>
<div class="line">        <span class="keywordtype">int</span> lcore_id;</div>
<div class="line"></div>
<div class="line">        lcore_id = cpu_core_map_get_lcore_id(app-&gt;core_map,</div>
<div class="line">            p-&gt;socket_id,</div>
<div class="line">            p-&gt;core_id,</div>
<div class="line">            p-&gt;hyper_th_id);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (lcore_id &lt; 0)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Cannot create CPU core mask\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">        mask |= 1LLU &lt;&lt; lcore_id;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    app-&gt;core_mask = mask;</div>
<div class="line">    APP_LOG(app, HIGH, <span class="stringliteral">&quot;CPU core mask = 0x%016&quot;</span> PRIx64, app-&gt;core_mask);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_eal(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> buffer[256];</div>
<div class="line">    <span class="keyword">struct </span>app_eal_params *p = &amp;app-&gt;eal_params;</div>
<div class="line">    uint32_t n_args = 0;</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    app-&gt;eal_argv[n_args++] = strdup(app-&gt;app_name);</div>
<div class="line"></div>
<div class="line">    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;-c%&quot;</span> PRIx64, app-&gt;core_mask);</div>
<div class="line">    app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;coremap) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--lcores=%s&quot;</span>, p-&gt;coremap);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;master_lcore_present) {</div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--master-lcore=%&quot;</span> PRIu32,</div>
<div class="line">            p-&gt;master_lcore);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;-n%&quot;</span> PRIu32, p-&gt;channels);</div>
<div class="line">    app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;memory_present) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;-m%&quot;</span> PRIu32, p-&gt;memory);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;ranks_present) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;-r%&quot;</span> PRIu32, p-&gt;ranks);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_LINKS; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;pci_blacklist[i] == NULL)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--pci-blacklist=%s&quot;</span>,</div>
<div class="line">            p-&gt;pci_blacklist[i]);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app-&gt;port_mask != 0)</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_LINKS; i++) {</div>
<div class="line">            <span class="keywordflow">if</span> (p-&gt;pci_whitelist[i] == NULL)</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">            snprintf(buffer,</div>
<div class="line">                <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">                <span class="stringliteral">&quot;--pci-whitelist=%s&quot;</span>,</div>
<div class="line">                p-&gt;pci_whitelist[i]);</div>
<div class="line">            app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">        }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_links; i++) {</div>
<div class="line">            <span class="keywordtype">char</span> *pci_bdf = app-&gt;link_params[i].pci_bdf;</div>
<div class="line"></div>
<div class="line">            snprintf(buffer,</div>
<div class="line">                <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">                <span class="stringliteral">&quot;--pci-whitelist=%s&quot;</span>,</div>
<div class="line">                pci_bdf);</div>
<div class="line">            app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; APP_MAX_LINKS; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;vdev[i] == NULL)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--vdev=%s&quot;</span>,</div>
<div class="line">            p-&gt;vdev[i]);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;vmware_tsc_map_present) &amp;&amp; p-&gt;vmware_tsc_map) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--vmware-tsc-map&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;proc_type) {</div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--proc-type=%s&quot;</span>,</div>
<div class="line">            p-&gt;proc_type);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;syslog) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--syslog=%s&quot;</span>, p-&gt;syslog);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;log_level_present) {</div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--log-level=%&quot;</span> PRIu32,</div>
<div class="line">            p-&gt;log_level);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;version_present) &amp;&amp; p-&gt;version) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;-v&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;help_present) &amp;&amp; p-&gt;help) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--help&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;no_huge_present) &amp;&amp; p-&gt;no_huge) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--no-huge&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;no_pci_present) &amp;&amp; p-&gt;no_pci) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--no-pci&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;no_hpet_present) &amp;&amp; p-&gt;no_hpet) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--no-hpet&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;no_shconf_present) &amp;&amp; p-&gt;no_shconf) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--no-shconf&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;add_driver) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;-d=%s&quot;</span>, p-&gt;add_driver);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;socket_mem) {</div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--socket-mem=%s&quot;</span>,</div>
<div class="line">            p-&gt;socket_mem);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;huge_dir) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--huge-dir=%s&quot;</span>, p-&gt;huge_dir);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;file_prefix) {</div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--file-prefix=%s&quot;</span>,</div>
<div class="line">            p-&gt;file_prefix);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;base_virtaddr) {</div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--base-virtaddr=%s&quot;</span>,</div>
<div class="line">            p-&gt;base_virtaddr);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;create_uio_dev_present) &amp;&amp; p-&gt;create_uio_dev) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--create-uio-dev&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;vfio_intr) {</div>
<div class="line">        snprintf(buffer,</div>
<div class="line">            <span class="keyword">sizeof</span>(buffer),</div>
<div class="line">            <span class="stringliteral">&quot;--vfio-intr=%s&quot;</span>,</div>
<div class="line">            p-&gt;vfio_intr);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((p-&gt;xen_dom0_present) &amp;&amp; (p-&gt;xen_dom0)) {</div>
<div class="line">        snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--xen-dom0&quot;</span>);</div>
<div class="line">        app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;--&quot;</span>);</div>
<div class="line">    app-&gt;eal_argv[n_args++] = strdup(buffer);</div>
<div class="line"></div>
<div class="line">    app-&gt;eal_argc = n_args;</div>
<div class="line"></div>
<div class="line">    APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing EAL ...&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (app-&gt;log_level &gt;= APP_LOG_LEVEL_LOW) {</div>
<div class="line">        <span class="keywordtype">int</span> i;</div>
<div class="line"></div>
<div class="line">        fprintf(stdout, <span class="stringliteral">&quot;[APP] EAL arguments: \&quot;&quot;</span>);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 1; i &lt; app-&gt;eal_argc; i++)</div>
<div class="line">            fprintf(stdout, <span class="stringliteral">&quot;%s &quot;</span>, app-&gt;eal_argv[i]);</div>
<div class="line">        fprintf(stdout, <span class="stringliteral">&quot;\&quot;\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = <a name="a1"></a><a class="code" href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a>(app-&gt;eal_argc, app-&gt;eal_argv);</div>
<div class="line">    <span class="keywordflow">if</span> (status &lt; 0)</div>
<div class="line">        <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;EAL init error\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_mempool(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_mempools; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_mempool_params *p = &amp;app-&gt;mempool_params[i];</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing %s ...&quot;</span>, p-&gt;name);</div>
<div class="line">        app-&gt;mempool[i] = <a name="a2"></a><a class="code" href="rte__mempool_8h.html#a7dc1d01a45144e3203c36d1800cb8f17">rte_mempool_create</a>(</div>
<div class="line">                p-&gt;name,</div>
<div class="line">                p-&gt;pool_size,</div>
<div class="line">                p-&gt;buffer_size,</div>
<div class="line">                p-&gt;cache_size,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a name="_a3"></a><a class="code" href="structrte__pktmbuf__pool__private.html">rte_pktmbuf_pool_private</a>),</div>
<div class="line">                <a name="a4"></a><a class="code" href="rte__mbuf_8h.html#af714a7341cb37bc2530ac07c84c829b6">rte_pktmbuf_pool_init</a>, NULL,</div>
<div class="line">                <a name="a5"></a><a class="code" href="rte__mbuf_8h.html#a7c0d0b427cb071856f2ff0805d608e35">rte_pktmbuf_init</a>, NULL,</div>
<div class="line">                p-&gt;cpu_socket_id,</div>
<div class="line">                0);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (app-&gt;mempool[i] == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s init error\n&quot;</span>, p-&gt;name);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_arp_add(<span class="keyword">struct</span> app_link_params *link)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a6"></a><a class="code" href="structrte__eth__ethertype__filter.html">rte_eth_ethertype_filter</a> filter = {</div>
<div class="line">        .<a name="a7"></a><a class="code" href="structrte__eth__ethertype__filter.html#ad6312397ccc57d322b1a037c7080d340">ether_type</a> = <a name="a8"></a><a class="code" href="rte__ether_8h.html#a3f5d778e8eb1a7ad731921a460e6c1dd">ETHER_TYPE_ARP</a>,</div>
<div class="line">        .flags = 0,</div>
<div class="line">        .queue = link-&gt;arp_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a name="a9"></a><a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(link-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_ETHERTYPE,</div>
<div class="line">        <a name="a10"></a><a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7a882958eb0c8ace333823773114bc85f0">RTE_ETH_FILTER_ADD</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_tcp_syn_add(<span class="keyword">struct</span> app_link_params *link)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a11"></a><a class="code" href="structrte__eth__syn__filter.html">rte_eth_syn_filter</a> filter = {</div>
<div class="line">        .<a name="a12"></a><a class="code" href="structrte__eth__syn__filter.html#a9edacbb8d588c53283dcbf0d97b63f6e">hig_pri</a> = 1,</div>
<div class="line">        .queue = link-&gt;tcp_syn_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(link-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_SYN,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7a882958eb0c8ace333823773114bc85f0">RTE_ETH_FILTER_ADD</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_ip_add(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a13"></a><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a name="a14"></a><a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a name="a15"></a><a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = 0,</div>
<div class="line">        .proto_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 1, <span class="comment">/* Lowest */</span></div>
<div class="line">        .queue = l1-&gt;ip_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7a882958eb0c8ace333823773114bc85f0">RTE_ETH_FILTER_ADD</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_ip_del(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = 0,</div>
<div class="line">        .proto_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 1, <span class="comment">/* Lowest */</span></div>
<div class="line">        .queue = l1-&gt;ip_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a name="a16"></a><a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7afee5d5303ad409c59512fa08331e18e1">RTE_ETH_FILTER_DELETE</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_tcp_add(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = IPPROTO_TCP,</div>
<div class="line">        .proto_mask = UINT8_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 2, <span class="comment">/* Higher priority than IP */</span></div>
<div class="line">        .queue = l1-&gt;tcp_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7a882958eb0c8ace333823773114bc85f0">RTE_ETH_FILTER_ADD</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_tcp_del(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = IPPROTO_TCP,</div>
<div class="line">        .proto_mask = UINT8_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 2, <span class="comment">/* Higher priority than IP */</span></div>
<div class="line">        .queue = l1-&gt;tcp_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7afee5d5303ad409c59512fa08331e18e1">RTE_ETH_FILTER_DELETE</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_udp_add(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = IPPROTO_UDP,</div>
<div class="line">        .proto_mask = UINT8_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 2, <span class="comment">/* Higher priority than IP */</span></div>
<div class="line">        .queue = l1-&gt;udp_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7a882958eb0c8ace333823773114bc85f0">RTE_ETH_FILTER_ADD</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_udp_del(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = IPPROTO_UDP,</div>
<div class="line">        .proto_mask = UINT8_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 2, <span class="comment">/* Higher priority than IP */</span></div>
<div class="line">        .queue = l1-&gt;udp_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7afee5d5303ad409c59512fa08331e18e1">RTE_ETH_FILTER_DELETE</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_sctp_add(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = IPPROTO_SCTP,</div>
<div class="line">        .proto_mask = UINT8_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 2, <span class="comment">/* Higher priority than IP */</span></div>
<div class="line">        .queue = l1-&gt;sctp_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7a882958eb0c8ace333823773114bc85f0">RTE_ETH_FILTER_ADD</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_filter_sctp_del(<span class="keyword">struct</span> app_link_params *l1, <span class="keyword">struct</span> app_link_params *l2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__eth__ntuple__filter.html">rte_eth_ntuple_filter</a> filter = {</div>
<div class="line">        .<a class="code" href="structrte__eth__ntuple__filter.html#a1e87af3c18a2fd36c61faf89949bdc3f">flags</a> = RTE_5TUPLE_FLAGS,</div>
<div class="line">        .dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(l2-&gt;ip),</div>
<div class="line">        .dst_ip_mask = UINT32_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .src_ip = 0,</div>
<div class="line">        .src_ip_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .dst_port = 0,</div>
<div class="line">        .dst_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .src_port = 0,</div>
<div class="line">        .src_port_mask = 0, <span class="comment">/* Disable */</span></div>
<div class="line">        .proto = IPPROTO_SCTP,</div>
<div class="line">        .proto_mask = UINT8_MAX, <span class="comment">/* Enable */</span></div>
<div class="line">        .tcp_flags = 0,</div>
<div class="line">        .priority = 2, <span class="comment">/* Higher priority than IP */</span></div>
<div class="line">        .queue = l1-&gt;sctp_local_q,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="rte__ethdev_8h.html#a07f393d559fc9f72efe892413cb8208d">rte_eth_dev_filter_ctrl</a>(l1-&gt;pmd_id,</div>
<div class="line">        RTE_ETH_FILTER_NTUPLE,</div>
<div class="line">        <a class="code" href="rte__eth__ctrl_8h.html#aa04c5276c9394e64bd94fac950bba9b7afee5d5303ad409c59512fa08331e18e1">RTE_ETH_FILTER_DELETE</a>,</div>
<div class="line">        &amp;filter);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_link_set_arp_filter(<span class="keyword">struct</span> app_params *app, <span class="keyword">struct</span> app_link_params *cp)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (cp-&gt;arp_q != 0) {</div>
<div class="line">        <span class="keywordtype">int</span> status = app_link_filter_arp_add(cp);</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;Adding ARP filter (queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">            cp-&gt;name, cp-&gt;pmd_id, cp-&gt;arp_q);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;Error adding ARP filter &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                cp-&gt;name, cp-&gt;pmd_id, cp-&gt;arp_q, status);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_link_set_tcp_syn_filter(<span class="keyword">struct</span> app_params *app, <span class="keyword">struct</span> app_link_params *cp)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (cp-&gt;tcp_syn_q != 0) {</div>
<div class="line">        <span class="keywordtype">int</span> status = app_link_filter_tcp_syn_add(cp);</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;Adding TCP SYN filter (queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">            cp-&gt;name, cp-&gt;pmd_id, cp-&gt;tcp_syn_q);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;Error adding TCP SYN filter &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                cp-&gt;name, cp-&gt;pmd_id, cp-&gt;tcp_syn_q,</div>
<div class="line">                status);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_link_is_virtual(<span class="keyword">struct</span> app_link_params *p)</div>
<div class="line">{</div>
<div class="line">    uint32_t pmd_id = p-&gt;pmd_id;</div>
<div class="line">    <span class="keyword">struct </span>rte_eth_dev *dev = &amp;rte_eth_devices[pmd_id];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (dev-&gt;dev_type == <a name="a17"></a><a class="code" href="rte__ethdev_8h.html#aebe12d0ec53182639c32c4f96701df7ca3e462d12ad8349a9d84adbac264d1480">RTE_ETH_DEV_VIRTUAL</a>)</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">app_link_up_internal(<span class="keyword">struct</span> app_params *app, <span class="keyword">struct</span> app_link_params *cp)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app_link_is_virtual(cp)) {</div>
<div class="line">        cp-&gt;state = 1;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* For each link, add filters for IP of current link */</span></div>
<div class="line">    <span class="keywordflow">if</span> (cp-&gt;ip != 0) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_links; i++) {</div>
<div class="line">            <span class="keyword">struct </span>app_link_params *p = &amp;app-&gt;link_params[i];</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* IP */</span></div>
<div class="line">            <span class="keywordflow">if</span> (p-&gt;ip_local_q != 0) {</div>
<div class="line">                <span class="keywordtype">int</span> status = app_link_filter_ip_add(p, cp);</div>
<div class="line"></div>
<div class="line">                APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;Adding IP filter (queue= %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%08&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;ip_local_q,</div>
<div class="line">                    cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (status)</div>
<div class="line">                    <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Error adding IP &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;filter (queue= %&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;IP = 0x%08&quot;</span> PRIx32</div>
<div class="line">                        <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                        p-&gt;name, p-&gt;pmd_id,</div>
<div class="line">                        p-&gt;ip_local_q, cp-&gt;ip, status);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* TCP */</span></div>
<div class="line">            <span class="keywordflow">if</span> (p-&gt;tcp_local_q != 0) {</div>
<div class="line">                <span class="keywordtype">int</span> status = app_link_filter_tcp_add(p, cp);</div>
<div class="line"></div>
<div class="line">                APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;Adding TCP filter &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%08&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;tcp_local_q,</div>
<div class="line">                    cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (status)</div>
<div class="line">                    <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Error adding TCP &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;filter (queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;IP = 0x%08&quot;</span> PRIx32</div>
<div class="line">                        <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                        p-&gt;name, p-&gt;pmd_id,</div>
<div class="line">                        p-&gt;tcp_local_q, cp-&gt;ip, status);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* UDP */</span></div>
<div class="line">            <span class="keywordflow">if</span> (p-&gt;udp_local_q != 0) {</div>
<div class="line">                <span class="keywordtype">int</span> status = app_link_filter_udp_add(p, cp);</div>
<div class="line"></div>
<div class="line">                APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;Adding UDP filter &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%08&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;udp_local_q,</div>
<div class="line">                    cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (status)</div>
<div class="line">                    <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Error adding UDP &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;filter (queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;IP = 0x%08&quot;</span> PRIx32</div>
<div class="line">                        <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                        p-&gt;name, p-&gt;pmd_id,</div>
<div class="line">                        p-&gt;udp_local_q, cp-&gt;ip, status);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* SCTP */</span></div>
<div class="line">            <span class="keywordflow">if</span> (p-&gt;sctp_local_q != 0) {</div>
<div class="line">                <span class="keywordtype">int</span> status = app_link_filter_sctp_add(p, cp);</div>
<div class="line"></div>
<div class="line">                APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;): Adding SCTP filter &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%08&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;sctp_local_q,</div>
<div class="line">                    cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (status)</div>
<div class="line">                    <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Error adding SCTP &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;filter (queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;IP = 0x%08&quot;</span> PRIx32</div>
<div class="line">                        <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                        p-&gt;name, p-&gt;pmd_id,</div>
<div class="line">                        p-&gt;sctp_local_q, cp-&gt;ip,</div>
<div class="line">                        status);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* PMD link up */</span></div>
<div class="line">    status = <a name="a18"></a><a class="code" href="rte__ethdev_8h.html#ad29198523ea850aa2045bc8654f62574">rte_eth_dev_set_link_up</a>(cp-&gt;pmd_id);</div>
<div class="line">    <span class="keywordflow">if</span> (status &lt; 0)</div>
<div class="line">        <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): PMD set link up error %&quot;</span></div>
<div class="line">            PRId32 <span class="stringliteral">&quot;\n&quot;</span>, cp-&gt;name, cp-&gt;pmd_id, status);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Mark link as UP */</span></div>
<div class="line">    cp-&gt;state = 1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">app_link_down_internal(<span class="keyword">struct</span> app_params *app, <span class="keyword">struct</span> app_link_params *cp)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app_link_is_virtual(cp)) {</div>
<div class="line">        cp-&gt;state = 0;</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* PMD link down */</span></div>
<div class="line">    status = <a name="a19"></a><a class="code" href="rte__ethdev_8h.html#a1fd9012303eae348ada932a671b752bc">rte_eth_dev_set_link_down</a>(cp-&gt;pmd_id);</div>
<div class="line">    <span class="keywordflow">if</span> (status &lt; 0)</div>
<div class="line">        <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): PMD set link down error %&quot;</span></div>
<div class="line">            PRId32 <span class="stringliteral">&quot;\n&quot;</span>, cp-&gt;name, cp-&gt;pmd_id, status);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Mark link as DOWN */</span></div>
<div class="line">    cp-&gt;state = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Return if current link IP is not valid */</span></div>
<div class="line">    <span class="keywordflow">if</span> (cp-&gt;ip == 0)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* For each link, remove filters for IP of current link */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_links; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_link_params *p = &amp;app-&gt;link_params[i];</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* IP */</span></div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;ip_local_q != 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status = app_link_filter_ip_del(p, cp);</div>
<div class="line"></div>
<div class="line">            APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                <span class="stringliteral">&quot;): Deleting IP filter &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                p-&gt;name, p-&gt;pmd_id, p-&gt;ip_local_q, cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (status)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;): Error deleting IP filter &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32</div>
<div class="line">                    <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;ip_local_q,</div>
<div class="line">                    cp-&gt;ip, status);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* TCP */</span></div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;tcp_local_q != 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status = app_link_filter_tcp_del(p, cp);</div>
<div class="line"></div>
<div class="line">            APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                <span class="stringliteral">&quot;): Deleting TCP filter &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                p-&gt;name, p-&gt;pmd_id, p-&gt;tcp_local_q, cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (status)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;): Error deleting TCP filter &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32</div>
<div class="line">                    <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;tcp_local_q,</div>
<div class="line">                    cp-&gt;ip, status);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* UDP */</span></div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;udp_local_q != 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status = app_link_filter_udp_del(p, cp);</div>
<div class="line"></div>
<div class="line">            APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                <span class="stringliteral">&quot;): Deleting UDP filter &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32 <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                p-&gt;name, p-&gt;pmd_id, p-&gt;udp_local_q, cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (status)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;): Error deleting UDP filter &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32</div>
<div class="line">                    <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;udp_local_q,</div>
<div class="line">                    cp-&gt;ip, status);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* SCTP */</span></div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;sctp_local_q != 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status = app_link_filter_sctp_del(p, cp);</div>
<div class="line"></div>
<div class="line">            APP_LOG(app, LOW, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                <span class="stringliteral">&quot;): Deleting SCTP filter &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line">                p-&gt;name, p-&gt;pmd_id, p-&gt;sctp_local_q, cp-&gt;ip);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (status)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;): Error deleting SCTP filter &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;(queue = %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot;, IP = 0x%&quot;</span> PRIx32</div>
<div class="line">                    <span class="stringliteral">&quot;) (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                    p-&gt;name, p-&gt;pmd_id, p-&gt;sctp_local_q,</div>
<div class="line">                    cp-&gt;ip, status);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_check_link(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t all_links_up, i;</div>
<div class="line"></div>
<div class="line">    all_links_up = 1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_links; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_link_params *p = &amp;app-&gt;link_params[i];</div>
<div class="line">        <span class="keyword">struct </span><a name="_a20"></a><a class="code" href="structrte__eth__link.html">rte_eth_link</a> link_params;</div>
<div class="line"></div>
<div class="line">        memset(&amp;link_params, 0, <span class="keyword">sizeof</span>(link_params));</div>
<div class="line">        <a name="a21"></a><a class="code" href="rte__ethdev_8h.html#a1ceaee11c58efd9c12ef7d2f99f87445">rte_eth_link_get</a>(p-&gt;pmd_id, &amp;link_params);</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, HIGH, <span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;) (%&quot;</span> PRIu32 <span class="stringliteral">&quot; Gbps) %s&quot;</span>,</div>
<div class="line">            p-&gt;name,</div>
<div class="line">            p-&gt;pmd_id,</div>
<div class="line">            link_params.link_speed / 1000,</div>
<div class="line">            link_params.link_status ? <span class="stringliteral">&quot;UP&quot;</span> : <span class="stringliteral">&quot;DOWN&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (link_params.link_status == <a name="a22"></a><a class="code" href="rte__ethdev_8h.html#a08c012f37e07726170ff67daf667d850">ETH_LINK_DOWN</a>)</div>
<div class="line">            all_links_up = 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (all_links_up == 0)</div>
<div class="line">        <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Some links are DOWN\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> uint32_t</div>
<div class="line">is_any_swq_frag_or_ras(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_pktq_swq; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pktq_swq_params *p = &amp;app-&gt;swq_params[i];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((p-&gt;ipv4_frag == 1) || (p-&gt;ipv6_frag == 1) ||</div>
<div class="line">            (p-&gt;ipv4_ras == 1) || (p-&gt;ipv6_ras == 1))</div>
<div class="line">            <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_link_frag_ras(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (is_any_swq_frag_or_ras(app)) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_pktq_hwq_out; i++) {</div>
<div class="line">            <span class="keyword">struct </span>app_pktq_hwq_out_params *p_txq = &amp;app-&gt;hwq_out_params[i];</div>
<div class="line"></div>
<div class="line">            p_txq-&gt;conf.txq_flags &amp;= ~<a name="a23"></a><a class="code" href="rte__ethdev_8h.html#a4902a1d01782ecc690203f9e9df25ee9">ETH_TXQ_FLAGS_NOMULTSEGS</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">app_get_cpu_socket_id(uint32_t pmd_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> status = rte_eth_dev_socket_id(pmd_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (status != <a name="a24"></a><a class="code" href="rte__memory_8h.html#a0307f4470d3f391102b0f489fc7d91b5">SOCKET_ID_ANY</a>) ? status : 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_link(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    app_init_link_frag_ras(app);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_links; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_link_params *p_link = &amp;app-&gt;link_params[i];</div>
<div class="line">        uint32_t link_id, n_hwq_in, n_hwq_out, j;</div>
<div class="line">        <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">        sscanf(p_link-&gt;name, <span class="stringliteral">&quot;LINK%&quot;</span> PRIu32, &amp;link_id);</div>
<div class="line">        n_hwq_in = app_link_get_n_rxq(app, p_link);</div>
<div class="line">        n_hwq_out = app_link_get_n_txq(app, p_link);</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing %s (%&quot;</span> PRIu32<span class="stringliteral">&quot;) &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;(%&quot;</span> PRIu32 <span class="stringliteral">&quot; RXQ, %&quot;</span> PRIu32 <span class="stringliteral">&quot; TXQ) ...&quot;</span>,</div>
<div class="line">            p_link-&gt;name,</div>
<div class="line">            p_link-&gt;pmd_id,</div>
<div class="line">            n_hwq_in,</div>
<div class="line">            n_hwq_out);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* LINK */</span></div>
<div class="line">        status = <a name="a25"></a><a class="code" href="rte__ethdev_8h.html#ac30d075b4b206c7122e200164ce69893">rte_eth_dev_configure</a>(</div>
<div class="line">            p_link-&gt;pmd_id,</div>
<div class="line">            n_hwq_in,</div>
<div class="line">            n_hwq_out,</div>
<div class="line">            &amp;p_link-&gt;conf);</div>
<div class="line">        <span class="keywordflow">if</span> (status &lt; 0)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRId32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;init error (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                p_link-&gt;name, p_link-&gt;pmd_id, status);</div>
<div class="line"></div>
<div class="line">        <a name="a26"></a><a class="code" href="rte__ethdev_8h.html#a5686df2817980236f2c4f1cc72dd2c30">rte_eth_macaddr_get</a>(p_link-&gt;pmd_id,</div>
<div class="line">            (<span class="keyword">struct</span> <a name="_a27"></a><a class="code" href="structether__addr.html">ether_addr</a> *) &amp;p_link-&gt;mac_addr);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (p_link-&gt;promisc)</div>
<div class="line">            <a name="a28"></a><a class="code" href="rte__ethdev_8h.html#aa8064b25aee324bdbbf779ea23d55f49">rte_eth_promiscuous_enable</a>(p_link-&gt;pmd_id);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* RXQ */</span></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; app-&gt;n_pktq_hwq_in; j++) {</div>
<div class="line">            <span class="keyword">struct </span>app_pktq_hwq_in_params *p_rxq =</div>
<div class="line">                &amp;app-&gt;hwq_in_params[j];</div>
<div class="line">            uint32_t rxq_link_id, rxq_queue_id;</div>
<div class="line"></div>
<div class="line">            sscanf(p_rxq-&gt;name, <span class="stringliteral">&quot;RXQ%&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32,</div>
<div class="line">                &amp;rxq_link_id, &amp;rxq_queue_id);</div>
<div class="line">            <span class="keywordflow">if</span> (rxq_link_id != link_id)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">            status = <a name="a29"></a><a class="code" href="rte__ethdev_8h.html#a8db38c1bb895250a99b217bb24126d8e">rte_eth_rx_queue_setup</a>(</div>
<div class="line">                p_link-&gt;pmd_id,</div>
<div class="line">                rxq_queue_id,</div>
<div class="line">                p_rxq-&gt;size,</div>
<div class="line">                app_get_cpu_socket_id(p_link-&gt;pmd_id),</div>
<div class="line">                &amp;p_rxq-&gt;conf,</div>
<div class="line">                app-&gt;mempool[p_rxq-&gt;mempool_id]);</div>
<div class="line">            <span class="keywordflow">if</span> (status &lt; 0)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;%s init error (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                    p_link-&gt;name,</div>
<div class="line">                    p_link-&gt;pmd_id,</div>
<div class="line">                    p_rxq-&gt;name,</div>
<div class="line">                    status);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* TXQ */</span></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; app-&gt;n_pktq_hwq_out; j++) {</div>
<div class="line">            <span class="keyword">struct </span>app_pktq_hwq_out_params *p_txq =</div>
<div class="line">                &amp;app-&gt;hwq_out_params[j];</div>
<div class="line">            uint32_t txq_link_id, txq_queue_id;</div>
<div class="line"></div>
<div class="line">            sscanf(p_txq-&gt;name, <span class="stringliteral">&quot;TXQ%&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32,</div>
<div class="line">                &amp;txq_link_id, &amp;txq_queue_id);</div>
<div class="line">            <span class="keywordflow">if</span> (txq_link_id != link_id)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">            status = <a name="a30"></a><a class="code" href="rte__ethdev_8h.html#af4b9fe682d4487fb3efecc40d08d04a7">rte_eth_tx_queue_setup</a>(</div>
<div class="line">                p_link-&gt;pmd_id,</div>
<div class="line">                txq_queue_id,</div>
<div class="line">                p_txq-&gt;size,</div>
<div class="line">                app_get_cpu_socket_id(p_link-&gt;pmd_id),</div>
<div class="line">                &amp;p_txq-&gt;conf);</div>
<div class="line">            <span class="keywordflow">if</span> (status &lt; 0)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s (%&quot;</span> PRIu32 <span class="stringliteral">&quot;): &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;%s init error (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                    p_link-&gt;name,</div>
<div class="line">                    p_link-&gt;pmd_id,</div>
<div class="line">                    p_txq-&gt;name,</div>
<div class="line">                    status);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* LINK START */</span></div>
<div class="line">        status = <a name="a31"></a><a class="code" href="rte__ethdev_8h.html#ab6cdec593efa6b9809e711ade3a2fe24">rte_eth_dev_start</a>(p_link-&gt;pmd_id);</div>
<div class="line">        <span class="keywordflow">if</span> (status &lt; 0)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Cannot start %s (error %&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                p_link-&gt;name, status);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* LINK UP */</span></div>
<div class="line">        app_link_set_arp_filter(app, p_link);</div>
<div class="line">        app_link_set_tcp_syn_filter(app, p_link);</div>
<div class="line">        app_link_up_internal(app, p_link);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    app_check_link(app);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_swq(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_pktq_swq; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pktq_swq_params *p = &amp;app-&gt;swq_params[i];</div>
<div class="line">        <span class="keywordtype">unsigned</span> flags = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (app_swq_get_readers(app, p) == 1)</div>
<div class="line">            flags |= <a name="a32"></a><a class="code" href="rte__ring_8h.html#a421a61b2f94cdf65b3a6ac146c492fb9">RING_F_SC_DEQ</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (app_swq_get_writers(app, p) == 1)</div>
<div class="line">            flags |= <a name="a33"></a><a class="code" href="rte__ring_8h.html#a127c66adbeab4653a47649993b94f35b">RING_F_SP_ENQ</a>;</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing %s...&quot;</span>, p-&gt;name);</div>
<div class="line">        app-&gt;swq[i] = <a name="a34"></a><a class="code" href="rte__ring_8h.html#a5556487d8ec76cacfc059b66d8b77c98">rte_ring_create</a>(</div>
<div class="line">                p-&gt;name,</div>
<div class="line">                p-&gt;size,</div>
<div class="line">                p-&gt;cpu_socket_id,</div>
<div class="line">                flags);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (app-&gt;swq[i] == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s init error\n&quot;</span>, p-&gt;name);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_tm(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_pktq_tm; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pktq_tm_params *p_tm = &amp;app-&gt;tm_params[i];</div>
<div class="line">        <span class="keyword">struct </span>app_link_params *p_link;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structrte__eth__link.html">rte_eth_link</a> link_eth_params;</div>
<div class="line">        <span class="keyword">struct </span>rte_sched_port *sched;</div>
<div class="line">        uint32_t n_subports, subport_id;</div>
<div class="line">        <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">        p_link = app_get_link_for_tm(app, p_tm);</div>
<div class="line">        <span class="comment">/* LINK */</span></div>
<div class="line">        <a class="code" href="rte__ethdev_8h.html#a1ceaee11c58efd9c12ef7d2f99f87445">rte_eth_link_get</a>(p_link-&gt;pmd_id, &amp;link_eth_params);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* TM */</span></div>
<div class="line">        p_tm-&gt;sched_port_params.name = p_tm-&gt;name;</div>
<div class="line">        p_tm-&gt;sched_port_params.socket =</div>
<div class="line">            app_get_cpu_socket_id(p_link-&gt;pmd_id);</div>
<div class="line">        p_tm-&gt;sched_port_params.rate =</div>
<div class="line">            (uint64_t) link_eth_params.link_speed * 1000 * 1000 / 8;</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing %s ...&quot;</span>, p_tm-&gt;name);</div>
<div class="line">        sched = <a name="a35"></a><a class="code" href="rte__sched_8h.html#a496f8da1e648ee8600897f8c748bf56e">rte_sched_port_config</a>(&amp;p_tm-&gt;sched_port_params);</div>
<div class="line">        <span class="keywordflow">if</span> (sched == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s init error\n&quot;</span>, p_tm-&gt;name);</div>
<div class="line">        app-&gt;tm[i] = sched;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Subport */</span></div>
<div class="line">        n_subports = p_tm-&gt;sched_port_params.n_subports_per_port;</div>
<div class="line">        <span class="keywordflow">for</span> (subport_id = 0; subport_id &lt; n_subports; subport_id++) {</div>
<div class="line">            uint32_t n_pipes_per_subport, pipe_id;</div>
<div class="line"></div>
<div class="line">            status = <a name="a36"></a><a class="code" href="rte__sched_8h.html#a4e51de951a33f798bf28c3437b441b31">rte_sched_subport_config</a>(sched,</div>
<div class="line">                subport_id,</div>
<div class="line">                &amp;p_tm-&gt;sched_subport_params[subport_id]);</div>
<div class="line">            <span class="keywordflow">if</span> (status)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s subport %&quot;</span> PRIu32</div>
<div class="line">                    <span class="stringliteral">&quot; init error (%&quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                    p_tm-&gt;name, subport_id, status);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Pipe */</span></div>
<div class="line">            n_pipes_per_subport =</div>
<div class="line">                p_tm-&gt;sched_port_params.n_pipes_per_subport;</div>
<div class="line">            <span class="keywordflow">for</span> (pipe_id = 0;</div>
<div class="line">                pipe_id &lt; n_pipes_per_subport;</div>
<div class="line">                pipe_id++) {</div>
<div class="line">                <span class="keywordtype">int</span> profile_id = p_tm-&gt;sched_pipe_to_profile[</div>
<div class="line">                    subport_id * APP_MAX_SCHED_PIPES +</div>
<div class="line">                    pipe_id];</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (profile_id == -1)</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">                status = <a name="a37"></a><a class="code" href="rte__sched_8h.html#a21f6f073d054faab7e6a9683b8e0fe0f">rte_sched_pipe_config</a>(sched,</div>
<div class="line">                    subport_id,</div>
<div class="line">                    pipe_id,</div>
<div class="line">                    profile_id);</div>
<div class="line">                <span class="keywordflow">if</span> (status)</div>
<div class="line">                    <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s subport %&quot;</span> PRIu32</div>
<div class="line">                        <span class="stringliteral">&quot; pipe %&quot;</span> PRIu32</div>
<div class="line">                        <span class="stringliteral">&quot; (profile %&quot;</span> PRId32 <span class="stringliteral">&quot;) &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;init error (% &quot;</span> PRId32 <span class="stringliteral">&quot;)\n&quot;</span>,</div>
<div class="line">                        p_tm-&gt;name, subport_id, pipe_id,</div>
<div class="line">                        profile_id, status);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_msgq(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_msgq; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_msgq_params *p = &amp;app-&gt;msgq_params[i];</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing %s ...&quot;</span>, p-&gt;name);</div>
<div class="line">        app-&gt;msgq[i] = <a class="code" href="rte__ring_8h.html#a5556487d8ec76cacfc059b66d8b77c98">rte_ring_create</a>(</div>
<div class="line">                p-&gt;name,</div>
<div class="line">                p-&gt;size,</div>
<div class="line">                p-&gt;cpu_socket_id,</div>
<div class="line">                <a class="code" href="rte__ring_8h.html#a127c66adbeab4653a47649993b94f35b">RING_F_SP_ENQ</a> | <a class="code" href="rte__ring_8h.html#a421a61b2f94cdf65b3a6ac146c492fb9">RING_F_SC_DEQ</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (app-&gt;msgq[i] == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;%s init error\n&quot;</span>, p-&gt;name);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> app_pipeline_params_get(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    <span class="keyword">struct</span> app_pipeline_params *p_in,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_params *p_out)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line">    uint32_t mempool_id;</div>
<div class="line"></div>
<div class="line">    snprintf(p_out-&gt;name, PIPELINE_NAME_SIZE, <span class="stringliteral">&quot;%s&quot;</span>, p_in-&gt;name);</div>
<div class="line"></div>
<div class="line">    p_out-&gt;socket_id = (int) p_in-&gt;socket_id;</div>
<div class="line"></div>
<div class="line">    p_out-&gt;log_level = app-&gt;log_level;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* pktq_in */</span></div>
<div class="line">    p_out-&gt;n_ports_in = p_in-&gt;n_pktq_in;</div>
<div class="line">    for (i = 0; i &lt; p_in-&gt;n_pktq_in; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pktq_in_params *in = &amp;p_in-&gt;pktq_in[i];</div>
<div class="line">        <span class="keyword">struct </span>pipeline_port_in_params *out = &amp;p_out-&gt;port_in[i];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span> (in-&gt;type) {</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_IN_HWQ:</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">struct </span>app_pktq_hwq_in_params *p_hwq_in =</div>
<div class="line">                &amp;app-&gt;hwq_in_params[in-&gt;id];</div>
<div class="line">            <span class="keyword">struct </span>app_link_params *p_link =</div>
<div class="line">                app_get_link_for_rxq(app, p_hwq_in);</div>
<div class="line">            uint32_t rxq_link_id, rxq_queue_id;</div>
<div class="line"></div>
<div class="line">            sscanf(p_hwq_in-&gt;name, <span class="stringliteral">&quot;RXQ%&quot;</span> SCNu32 <span class="stringliteral">&quot;.%&quot;</span> SCNu32,</div>
<div class="line">                &amp;rxq_link_id,</div>
<div class="line">                &amp;rxq_queue_id);</div>
<div class="line"></div>
<div class="line">            out-&gt;type = PIPELINE_PORT_IN_ETHDEV_READER;</div>
<div class="line">            out-&gt;params.ethdev.port_id = p_link-&gt;pmd_id;</div>
<div class="line">            out-&gt;params.ethdev.queue_id = rxq_queue_id;</div>
<div class="line">            out-&gt;burst_size = p_hwq_in-&gt;burst;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_IN_SWQ:</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">struct </span>app_pktq_swq_params *swq_params = &amp;app-&gt;swq_params[in-&gt;id];</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ((swq_params-&gt;ipv4_frag == 0) &amp;&amp; (swq_params-&gt;ipv6_frag == 0)) {</div>
<div class="line">                <span class="keywordflow">if</span> (app_swq_get_readers(app, swq_params) == 1) {</div>
<div class="line">                    out-&gt;type = PIPELINE_PORT_IN_RING_READER;</div>
<div class="line">                    out-&gt;params.ring.ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                    out-&gt;burst_size = app-&gt;swq_params[in-&gt;id].burst_read;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    out-&gt;type = PIPELINE_PORT_IN_RING_MULTI_READER;</div>
<div class="line">                    out-&gt;params.ring_multi.ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                    out-&gt;burst_size = swq_params-&gt;burst_read;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (swq_params-&gt;ipv4_frag == 1) {</div>
<div class="line">                    <span class="keyword">struct </span>rte_port_ring_reader_ipv4_frag_params *params =</div>
<div class="line">                        &amp;out-&gt;params.ring_ipv4_frag;</div>
<div class="line"></div>
<div class="line">                    out-&gt;type = PIPELINE_PORT_IN_RING_READER_IPV4_FRAG;</div>
<div class="line">                    params-&gt;ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                    params-&gt;mtu = swq_params-&gt;mtu;</div>
<div class="line">                    params-&gt;metadata_size = swq_params-&gt;metadata_size;</div>
<div class="line">                    params-&gt;pool_direct =</div>
<div class="line">                        app-&gt;mempool[swq_params-&gt;mempool_direct_id];</div>
<div class="line">                    params-&gt;pool_indirect =</div>
<div class="line">                        app-&gt;mempool[swq_params-&gt;mempool_indirect_id];</div>
<div class="line">                    out-&gt;burst_size = swq_params-&gt;burst_read;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keyword">struct </span>rte_port_ring_reader_ipv6_frag_params *params =</div>
<div class="line">                        &amp;out-&gt;params.ring_ipv6_frag;</div>
<div class="line"></div>
<div class="line">                    out-&gt;type = PIPELINE_PORT_IN_RING_READER_IPV6_FRAG;</div>
<div class="line">                    params-&gt;ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                    params-&gt;mtu = swq_params-&gt;mtu;</div>
<div class="line">                    params-&gt;metadata_size = swq_params-&gt;metadata_size;</div>
<div class="line">                    params-&gt;pool_direct =</div>
<div class="line">                        app-&gt;mempool[swq_params-&gt;mempool_direct_id];</div>
<div class="line">                    params-&gt;pool_indirect =</div>
<div class="line">                        app-&gt;mempool[swq_params-&gt;mempool_indirect_id];</div>
<div class="line">                    out-&gt;burst_size = swq_params-&gt;burst_read;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_IN_TM:</div>
<div class="line">            out-&gt;type = PIPELINE_PORT_IN_SCHED_READER;</div>
<div class="line">            out-&gt;params.sched.sched = app-&gt;tm[in-&gt;id];</div>
<div class="line">            out-&gt;burst_size = app-&gt;tm_params[in-&gt;id].burst_read;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_IN_SOURCE:</div>
<div class="line">            mempool_id = app-&gt;source_params[in-&gt;id].mempool_id;</div>
<div class="line">            out-&gt;type = PIPELINE_PORT_IN_SOURCE;</div>
<div class="line">            out-&gt;params.source.mempool = app-&gt;mempool[mempool_id];</div>
<div class="line">            out-&gt;burst_size = app-&gt;source_params[in-&gt;id].burst;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef RTE_NEXT_ABI</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="keywordflow">if</span> (app-&gt;source_params[in-&gt;id].file_name</div>
<div class="line">                != NULL) {</div>
<div class="line">                out-&gt;params.source.file_name = strdup(</div>
<div class="line">                    app-&gt;source_params[in-&gt;id].</div>
<div class="line">                    file_name);</div>
<div class="line">                <span class="keywordflow">if</span> (out-&gt;params.source.file_name == NULL) {</div>
<div class="line">                    out-&gt;params.source.</div>
<div class="line">                        n_bytes_per_pkt = 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                out-&gt;params.source.n_bytes_per_pkt =</div>
<div class="line">                    app-&gt;source_params[in-&gt;id].</div>
<div class="line">                    n_bytes_per_pkt;</div>
<div class="line">            }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* pktq_out */</span></div>
<div class="line">    p_out-&gt;n_ports_out = p_in-&gt;n_pktq_out;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p_in-&gt;n_pktq_out; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pktq_out_params *in = &amp;p_in-&gt;pktq_out[i];</div>
<div class="line">        <span class="keyword">struct </span>pipeline_port_out_params *out = &amp;p_out-&gt;port_out[i];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span> (in-&gt;type) {</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_OUT_HWQ:</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">struct </span>app_pktq_hwq_out_params *p_hwq_out =</div>
<div class="line">                &amp;app-&gt;hwq_out_params[in-&gt;id];</div>
<div class="line">            <span class="keyword">struct </span>app_link_params *p_link =</div>
<div class="line">                app_get_link_for_txq(app, p_hwq_out);</div>
<div class="line">            uint32_t txq_link_id, txq_queue_id;</div>
<div class="line"></div>
<div class="line">            sscanf(p_hwq_out-&gt;name,</div>
<div class="line">                <span class="stringliteral">&quot;TXQ%&quot;</span> SCNu32 <span class="stringliteral">&quot;.%&quot;</span> SCNu32,</div>
<div class="line">                &amp;txq_link_id,</div>
<div class="line">                &amp;txq_queue_id);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (p_hwq_out-&gt;dropless == 0) {</div>
<div class="line">                <span class="keyword">struct </span><a name="_a38"></a><a class="code" href="structrte__port__ethdev__writer__params.html">rte_port_ethdev_writer_params</a> *params =</div>
<div class="line">                    &amp;out-&gt;params.ethdev;</div>
<div class="line"></div>
<div class="line">                out-&gt;type = PIPELINE_PORT_OUT_ETHDEV_WRITER;</div>
<div class="line">                params-&gt;<a name="a39"></a><a class="code" href="structrte__port__ethdev__writer__params.html#aae6814cc8987b1899b9d94cb621857c3">port_id</a> = p_link-&gt;pmd_id;</div>
<div class="line">                params-&gt;<a name="a40"></a><a class="code" href="structrte__port__ethdev__writer__params.html#ad36dd41501a26e3cc7590d1d9a62cdb9">queue_id</a> = txq_queue_id;</div>
<div class="line">                params-&gt;<a name="a41"></a><a class="code" href="structrte__port__ethdev__writer__params.html#a9ed7dbe6241b97c9b68a9491e77c84d0">tx_burst_sz</a> =</div>
<div class="line">                    app-&gt;hwq_out_params[in-&gt;id].burst;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keyword">struct </span><a name="_a42"></a><a class="code" href="structrte__port__ethdev__writer__nodrop__params.html">rte_port_ethdev_writer_nodrop_params</a></div>
<div class="line">                    *params = &amp;out-&gt;params.ethdev_nodrop;</div>
<div class="line"></div>
<div class="line">                out-&gt;type =</div>
<div class="line">                    PIPELINE_PORT_OUT_ETHDEV_WRITER_NODROP;</div>
<div class="line">                params-&gt;<a name="a43"></a><a class="code" href="structrte__port__ethdev__writer__nodrop__params.html#aae6814cc8987b1899b9d94cb621857c3">port_id</a> = p_link-&gt;pmd_id;</div>
<div class="line">                params-&gt;<a name="a44"></a><a class="code" href="structrte__port__ethdev__writer__nodrop__params.html#ad36dd41501a26e3cc7590d1d9a62cdb9">queue_id</a> = txq_queue_id;</div>
<div class="line">                params-&gt;<a name="a45"></a><a class="code" href="structrte__port__ethdev__writer__nodrop__params.html#a9ed7dbe6241b97c9b68a9491e77c84d0">tx_burst_sz</a> = p_hwq_out-&gt;burst;</div>
<div class="line">                params-&gt;<a name="a46"></a><a class="code" href="structrte__port__ethdev__writer__nodrop__params.html#a0a4998932bd3a08a0b8221652fa39fc5">n_retries</a> = p_hwq_out-&gt;n_retries;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_OUT_SWQ:</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">struct </span>app_pktq_swq_params *swq_params = &amp;app-&gt;swq_params[in-&gt;id];</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ((swq_params-&gt;ipv4_ras == 0) &amp;&amp; (swq_params-&gt;ipv6_ras == 0)) {</div>
<div class="line">                <span class="keywordflow">if</span> (app_swq_get_writers(app, swq_params) == 1) {</div>
<div class="line">                    <span class="keywordflow">if</span> (app-&gt;swq_params[in-&gt;id].dropless == 0) {</div>
<div class="line">                        <span class="keyword">struct </span><a name="_a47"></a><a class="code" href="structrte__port__ring__writer__params.html">rte_port_ring_writer_params</a> *params =</div>
<div class="line">                            &amp;out-&gt;params.<a name="a48"></a><a class="code" href="structrte__port__ring__writer__params.html#a1dfc25cca5a340eff30700b60fd41339">ring</a>;</div>
<div class="line"></div>
<div class="line">                        out-&gt;type = PIPELINE_PORT_OUT_RING_WRITER;</div>
<div class="line">                        params-&gt;<a class="code" href="structrte__port__ring__writer__params.html#a1dfc25cca5a340eff30700b60fd41339">ring</a> = app-&gt;swq[in-&gt;id];</div>
<div class="line">                        params-&gt;<a name="a49"></a><a class="code" href="structrte__port__ring__writer__params.html#a9ed7dbe6241b97c9b68a9491e77c84d0">tx_burst_sz</a> =</div>
<div class="line">                            app-&gt;swq_params[in-&gt;id].burst_write;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keyword">struct </span><a name="_a50"></a><a class="code" href="structrte__port__ring__writer__nodrop__params.html">rte_port_ring_writer_nodrop_params</a></div>
<div class="line">                            *params = &amp;out-&gt;params.ring_nodrop;</div>
<div class="line"></div>
<div class="line">                        out-&gt;type =</div>
<div class="line">                            PIPELINE_PORT_OUT_RING_WRITER_NODROP;</div>
<div class="line">                        params-&gt;<a name="a51"></a><a class="code" href="structrte__port__ring__writer__nodrop__params.html#a1dfc25cca5a340eff30700b60fd41339">ring</a> = app-&gt;swq[in-&gt;id];</div>
<div class="line">                        params-&gt;<a name="a52"></a><a class="code" href="structrte__port__ring__writer__nodrop__params.html#a9ed7dbe6241b97c9b68a9491e77c84d0">tx_burst_sz</a> =</div>
<div class="line">                            app-&gt;swq_params[in-&gt;id].burst_write;</div>
<div class="line">                        params-&gt;<a name="a53"></a><a class="code" href="structrte__port__ring__writer__nodrop__params.html#a0a4998932bd3a08a0b8221652fa39fc5">n_retries</a> =</div>
<div class="line">                            app-&gt;swq_params[in-&gt;id].n_retries;</div>
<div class="line">                    }</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keywordflow">if</span> (swq_params-&gt;dropless == 0) {</div>
<div class="line">                        <span class="keyword">struct </span><a name="a54"></a><a class="code" href="rte__port__ring_8h.html#a2d9d2dfded5b5fbb5e55c8cd21491824">rte_port_ring_multi_writer_params</a> *params =</div>
<div class="line">                            &amp;out-&gt;params.ring_multi;</div>
<div class="line"></div>
<div class="line">                        out-&gt;type = PIPELINE_PORT_OUT_RING_MULTI_WRITER;</div>
<div class="line">                        params-&gt;ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                        params-&gt;tx_burst_sz = swq_params-&gt;burst_write;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        <span class="keyword">struct </span><a name="a55"></a><a class="code" href="rte__port__ring_8h.html#a088cb217c5f48215a65141d1a2a40bc4">rte_port_ring_multi_writer_nodrop_params</a></div>
<div class="line">                            *params = &amp;out-&gt;params.ring_multi_nodrop;</div>
<div class="line"></div>
<div class="line">                        out-&gt;type = PIPELINE_PORT_OUT_RING_MULTI_WRITER_NODROP;</div>
<div class="line">                        params-&gt;ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                        params-&gt;tx_burst_sz = swq_params-&gt;burst_write;</div>
<div class="line">                        params-&gt;n_retries = swq_params-&gt;n_retries;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                <span class="keywordflow">if</span> (swq_params-&gt;ipv4_ras == 1) {</div>
<div class="line">                    <span class="keyword">struct </span>rte_port_ring_writer_ipv4_ras_params *params =</div>
<div class="line">                        &amp;out-&gt;params.ring_ipv4_ras;</div>
<div class="line"></div>
<div class="line">                    out-&gt;type = PIPELINE_PORT_OUT_RING_WRITER_IPV4_RAS;</div>
<div class="line">                    params-&gt;ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                    params-&gt;tx_burst_sz = swq_params-&gt;burst_write;</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                    <span class="keyword">struct </span>rte_port_ring_writer_ipv6_ras_params *params =</div>
<div class="line">                        &amp;out-&gt;params.ring_ipv6_ras;</div>
<div class="line"></div>
<div class="line">                    out-&gt;type = PIPELINE_PORT_OUT_RING_WRITER_IPV6_RAS;</div>
<div class="line">                    params-&gt;ring = app-&gt;swq[in-&gt;id];</div>
<div class="line">                    params-&gt;tx_burst_sz = swq_params-&gt;burst_write;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_OUT_TM: {</div>
<div class="line">            <span class="keyword">struct </span><a name="_a56"></a><a class="code" href="structrte__port__sched__writer__params.html">rte_port_sched_writer_params</a> *params =</div>
<div class="line">                &amp;out-&gt;params.<a name="a57"></a><a class="code" href="structrte__port__sched__writer__params.html#afac65a177b53f7589c4bfd38423bde94">sched</a>;</div>
<div class="line"></div>
<div class="line">            out-&gt;type = PIPELINE_PORT_OUT_SCHED_WRITER;</div>
<div class="line">            params-&gt;<a class="code" href="structrte__port__sched__writer__params.html#afac65a177b53f7589c4bfd38423bde94">sched</a> = app-&gt;tm[in-&gt;id];</div>
<div class="line">            params-&gt;<a name="a58"></a><a class="code" href="structrte__port__sched__writer__params.html#a9ed7dbe6241b97c9b68a9491e77c84d0">tx_burst_sz</a> =</div>
<div class="line">                app-&gt;tm_params[in-&gt;id].burst_write;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">case</span> APP_PKTQ_OUT_SINK:</div>
<div class="line">            out-&gt;type = PIPELINE_PORT_OUT_SINK;</div>
<div class="line">            <span class="keywordflow">if</span> (app-&gt;sink_params[in-&gt;id].file_name != NULL) {</div>
<div class="line">                out-&gt;params.sink.file_name = strdup(</div>
<div class="line">                    app-&gt;sink_params[in-&gt;id].</div>
<div class="line">                    file_name);</div>
<div class="line">                <span class="keywordflow">if</span> (out-&gt;params.sink.file_name == NULL) {</div>
<div class="line">                    out-&gt;params.sink.max_n_pkts = 0;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                out-&gt;params.sink.max_n_pkts =</div>
<div class="line">                    app-&gt;sink_params[in-&gt;id].</div>
<div class="line">                    n_pkts_to_dump;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                out-&gt;params.sink.file_name = NULL;</div>
<div class="line">                out-&gt;params.sink.max_n_pkts = 0;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* msgq */</span></div>
<div class="line">    p_out-&gt;n_msgq = p_in-&gt;n_msgq_in;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p_in-&gt;n_msgq_in; i++)</div>
<div class="line">        p_out-&gt;msgq_in[i] = app-&gt;msgq[p_in-&gt;msgq_in[i]];</div>
<div class="line"></div>
<div class="line">    for (i = 0; i &lt; p_in-&gt;n_msgq_out; i++)</div>
<div class="line">        p_out-&gt;msgq_out[i] = app-&gt;msgq[p_in-&gt;msgq_out[i]];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* args */</span></div>
<div class="line">    p_out-&gt;n_args = p_in-&gt;n_args;</div>
<div class="line">    for (i = 0; i &lt; p_in-&gt;n_args; i++) {</div>
<div class="line">        p_out-&gt;args_name[i] = p_in-&gt;args_name[i];</div>
<div class="line">        p_out-&gt;args_value[i] = p_in-&gt;args_value[i];</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_pipelines(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t p_id;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (p_id = 0; p_id &lt; app-&gt;n_pipelines; p_id++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_params *params =</div>
<div class="line">            &amp;app-&gt;pipeline_params[p_id];</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_data *data = &amp;app-&gt;pipeline_data[p_id];</div>
<div class="line">        <span class="keyword">struct </span>pipeline_type *ptype;</div>
<div class="line">        <span class="keyword">struct </span>pipeline_params pp;</div>
<div class="line"></div>
<div class="line">        APP_LOG(app, HIGH, <span class="stringliteral">&quot;Initializing %s ...&quot;</span>, params-&gt;name);</div>
<div class="line"></div>
<div class="line">        ptype = app_pipeline_type_find(app, params-&gt;type);</div>
<div class="line">        <span class="keywordflow">if</span> (ptype == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Init error: Unknown pipeline type \&quot;%s\&quot;\n&quot;</span>,</div>
<div class="line">                params-&gt;type);</div>
<div class="line"></div>
<div class="line">        app_pipeline_params_get(app, params, &amp;pp);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Back-end */</span></div>
<div class="line">        data-&gt;be = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (ptype-&gt;be_ops-&gt;f_init) {</div>
<div class="line">            data-&gt;be = ptype-&gt;be_ops-&gt;f_init(&amp;pp, (<span class="keywordtype">void</span> *) app);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (data-&gt;be == NULL)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Pipeline instance \&quot;%s\&quot; back-end &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;init error\n&quot;</span>, params-&gt;name);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Front-end */</span></div>
<div class="line">        data-&gt;fe = NULL;</div>
<div class="line">        <span class="keywordflow">if</span> (ptype-&gt;fe_ops-&gt;f_init) {</div>
<div class="line">            data-&gt;fe = ptype-&gt;fe_ops-&gt;f_init(&amp;pp, (<span class="keywordtype">void</span> *) app);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (data-&gt;fe == NULL)</div>
<div class="line">                <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Pipeline instance \&quot;%s\&quot; front-end &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;init error\n&quot;</span>, params-&gt;name);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        data-&gt;ptype = ptype;</div>
<div class="line"></div>
<div class="line">        data-&gt;timer_period = (<a name="a59"></a><a class="code" href="rte__cycles_8h.html#ae016e608f344823e677819d8f04264c5">rte_get_tsc_hz</a>() *</div>
<div class="line">            params-&gt;timer_period) / 100;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">app_init_threads(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint64_t time = <a name="a60"></a><a class="code" href="rte__cycles_8h.html#a34aaedfb8b9fa4f83d4cb3108cda2041">rte_get_tsc_cycles</a>();</div>
<div class="line">    uint32_t p_id;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (p_id = 0; p_id &lt; app-&gt;n_pipelines; p_id++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_params *params =</div>
<div class="line">            &amp;app-&gt;pipeline_params[p_id];</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_data *data = &amp;app-&gt;pipeline_data[p_id];</div>
<div class="line">        <span class="keyword">struct </span>pipeline_type *ptype;</div>
<div class="line">        <span class="keyword">struct </span>app_thread_data *t;</div>
<div class="line">        <span class="keyword">struct </span>app_thread_pipeline_data *p;</div>
<div class="line">        <span class="keywordtype">int</span> lcore_id;</div>
<div class="line"></div>
<div class="line">        lcore_id = cpu_core_map_get_lcore_id(app-&gt;core_map,</div>
<div class="line">            params-&gt;socket_id,</div>
<div class="line">            params-&gt;core_id,</div>
<div class="line">            params-&gt;hyper_th_id);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (lcore_id &lt; 0)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Invalid core s%&quot;</span> PRIu32 <span class="stringliteral">&quot;c%&quot;</span> PRIu32 <span class="stringliteral">&quot;%s\n&quot;</span>,</div>
<div class="line">                params-&gt;socket_id,</div>
<div class="line">                params-&gt;core_id,</div>
<div class="line">                (params-&gt;hyper_th_id) ? <span class="stringliteral">&quot;h&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"></div>
<div class="line">        t = &amp;app-&gt;thread_data[lcore_id];</div>
<div class="line"></div>
<div class="line">        t-&gt;timer_period = (<a class="code" href="rte__cycles_8h.html#ae016e608f344823e677819d8f04264c5">rte_get_tsc_hz</a>() * APP_THREAD_TIMER_PERIOD) / 1000;</div>
<div class="line">        t-&gt;thread_req_deadline = time + t-&gt;timer_period;</div>
<div class="line"></div>
<div class="line">        t-&gt;headroom_cycles = 0;</div>
<div class="line">        t-&gt;headroom_time = <a class="code" href="rte__cycles_8h.html#a34aaedfb8b9fa4f83d4cb3108cda2041">rte_get_tsc_cycles</a>();</div>
<div class="line">        t-&gt;headroom_ratio = 0.0;</div>
<div class="line"></div>
<div class="line">        t-&gt;msgq_in = app_thread_msgq_in_get(app,</div>
<div class="line">                params-&gt;socket_id,</div>
<div class="line">                params-&gt;core_id,</div>
<div class="line">                params-&gt;hyper_th_id);</div>
<div class="line">        <span class="keywordflow">if</span> (t-&gt;msgq_in == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Init error: Cannot find MSGQ_IN for thread %&quot;</span> PRId32,</div>
<div class="line">                lcore_id);</div>
<div class="line"></div>
<div class="line">        t-&gt;msgq_out = app_thread_msgq_out_get(app,</div>
<div class="line">                params-&gt;socket_id,</div>
<div class="line">                params-&gt;core_id,</div>
<div class="line">                params-&gt;hyper_th_id);</div>
<div class="line">        <span class="keywordflow">if</span> (t-&gt;msgq_out == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Init error: Cannot find MSGQ_OUT for thread %&quot;</span> PRId32,</div>
<div class="line">                lcore_id);</div>
<div class="line"></div>
<div class="line">        ptype = app_pipeline_type_find(app, params-&gt;type);</div>
<div class="line">        <span class="keywordflow">if</span> (ptype == NULL)</div>
<div class="line">            <a class="code" href="rte__debug_8h.html#a9fcab5683ce1c1164c52c17579cc2b5f">rte_panic</a>(<span class="stringliteral">&quot;Init error: Unknown pipeline &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;type \&quot;%s\&quot;\n&quot;</span>, params-&gt;type);</div>
<div class="line"></div>
<div class="line">        p = (ptype-&gt;be_ops-&gt;f_run == NULL) ?</div>
<div class="line">            &amp;t-&gt;regular[t-&gt;n_regular] :</div>
<div class="line">            &amp;t-&gt;custom[t-&gt;n_custom];</div>
<div class="line"></div>
<div class="line">        p-&gt;pipeline_id = p_id;</div>
<div class="line">        p-&gt;be = data-&gt;be;</div>
<div class="line">        p-&gt;f_run = ptype-&gt;be_ops-&gt;f_run;</div>
<div class="line">        p-&gt;f_timer = ptype-&gt;be_ops-&gt;f_timer;</div>
<div class="line">        p-&gt;timer_period = data-&gt;timer_period;</div>
<div class="line">        p-&gt;deadline = time + data-&gt;timer_period;</div>
<div class="line"></div>
<div class="line">        data-&gt;enabled = 1;</div>
<div class="line"></div>
<div class="line">        if (ptype-&gt;be_ops-&gt;f_run == NULL)</div>
<div class="line">            t-&gt;n_regular++;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            t-&gt;n_custom++;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> app_init(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    app_init_core_map(app);</div>
<div class="line">    app_init_core_mask(app);</div>
<div class="line"></div>
<div class="line">    app_init_eal(app);</div>
<div class="line">    app_init_mempool(app);</div>
<div class="line">    app_init_link(app);</div>
<div class="line">    app_init_swq(app);</div>
<div class="line">    app_init_tm(app);</div>
<div class="line">    app_init_msgq(app);</div>
<div class="line"></div>
<div class="line">    app_pipeline_common_cmd_push(app);</div>
<div class="line">    app_pipeline_thread_cmd_push(app);</div>
<div class="line">    app_pipeline_type_register(app, &amp;pipeline_master);</div>
<div class="line">    app_pipeline_type_register(app, &amp;pipeline_passthrough);</div>
<div class="line">    app_pipeline_type_register(app, &amp;pipeline_flow_classification);</div>
<div class="line">    app_pipeline_type_register(app, &amp;pipeline_flow_actions);</div>
<div class="line">    app_pipeline_type_register(app, &amp;pipeline_firewall);</div>
<div class="line">    app_pipeline_type_register(app, &amp;pipeline_routing);</div>
<div class="line"></div>
<div class="line">    app_init_pipelines(app);</div>
<div class="line">    app_init_threads(app);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_type_cmd_push(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_type *ptype)</div>
<div class="line">{</div>
<div class="line">    cmdline_parse_ctx_t *cmds;</div>
<div class="line">    uint32_t n_cmds, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (ptype == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"></div>
<div class="line">    n_cmds = pipeline_type_cmds_count(ptype);</div>
<div class="line">    <span class="keywordflow">if</span> (n_cmds == 0)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">    cmds = ptype-&gt;fe_ops-&gt;cmds;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check for available slots in the application commands array */</span></div>
<div class="line">    <span class="keywordflow">if</span> (n_cmds &gt; APP_MAX_CMDS - app-&gt;n_cmds)</div>
<div class="line">        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Push pipeline commands into the application */</span></div>
<div class="line">    memcpy(&amp;app-&gt;cmds[app-&gt;n_cmds],</div>
<div class="line">        cmds,</div>
<div class="line">        n_cmds * <span class="keyword">sizeof</span>(cmdline_parse_ctx_t));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_cmds; i++)</div>
<div class="line">        app-&gt;cmds[app-&gt;n_cmds + i]-&gt;data = app;</div>
<div class="line"></div>
<div class="line">    app-&gt;n_cmds += n_cmds;</div>
<div class="line">    app-&gt;cmds[app-&gt;n_cmds] = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_type_register(<span class="keyword">struct</span> app_params *app, <span class="keyword">struct</span> pipeline_type *ptype)</div>
<div class="line">{</div>
<div class="line">    uint32_t n_cmds, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (ptype == NULL) ||</div>
<div class="line">        (ptype-&gt;name == NULL) ||</div>
<div class="line">        (strlen(ptype-&gt;name) == 0) ||</div>
<div class="line">        (ptype-&gt;be_ops-&gt;f_init == NULL) ||</div>
<div class="line">        (ptype-&gt;be_ops-&gt;f_timer == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check for duplicate entry */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_pipeline_types; i++)</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(app-&gt;pipeline_type[i].name, ptype-&gt;name) == 0)</div>
<div class="line">            <span class="keywordflow">return</span> -EEXIST;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check for resource availability */</span></div>
<div class="line">    n_cmds = pipeline_type_cmds_count(ptype);</div>
<div class="line">    <span class="keywordflow">if</span> ((app-&gt;n_pipeline_types == APP_MAX_PIPELINE_TYPES) ||</div>
<div class="line">        (n_cmds &gt; APP_MAX_CMDS - app-&gt;n_cmds))</div>
<div class="line">        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Copy pipeline type */</span></div>
<div class="line">    memcpy(&amp;app-&gt;pipeline_type[app-&gt;n_pipeline_types++],</div>
<div class="line">        ptype,</div>
<div class="line">        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_type));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Copy CLI commands */</span></div>
<div class="line">    <span class="keywordflow">if</span> (n_cmds)</div>
<div class="line">        app_pipeline_type_cmd_push(app, ptype);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct</span></div>
<div class="line">pipeline_type *app_pipeline_type_find(<span class="keyword">struct</span> app_params *app, <span class="keywordtype">char</span> *name)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; app-&gt;n_pipeline_types; i++)</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(app-&gt;pipeline_type[i].name, name) == 0)</div>
<div class="line">            <span class="keywordflow">return</span> &amp;app-&gt;pipeline_type[i];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
