<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/thread_fe.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/thread_fe.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ring_8h.html">rte_ring.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_rdline.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_num.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_ipaddr.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_etheraddr.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cmdline_8h.html">cmdline.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;thread.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;thread_fe.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_common_fe.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;app.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *</div>
<div class="line">thread_msg_send_recv(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t socket_id, uint32_t core_id, uint32_t ht_id,</div>
<div class="line">    <span class="keywordtype">void</span> *msg,</div>
<div class="line">    uint32_t timeout_ms)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a0"></a><a class="code" href="structrte__ring.html">rte_ring</a> *r_req = app_thread_msgq_in_get(app,</div>
<div class="line">        socket_id, core_id, ht_id);</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__ring.html">rte_ring</a> *r_rsp = app_thread_msgq_out_get(app,</div>
<div class="line">        socket_id, core_id, ht_id);</div>
<div class="line">    uint64_t hz = <a name="a1"></a><a class="code" href="rte__cycles_8h.html#ae016e608f344823e677819d8f04264c5">rte_get_tsc_hz</a>();</div>
<div class="line">    <span class="keywordtype">void</span> *msg_recv;</div>
<div class="line">    uint64_t deadline;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* send */</span></div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        status = <a name="a2"></a><a class="code" href="rte__ring_8h.html#a644b1d6866fed20f0a5711e63ecefc38">rte_ring_sp_enqueue</a>(r_req, (<span class="keywordtype">void</span> *) msg);</div>
<div class="line">    } <span class="keywordflow">while</span> (status == -ENOBUFS);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* recv */</span></div>
<div class="line">    deadline = (timeout_ms) ?</div>
<div class="line">        (rte_rdtsc() + ((hz * timeout_ms) / 1000)) :</div>
<div class="line">        UINT64_MAX;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (rte_rdtsc() &gt; deadline)</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">        status = <a name="a3"></a><a class="code" href="rte__ring_8h.html#a242877d9dc94b252277d6336c31b53ae">rte_ring_sc_dequeue</a>(r_rsp, &amp;msg_recv);</div>
<div class="line">    } <span class="keywordflow">while</span> (status != 0);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> msg_recv;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_enable(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">        uint32_t socket_id,</div>
<div class="line">        uint32_t core_id,</div>
<div class="line">        uint32_t hyper_th_id,</div>
<div class="line">        uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>thread_pipeline_enable_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>thread_pipeline_enable_msg_rsp *rsp;</div>
<div class="line">    <span class="keywordtype">int</span> thread_id;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_data *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_params *p_params;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_type *p_type;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    thread_id = cpu_core_map_get_lcore_id(app-&gt;core_map,</div>
<div class="line">            socket_id,</div>
<div class="line">            core_id,</div>
<div class="line">            hyper_th_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((thread_id &lt; 0) ||</div>
<div class="line">        ((app-&gt;core_mask &amp; (1LLU &lt;&lt; thread_id)) == 0))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app_pipeline_data(app, pipeline_id) == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = &amp;app-&gt;pipeline_data[pipeline_id];</div>
<div class="line">    p_params = &amp;app-&gt;pipeline_params[pipeline_id];</div>
<div class="line">    p_type = app_pipeline_type_find(app, p_params-&gt;type);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;enabled == 1)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = THREAD_MSG_REQ_PIPELINE_ENABLE;</div>
<div class="line">    req-&gt;pipeline_id = pipeline_id;</div>
<div class="line">    req-&gt;be = p-&gt;be;</div>
<div class="line">    req-&gt;f_run = p_type-&gt;be_ops-&gt;f_run;</div>
<div class="line">    req-&gt;f_timer = p_type-&gt;be_ops-&gt;f_timer;</div>
<div class="line">    req-&gt;timer_period = p-&gt;timer_period;</div>
<div class="line"></div>
<div class="line">    rsp = thread_msg_send_recv(app,</div>
<div class="line">        socket_id, core_id, hyper_th_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    status = rsp-&gt;status;</div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p-&gt;enabled = 1;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_disable(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">        uint32_t socket_id,</div>
<div class="line">        uint32_t core_id,</div>
<div class="line">        uint32_t hyper_th_id,</div>
<div class="line">        uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>thread_pipeline_disable_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>thread_pipeline_disable_msg_rsp *rsp;</div>
<div class="line">    <span class="keywordtype">int</span> thread_id;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_data *p;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    thread_id = cpu_core_map_get_lcore_id(app-&gt;core_map,</div>
<div class="line">            socket_id,</div>
<div class="line">            core_id,</div>
<div class="line">            hyper_th_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((thread_id &lt; 0) ||</div>
<div class="line">        ((app-&gt;core_mask &amp; (1LLU &lt;&lt; thread_id)) == 0))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app_pipeline_data(app, pipeline_id) == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = &amp;app-&gt;pipeline_data[pipeline_id];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;enabled == 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = THREAD_MSG_REQ_PIPELINE_DISABLE;</div>
<div class="line">    req-&gt;pipeline_id = pipeline_id;</div>
<div class="line"></div>
<div class="line">    rsp = thread_msg_send_recv(app,</div>
<div class="line">        socket_id, core_id, hyper_th_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    status = rsp-&gt;status;</div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p-&gt;enabled = 0;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_thread_headroom(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">        uint32_t socket_id,</div>
<div class="line">        uint32_t core_id,</div>
<div class="line">        uint32_t hyper_th_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>thread_headroom_read_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>thread_headroom_read_msg_rsp *rsp;</div>
<div class="line">    <span class="keywordtype">int</span> thread_id;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    thread_id = cpu_core_map_get_lcore_id(app-&gt;core_map,</div>
<div class="line">            socket_id,</div>
<div class="line">            core_id,</div>
<div class="line">            hyper_th_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((thread_id &lt; 0) ||</div>
<div class="line">        ((app-&gt;core_mask &amp; (1LLU &lt;&lt; thread_id)) == 0))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = THREAD_MSG_REQ_HEADROOM_READ;</div>
<div class="line"></div>
<div class="line">    rsp = thread_msg_send_recv(app,</div>
<div class="line">        socket_id, core_id, hyper_th_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    status = rsp-&gt;status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;%.3f%%\n&quot;</span>, rsp-&gt;headroom_ratio * 100);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * pipeline enable</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_pipeline_enable_result {</div>
<div class="line">    cmdline_fixed_string_t t_string;</div>
<div class="line">    cmdline_fixed_string_t t_id_string;</div>
<div class="line">    cmdline_fixed_string_t pipeline_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t enable_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_pipeline_enable_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a name="a4"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">     <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_pipeline_enable_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line">    uint32_t core_id, socket_id, hyper_th_id;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (parse_pipeline_core(&amp;socket_id,</div>
<div class="line">            &amp;core_id,</div>
<div class="line">            &amp;hyper_th_id,</div>
<div class="line">            params-&gt;t_id_string) != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_enable(app,</div>
<div class="line">            socket_id,</div>
<div class="line">            core_id,</div>
<div class="line">            hyper_th_id,</div>
<div class="line">            params-&gt;pipeline_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_enable_t_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_enable_result, t_string, <span class="stringliteral">&quot;t&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_enable_t_id_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_enable_result, t_id_string,</div>
<div class="line">        NULL);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_enable_pipeline_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_enable_result, pipeline_string,</div>
<div class="line">        <span class="stringliteral">&quot;pipeline&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_pipeline_enable_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_enable_result, pipeline_id,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_enable_enable_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_enable_result, enable_string,</div>
<div class="line">        <span class="stringliteral">&quot;enable&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_pipeline_enable = {</div>
<div class="line">    .f = cmd_pipeline_enable_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Enable pipeline on specified core&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_enable_t_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_enable_t_id_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_enable_pipeline_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_enable_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_enable_enable_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * pipeline disable</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_pipeline_disable_result {</div>
<div class="line">    cmdline_fixed_string_t t_string;</div>
<div class="line">    cmdline_fixed_string_t t_id_string;</div>
<div class="line">    cmdline_fixed_string_t pipeline_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t disable_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_pipeline_disable_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">     <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_pipeline_disable_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line">    uint32_t core_id, socket_id, hyper_th_id;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (parse_pipeline_core(&amp;socket_id,</div>
<div class="line">            &amp;core_id,</div>
<div class="line">            &amp;hyper_th_id,</div>
<div class="line">            params-&gt;t_id_string) != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_disable(app,</div>
<div class="line">            socket_id,</div>
<div class="line">            core_id,</div>
<div class="line">            hyper_th_id,</div>
<div class="line">            params-&gt;pipeline_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_disable_t_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_disable_result, t_string, <span class="stringliteral">&quot;t&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_disable_t_id_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_disable_result, t_id_string,</div>
<div class="line">        NULL);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_disable_pipeline_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_disable_result,</div>
<div class="line">        pipeline_string, <span class="stringliteral">&quot;pipeline&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_pipeline_disable_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_disable_result, pipeline_id,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_pipeline_disable_disable_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_pipeline_disable_result, disable_string,</div>
<div class="line">        <span class="stringliteral">&quot;disable&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_pipeline_disable = {</div>
<div class="line">    .f = cmd_pipeline_disable_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Disable pipeline on specified core&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_disable_t_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_disable_t_id_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_disable_pipeline_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_disable_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_pipeline_disable_disable_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * thread headroom</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_thread_headroom_result {</div>
<div class="line">    cmdline_fixed_string_t t_string;</div>
<div class="line">    cmdline_fixed_string_t t_id_string;</div>
<div class="line">    cmdline_fixed_string_t headroom_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_thread_headroom_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">     <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_thread_headroom_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line">    uint32_t core_id, socket_id, hyper_th_id;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (parse_pipeline_core(&amp;socket_id,</div>
<div class="line">            &amp;core_id,</div>
<div class="line">            &amp;hyper_th_id,</div>
<div class="line">            params-&gt;t_id_string) != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = app_thread_headroom(app,</div>
<div class="line">            socket_id,</div>
<div class="line">            core_id,</div>
<div class="line">            hyper_th_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_thread_headroom_t_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_thread_headroom_result,</div>
<div class="line">    t_string, <span class="stringliteral">&quot;t&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_thread_headroom_t_id_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_thread_headroom_result,</div>
<div class="line">    t_id_string, NULL);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_thread_headroom_headroom_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_thread_headroom_result,</div>
<div class="line">        headroom_string, <span class="stringliteral">&quot;headroom&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_thread_headroom = {</div>
<div class="line">    .f = cmd_thread_headroom_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Display thread headroom&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_thread_headroom_t_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_thread_headroom_t_id_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_thread_headroom_headroom_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_ctx_t thread_cmds[] = {</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_pipeline_enable,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_pipeline_disable,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_thread_headroom,</div>
<div class="line">    NULL,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_thread_cmd_push(<span class="keyword">struct</span> app_params *app)</div>
<div class="line">{</div>
<div class="line">    uint32_t n_cmds, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check for available slots in the application commands array */</span></div>
<div class="line">    n_cmds = <a name="a5"></a><a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(thread_cmds) - 1;</div>
<div class="line">    <span class="keywordflow">if</span> (n_cmds &gt; APP_MAX_CMDS - app-&gt;n_cmds)</div>
<div class="line">        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Push thread commands into the application */</span></div>
<div class="line">    memcpy(&amp;app-&gt;cmds[app-&gt;n_cmds], thread_cmds,</div>
<div class="line">        n_cmds * <span class="keyword">sizeof</span>(cmdline_parse_ctx_t));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_cmds; i++)</div>
<div class="line">        app-&gt;cmds[app-&gt;n_cmds + i]-&gt;data = app;</div>
<div class="line"></div>
<div class="line">    app-&gt;n_cmds += n_cmds;</div>
<div class="line">    app-&gt;cmds[app-&gt;n_cmds] = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
