<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/pipeline/pipeline_passthrough_be.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/pipeline/pipeline_passthrough_be.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2016 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__byteorder_8h.html">rte_byteorder.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__table__stub_8h.html">rte_table_stub.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__table__hash_8h.html">rte_table_hash.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__pipeline_8h.html">rte_pipeline.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_passthrough_be.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_actions_common.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;parser.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hash_func.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_passthrough {</div>
<div class="line">    <span class="keyword">struct </span>pipeline p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_passthrough_params params;</div>
<div class="line">    <a name="a0"></a><a class="code" href="rte__table__hash_8h.html#a2b9cf2fd12b34cb416174eabcd443cca">rte_table_hash_op_hash</a> f_hash;</div>
<div class="line">} <a name="a1"></a><a class="code" href="rte__memory_8h.html#a1a29b3bf8655b79e8dca721c5e815aa4">__rte_cache_aligned</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> pipeline_msg_req_handler handlers[] = {</div>
<div class="line">    [PIPELINE_MSG_REQ_PING] =</div>
<div class="line">        pipeline_msg_req_ping_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_PORT_IN] =</div>
<div class="line">        pipeline_msg_req_stats_port_in_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_PORT_OUT] =</div>
<div class="line">        pipeline_msg_req_stats_port_out_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_TABLE] =</div>
<div class="line">        pipeline_msg_req_stats_table_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_PORT_IN_ENABLE] =</div>
<div class="line">        pipeline_msg_req_port_in_enable_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_PORT_IN_DISABLE] =</div>
<div class="line">        pipeline_msg_req_port_in_disable_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_CUSTOM] =</div>
<div class="line">        pipeline_msg_req_invalid_handler,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> __attribute__((always_inline)) void</div>
<div class="line">pkt_work(</div>
<div class="line">    struct <a name="_a2"></a><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkt,</div>
<div class="line">    <span class="keywordtype">void</span> *arg,</div>
<div class="line">    uint32_t dma_size,</div>
<div class="line">    uint32_t hash_enabled,</div>
<div class="line">    uint32_t lb_hash,</div>
<div class="line">    uint32_t port_out_pow2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_passthrough *p = arg;</div>
<div class="line"></div>
<div class="line">    uint64_t *dma_dst = <a name="a3"></a><a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkt,</div>
<div class="line">        p-&gt;params.dma_dst_offset);</div>
<div class="line">    uint64_t *dma_src = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkt,</div>
<div class="line">        p-&gt;params.dma_src_offset);</div>
<div class="line">    uint64_t *dma_mask = (uint64_t *) p-&gt;params.dma_src_mask;</div>
<div class="line">    uint32_t *dma_hash = <a name="a4"></a><a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkt,</div>
<div class="line">        p-&gt;params.dma_hash_offset);</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read (dma_src), compute (dma_dst), write (dma_dst) */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; (dma_size / 8); i++)</div>
<div class="line">        dma_dst[i] = dma_src[i] &amp; dma_mask[i];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read (dma_dst), compute (hash), write (hash) */</span></div>
<div class="line">    <span class="keywordflow">if</span> (hash_enabled) {</div>
<div class="line">        uint32_t hash = p-&gt;f_hash(dma_dst, dma_size, 0);</div>
<div class="line">        *dma_hash = hash;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (lb_hash) {</div>
<div class="line">            uint32_t port_out;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (port_out_pow2)</div>
<div class="line">                port_out</div>
<div class="line">                    = hash &amp; (p-&gt;p.n_ports_out - 1);</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                port_out</div>
<div class="line">                    = hash % p-&gt;p.n_ports_out;</div>
<div class="line"></div>
<div class="line">            <a name="a5"></a><a class="code" href="rte__pipeline_8h.html#a2abe46f84e0842eec2f0f52083706fc4">rte_pipeline_port_out_packet_insert</a>(p-&gt;p.p,</div>
<div class="line">                port_out, pkt);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> __attribute__((always_inline)) void</div>
<div class="line">pkt4_work(</div>
<div class="line">    struct <a class="code" href="structrte__mbuf.html">rte_mbuf</a> **pkts,</div>
<div class="line">    <span class="keywordtype">void</span> *arg,</div>
<div class="line">    uint32_t dma_size,</div>
<div class="line">    uint32_t hash_enabled,</div>
<div class="line">    uint32_t lb_hash,</div>
<div class="line">    uint32_t port_out_pow2)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_passthrough *p = arg;</div>
<div class="line"></div>
<div class="line">    uint64_t *dma_dst0 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[0],</div>
<div class="line">        p-&gt;params.dma_dst_offset);</div>
<div class="line">    uint64_t *dma_dst1 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[1],</div>
<div class="line">        p-&gt;params.dma_dst_offset);</div>
<div class="line">    uint64_t *dma_dst2 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[2],</div>
<div class="line">        p-&gt;params.dma_dst_offset);</div>
<div class="line">    uint64_t *dma_dst3 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[3],</div>
<div class="line">        p-&gt;params.dma_dst_offset);</div>
<div class="line"></div>
<div class="line">    uint64_t *dma_src0 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[0],</div>
<div class="line">        p-&gt;params.dma_src_offset);</div>
<div class="line">    uint64_t *dma_src1 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[1],</div>
<div class="line">        p-&gt;params.dma_src_offset);</div>
<div class="line">    uint64_t *dma_src2 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[2],</div>
<div class="line">        p-&gt;params.dma_src_offset);</div>
<div class="line">    uint64_t *dma_src3 = <a class="code" href="rte__port_8h.html#aac211161c49f1b4a84243a911421fd50">RTE_MBUF_METADATA_UINT64_PTR</a>(pkts[3],</div>
<div class="line">        p-&gt;params.dma_src_offset);</div>
<div class="line"></div>
<div class="line">    uint64_t *dma_mask = (uint64_t *) p-&gt;params.dma_src_mask;</div>
<div class="line"></div>
<div class="line">    uint32_t *dma_hash0 = <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[0],</div>
<div class="line">        p-&gt;params.dma_hash_offset);</div>
<div class="line">    uint32_t *dma_hash1 = <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[1],</div>
<div class="line">        p-&gt;params.dma_hash_offset);</div>
<div class="line">    uint32_t *dma_hash2 = <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[2],</div>
<div class="line">        p-&gt;params.dma_hash_offset);</div>
<div class="line">    uint32_t *dma_hash3 = <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[3],</div>
<div class="line">        p-&gt;params.dma_hash_offset);</div>
<div class="line"></div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read (dma_src), compute (dma_dst), write (dma_dst) */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; (dma_size / 8); i++) {</div>
<div class="line">        dma_dst0[i] = dma_src0[i] &amp; dma_mask[i];</div>
<div class="line">        dma_dst1[i] = dma_src1[i] &amp; dma_mask[i];</div>
<div class="line">        dma_dst2[i] = dma_src2[i] &amp; dma_mask[i];</div>
<div class="line">        dma_dst3[i] = dma_src3[i] &amp; dma_mask[i];</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read (dma_dst), compute (hash), write (hash) */</span></div>
<div class="line">    <span class="keywordflow">if</span> (hash_enabled) {</div>
<div class="line">        uint32_t hash0 = p-&gt;f_hash(dma_dst0, dma_size, 0);</div>
<div class="line">        uint32_t hash1 = p-&gt;f_hash(dma_dst1, dma_size, 0);</div>
<div class="line">        uint32_t hash2 = p-&gt;f_hash(dma_dst2, dma_size, 0);</div>
<div class="line">        uint32_t hash3 = p-&gt;f_hash(dma_dst3, dma_size, 0);</div>
<div class="line"></div>
<div class="line">        *dma_hash0 = hash0;</div>
<div class="line">        *dma_hash1 = hash1;</div>
<div class="line">        *dma_hash2 = hash2;</div>
<div class="line">        *dma_hash3 = hash3;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (lb_hash) {</div>
<div class="line">            uint32_t port_out0, port_out1, port_out2, port_out3;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (port_out_pow2) {</div>
<div class="line">                port_out0</div>
<div class="line">                    = hash0 &amp; (p-&gt;p.n_ports_out - 1);</div>
<div class="line">                port_out1</div>
<div class="line">                    = hash1 &amp; (p-&gt;p.n_ports_out - 1);</div>
<div class="line">                port_out2</div>
<div class="line">                    = hash2 &amp; (p-&gt;p.n_ports_out - 1);</div>
<div class="line">                port_out3</div>
<div class="line">                    = hash3 &amp; (p-&gt;p.n_ports_out - 1);</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                port_out0</div>
<div class="line">                    = hash0 % p-&gt;p.n_ports_out;</div>
<div class="line">                port_out1</div>
<div class="line">                    = hash1 % p-&gt;p.n_ports_out;</div>
<div class="line">                port_out2</div>
<div class="line">                    = hash2 % p-&gt;p.n_ports_out;</div>
<div class="line">                port_out3</div>
<div class="line">                    = hash3 % p-&gt;p.n_ports_out;</div>
<div class="line">            }</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a2abe46f84e0842eec2f0f52083706fc4">rte_pipeline_port_out_packet_insert</a>(p-&gt;p.p,</div>
<div class="line">                port_out0, pkts[0]);</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a2abe46f84e0842eec2f0f52083706fc4">rte_pipeline_port_out_packet_insert</a>(p-&gt;p.p,</div>
<div class="line">                port_out1, pkts[1]);</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a2abe46f84e0842eec2f0f52083706fc4">rte_pipeline_port_out_packet_insert</a>(p-&gt;p.p,</div>
<div class="line">                port_out2, pkts[2]);</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a2abe46f84e0842eec2f0f52083706fc4">rte_pipeline_port_out_packet_insert</a>(p-&gt;p.p,</div>
<div class="line">                port_out3, pkts[3]);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define PKT_WORK(dma_size, hash_enabled, lb_hash, port_pow2)    \</span></div>
<div class="line"><span class="preprocessor">static inline void                      \</span></div>
<div class="line"><span class="preprocessor">pkt_work_size##dma_size##_hash##hash_enabled        \</span></div>
<div class="line"><span class="preprocessor">    ##_lb##lb_hash##_pw##port_pow2(         \</span></div>
<div class="line"><span class="preprocessor">    struct rte_mbuf *pkt,                   \</span></div>
<div class="line"><span class="preprocessor">    void *arg)                      \</span></div>
<div class="line"><span class="preprocessor">{                               \</span></div>
<div class="line"><span class="preprocessor">    pkt_work(pkt, arg, dma_size, hash_enabled, lb_hash, port_pow2); \</span></div>
<div class="line"><span class="preprocessor">}</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define PKT4_WORK(dma_size, hash_enabled, lb_hash, port_pow2)   \</span></div>
<div class="line"><span class="preprocessor">static inline void                      \</span></div>
<div class="line"><span class="preprocessor">pkt4_work_size##dma_size##_hash##hash_enabled           \</span></div>
<div class="line"><span class="preprocessor">    ##_lb##lb_hash##_pw##port_pow2(         \</span></div>
<div class="line"><span class="preprocessor">    struct rte_mbuf **pkts,                 \</span></div>
<div class="line"><span class="preprocessor">    void *arg)                      \</span></div>
<div class="line"><span class="preprocessor">{                               \</span></div>
<div class="line"><span class="preprocessor">    pkt4_work(pkts, arg, dma_size, hash_enabled, lb_hash, port_pow2); \</span></div>
<div class="line"><span class="preprocessor">}</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define port_in_ah(dma_size, hash_enabled, lb_hash, port_pow2)  \</span></div>
<div class="line"><span class="preprocessor">PKT_WORK(dma_size, hash_enabled, lb_hash, port_pow2)            \</span></div>
<div class="line"><span class="preprocessor">PKT4_WORK(dma_size, hash_enabled, lb_hash, port_pow2)           \</span></div>
<div class="line"><span class="preprocessor">PIPELINE_PORT_IN_AH(port_in_ah_size##dma_size##_hash    \</span></div>
<div class="line"><span class="preprocessor">    ##hash_enabled##_lb##lb_hash##_pw##port_pow2,       \</span></div>
<div class="line"><span class="preprocessor">    pkt_work_size##dma_size##_hash##hash_enabled        \</span></div>
<div class="line"><span class="preprocessor">    ##_lb##lb_hash##_pw##port_pow2,         \</span></div>
<div class="line"><span class="preprocessor">    pkt4_work_size##dma_size##_hash##hash_enabled       \</span></div>
<div class="line"><span class="preprocessor">    ##_lb##lb_hash##_pw##port_pow2)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define port_in_ah_lb(dma_size, hash_enabled, lb_hash, port_pow2) \</span></div>
<div class="line"><span class="preprocessor">PKT_WORK(dma_size, hash_enabled, lb_hash, port_pow2)        \</span></div>
<div class="line"><span class="preprocessor">PKT4_WORK(dma_size, hash_enabled, lb_hash, port_pow2)   \</span></div>
<div class="line"><span class="preprocessor">PIPELINE_PORT_IN_AH_HIJACK_ALL(                     \</span></div>
<div class="line"><span class="preprocessor">    port_in_ah_size##dma_size##_hash##hash_enabled      \</span></div>
<div class="line"><span class="preprocessor">    ##_lb##lb_hash##_pw##port_pow2,         \</span></div>
<div class="line"><span class="preprocessor">    pkt_work_size##dma_size##_hash##hash_enabled        \</span></div>
<div class="line"><span class="preprocessor">    ##_lb##lb_hash##_pw##port_pow2, \</span></div>
<div class="line"><span class="preprocessor">    pkt4_work_size##dma_size##_hash##hash_enabled       \</span></div>
<div class="line"><span class="preprocessor">    ##_lb##lb_hash##_pw##port_pow2)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/* Port in AH (dma_size, hash_enabled, lb_hash, port_pow2) */</span></div>
<div class="line"></div>
<div class="line">port_in_ah(8, 0, 0, 0)</div>
<div class="line">port_in_ah(8, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(8, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(8, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">port_in_ah(16, 0, 0, 0)</div>
<div class="line">port_in_ah(16, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(16, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(16, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">port_in_ah(24, 0, 0, 0)</div>
<div class="line">port_in_ah(24, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(24, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(24, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">port_in_ah(32, 0, 0, 0)</div>
<div class="line">port_in_ah(32, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(32, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(32, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">port_in_ah(40, 0, 0, 0)</div>
<div class="line">port_in_ah(40, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(40, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(40, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">port_in_ah(48, 0, 0, 0)</div>
<div class="line">port_in_ah(48, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(48, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(48, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">port_in_ah(56, 0, 0, 0)</div>
<div class="line">port_in_ah(56, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(56, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(56, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">port_in_ah(64, 0, 0, 0)</div>
<div class="line">port_in_ah(64, 1, 0, 0)</div>
<div class="line">port_in_ah_lb(64, 1, 1, 0)</div>
<div class="line">port_in_ah_lb(64, 1, 1, 1)</div>
<div class="line"></div>
<div class="line">static <a name="a6"></a><a class="code" href="rte__pipeline_8h.html#a07e46798593a5225761fda51abd2e0e0">rte_pipeline_port_in_action_handler</a></div>
<div class="line">get_port_in_ah(struct pipeline_passthrough *p)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;params.dma_enabled == 0)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;params.dma_hash_enabled) {</div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;params.lb_hash_enabled) {</div>
<div class="line">            <span class="keywordflow">if</span> (<a name="a7"></a><a class="code" href="rte__common_8h.html#adf96e98b8f6bb0b22e8a8d3a0ac16e7d">rte_is_power_of_2</a>(p-&gt;p.n_ports_out))</div>
<div class="line">                <span class="keywordflow">switch</span> (p-&gt;params.dma_size) {</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">case</span> 8: <span class="keywordflow">return</span> port_in_ah_size8_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">case</span> 16: <span class="keywordflow">return</span> port_in_ah_size16_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">case</span> 24: <span class="keywordflow">return</span> port_in_ah_size24_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">case</span> 32: <span class="keywordflow">return</span> port_in_ah_size32_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">case</span> 40: <span class="keywordflow">return</span> port_in_ah_size40_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">case</span> 48: <span class="keywordflow">return</span> port_in_ah_size48_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">case</span> 56: <span class="keywordflow">return</span> port_in_ah_size56_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">case</span> 64: <span class="keywordflow">return</span> port_in_ah_size64_hash1_lb1_pw1;</div>
<div class="line">                <span class="keywordflow">default</span>: <span class="keywordflow">return</span> NULL;</div>
<div class="line">                }</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">switch</span> (p-&gt;params.dma_size) {</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">case</span> 8: <span class="keywordflow">return</span> port_in_ah_size8_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">case</span> 16: <span class="keywordflow">return</span> port_in_ah_size16_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">case</span> 24: <span class="keywordflow">return</span> port_in_ah_size24_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">case</span> 32: <span class="keywordflow">return</span> port_in_ah_size32_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">case</span> 40: <span class="keywordflow">return</span> port_in_ah_size40_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">case</span> 48: <span class="keywordflow">return</span> port_in_ah_size48_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">case</span> 56: <span class="keywordflow">return</span> port_in_ah_size56_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">case</span> 64: <span class="keywordflow">return</span> port_in_ah_size64_hash1_lb1_pw0;</div>
<div class="line">                <span class="keywordflow">default</span>: <span class="keywordflow">return</span> NULL;</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">switch</span> (p-&gt;params.dma_size) {</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">case</span> 8: <span class="keywordflow">return</span> port_in_ah_size8_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">case</span> 16: <span class="keywordflow">return</span> port_in_ah_size16_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">case</span> 24: <span class="keywordflow">return</span> port_in_ah_size24_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">case</span> 32: <span class="keywordflow">return</span> port_in_ah_size32_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">case</span> 40: <span class="keywordflow">return</span> port_in_ah_size40_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">case</span> 48: <span class="keywordflow">return</span> port_in_ah_size48_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">case</span> 56: <span class="keywordflow">return</span> port_in_ah_size56_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">case</span> 64: <span class="keywordflow">return</span> port_in_ah_size64_hash1_lb0_pw0;</div>
<div class="line">            <span class="keywordflow">default</span>: <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">switch</span> (p-&gt;params.dma_size) {</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> 8: <span class="keywordflow">return</span> port_in_ah_size8_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">case</span> 16: <span class="keywordflow">return</span> port_in_ah_size16_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">case</span> 24: <span class="keywordflow">return</span> port_in_ah_size24_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">case</span> 32: <span class="keywordflow">return</span> port_in_ah_size32_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">case</span> 40: <span class="keywordflow">return</span> port_in_ah_size40_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">case</span> 48: <span class="keywordflow">return</span> port_in_ah_size48_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">case</span> 56: <span class="keywordflow">return</span> port_in_ah_size56_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">case</span> 64: <span class="keywordflow">return</span> port_in_ah_size64_hash0_lb0_pw0;</div>
<div class="line">        <span class="keywordflow">default</span>: <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">pipeline_passthrough_parse_args(<span class="keyword">struct</span> pipeline_passthrough_params *p,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_params *params)</div>
<div class="line">{</div>
<div class="line">    uint32_t dma_dst_offset_present = 0;</div>
<div class="line">    uint32_t dma_src_offset_present = 0;</div>
<div class="line">    uint32_t dma_src_mask_present = 0;</div>
<div class="line">    uint32_t dma_size_present = 0;</div>
<div class="line">    uint32_t dma_hash_offset_present = 0;</div>
<div class="line">    uint32_t lb_present = 0;</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">char</span> dma_mask_str[PIPELINE_PASSTHROUGH_DMA_SIZE_MAX * 2];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* default values */</span></div>
<div class="line">    p-&gt;dma_enabled = 0;</div>
<div class="line">    p-&gt;dma_hash_enabled = 0;</div>
<div class="line">    p-&gt;lb_hash_enabled = 0;</div>
<div class="line">    memset(p-&gt;dma_src_mask, 0xFF, <span class="keyword">sizeof</span>(p-&gt;dma_src_mask));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params-&gt;n_args; i++) {</div>
<div class="line">        <span class="keywordtype">char</span> *arg_name = params-&gt;args_name[i];</div>
<div class="line">        <span class="keywordtype">char</span> *arg_value = params-&gt;args_value[i];</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* dma_dst_offset */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;dma_dst_offset&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                dma_dst_offset_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            dma_dst_offset_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;dma_dst_offset,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL((status != -EINVAL),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            p-&gt;dma_enabled = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* dma_src_offset */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;dma_src_offset&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                dma_src_offset_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            dma_src_offset_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;dma_src_offset,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL((status != -EINVAL),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            p-&gt;dma_enabled = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* dma_size */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;dma_size&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                dma_size_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            dma_size_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;dma_size,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL(((status != -EINVAL) &amp;&amp;</div>
<div class="line">                (p-&gt;dma_size != 0) &amp;&amp;</div>
<div class="line">                ((p-&gt;dma_size % 8) == 0)),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG(((status != -ERANGE) &amp;&amp;</div>
<div class="line">                (p-&gt;dma_size &lt;=</div>
<div class="line">                PIPELINE_PASSTHROUGH_DMA_SIZE_MAX)),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            p-&gt;dma_enabled = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* dma_src_mask */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;dma_src_mask&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> mask_str_len = strlen(arg_value);</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                dma_src_mask_present == 0,</div>
<div class="line">                params-&gt;name, arg_name);</div>
<div class="line">            dma_src_mask_present = 1;</div>
<div class="line"></div>
<div class="line">            PIPELINE_ARG_CHECK((mask_str_len &lt;</div>
<div class="line">                (PIPELINE_PASSTHROUGH_DMA_SIZE_MAX * 2)),</div>
<div class="line">                <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: entry &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;\&quot;%s\&quot; too long&quot;</span>, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line"></div>
<div class="line">            snprintf(dma_mask_str, mask_str_len + 1,</div>
<div class="line">                <span class="stringliteral">&quot;%s&quot;</span>, arg_value);</div>
<div class="line"></div>
<div class="line">            p-&gt;dma_enabled = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* dma_hash_offset */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;dma_hash_offset&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                dma_hash_offset_present == 0,</div>
<div class="line">                params-&gt;name, arg_name);</div>
<div class="line">            dma_hash_offset_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;dma_hash_offset,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL((status != -EINVAL),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            p-&gt;dma_hash_enabled = 1;</div>
<div class="line">            p-&gt;dma_enabled = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* load_balance mode */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;lb&quot;</span>) == 0) {</div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                lb_present == 0,</div>
<div class="line">                params-&gt;name, arg_name);</div>
<div class="line">            lb_present = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ((strcmp(arg_value, <span class="stringliteral">&quot;hash&quot;</span>) == 0) ||</div>
<div class="line">                (strcmp(arg_value, <span class="stringliteral">&quot;HASH&quot;</span>) == 0))</div>
<div class="line">                p-&gt;lb_hash_enabled = 1;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                PIPELINE_PARSE_ERR_INV_VAL(0,</div>
<div class="line">                    params-&gt;name,</div>
<div class="line">                    arg_name,</div>
<div class="line">                    arg_value);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* any other */</span></div>
<div class="line">        PIPELINE_PARSE_ERR_INV_ENT(0, params-&gt;name, arg_name);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check correlations between arguments */</span></div>
<div class="line">    PIPELINE_ARG_CHECK((dma_dst_offset_present == p-&gt;dma_enabled),</div>
<div class="line">        <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: missing entry &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\&quot;dma_dst_offset\&quot;&quot;</span>, params-&gt;name);</div>
<div class="line">    PIPELINE_ARG_CHECK((dma_src_offset_present == p-&gt;dma_enabled),</div>
<div class="line">        <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: missing entry &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\&quot;dma_src_offset\&quot;&quot;</span>, params-&gt;name);</div>
<div class="line">    PIPELINE_ARG_CHECK((dma_size_present == p-&gt;dma_enabled),</div>
<div class="line">        <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: missing entry &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\&quot;dma_size\&quot;&quot;</span>, params-&gt;name);</div>
<div class="line">    PIPELINE_ARG_CHECK((dma_hash_offset_present == p-&gt;dma_enabled),</div>
<div class="line">        <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: missing entry &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\&quot;dma_hash_offset\&quot;&quot;</span>, params-&gt;name);</div>
<div class="line">    PIPELINE_ARG_CHECK((p-&gt;lb_hash_enabled &lt;= p-&gt;dma_hash_enabled),</div>
<div class="line">        <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: missing entry &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;\&quot;dma_hash_offset\&quot;&quot;</span>, params-&gt;name);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (dma_src_mask_present) {</div>
<div class="line">        uint32_t dma_size = p-&gt;dma_size;</div>
<div class="line">        <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">        PIPELINE_ARG_CHECK((strlen(dma_mask_str) ==</div>
<div class="line">            (dma_size * 2)), <span class="stringliteral">&quot;Parse error in section &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;\&quot;%s\&quot;: dma_src_mask should have exactly %u hex &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;digits&quot;</span>, params-&gt;name, (dma_size * 2));</div>
<div class="line"></div>
<div class="line">        status = parse_hex_string(dma_mask_str, p-&gt;dma_src_mask,</div>
<div class="line">            &amp;p-&gt;dma_size);</div>
<div class="line"></div>
<div class="line">        PIPELINE_PARSE_ERR_INV_VAL(((status == 0) &amp;&amp;</div>
<div class="line">            (dma_size == p-&gt;dma_size)), params-&gt;name,</div>
<div class="line">            <span class="stringliteral">&quot;dma_src_mask&quot;</span>, dma_mask_str);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a class="code" href="rte__table__hash_8h.html#a2b9cf2fd12b34cb416174eabcd443cca">rte_table_hash_op_hash</a></div>
<div class="line">get_hash_function(<span class="keyword">struct</span> pipeline_passthrough *p)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (p-&gt;params.dma_size) {</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">case</span> 8: <span class="keywordflow">return</span> hash_default_key8;</div>
<div class="line">    <span class="keywordflow">case</span> 16: <span class="keywordflow">return</span> hash_default_key16;</div>
<div class="line">    <span class="keywordflow">case</span> 24: <span class="keywordflow">return</span> hash_default_key24;</div>
<div class="line">    <span class="keywordflow">case</span> 32: <span class="keywordflow">return</span> hash_default_key32;</div>
<div class="line">    <span class="keywordflow">case</span> 40: <span class="keywordflow">return</span> hash_default_key40;</div>
<div class="line">    <span class="keywordflow">case</span> 48: <span class="keywordflow">return</span> hash_default_key48;</div>
<div class="line">    <span class="keywordflow">case</span> 56: <span class="keywordflow">return</span> hash_default_key56;</div>
<div class="line">    <span class="keywordflow">case</span> 64: <span class="keywordflow">return</span> hash_default_key64;</div>
<div class="line">    <span class="keywordflow">default</span>: <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>*</div>
<div class="line">pipeline_passthrough_init(<span class="keyword">struct</span> pipeline_params *params,</div>
<div class="line">    <a name="a8"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_passthrough *p_pt;</div>
<div class="line">    uint32_t size, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((params == NULL) ||</div>
<div class="line">        (params-&gt;n_ports_in == 0) ||</div>
<div class="line">        (params-&gt;n_ports_out == 0) ||</div>
<div class="line">        (params-&gt;n_ports_in &lt; params-&gt;n_ports_out) ||</div>
<div class="line">        (params-&gt;n_ports_in % params-&gt;n_ports_out))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Memory allocation */</span></div>
<div class="line">    size = <a name="a9"></a><a class="code" href="rte__memory_8h.html#a30eec128f3d71add687a1cbfe48abcbb">RTE_CACHE_LINE_ROUNDUP</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_passthrough));</div>
<div class="line">    p = <a name="a10"></a><a class="code" href="rte__malloc_8h.html#a58042061ad622f028aa2b97e8cb73a41">rte_zmalloc</a>(NULL, size, RTE_CACHE_LINE_SIZE);</div>
<div class="line">    p_pt = (<span class="keyword">struct </span>pipeline_passthrough *) p;</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    strcpy(p-&gt;name, params-&gt;name);</div>
<div class="line">    p-&gt;log_level = params-&gt;log_level;</div>
<div class="line"></div>
<div class="line">    PLOG(p, HIGH, <span class="stringliteral">&quot;Pass-through&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Parse arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pipeline_passthrough_parse_args(&amp;p_pt-&gt;params, params))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    p_pt-&gt;f_hash = get_hash_function(p_pt);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Pipeline */</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a11"></a><a class="code" href="structrte__pipeline__params.html">rte_pipeline_params</a> pipeline_params = {</div>
<div class="line">            .<a name="a12"></a><a class="code" href="structrte__pipeline__params.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <span class="stringliteral">&quot;PASS-THROUGH&quot;</span>,</div>
<div class="line">            .socket_id = params-&gt;socket_id,</div>
<div class="line">            .offset_port_id = 0,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        p-&gt;p = <a name="a13"></a><a class="code" href="rte__pipeline_8h.html#ad650149ed178057bfb54bda0b6e39e05">rte_pipeline_create</a>(&amp;pipeline_params);</div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;p == NULL) {</div>
<div class="line">            <a name="a14"></a><a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    p-&gt;n_ports_in = params-&gt;n_ports_in;</div>
<div class="line">    p-&gt;n_ports_out = params-&gt;n_ports_out;</div>
<div class="line">    p-&gt;n_tables = p-&gt;n_ports_in;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*Input ports*/</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a15"></a><a class="code" href="structrte__pipeline__port__in__params.html">rte_pipeline_port_in_params</a> port_params = {</div>
<div class="line">            .<a name="a16"></a><a class="code" href="structrte__pipeline__port__in__params.html#ad8c92480b58ad5e6b7917c16b5ea7b3d">ops</a> = pipeline_port_in_params_get_ops(</div>
<div class="line">                &amp;params-&gt;port_in[i]),</div>
<div class="line">            .arg_create = pipeline_port_in_params_convert(</div>
<div class="line">                &amp;params-&gt;port_in[i]),</div>
<div class="line">            .f_action = get_port_in_ah(p_pt),</div>
<div class="line">            .arg_ah = p_pt,</div>
<div class="line">            .burst_size = params-&gt;port_in[i].burst_size,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a17"></a><a class="code" href="rte__pipeline_8h.html#ab0c0f093519ccc9fbb76e7c5696fd266">rte_pipeline_port_in_create</a>(p-&gt;p,</div>
<div class="line">            &amp;port_params,</div>
<div class="line">            &amp;p-&gt;port_in_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a name="a18"></a><a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Output ports */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_out; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a19"></a><a class="code" href="structrte__pipeline__port__out__params.html">rte_pipeline_port_out_params</a> port_params = {</div>
<div class="line">            .<a class="code" href="structrte__pipeline__port__in__params.html#ad8c92480b58ad5e6b7917c16b5ea7b3d">ops</a> = pipeline_port_out_params_get_ops(</div>
<div class="line">                &amp;params-&gt;port_out[i]),</div>
<div class="line">            .arg_create = pipeline_port_out_params_convert(</div>
<div class="line">                &amp;params-&gt;port_out[i]),</div>
<div class="line">            .f_action = NULL,</div>
<div class="line">            .arg_ah = NULL,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a20"></a><a class="code" href="rte__pipeline_8h.html#a247f58fe13cba38922ccf5c60a2f86bb">rte_pipeline_port_out_create</a>(p-&gt;p,</div>
<div class="line">            &amp;port_params,</div>
<div class="line">            &amp;p-&gt;port_out_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Tables */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a21"></a><a class="code" href="structrte__pipeline__table__params.html">rte_pipeline_table_params</a> table_params = {</div>
<div class="line">            .<a name="a22"></a><a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> = &amp;<a name="a23"></a><a class="code" href="rte__table__stub_8h.html#ac83a23a9e9a7428c839c5f6f158d7ffa">rte_table_stub_ops</a>,</div>
<div class="line">            .arg_create = NULL,</div>
<div class="line">            .f_action_hit = NULL,</div>
<div class="line">            .f_action_miss = NULL,</div>
<div class="line">            .arg_ah = NULL,</div>
<div class="line">            .action_data_size = 0,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a24"></a><a class="code" href="rte__pipeline_8h.html#af1cb4d7ac4516443e6f9d82a4beebed6">rte_pipeline_table_create</a>(p-&gt;p,</div>
<div class="line">            &amp;table_params,</div>
<div class="line">            &amp;p-&gt;table_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Connecting input ports to tables */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a25"></a><a class="code" href="rte__pipeline_8h.html#adc4634b81c75f146f3afac17dbbe727c">rte_pipeline_port_in_connect_to_table</a>(p-&gt;p,</div>
<div class="line">            p-&gt;port_in_id[i],</div>
<div class="line">            p-&gt;table_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Add entries to tables */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a26"></a><a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> default_entry = {</div>
<div class="line">            .<a name="a27"></a><a class="code" href="structrte__pipeline__table__entry.html#ab65480a4c6171d9ea813e0b1be3afef2">action</a> = <a name="a28"></a><a class="code" href="rte__pipeline_8h.html#a6376b240935404d998f003d113651572ac8c58609785d844989b7d9eb1e6db8aa">RTE_PIPELINE_ACTION_PORT</a>,</div>
<div class="line">            {.port_id = p-&gt;port_out_id[</div>
<div class="line">                i / (p-&gt;n_ports_in / p-&gt;n_ports_out)]},</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *default_entry_ptr;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a29"></a><a class="code" href="rte__pipeline_8h.html#a8980fbc2a51d6dc8041b798ea5172318">rte_pipeline_table_default_entry_add</a>(p-&gt;p,</div>
<div class="line">            p-&gt;table_id[i],</div>
<div class="line">            &amp;default_entry,</div>
<div class="line">            &amp;default_entry_ptr);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Enable input ports */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a30"></a><a class="code" href="rte__pipeline_8h.html#af8a48f99a99731883005dfe93c5406e6">rte_pipeline_port_in_enable</a>(p-&gt;p,</div>
<div class="line">            p-&gt;port_in_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check pipeline consistency */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a31"></a><a class="code" href="rte__pipeline_8h.html#ada72ecd95a1a181d1d555dd699f95475">rte_pipeline_check</a>(p-&gt;p) &lt; 0) {</div>
<div class="line">        <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message queues */</span></div>
<div class="line">    p-&gt;n_msgq = params-&gt;n_msgq;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_msgq; i++)</div>
<div class="line">        p-&gt;msgq_in[i] = params-&gt;msgq_in[i];</div>
<div class="line">    for (i = 0; i &lt; p-&gt;n_msgq; i++)</div>
<div class="line">        p-&gt;msgq_out[i] = params-&gt;msgq_out[i];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message handlers */</span></div>
<div class="line">    memcpy(p-&gt;handlers, handlers, <span class="keyword">sizeof</span>(p-&gt;handlers));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> p;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_passthrough_free(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free resources */</span></div>
<div class="line">    <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_passthrough_timer(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    pipeline_msg_req_handle(p);</div>
<div class="line">    <a name="a32"></a><a class="code" href="rte__pipeline_8h.html#ac26447a6b0c4b1ec218a9133d790fef1">rte_pipeline_flush</a>(p-&gt;p);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_passthrough_track(<span class="keywordtype">void</span> *pipeline, uint32_t port_in, uint32_t *port_out)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((p == NULL) ||</div>
<div class="line">        (port_in &gt;= p-&gt;n_ports_in) ||</div>
<div class="line">        (port_out == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    *port_out = port_in / p-&gt;n_ports_in;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_be_ops pipeline_passthrough_be_ops = {</div>
<div class="line">    .f_init = pipeline_passthrough_init,</div>
<div class="line">    .f_free = pipeline_passthrough_free,</div>
<div class="line">    .f_run = NULL,</div>
<div class="line">    .f_timer = pipeline_passthrough_timer,</div>
<div class="line">    .f_track = pipeline_passthrough_track,</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
