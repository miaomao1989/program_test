<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/pipeline/pipeline_flow_actions.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/pipeline/pipeline_flow_actions.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2015 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/queue.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__hexdump_8h.html">rte_hexdump.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_rdline.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_num.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_ipaddr.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_etheraddr.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;app.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_common_fe.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_flow_actions.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hash_func.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow actions pipeline</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#ifndef N_FLOWS_BULK</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define N_FLOWS_BULK                    4096</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_fa_flow {</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_params params;</div>
<div class="line">    <span class="keywordtype">void</span> *entry_ptr;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_fa_dscp {</div>
<div class="line">    uint32_t traffic_class;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3a">rte_meter_color</a> color;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_fa {</div>
<div class="line">    <span class="comment">/* Parameters */</span></div>
<div class="line">    uint32_t n_ports_in;</div>
<div class="line">    uint32_t n_ports_out;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_params params;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Flows */</span></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa_dscp dscp[PIPELINE_FA_N_DSCP];</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa_flow *flows;</div>
<div class="line">} <a name="a0"></a><a class="code" href="rte__memory_8h.html#a1a29b3bf8655b79e8dca721c5e815aa4">__rte_cache_aligned</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>*</div>
<div class="line">app_pipeline_fa_init(<span class="keyword">struct</span> pipeline_params *params,</div>
<div class="line">    <a name="a1"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p;</div>
<div class="line">    uint32_t size, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((params == NULL) ||</div>
<div class="line">        (params-&gt;n_ports_in == 0) ||</div>
<div class="line">        (params-&gt;n_ports_out == 0))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Memory allocation */</span></div>
<div class="line">    size = <a name="a2"></a><a class="code" href="rte__memory_8h.html#a30eec128f3d71add687a1cbfe48abcbb">RTE_CACHE_LINE_ROUNDUP</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> app_pipeline_fa));</div>
<div class="line">    p = <a name="a3"></a><a class="code" href="rte__malloc_8h.html#a58042061ad622f028aa2b97e8cb73a41">rte_zmalloc</a>(NULL, size, RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Initialization */</span></div>
<div class="line">    p-&gt;n_ports_in = params-&gt;n_ports_in;</div>
<div class="line">    p-&gt;n_ports_out = params-&gt;n_ports_out;</div>
<div class="line">    <span class="keywordflow">if</span> (pipeline_fa_parse_args(&amp;p-&gt;params, params)) {</div>
<div class="line">        <a name="a4"></a><a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Memory allocation */</span></div>
<div class="line">    size = <a class="code" href="rte__memory_8h.html#a30eec128f3d71add687a1cbfe48abcbb">RTE_CACHE_LINE_ROUNDUP</a>(</div>
<div class="line">        p-&gt;params.n_flows * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> app_pipeline_fa_flow));</div>
<div class="line">    p-&gt;flows = <a class="code" href="rte__malloc_8h.html#a58042061ad622f028aa2b97e8cb73a41">rte_zmalloc</a>(NULL, size, RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;flows == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Initialization of flow table */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;params.n_flows; i++)</div>
<div class="line">        pipeline_fa_flow_params_set_default(&amp;p-&gt;flows[i].params);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Initialization of DSCP table */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a name="a5"></a><a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(p-&gt;dscp); i++) {</div>
<div class="line">        p-&gt;dscp[i].traffic_class = 0;</div>
<div class="line">        p-&gt;dscp[i].color = <a name="a6"></a><a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *) p;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_fa_free(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p = pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free resources */</span></div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p-&gt;flows);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">flow_params_check(<span class="keyword">struct</span> app_pipeline_fa *p,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> uint32_t meter_update_mask,</div>
<div class="line">    uint32_t policer_update_mask,</div>
<div class="line">    uint32_t port_update,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_fa_flow_params *params)</div>
<div class="line">{</div>
<div class="line">    uint32_t mask, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Meter */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Policer */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0, mask = 1; i &lt; PIPELINE_FA_N_TC_MAX; i++, mask &lt;&lt;= 1) {</div>
<div class="line">        <span class="keyword">struct </span>pipeline_fa_policer_params *p = &amp;params-&gt;p[i];</div>
<div class="line">        uint32_t j;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((mask &amp; policer_update_mask) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; <a name="a7"></a><a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aabc1b9f1c718a0bf520cd06be98c4843f">e_RTE_METER_COLORS</a>; j++) {</div>
<div class="line">            <span class="keyword">struct </span>pipeline_fa_policer_action *action =</div>
<div class="line">                &amp;p-&gt;action[j];</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> ((action-&gt;drop == 0) &amp;&amp;</div>
<div class="line">                (action-&gt;color &gt;= e_RTE_METER_COLORS))</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Port */</span></div>
<div class="line">    <span class="keywordflow">if</span> (port_update &amp;&amp; (params-&gt;port_id &gt;= p-&gt;n_ports_out))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_fa_flow_config(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    uint32_t flow_id,</div>
<div class="line">    uint32_t meter_update_mask,</div>
<div class="line">    uint32_t policer_update_mask,</div>
<div class="line">    uint32_t port_update,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_fa_flow_params *params)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa_flow *flow;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_config_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_config_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    uint32_t i, mask;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        ((meter_update_mask == 0) &amp;&amp;</div>
<div class="line">        (policer_update_mask == 0) &amp;&amp;</div>
<div class="line">        (port_update == 0)) ||</div>
<div class="line">        (meter_update_mask &gt;= (1 &lt;&lt; PIPELINE_FA_N_TC_MAX)) ||</div>
<div class="line">        (policer_update_mask &gt;= (1 &lt;&lt; PIPELINE_FA_N_TC_MAX)) ||</div>
<div class="line">        (params == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id,</div>
<div class="line">        &amp;pipeline_flow_actions);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (flow_params_check(p,</div>
<div class="line">        meter_update_mask,</div>
<div class="line">        policer_update_mask,</div>
<div class="line">        port_update,</div>
<div class="line">        params) != 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    flow_id %= p-&gt;params.n_flows;</div>
<div class="line">    flow = &amp;p-&gt;flows[flow_id];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FA_MSG_REQ_FLOW_CONFIG;</div>
<div class="line">    req-&gt;entry_ptr = flow-&gt;entry_ptr;</div>
<div class="line">    req-&gt;flow_id = flow_id;</div>
<div class="line">    req-&gt;meter_update_mask = meter_update_mask;</div>
<div class="line">    req-&gt;policer_update_mask = policer_update_mask;</div>
<div class="line">    req-&gt;port_update = port_update;</div>
<div class="line">    memcpy(&amp;req-&gt;params, params, <span class="keyword">sizeof</span>(*params));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status ||</div>
<div class="line">        (rsp-&gt;entry_ptr == NULL)) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit flow */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0, mask = 1; i &lt; PIPELINE_FA_N_TC_MAX; i++, mask &lt;&lt;= 1) {</div>
<div class="line">        <span class="keywordflow">if</span> ((mask &amp; meter_update_mask) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        memcpy(&amp;flow-&gt;params.m[i], &amp;params-&gt;m[i], <span class="keyword">sizeof</span>(params-&gt;m[i]));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0, mask = 1; i &lt; PIPELINE_FA_N_TC_MAX; i++, mask &lt;&lt;= 1) {</div>
<div class="line">        <span class="keywordflow">if</span> ((mask &amp; policer_update_mask) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        memcpy(&amp;flow-&gt;params.p[i], &amp;params-&gt;p[i], <span class="keyword">sizeof</span>(params-&gt;p[i]));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (port_update)</div>
<div class="line">        flow-&gt;params.port_id = params-&gt;port_id;</div>
<div class="line"></div>
<div class="line">    flow-&gt;entry_ptr = rsp-&gt;entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_fa_flow_config_bulk(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    uint32_t *flow_id,</div>
<div class="line">    uint32_t n_flows,</div>
<div class="line">    uint32_t meter_update_mask,</div>
<div class="line">    uint32_t policer_update_mask,</div>
<div class="line">    uint32_t port_update,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_fa_flow_params *params)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_config_bulk_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_config_bulk_msg_rsp *rsp;</div>
<div class="line">    <span class="keywordtype">void</span> **req_entry_ptr;</div>
<div class="line">    uint32_t *req_flow_id;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (flow_id == NULL) ||</div>
<div class="line">        (n_flows == 0) ||</div>
<div class="line">        ((meter_update_mask == 0) &amp;&amp;</div>
<div class="line">        (policer_update_mask == 0) &amp;&amp;</div>
<div class="line">        (port_update == 0)) ||</div>
<div class="line">        (meter_update_mask &gt;= (1 &lt;&lt; PIPELINE_FA_N_TC_MAX)) ||</div>
<div class="line">        (policer_update_mask &gt;= (1 &lt;&lt; PIPELINE_FA_N_TC_MAX)) ||</div>
<div class="line">        (params == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id,</div>
<div class="line">        &amp;pipeline_flow_actions);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_flows; i++) {</div>
<div class="line">        <span class="keyword">struct </span>pipeline_fa_flow_params *flow_params = &amp;params[i];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (flow_params_check(p,</div>
<div class="line">            meter_update_mask,</div>
<div class="line">            policer_update_mask,</div>
<div class="line">            port_update,</div>
<div class="line">            flow_params) != 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req_entry_ptr = (<span class="keywordtype">void</span> **) <a name="a8"></a><a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        n_flows * <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (req_entry_ptr == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req_flow_id = (uint32_t *) <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        n_flows * <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (req_flow_id == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(req_entry_ptr);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_flows; i++) {</div>
<div class="line">        uint32_t fid = flow_id[i] % p-&gt;params.n_flows;</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_fa_flow *flow = &amp;p-&gt;flows[fid];</div>
<div class="line"></div>
<div class="line">        req_flow_id[i] = fid;</div>
<div class="line">        req_entry_ptr[i] = flow-&gt;entry_ptr;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(req_flow_id);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(req_entry_ptr);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FA_MSG_REQ_FLOW_CONFIG_BULK;</div>
<div class="line">    req-&gt;entry_ptr = req_entry_ptr;</div>
<div class="line">    req-&gt;flow_id = req_flow_id;</div>
<div class="line">    req-&gt;n_flows = n_flows;</div>
<div class="line">    req-&gt;meter_update_mask = meter_update_mask;</div>
<div class="line">    req-&gt;policer_update_mask = policer_update_mask;</div>
<div class="line">    req-&gt;port_update = port_update;</div>
<div class="line">    req-&gt;params = params;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(req_flow_id);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(req_entry_ptr);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit flows */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; rsp-&gt;n_flows; i++) {</div>
<div class="line">        uint32_t fid = flow_id[i] % p-&gt;params.n_flows;</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_fa_flow *flow = &amp;p-&gt;flows[fid];</div>
<div class="line">        <span class="keyword">struct </span>pipeline_fa_flow_params *flow_params = &amp;params[i];</div>
<div class="line">        <span class="keywordtype">void</span> *entry_ptr = req_entry_ptr[i];</div>
<div class="line">        uint32_t j, mask;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0, mask = 1; j &lt; PIPELINE_FA_N_TC_MAX;</div>
<div class="line">            j++, mask &lt;&lt;= 1) {</div>
<div class="line">            <span class="keywordflow">if</span> ((mask &amp; meter_update_mask) == 0)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">            memcpy(&amp;flow-&gt;params.m[j],</div>
<div class="line">                &amp;flow_params-&gt;m[j],</div>
<div class="line">                <span class="keyword">sizeof</span>(flow_params-&gt;m[j]));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0, mask = 1; j &lt; PIPELINE_FA_N_TC_MAX;</div>
<div class="line">            j++, mask &lt;&lt;= 1) {</div>
<div class="line">            <span class="keywordflow">if</span> ((mask &amp; policer_update_mask) == 0)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">            memcpy(&amp;flow-&gt;params.p[j],</div>
<div class="line">                &amp;flow_params-&gt;p[j],</div>
<div class="line">                <span class="keyword">sizeof</span>(flow_params-&gt;p[j]));</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (port_update)</div>
<div class="line">            flow-&gt;params.port_id = flow_params-&gt;port_id;</div>
<div class="line"></div>
<div class="line">        flow-&gt;entry_ptr = entry_ptr;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(req_flow_id);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(req_entry_ptr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (rsp-&gt;n_flows == n_flows) ? 0 : -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_fa_dscp_config(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    uint32_t dscp,</div>
<div class="line">    uint32_t traffic_class,</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3a">rte_meter_color</a> color)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_dscp_config_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_dscp_config_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (dscp &gt;= PIPELINE_FA_N_DSCP) ||</div>
<div class="line">        (traffic_class &gt;= PIPELINE_FA_N_TC_MAX) ||</div>
<div class="line">        (color &gt;= e_RTE_METER_COLORS))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id,</div>
<div class="line">        &amp;pipeline_flow_actions);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;params.dscp_enabled == 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FA_MSG_REQ_DSCP_CONFIG;</div>
<div class="line">    req-&gt;dscp = dscp;</div>
<div class="line">    req-&gt;traffic_class = traffic_class;</div>
<div class="line">    req-&gt;color = color;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit DSCP */</span></div>
<div class="line">    p-&gt;dscp[dscp].traffic_class = traffic_class;</div>
<div class="line">    p-&gt;dscp[dscp].color = color;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_fa_flow_policer_stats_read(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    uint32_t flow_id,</div>
<div class="line">    uint32_t policer_id,</div>
<div class="line">    <span class="keywordtype">int</span> clear,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_fa_policer_stats *stats)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa_flow *flow;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_policer_stats_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_policer_stats_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) || (stats == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id,</div>
<div class="line">        &amp;pipeline_flow_actions);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    flow_id %= p-&gt;params.n_flows;</div>
<div class="line">    flow = &amp;p-&gt;flows[flow_id];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((policer_id &gt;= p-&gt;params.n_meters_per_flow) ||</div>
<div class="line">        (flow-&gt;entry_ptr == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FA_MSG_REQ_POLICER_STATS_READ;</div>
<div class="line">    req-&gt;entry_ptr = flow-&gt;entry_ptr;</div>
<div class="line">    req-&gt;policer_id = policer_id;</div>
<div class="line">    req-&gt;clear = clear;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memcpy(stats, &amp;rsp-&gt;stats, <span class="keyword">sizeof</span>(*stats));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line">color_to_string(<span class="keyword">enum</span> <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3a">rte_meter_color</a> color)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (color) {</div>
<div class="line">    <span class="keywordflow">case</span> <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;G&quot;</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a9"></a><a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aaebaa52dbbb6d8b9c60df0093dce62c47">e_RTE_METER_YELLOW</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;Y&quot;</span>;</div>
<div class="line">    <span class="keywordflow">case</span> <a name="a10"></a><a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aae65749b902d61cafb58aa85c0e0849fb">e_RTE_METER_RED</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;R&quot;</span>;</div>
<div class="line">    <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;?&quot;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">string_to_color(<span class="keywordtype">char</span> *s, <span class="keyword">enum</span> <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3a">rte_meter_color</a> *c)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">&quot;G&quot;</span>) == 0) {</div>
<div class="line">        *c = <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">&quot;Y&quot;</span>) == 0) {</div>
<div class="line">        *c = <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aaebaa52dbbb6d8b9c60df0093dce62c47">e_RTE_METER_YELLOW</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">&quot;R&quot;</span>) == 0) {</div>
<div class="line">        *c = <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aae65749b902d61cafb58aa85c0e0849fb">e_RTE_METER_RED</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line">policer_action_to_string(<span class="keyword">struct</span> pipeline_fa_policer_action *a)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (a-&gt;drop)</div>
<div class="line">        <span class="keywordflow">return</span> <span class="stringliteral">&quot;D&quot;</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> color_to_string(a-&gt;color);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">string_to_policer_action(<span class="keywordtype">char</span> *s, <span class="keyword">struct</span> pipeline_fa_policer_action *a)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">&quot;G&quot;</span>) == 0) {</div>
<div class="line">        a-&gt;drop = 0;</div>
<div class="line">        a-&gt;color = <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">&quot;Y&quot;</span>) == 0) {</div>
<div class="line">        a-&gt;drop = 0;</div>
<div class="line">        a-&gt;color = <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aaebaa52dbbb6d8b9c60df0093dce62c47">e_RTE_METER_YELLOW</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">&quot;R&quot;</span>) == 0) {</div>
<div class="line">        a-&gt;drop = 0;</div>
<div class="line">        a-&gt;color = <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aae65749b902d61cafb58aa85c0e0849fb">e_RTE_METER_RED</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(s, <span class="stringliteral">&quot;D&quot;</span>) == 0) {</div>
<div class="line">        a-&gt;drop = 1;</div>
<div class="line">        a-&gt;color = <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_flow(<span class="keyword">struct</span> app_pipeline_fa *p,</div>
<div class="line">    uint32_t flow_id,</div>
<div class="line">    <span class="keyword">struct</span> app_pipeline_fa_flow *flow)</div>
<div class="line">{</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Flow ID = %&quot;</span> PRIu32 <span class="stringliteral">&quot;\n&quot;</span>, flow_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;params.n_meters_per_flow; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a11"></a><a class="code" href="structrte__meter__trtcm__params.html">rte_meter_trtcm_params</a> *meter = &amp;flow-&gt;params.m[i];</div>
<div class="line">        <span class="keyword">struct </span>pipeline_fa_policer_params *policer = &amp;flow-&gt;params.p[i];</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\ttrTCM [CIR = %&quot;</span> PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;, CBS = %&quot;</span> PRIu64 <span class="stringliteral">&quot;, PIR = %&quot;</span> PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;, PBS = %&quot;</span> PRIu64  <span class="stringliteral">&quot;] Policer [G : %s, Y : %s, R : %s]\n&quot;</span>,</div>
<div class="line">        meter-&gt;<a name="a12"></a><a class="code" href="structrte__meter__trtcm__params.html#a882cbe4a787376c3a4d55bbf0b6e1f13">cir</a>,</div>
<div class="line">        meter-&gt;<a name="a13"></a><a class="code" href="structrte__meter__trtcm__params.html#ad914d97dc6b389901af9ddee395827de">cbs</a>,</div>
<div class="line">        meter-&gt;<a name="a14"></a><a class="code" href="structrte__meter__trtcm__params.html#a2acc9a04d3a8ffeeb3b95f142ee15be7">pir</a>,</div>
<div class="line">        meter-&gt;<a name="a15"></a><a class="code" href="structrte__meter__trtcm__params.html#aac8f0f5688bed97bc62949c37308b13d">pbs</a>,</div>
<div class="line">        policer_action_to_string(&amp;policer-&gt;action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>]),</div>
<div class="line">        policer_action_to_string(&amp;policer-&gt;action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aaebaa52dbbb6d8b9c60df0093dce62c47">e_RTE_METER_YELLOW</a>]),</div>
<div class="line">        policer_action_to_string(&amp;policer-&gt;action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aae65749b902d61cafb58aa85c0e0849fb">e_RTE_METER_RED</a>]));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\tPort %u (entry_ptr = %p)\n&quot;</span>,</div>
<div class="line">        flow-&gt;params.port_id,</div>
<div class="line">        flow-&gt;entry_ptr);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_fa_flow_ls(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">        uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id,</div>
<div class="line">        &amp;pipeline_flow_actions);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;params.n_flows; i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_fa_flow *flow = &amp;p-&gt;flows[i];</div>
<div class="line"></div>
<div class="line">        print_flow(p, i, flow);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_fa_dscp_ls(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">        uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_fa *p;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id,</div>
<div class="line">        &amp;pipeline_flow_actions);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;params.dscp_enabled == 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(p-&gt;dscp); i++) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_fa_dscp *dscp = &amp;p-&gt;dscp[i];</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;DSCP = %2&quot;</span> PRIu32 <span class="stringliteral">&quot;: Traffic class = %&quot;</span> PRIu32</div>
<div class="line">            <span class="stringliteral">&quot;, Color = %s\n&quot;</span>,</div>
<div class="line">            i,</div>
<div class="line">            dscp-&gt;traffic_class,</div>
<div class="line">            color_to_string(dscp-&gt;color));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow meter configuration (single flow)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flow &lt;flow ID&gt; meter &lt;meter ID&gt; trtcm &lt;trtcm params&gt;</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_meter_config_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flow_string;</div>
<div class="line">    uint32_t flow_id;</div>
<div class="line">    cmdline_fixed_string_t meter_string;</div>
<div class="line">    uint32_t meter_id;</div>
<div class="line">    cmdline_fixed_string_t trtcm_string;</div>
<div class="line">    uint64_t cir;</div>
<div class="line">    uint64_t pir;</div>
<div class="line">    uint64_t cbs;</div>
<div class="line">    uint64_t pbs;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_meter_config_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_meter_config_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_params flow_params;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;meter_id &gt;= PIPELINE_FA_N_TC_MAX) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    flow_params.m[params-&gt;meter_id].cir = params-&gt;cir;</div>
<div class="line">    flow_params.m[params-&gt;meter_id].pir = params-&gt;pir;</div>
<div class="line">    flow_params.m[params-&gt;meter_id].cbs = params-&gt;cbs;</div>
<div class="line">    flow_params.m[params-&gt;meter_id].pbs = params-&gt;pbs;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_fa_flow_config(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        params-&gt;flow_id,</div>
<div class="line">        1 &lt;&lt; params-&gt;meter_id,</div>
<div class="line">        0,</div>
<div class="line">        0,</div>
<div class="line">        &amp;flow_params);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_flow_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result,</div>
<div class="line">    flow_string, <span class="stringliteral">&quot;flow&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_flow_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result,</div>
<div class="line">    flow_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_meter_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result,</div>
<div class="line">    meter_string, <span class="stringliteral">&quot;meter&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_meter_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result,</div>
<div class="line">    meter_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_trtcm_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result,</div>
<div class="line">    trtcm_string, <span class="stringliteral">&quot;trtcm&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_cir =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result, cir, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_pir =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result, pir, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_cbs =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result, cbs, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_pbs =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_result, pbs, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_meter_config = {</div>
<div class="line">    .f = cmd_fa_meter_config_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow meter configuration (single flow) &quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_flow_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_flow_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_meter_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_meter_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_trtcm_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_cir,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_pir,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_cbs,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_pbs,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow meter configuration (multiple flows)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flows &lt;n_flows&gt; meter &lt;meter ID&gt; trtcm &lt;trtcm params&gt;</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_meter_config_bulk_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flows_string;</div>
<div class="line">    uint32_t n_flows;</div>
<div class="line">    cmdline_fixed_string_t meter_string;</div>
<div class="line">    uint32_t meter_id;</div>
<div class="line">    cmdline_fixed_string_t trtcm_string;</div>
<div class="line">    uint64_t cir;</div>
<div class="line">    uint64_t pir;</div>
<div class="line">    uint64_t cbs;</div>
<div class="line">    uint64_t pbs;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_meter_config_bulk_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_meter_config_bulk_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_params flow_template, *flow_params;</div>
<div class="line">    uint32_t *flow_id;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((params-&gt;n_flows == 0) ||</div>
<div class="line">        (params-&gt;meter_id &gt;= PIPELINE_FA_N_TC_MAX)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid arguments\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    flow_id = (uint32_t *) <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        N_FLOWS_BULK * <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (flow_id == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Memory allocation failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    flow_params = (<span class="keyword">struct </span>pipeline_fa_flow_params *) <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        N_FLOWS_BULK * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_fa_flow_params),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (flow_params == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_id);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Memory allocation failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memset(&amp;flow_template, 0, <span class="keyword">sizeof</span>(flow_template));</div>
<div class="line">    flow_template.m[params-&gt;meter_id].cir = params-&gt;cir;</div>
<div class="line">    flow_template.m[params-&gt;meter_id].pir = params-&gt;pir;</div>
<div class="line">    flow_template.m[params-&gt;meter_id].cbs = params-&gt;cbs;</div>
<div class="line">    flow_template.m[params-&gt;meter_id].pbs = params-&gt;pbs;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params-&gt;n_flows; i++) {</div>
<div class="line">        uint32_t pos = i % N_FLOWS_BULK;</div>
<div class="line"></div>
<div class="line">        flow_id[pos] = i;</div>
<div class="line">        memcpy(&amp;flow_params[pos],</div>
<div class="line">            &amp;flow_template,</div>
<div class="line">            <span class="keyword">sizeof</span>(flow_template));</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((pos == N_FLOWS_BULK - 1) ||</div>
<div class="line">            (i == params-&gt;n_flows - 1)) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            status = app_pipeline_fa_flow_config_bulk(app,</div>
<div class="line">                params-&gt;pipeline_id,</div>
<div class="line">                flow_id,</div>
<div class="line">                pos + 1,</div>
<div class="line">                1 &lt;&lt; params-&gt;meter_id,</div>
<div class="line">                0,</div>
<div class="line">                0,</div>
<div class="line">                flow_params);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_params);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_id);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_bulk_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_bulk_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_bulk_flows_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    flows_string, <span class="stringliteral">&quot;flows&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_bulk_n_flows =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    n_flows, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_bulk_meter_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    meter_string, <span class="stringliteral">&quot;meter&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_bulk_meter_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    meter_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_meter_config_bulk_trtcm_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    trtcm_string, <span class="stringliteral">&quot;trtcm&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_bulk_cir =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    cir, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_bulk_pir =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    pir, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_bulk_cbs =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    cbs, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_meter_config_bulk_pbs =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_meter_config_bulk_result,</div>
<div class="line">    pbs, UINT64);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_meter_config_bulk = {</div>
<div class="line">    .f = cmd_fa_meter_config_bulk_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow meter configuration (multiple flows)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_bulk_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_bulk_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_bulk_flows_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_bulk_n_flows,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_bulk_meter_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_bulk_meter_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_bulk_trtcm_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_cir,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_pir,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_cbs,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_meter_config_pbs,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow policer configuration (single flow)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flow &lt;flow ID&gt; policer &lt;policer ID&gt;</span></div>
<div class="line"><span class="comment"> *    G &lt;action&gt; Y &lt;action&gt; R &lt;action&gt;</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * &lt;action&gt; = G (green) | Y (yellow) | R (red) | D (drop)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_policer_config_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flow_string;</div>
<div class="line">    uint32_t flow_id;</div>
<div class="line">    cmdline_fixed_string_t policer_string;</div>
<div class="line">    uint32_t policer_id;</div>
<div class="line">    cmdline_fixed_string_t green_string;</div>
<div class="line">    cmdline_fixed_string_t g_action;</div>
<div class="line">    cmdline_fixed_string_t yellow_string;</div>
<div class="line">    cmdline_fixed_string_t y_action;</div>
<div class="line">    cmdline_fixed_string_t red_string;</div>
<div class="line">    cmdline_fixed_string_t r_action;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_policer_config_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_policer_config_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_params flow_params;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;policer_id &gt;= PIPELINE_FA_N_TC_MAX) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = string_to_policer_action(params-&gt;g_action,</div>
<div class="line">        &amp;flow_params.p[params-&gt;policer_id].action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>]);</div>
<div class="line">    <span class="keywordflow">if</span> (status)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid policer green action\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    status = string_to_policer_action(params-&gt;y_action,</div>
<div class="line">        &amp;flow_params.p[params-&gt;policer_id].action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aaebaa52dbbb6d8b9c60df0093dce62c47">e_RTE_METER_YELLOW</a>]);</div>
<div class="line">    <span class="keywordflow">if</span> (status)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid policer yellow action\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    status = string_to_policer_action(params-&gt;r_action,</div>
<div class="line">        &amp;flow_params.p[params-&gt;policer_id].action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aae65749b902d61cafb58aa85c0e0849fb">e_RTE_METER_RED</a>]);</div>
<div class="line">    <span class="keywordflow">if</span> (status)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid policer red action\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_fa_flow_config(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        params-&gt;flow_id,</div>
<div class="line">        0,</div>
<div class="line">        1 &lt;&lt; params-&gt;policer_id,</div>
<div class="line">        0,</div>
<div class="line">        &amp;flow_params);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_config_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_flow_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    flow_string, <span class="stringliteral">&quot;flow&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_config_flow_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    flow_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_policer_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    policer_string, <span class="stringliteral">&quot;policer&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_config_policer_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    policer_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_green_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    green_string, <span class="stringliteral">&quot;G&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_g_action =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    g_action, <span class="stringliteral">&quot;R#Y#G#D&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_yellow_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    yellow_string, <span class="stringliteral">&quot;Y&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_y_action =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    y_action, <span class="stringliteral">&quot;R#Y#G#D&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_red_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    red_string, <span class="stringliteral">&quot;R&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_r_action =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_result,</div>
<div class="line">    r_action, <span class="stringliteral">&quot;R#Y#G#D&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_policer_config = {</div>
<div class="line">    .f = cmd_fa_policer_config_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow policer configuration (single flow)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_flow_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_flow_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_policer_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_policer_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_green_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_g_action,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_yellow_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_y_action,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_red_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_r_action,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow policer configuration (multiple flows)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flows &lt;n_flows&gt; policer &lt;policer ID&gt;</span></div>
<div class="line"><span class="comment"> *    G &lt;action&gt; Y &lt;action&gt; R &lt;action&gt;</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * &lt;action&gt; = G (green) | Y (yellow) | R (red) | D (drop)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_policer_config_bulk_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flows_string;</div>
<div class="line">    uint32_t n_flows;</div>
<div class="line">    cmdline_fixed_string_t policer_string;</div>
<div class="line">    uint32_t policer_id;</div>
<div class="line">    cmdline_fixed_string_t green_string;</div>
<div class="line">    cmdline_fixed_string_t g_action;</div>
<div class="line">    cmdline_fixed_string_t yellow_string;</div>
<div class="line">    cmdline_fixed_string_t y_action;</div>
<div class="line">    cmdline_fixed_string_t red_string;</div>
<div class="line">    cmdline_fixed_string_t r_action;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_policer_config_bulk_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_policer_config_bulk_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_params flow_template, *flow_params;</div>
<div class="line">    uint32_t *flow_id, i;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ((params-&gt;n_flows == 0) ||</div>
<div class="line">        (params-&gt;policer_id &gt;= PIPELINE_FA_N_TC_MAX)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid arguments\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    flow_id = (uint32_t *) <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        N_FLOWS_BULK * <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (flow_id == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Memory allocation failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    flow_params = (<span class="keyword">struct </span>pipeline_fa_flow_params *) <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        N_FLOWS_BULK * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_fa_flow_params),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (flow_params == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_id);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Memory allocation failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memset(&amp;flow_template, 0, <span class="keyword">sizeof</span>(flow_template));</div>
<div class="line"></div>
<div class="line">    status = string_to_policer_action(params-&gt;g_action,</div>
<div class="line">        &amp;flow_template.p[params-&gt;policer_id].action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>]);</div>
<div class="line">    <span class="keywordflow">if</span> (status)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid policer green action\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    status = string_to_policer_action(params-&gt;y_action,</div>
<div class="line">     &amp;flow_template.p[params-&gt;policer_id].action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aaebaa52dbbb6d8b9c60df0093dce62c47">e_RTE_METER_YELLOW</a>]);</div>
<div class="line">    <span class="keywordflow">if</span> (status)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid policer yellow action\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    status = string_to_policer_action(params-&gt;r_action,</div>
<div class="line">        &amp;flow_template.p[params-&gt;policer_id].action[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aae65749b902d61cafb58aa85c0e0849fb">e_RTE_METER_RED</a>]);</div>
<div class="line">    <span class="keywordflow">if</span> (status)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid policer red action\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params-&gt;n_flows; i++) {</div>
<div class="line">        uint32_t pos = i % N_FLOWS_BULK;</div>
<div class="line"></div>
<div class="line">        flow_id[pos] = i;</div>
<div class="line">        memcpy(&amp;flow_params[pos], &amp;flow_template,</div>
<div class="line">            <span class="keyword">sizeof</span>(flow_template));</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((pos == N_FLOWS_BULK - 1) ||</div>
<div class="line">            (i == params-&gt;n_flows - 1)) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            status = app_pipeline_fa_flow_config_bulk(app,</div>
<div class="line">                params-&gt;pipeline_id,</div>
<div class="line">                flow_id,</div>
<div class="line">                pos + 1,</div>
<div class="line">                0,</div>
<div class="line">                1 &lt;&lt; params-&gt;policer_id,</div>
<div class="line">                0,</div>
<div class="line">                flow_params);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_params);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_id);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_config_bulk_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_flows_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    flows_string, <span class="stringliteral">&quot;flows&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_config_bulk_n_flows =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    n_flows, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_policer_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    policer_string, <span class="stringliteral">&quot;policer&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_config_bulk_policer_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    policer_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_green_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    green_string, <span class="stringliteral">&quot;G&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_g_action =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    g_action, <span class="stringliteral">&quot;R#Y#G#D&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_yellow_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    yellow_string, <span class="stringliteral">&quot;Y&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_y_action =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    y_action, <span class="stringliteral">&quot;R#Y#G#D&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_red_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    red_string, <span class="stringliteral">&quot;R&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_config_bulk_r_action =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_config_bulk_result,</div>
<div class="line">    r_action, <span class="stringliteral">&quot;R#Y#G#D&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_policer_config_bulk = {</div>
<div class="line">    .f = cmd_fa_policer_config_bulk_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow policer configuration (multiple flows)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_flows_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_n_flows,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_policer_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_policer_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_green_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_g_action,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_yellow_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_y_action,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_red_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_config_bulk_r_action,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow output port configuration (single flow)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flow &lt;flow ID&gt; port &lt;port ID&gt;</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_output_port_config_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flow_string;</div>
<div class="line">    uint32_t flow_id;</div>
<div class="line">    cmdline_fixed_string_t port_string;</div>
<div class="line">    uint32_t port_id;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_output_port_config_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_output_port_config_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_params flow_params;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    flow_params.port_id = params-&gt;port_id;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_fa_flow_config(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        params-&gt;flow_id,</div>
<div class="line">        0,</div>
<div class="line">        0,</div>
<div class="line">        1,</div>
<div class="line">        &amp;flow_params);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_output_port_config_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_output_port_config_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_output_port_config_flow_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_result,</div>
<div class="line">    flow_string, <span class="stringliteral">&quot;flow&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_output_port_config_flow_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_result,</div>
<div class="line">    flow_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_output_port_config_port_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_result,</div>
<div class="line">    port_string, <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_output_port_config_port_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_result,</div>
<div class="line">    port_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_output_port_config = {</div>
<div class="line">    .f = cmd_fa_output_port_config_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow output port configuration (single flow)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_flow_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_flow_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_port_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_port_id,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow output port configuration (multiple flows)</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flows &lt;n_flows&gt; ports &lt;n_ports&gt;</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_output_port_config_bulk_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flows_string;</div>
<div class="line">    uint32_t n_flows;</div>
<div class="line">    cmdline_fixed_string_t ports_string;</div>
<div class="line">    uint32_t n_ports;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_output_port_config_bulk_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_output_port_config_bulk_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_flow_params *flow_params;</div>
<div class="line">    uint32_t *flow_id;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;n_flows == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid arguments\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    flow_id = (uint32_t *) <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        N_FLOWS_BULK * <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (flow_id == NULL) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Memory allocation failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    flow_params = (<span class="keyword">struct </span>pipeline_fa_flow_params *) <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">        N_FLOWS_BULK * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_fa_flow_params),</div>
<div class="line">        RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (flow_params == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_id);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Memory allocation failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params-&gt;n_flows; i++) {</div>
<div class="line">        uint32_t pos = i % N_FLOWS_BULK;</div>
<div class="line">        uint32_t port_id = i % params-&gt;n_ports;</div>
<div class="line"></div>
<div class="line">        flow_id[pos] = i;</div>
<div class="line"></div>
<div class="line">        memset(&amp;flow_params[pos], 0, <span class="keyword">sizeof</span>(flow_params[pos]));</div>
<div class="line">        flow_params[pos].port_id = port_id;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((pos == N_FLOWS_BULK - 1) ||</div>
<div class="line">            (i == params-&gt;n_flows - 1)) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            status = app_pipeline_fa_flow_config_bulk(app,</div>
<div class="line">                params-&gt;pipeline_id,</div>
<div class="line">                flow_id,</div>
<div class="line">                pos + 1,</div>
<div class="line">                0,</div>
<div class="line">                0,</div>
<div class="line">                1,</div>
<div class="line">                flow_params);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_params);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(flow_id);</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_output_port_config_bulk_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_bulk_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_output_port_config_bulk_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_bulk_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_output_port_config_bulk_flows_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_bulk_result,</div>
<div class="line">    flows_string, <span class="stringliteral">&quot;flows&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_output_port_config_bulk_n_flows =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_bulk_result,</div>
<div class="line">    n_flows, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_output_port_config_bulk_ports_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_bulk_result,</div>
<div class="line">    ports_string, <span class="stringliteral">&quot;ports&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_output_port_config_bulk_n_ports =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_output_port_config_bulk_result,</div>
<div class="line">    n_ports, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_output_port_config_bulk = {</div>
<div class="line">    .f = cmd_fa_output_port_config_bulk_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow output port configuration (multiple flows)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_bulk_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_bulk_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_bulk_flows_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_bulk_n_flows,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_bulk_ports_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_output_port_config_bulk_n_ports,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow DiffServ Code Point (DSCP) translation table configuration</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; dscp &lt;DSCP ID&gt; class &lt;traffic class ID&gt; color &lt;color&gt;</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * &lt;color&gt; = G (green) | Y (yellow) | R (red)</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_dscp_config_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t dscp_string;</div>
<div class="line">    uint32_t dscp_id;</div>
<div class="line">    cmdline_fixed_string_t class_string;</div>
<div class="line">    uint32_t traffic_class_id;</div>
<div class="line">    cmdline_fixed_string_t color_string;</div>
<div class="line">    cmdline_fixed_string_t color;</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_dscp_config_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_dscp_config_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3a">rte_meter_color</a> color;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = string_to_color(params-&gt;color, &amp;color);</div>
<div class="line">    <span class="keywordflow">if</span> (status) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Invalid color\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_fa_dscp_config(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        params-&gt;dscp_id,</div>
<div class="line">        params-&gt;traffic_class_id,</div>
<div class="line">        color);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_config_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_dscp_config_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_config_dscp_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    dscp_string, <span class="stringliteral">&quot;dscp&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_dscp_config_dscp_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    dscp_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_config_class_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    class_string, <span class="stringliteral">&quot;class&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_dscp_config_traffic_class_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    traffic_class_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_config_color_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    color_string, <span class="stringliteral">&quot;color&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_config_color =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_config_result,</div>
<div class="line">    color, <span class="stringliteral">&quot;G#Y#R&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_dscp_config = {</div>
<div class="line">    .f = cmd_fa_dscp_config_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow DSCP translation table configuration&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_dscp_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_dscp_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_class_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_traffic_class_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_color_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_config_color,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow policer stats read</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flow &lt;flow ID&gt; policer &lt;policer ID&gt; stats</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_policer_stats_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flow_string;</div>
<div class="line">    uint32_t flow_id;</div>
<div class="line">    cmdline_fixed_string_t policer_string;</div>
<div class="line">    uint32_t policer_id;</div>
<div class="line">    cmdline_fixed_string_t stats_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_policer_stats_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_policer_stats_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fa_policer_stats stats;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_fa_flow_policer_stats_read(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        params-&gt;flow_id,</div>
<div class="line">        params-&gt;policer_id,</div>
<div class="line">        1,</div>
<div class="line">        &amp;stats);</div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Display stats */</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;\tPkts G: %&quot;</span> PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;\tPkts Y: %&quot;</span> PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;\tPkts R: %&quot;</span> PRIu64</div>
<div class="line">        <span class="stringliteral">&quot;\tPkts D: %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line">        stats.n_pkts[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aa635687a12163cdd741edb786ba5419ec">e_RTE_METER_GREEN</a>],</div>
<div class="line">        stats.n_pkts[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aaebaa52dbbb6d8b9c60df0093dce62c47">e_RTE_METER_YELLOW</a>],</div>
<div class="line">        stats.n_pkts[<a class="code" href="rte__meter_8h.html#a9fdad5fa95e62568e827ab7d0c792f3aae65749b902d61cafb58aa85c0e0849fb">e_RTE_METER_RED</a>],</div>
<div class="line">        stats.n_pkts_drop);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_stats_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_stats_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_stats_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_stats_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_stats_flow_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_stats_result,</div>
<div class="line">    flow_string, <span class="stringliteral">&quot;flow&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_stats_flow_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_stats_result,</div>
<div class="line">    flow_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_stats_policer_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_stats_result,</div>
<div class="line">    policer_string, <span class="stringliteral">&quot;policer&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_policer_stats_policer_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_stats_result,</div>
<div class="line">    policer_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_policer_stats_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_policer_stats_result,</div>
<div class="line">    stats_string, <span class="stringliteral">&quot;stats&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_policer_stats = {</div>
<div class="line">    .f = cmd_fa_policer_stats_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow policer stats read&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_stats_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_stats_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_stats_flow_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_stats_flow_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_stats_policer_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_stats_policer_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_policer_stats_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow list</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; flow ls</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_flow_ls_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t flow_string;</div>
<div class="line">    cmdline_fixed_string_t actions_string;</div>
<div class="line">    cmdline_fixed_string_t ls_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_flow_ls_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_flow_ls_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_fa_flow_ls(app, params-&gt;pipeline_id);</div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_flow_ls_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_flow_ls_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_flow_ls_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_flow_ls_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_flow_ls_flow_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_flow_ls_result,</div>
<div class="line">    flow_string, <span class="stringliteral">&quot;flow&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_flow_ls_actions_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_flow_ls_result,</div>
<div class="line">    actions_string, <span class="stringliteral">&quot;actions&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_flow_ls_ls_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_flow_ls_result,</div>
<div class="line">    ls_string, <span class="stringliteral">&quot;ls&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_flow_ls = {</div>
<div class="line">    .f = cmd_fa_flow_ls_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow actions list&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_flow_ls_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_flow_ls_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_flow_ls_flow_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_flow_ls_actions_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_flow_ls_ls_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow DiffServ Code Point (DSCP) translation table list</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * p &lt;pipeline ID&gt; dscp ls</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_fa_dscp_ls_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t dscp_string;</div>
<div class="line">    cmdline_fixed_string_t ls_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_fa_dscp_ls_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_fa_dscp_ls_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_fa_dscp_ls(app, params-&gt;pipeline_id);</div>
<div class="line">    <span class="keywordflow">if</span> (status != 0)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_ls_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_ls_result,</div>
<div class="line">    p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_fa_dscp_ls_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_ls_result,</div>
<div class="line">    pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_ls_dscp_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_ls_result,</div>
<div class="line">    dscp_string, <span class="stringliteral">&quot;dscp&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_fa_dscp_ls_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_fa_dscp_ls_result, ls_string,</div>
<div class="line">    <span class="stringliteral">&quot;ls&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_fa_dscp_ls = {</div>
<div class="line">    .f = cmd_fa_dscp_ls_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Flow DSCP translaton table list&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_ls_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_ls_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_ls_dscp_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_fa_dscp_ls_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_ctx_t pipeline_cmds[] = {</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_meter_config,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_meter_config_bulk,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_policer_config,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_policer_config_bulk,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_output_port_config,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_output_port_config_bulk,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_dscp_config,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_policer_stats,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_flow_ls,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_fa_dscp_ls,</div>
<div class="line">    NULL,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>pipeline_fe_ops pipeline_flow_actions_fe_ops = {</div>
<div class="line">    .f_init = app_pipeline_fa_init,</div>
<div class="line">    .f_free = app_pipeline_fa_free,</div>
<div class="line">    .cmds = pipeline_cmds,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_type pipeline_flow_actions = {</div>
<div class="line">    .name = <span class="stringliteral">&quot;FLOW_ACTIONS&quot;</span>,</div>
<div class="line">    .be_ops = &amp;pipeline_flow_actions_be_ops,</div>
<div class="line">    .fe_ops = &amp;pipeline_flow_actions_fe_ops,</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
