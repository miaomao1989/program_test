<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: l2fwd-crypto/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">l2fwd-crypto/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2015-2016 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/queue.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;setjmp.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdarg.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;getopt.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__atomic_8h.html">rte_atomic.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__branch__prediction_8h.html">rte_branch_prediction.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__cryptodev_8h.html">rte_cryptodev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__cycles_8h.html">rte_cycles.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__debug_8h.html">rte_debug.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__eal_8h.html">rte_eal.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ether_8h.html">rte_ether.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ethdev_8h.html">rte_ethdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__interrupts_8h.html">rte_interrupts.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ip_8h.html">rte_ip.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__launch_8h.html">rte_launch.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__lcore_8h.html">rte_lcore.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__log_8h.html">rte_log.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mbuf_8h.html">rte_mbuf.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memcpy_8h.html">rte_memcpy.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memory_8h.html">rte_memory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mempool_8h.html">rte_mempool.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memzone_8h.html">rte_memzone.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__pci_8h.html">rte_pci.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__per__lcore_8h.html">rte_per_lcore.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__prefetch_8h.html">rte_prefetch.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__random_8h.html">rte_random.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ring_8h.html">rte_ring.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__hexdump_8h.html">rte_hexdump.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">enum</span> cdev_type {</div>
<div class="line">    CDEV_TYPE_ANY,</div>
<div class="line">    CDEV_TYPE_HW,</div>
<div class="line">    CDEV_TYPE_SW</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define RTE_LOGTYPE_L2FWD RTE_LOGTYPE_USER1</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define NB_MBUF   8192</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define MAX_STR_LEN 32</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_KEY_SIZE 128</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_PKT_BURST 32</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BURST_TX_DRAIN_US 100 </span><span class="comment">/* TX drain every ~100us */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Configurable number of RX/TX ring descriptors</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="preprocessor">#define RTE_TEST_RX_DESC_DEFAULT 128</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define RTE_TEST_TX_DESC_DEFAULT 512</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">static</span> uint16_t nb_rxd = RTE_TEST_RX_DESC_DEFAULT;</div>
<div class="line"><span class="keyword">static</span> uint16_t nb_txd = RTE_TEST_TX_DESC_DEFAULT;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* ethernet addresses of ports */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a name="_a0"></a><a class="code" href="structether__addr.html">ether_addr</a> l2fwd_ports_eth_addr[RTE_MAX_ETHPORTS];</div>
<div class="line"></div>
<div class="line"><span class="comment">/* mask of enabled ports */</span></div>
<div class="line"><span class="keyword">static</span> uint64_t l2fwd_enabled_port_mask;</div>
<div class="line"><span class="keyword">static</span> uint64_t l2fwd_enabled_crypto_mask;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* list of enabled ports */</span></div>
<div class="line"><span class="keyword">static</span> uint32_t l2fwd_dst_ports[RTE_MAX_ETHPORTS];</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pkt_buffer {</div>
<div class="line">    <span class="keywordtype">unsigned</span> len;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *buffer[MAX_PKT_BURST];</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>op_buffer {</div>
<div class="line">    <span class="keywordtype">unsigned</span> len;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a2"></a><a class="code" href="structrte__crypto__op.html">rte_crypto_op</a> *buffer[MAX_PKT_BURST];</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define MAX_RX_QUEUE_PER_LCORE 16</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_TX_QUEUE_PER_PORT 16</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">enum</span> l2fwd_crypto_xform_chain {</div>
<div class="line">    L2FWD_CRYPTO_CIPHER_HASH,</div>
<div class="line">    L2FWD_CRYPTO_HASH_CIPHER,</div>
<div class="line">    L2FWD_CRYPTO_CIPHER_ONLY,</div>
<div class="line">    L2FWD_CRYPTO_HASH_ONLY</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>l2fwd_key {</div>
<div class="line">    uint8_t *data;</div>
<div class="line">    uint32_t length;</div>
<div class="line">    <a class="code" href="rte__memory_8h.html#aeed7e715f3dcfddef6f34dec94037646">phys_addr_t</a> phys_addr;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">char</span> supported_auth_algo[RTE_CRYPTO_AUTH_LIST_END][MAX_STR_LEN];</div>
<div class="line"><span class="keywordtype">char</span> supported_cipher_algo[RTE_CRYPTO_CIPHER_LIST_END][MAX_STR_LEN];</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>l2fwd_crypto_options {</div>
<div class="line">    <span class="keywordtype">unsigned</span> portmask;</div>
<div class="line">    <span class="keywordtype">unsigned</span> nb_ports_per_lcore;</div>
<div class="line">    <span class="keywordtype">unsigned</span> refresh_period;</div>
<div class="line">    <span class="keywordtype">unsigned</span> single_lcore:1;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">enum</span> cdev_type type;</div>
<div class="line">    <span class="keywordtype">unsigned</span> sessionless:1;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">enum</span> l2fwd_crypto_xform_chain xform_chain;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span><a name="_a3"></a><a class="code" href="structrte__crypto__sym__xform.html">rte_crypto_sym_xform</a> cipher_xform;</div>
<div class="line">    <span class="keywordtype">unsigned</span> ckey_param;</div>
<div class="line">    <span class="keywordtype">int</span> ckey_random_size;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>l2fwd_key iv;</div>
<div class="line">    <span class="keywordtype">unsigned</span> iv_param;</div>
<div class="line">    <span class="keywordtype">int</span> iv_random_size;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__crypto__sym__xform.html">rte_crypto_sym_xform</a> auth_xform;</div>
<div class="line">    uint8_t akey_param;</div>
<div class="line">    <span class="keywordtype">int</span> akey_random_size;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>l2fwd_key aad;</div>
<div class="line">    <span class="keywordtype">unsigned</span> aad_param;</div>
<div class="line">    <span class="keywordtype">int</span> aad_random_size;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> digest_size;</div>
<div class="line"></div>
<div class="line">    uint16_t block_size;</div>
<div class="line">    <span class="keywordtype">char</span> string_type[MAX_STR_LEN];</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>l2fwd_crypto_params {</div>
<div class="line">    uint8_t <a name="a4"></a><a class="code" href="rte__cryptodev_8h.html#a360603720ae8b2c0e4931dd0f648c504">dev_id</a>;</div>
<div class="line">    uint8_t qp_id;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> digest_length;</div>
<div class="line">    <span class="keywordtype">unsigned</span> block_size;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>l2fwd_key iv;</div>
<div class="line">    <span class="keyword">struct </span>l2fwd_key aad;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a5"></a><a class="code" href="structrte__cryptodev__sym__session.html">rte_cryptodev_sym_session</a> *session;</div>
<div class="line"></div>
<div class="line">    uint8_t do_cipher;</div>
<div class="line">    uint8_t do_hash;</div>
<div class="line">    uint8_t hash_verify;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75e">rte_crypto_cipher_algorithm</a> cipher_algo;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793">rte_crypto_auth_algorithm</a> auth_algo;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>lcore_queue_conf {</div>
<div class="line">    <span class="keywordtype">unsigned</span> nb_rx_ports;</div>
<div class="line">    <span class="keywordtype">unsigned</span> rx_port_list[MAX_RX_QUEUE_PER_LCORE];</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> nb_crypto_devs;</div>
<div class="line">    <span class="keywordtype">unsigned</span> cryptodev_list[MAX_RX_QUEUE_PER_LCORE];</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>op_buffer op_buf[RTE_MAX_ETHPORTS];</div>
<div class="line">    <span class="keyword">struct </span>pkt_buffer pkt_buf[RTE_MAX_ETHPORTS];</div>
<div class="line">} <a name="a6"></a><a class="code" href="rte__memory_8h.html#a1a29b3bf8655b79e8dca721c5e815aa4">__rte_cache_aligned</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>lcore_queue_conf lcore_queue_conf[RTE_MAX_LCORE];</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a name="_a7"></a><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> port_conf = {</div>
<div class="line">    .<a name="a8"></a><a class="code" href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rxmode</a> = {</div>
<div class="line">        .<a name="a9"></a><a class="code" href="structrte__eth__rxmode.html#aa0562513c4569f1aa53050f1beac6b5d">mq_mode</a> = <a name="a10"></a><a class="code" href="rte__ethdev_8h.html#a586b8e86131b4ec0ccaf464e847ccf3ea4600ff07419327deb9b8534bc66daf19">ETH_MQ_RX_NONE</a>,</div>
<div class="line">        .max_rx_pkt_len = <a name="a11"></a><a class="code" href="rte__ether_8h.html#aaebedff0cce73327398dd3139ba50e43">ETHER_MAX_LEN</a>,</div>
<div class="line">        .split_hdr_size = 0,</div>
<div class="line">        .header_split   = 0, </div>
<div class="line">        .hw_ip_checksum = 0, </div>
<div class="line">        .hw_vlan_filter = 0, </div>
<div class="line">        .jumbo_frame    = 0, </div>
<div class="line">        .hw_strip_crc   = 0, </div>
<div class="line">    },</div>
<div class="line">    .txmode = {</div>
<div class="line">        .mq_mode = <a name="a12"></a><a class="code" href="rte__ethdev_8h.html#a4834f572f4dd4e46d81ad09b7d5fffd5aada568551470d5f419cd2f3d6b6bfedc">ETH_MQ_TX_NONE</a>,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span><a name="_a13"></a><a class="code" href="structrte__mempool.html">rte_mempool</a> *l2fwd_pktmbuf_pool;</div>
<div class="line"><span class="keyword">struct </span><a class="code" href="structrte__mempool.html">rte_mempool</a> *l2fwd_crypto_op_pool;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Per-port statistics struct */</span></div>
<div class="line"><span class="keyword">struct </span>l2fwd_port_statistics {</div>
<div class="line">    uint64_t tx;</div>
<div class="line">    uint64_t rx;</div>
<div class="line"></div>
<div class="line">    uint64_t crypto_enqueued;</div>
<div class="line">    uint64_t crypto_dequeued;</div>
<div class="line"></div>
<div class="line">    uint64_t dropped;</div>
<div class="line">} <a class="code" href="rte__memory_8h.html#a1a29b3bf8655b79e8dca721c5e815aa4">__rte_cache_aligned</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>l2fwd_crypto_statistics {</div>
<div class="line">    uint64_t enqueued;</div>
<div class="line">    uint64_t dequeued;</div>
<div class="line"></div>
<div class="line">    uint64_t errors;</div>
<div class="line">} <a class="code" href="rte__memory_8h.html#a1a29b3bf8655b79e8dca721c5e815aa4">__rte_cache_aligned</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>l2fwd_port_statistics port_statistics[RTE_MAX_ETHPORTS];</div>
<div class="line"><span class="keyword">struct </span>l2fwd_crypto_statistics crypto_statistics[RTE_MAX_ETHPORTS];</div>
<div class="line"></div>
<div class="line"><span class="comment">/* A tsc-based timer responsible for triggering statistics printout */</span></div>
<div class="line"><span class="preprocessor">#define TIMER_MILLISECOND 2000000ULL </span><span class="comment">/* around 1ms at 2 Ghz */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_TIMER_PERIOD 86400UL </span><span class="comment">/* 1 day max */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/* default period is 10 seconds */</span></div>
<div class="line"><span class="keyword">static</span> int64_t timer_period = 10 * TIMER_MILLISECOND * 1000;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Print out statistics on packets dropped */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_stats(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    uint64_t total_packets_dropped, total_packets_tx, total_packets_rx;</div>
<div class="line">    uint64_t total_packets_enqueued, total_packets_dequeued,</div>
<div class="line">        total_packets_errors;</div>
<div class="line">    <span class="keywordtype">unsigned</span> portid;</div>
<div class="line">    uint64_t cdevid;</div>
<div class="line"></div>
<div class="line">    total_packets_dropped = 0;</div>
<div class="line">    total_packets_tx = 0;</div>
<div class="line">    total_packets_rx = 0;</div>
<div class="line">    total_packets_enqueued = 0;</div>
<div class="line">    total_packets_dequeued = 0;</div>
<div class="line">    total_packets_errors = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> clr[] = { 27, <span class="charliteral">&#39;[&#39;</span>, <span class="charliteral">&#39;2&#39;</span>, <span class="charliteral">&#39;J&#39;</span>, <span class="charliteral">&#39;\0&#39;</span> };</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> topLeft[] = { 27, <span class="charliteral">&#39;[&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;;&#39;</span>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;H&#39;</span>, <span class="charliteral">&#39;\0&#39;</span> };</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Clear screen and move to top left */</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;%s%s&quot;</span>, clr, topLeft);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\nPort statistics ====================================&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (portid = 0; portid &lt; RTE_MAX_ETHPORTS; portid++) {</div>
<div class="line">        <span class="comment">/* skip disabled ports */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((l2fwd_enabled_port_mask &amp; (1 &lt;&lt; portid)) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        printf(<span class="stringliteral">&quot;\nStatistics for port %u ------------------------------&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;\nPackets sent: %32&quot;</span>PRIu64</div>
<div class="line">               <span class="stringliteral">&quot;\nPackets received: %28&quot;</span>PRIu64</div>
<div class="line">               <span class="stringliteral">&quot;\nPackets dropped: %29&quot;</span>PRIu64,</div>
<div class="line">               portid,</div>
<div class="line">               port_statistics[portid].tx,</div>
<div class="line">               port_statistics[portid].rx,</div>
<div class="line">               port_statistics[portid].dropped);</div>
<div class="line"></div>
<div class="line">        total_packets_dropped += port_statistics[portid].dropped;</div>
<div class="line">        total_packets_tx += port_statistics[portid].tx;</div>
<div class="line">        total_packets_rx += port_statistics[portid].rx;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nCrypto statistics ==================================&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (cdevid = 0; cdevid &lt; RTE_CRYPTO_MAX_DEVS; cdevid++) {</div>
<div class="line">        <span class="comment">/* skip disabled ports */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((l2fwd_enabled_crypto_mask &amp; (1lu &lt;&lt; cdevid)) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        printf(<span class="stringliteral">&quot;\nStatistics for cryptodev %&quot;</span>PRIu64</div>
<div class="line">                <span class="stringliteral">&quot; -------------------------&quot;</span></div>
<div class="line">               <span class="stringliteral">&quot;\nPackets enqueued: %28&quot;</span>PRIu64</div>
<div class="line">               <span class="stringliteral">&quot;\nPackets dequeued: %28&quot;</span>PRIu64</div>
<div class="line">               <span class="stringliteral">&quot;\nPackets errors: %30&quot;</span>PRIu64,</div>
<div class="line">               cdevid,</div>
<div class="line">               crypto_statistics[cdevid].enqueued,</div>
<div class="line">               crypto_statistics[cdevid].dequeued,</div>
<div class="line">               crypto_statistics[cdevid].errors);</div>
<div class="line"></div>
<div class="line">        total_packets_enqueued += crypto_statistics[cdevid].enqueued;</div>
<div class="line">        total_packets_dequeued += crypto_statistics[cdevid].dequeued;</div>
<div class="line">        total_packets_errors += crypto_statistics[cdevid].errors;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;\nAggregate statistics ===============================&quot;</span></div>
<div class="line">           <span class="stringliteral">&quot;\nTotal packets received: %22&quot;</span>PRIu64</div>
<div class="line">           <span class="stringliteral">&quot;\nTotal packets enqueued: %22&quot;</span>PRIu64</div>
<div class="line">           <span class="stringliteral">&quot;\nTotal packets dequeued: %22&quot;</span>PRIu64</div>
<div class="line">           <span class="stringliteral">&quot;\nTotal packets sent: %26&quot;</span>PRIu64</div>
<div class="line">           <span class="stringliteral">&quot;\nTotal packets dropped: %23&quot;</span>PRIu64</div>
<div class="line">           <span class="stringliteral">&quot;\nTotal packets crypto errors: %17&quot;</span>PRIu64,</div>
<div class="line">           total_packets_rx,</div>
<div class="line">           total_packets_enqueued,</div>
<div class="line">           total_packets_dequeued,</div>
<div class="line">           total_packets_tx,</div>
<div class="line">           total_packets_dropped,</div>
<div class="line">           total_packets_errors);</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n====================================================\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">fill_supported_algorithm_tables(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_CRYPTO_AUTH_LIST_END; i++)</div>
<div class="line">        strcpy(supported_auth_algo[i], <span class="stringliteral">&quot;NOT_SUPPORTED&quot;</span>);</div>
<div class="line"></div>
<div class="line">    strcpy(supported_auth_algo[<a name="a14"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a2b213f1db62f6487f6b548355859f2ee">RTE_CRYPTO_AUTH_AES_GCM</a>], <span class="stringliteral">&quot;AES_GCM&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a15"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a71706690d26cf6578388efbacf149475">RTE_CRYPTO_AUTH_MD5_HMAC</a>], <span class="stringliteral">&quot;MD5_HMAC&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a16"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a9ea752ee9e74822da84cb75ef90cf583">RTE_CRYPTO_AUTH_NULL</a>], <span class="stringliteral">&quot;NULL&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a17"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a98921a1d0174e6ec9f252b408dd39d20">RTE_CRYPTO_AUTH_SHA1_HMAC</a>], <span class="stringliteral">&quot;SHA1_HMAC&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a18"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a1d62fa0151fcd73065f595deffcd1eb1">RTE_CRYPTO_AUTH_SHA224_HMAC</a>], <span class="stringliteral">&quot;SHA224_HMAC&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a19"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793ad1b12ffc0e9202c46cff017c0bbcd6eb">RTE_CRYPTO_AUTH_SHA256_HMAC</a>], <span class="stringliteral">&quot;SHA256_HMAC&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a20"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a634c146058e5de433ecd38045b2f5acd">RTE_CRYPTO_AUTH_SHA384_HMAC</a>], <span class="stringliteral">&quot;SHA384_HMAC&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a21"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a03fb86db5564fed7f4f3db1dea33eb74">RTE_CRYPTO_AUTH_SHA512_HMAC</a>], <span class="stringliteral">&quot;SHA512_HMAC&quot;</span>);</div>
<div class="line">    strcpy(supported_auth_algo[<a name="a22"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a3a068d41ffd387e294fade7fbe0b11af">RTE_CRYPTO_AUTH_SNOW3G_UIA2</a>], <span class="stringliteral">&quot;SNOW3G_UIA2&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_CRYPTO_CIPHER_LIST_END; i++)</div>
<div class="line">        strcpy(supported_cipher_algo[i], <span class="stringliteral">&quot;NOT_SUPPORTED&quot;</span>);</div>
<div class="line"></div>
<div class="line">    strcpy(supported_cipher_algo[<a name="a23"></a><a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75ead9f8e28815f3dd2b77e7ce93b7b8a7ca">RTE_CRYPTO_CIPHER_AES_CBC</a>], <span class="stringliteral">&quot;AES_CBC&quot;</span>);</div>
<div class="line">    strcpy(supported_cipher_algo[<a name="a24"></a><a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75ea91021f79da58ebc3221c481e787b05be">RTE_CRYPTO_CIPHER_AES_GCM</a>], <span class="stringliteral">&quot;AES_GCM&quot;</span>);</div>
<div class="line">    strcpy(supported_cipher_algo[<a name="a25"></a><a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75eacc63a4618def739e08bb778de9f6e077">RTE_CRYPTO_CIPHER_NULL</a>], <span class="stringliteral">&quot;NULL&quot;</span>);</div>
<div class="line">    strcpy(supported_cipher_algo[<a name="a26"></a><a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75ea8598018741a79db99387a47133c94525">RTE_CRYPTO_CIPHER_SNOW3G_UEA2</a>], <span class="stringliteral">&quot;SNOW3G_UEA2&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_crypto_send_burst(<span class="keyword">struct</span> lcore_queue_conf *qconf, <span class="keywordtype">unsigned</span> n,</div>
<div class="line">        <span class="keyword">struct</span> l2fwd_crypto_params *cparams)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__crypto__op.html">rte_crypto_op</a> **op_buffer;</div>
<div class="line">    <span class="keywordtype">unsigned</span> ret;</div>
<div class="line"></div>
<div class="line">    op_buffer = (<span class="keyword">struct </span><a class="code" href="structrte__crypto__op.html">rte_crypto_op</a> **)</div>
<div class="line">            qconf-&gt;op_buf[cparams-&gt;dev_id].buffer;</div>
<div class="line"></div>
<div class="line">    ret = <a name="a27"></a><a class="code" href="rte__cryptodev_8h.html#a1e1336b0a8fe381ea03a52bad85e5734">rte_cryptodev_enqueue_burst</a>(cparams-&gt;dev_id,</div>
<div class="line">            cparams-&gt;qp_id, op_buffer, (uint16_t) n);</div>
<div class="line"></div>
<div class="line">    crypto_statistics[cparams-&gt;dev_id].enqueued += ret;</div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a28"></a><a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ret &lt; n)) {</div>
<div class="line">        crypto_statistics[cparams-&gt;dev_id].errors += (n - ret);</div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">            <a name="a29"></a><a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(op_buffer[ret]-&gt;<a name="a30"></a><a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;<a name="a31"></a><a class="code" href="structrte__crypto__sym__op.html#af021669494a2806b0569587e2096e88e">m_src</a>);</div>
<div class="line">            <a name="a32"></a><a class="code" href="rte__crypto_8h.html#aca76406e3f1ab04ab44dfbe4ff26f4ba">rte_crypto_op_free</a>(op_buffer[ret]);</div>
<div class="line">        } <span class="keywordflow">while</span> (++ret &lt; n);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_crypto_enqueue(<span class="keyword">struct</span> <a class="code" href="structrte__crypto__op.html">rte_crypto_op</a> *op,</div>
<div class="line">        <span class="keyword">struct</span> l2fwd_crypto_params *cparams)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> lcore_id, len;</div>
<div class="line">    <span class="keyword">struct </span>lcore_queue_conf *qconf;</div>
<div class="line"></div>
<div class="line">    lcore_id = <a name="a33"></a><a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>();</div>
<div class="line"></div>
<div class="line">    qconf = &amp;lcore_queue_conf[lcore_id];</div>
<div class="line">    len = qconf-&gt;op_buf[cparams-&gt;dev_id].len;</div>
<div class="line">    qconf-&gt;op_buf[cparams-&gt;dev_id].buffer[len] = op;</div>
<div class="line">    len++;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* enough ops to be sent */</span></div>
<div class="line">    <span class="keywordflow">if</span> (len == MAX_PKT_BURST) {</div>
<div class="line">        l2fwd_crypto_send_burst(qconf, MAX_PKT_BURST, cparams);</div>
<div class="line">        len = 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    qconf-&gt;op_buf[cparams-&gt;dev_id].len = len;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_simple_crypto_enqueue(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> *m,</div>
<div class="line">        <span class="keyword">struct</span> <a class="code" href="structrte__crypto__op.html">rte_crypto_op</a> *op,</div>
<div class="line">        <span class="keyword">struct</span> l2fwd_crypto_params *cparams)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a name="_a34"></a><a class="code" href="structether__hdr.html">ether_hdr</a> *eth_hdr;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a35"></a><a class="code" href="structipv4__hdr.html">ipv4_hdr</a> *ip_hdr;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> ipdata_offset, pad_len, data_len;</div>
<div class="line">    <span class="keywordtype">char</span> *padding;</div>
<div class="line"></div>
<div class="line">    eth_hdr = <a name="a36"></a><a class="code" href="rte__mbuf_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(m, <span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a> *);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (eth_hdr-&gt;<a name="a37"></a><a class="code" href="structether__hdr.html#ad6312397ccc57d322b1a037c7080d340">ether_type</a> != <a name="a38"></a><a class="code" href="rte__byteorder_8h.html#aaf31412a30c1d00c9e1cc9fa598b6484">rte_cpu_to_be_16</a>(<a name="a39"></a><a class="code" href="rte__ether_8h.html#a08cc3337f1584270c6f9de9bffd14b2b">ETHER_TYPE_IPv4</a>))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    ipdata_offset = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structether__hdr.html">ether_hdr</a>);</div>
<div class="line"></div>
<div class="line">    ip_hdr = (<span class="keyword">struct </span><a class="code" href="structipv4__hdr.html">ipv4_hdr</a> *)(<a class="code" href="rte__mbuf_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(m, <span class="keywordtype">char</span> *) +</div>
<div class="line">            ipdata_offset);</div>
<div class="line"></div>
<div class="line">    ipdata_offset += (ip_hdr-&gt;<a name="a40"></a><a class="code" href="structipv4__hdr.html#a0f143df6fd0e09aba2963a160e33ce16">version_ihl</a> &amp; <a name="a41"></a><a class="code" href="rte__ip_8h.html#a8c9248b9f42d71c158ba650f8c91b238">IPV4_HDR_IHL_MASK</a>)</div>
<div class="line">            * <a name="a42"></a><a class="code" href="rte__ip_8h.html#ab765e72fa531b60b36d5322110aa6022">IPV4_IHL_MULTIPLIER</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Zero pad data to be crypto&#39;d so it is block aligned */</span></div>
<div class="line">    data_len  = <a name="a43"></a><a class="code" href="rte__mbuf_8h.html#a2a1e1b30162161ed11d3ba2faf7bbf13">rte_pktmbuf_data_len</a>(m) - ipdata_offset;</div>
<div class="line">    pad_len = data_len % cparams-&gt;block_size ? cparams-&gt;block_size -</div>
<div class="line">            (data_len % cparams-&gt;block_size) : 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (pad_len) {</div>
<div class="line">        padding = <a name="a44"></a><a class="code" href="rte__mbuf_8h.html#ad5b0cd686ad3bcbb83416ca8395a080b">rte_pktmbuf_append</a>(m, pad_len);</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(!padding))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">        data_len += pad_len;</div>
<div class="line">        memset(padding, 0, pad_len);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Set crypto operation data parameters */</span></div>
<div class="line">    <a name="a45"></a><a class="code" href="rte__crypto_8h.html#affaf4fd29a51d350b387155494402a84">rte_crypto_op_attach_sym_session</a>(op, cparams-&gt;session);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (cparams-&gt;do_hash) {</div>
<div class="line">        <span class="keywordflow">if</span> (!cparams-&gt;hash_verify) {</div>
<div class="line">            <span class="comment">/* Append space for digest to end of packet */</span></div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;<a name="a46"></a>auth.<a name="a47"></a><a class="code" href="structrte__crypto__sym__op.html#ae06af5639eb8d45f99d872b07dc4297f">digest</a>.data = (uint8_t *)<a class="code" href="rte__mbuf_8h.html#ad5b0cd686ad3bcbb83416ca8395a080b">rte_pktmbuf_append</a>(m,</div>
<div class="line">                cparams-&gt;digest_length);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#ae06af5639eb8d45f99d872b07dc4297f">digest</a>.data = (uint8_t *)<a class="code" href="rte__mbuf_8h.html#ad5b0cd686ad3bcbb83416ca8395a080b">rte_pktmbuf_append</a>(m,</div>
<div class="line">                cparams-&gt;digest_length);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#ae06af5639eb8d45f99d872b07dc4297f">digest</a>.phys_addr = <a name="a48"></a><a class="code" href="rte__mbuf_8h.html#a5b9472f72c06fe5e573d305e55c9d77a">rte_pktmbuf_mtophys_offset</a>(m,</div>
<div class="line">                <a name="a49"></a><a class="code" href="rte__mbuf_8h.html#a7a7ea614c79d5b9ed790a56c1c79189d">rte_pktmbuf_pkt_len</a>(m) - cparams-&gt;digest_length);</div>
<div class="line">        op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#ae06af5639eb8d45f99d872b07dc4297f">digest</a>.length = cparams-&gt;digest_length;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* For SNOW3G algorithms, offset/length must be in bits */</span></div>
<div class="line">        <span class="keywordflow">if</span> (cparams-&gt;auth_algo == <a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a3a068d41ffd387e294fade7fbe0b11af">RTE_CRYPTO_AUTH_SNOW3G_UIA2</a>) {</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a name="a50"></a><a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.offset = ipdata_offset &lt;&lt; 3;</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.length = data_len &lt;&lt; 3;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.offset = ipdata_offset;</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.length = data_len;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (cparams-&gt;aad.length) {</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a name="a51"></a><a class="code" href="structrte__crypto__sym__op.html#ae12c81e349b45a6cb9689a0450db1a65">aad</a>.data = cparams-&gt;aad.data;</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#ae12c81e349b45a6cb9689a0450db1a65">aad</a>.phys_addr = cparams-&gt;aad.phys_addr;</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;auth.<a class="code" href="structrte__crypto__sym__op.html#ae12c81e349b45a6cb9689a0450db1a65">aad</a>.length = cparams-&gt;aad.length;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (cparams-&gt;do_cipher) {</div>
<div class="line">        op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;<a name="a52"></a>cipher.<a name="a53"></a><a class="code" href="structrte__crypto__sym__op.html#a8a7998e94e97e73a0aa5ae2eabd0bd51">iv</a>.data = cparams-&gt;iv.data;</div>
<div class="line">        op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a8a7998e94e97e73a0aa5ae2eabd0bd51">iv</a>.phys_addr = cparams-&gt;iv.phys_addr;</div>
<div class="line">        op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a8a7998e94e97e73a0aa5ae2eabd0bd51">iv</a>.length = cparams-&gt;iv.length;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* For SNOW3G algorithms, offset/length must be in bits */</span></div>
<div class="line">        <span class="keywordflow">if</span> (cparams-&gt;cipher_algo == <a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75ea8598018741a79db99387a47133c94525">RTE_CRYPTO_CIPHER_SNOW3G_UEA2</a>) {</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.offset = ipdata_offset &lt;&lt; 3;</div>
<div class="line">            <span class="keywordflow">if</span> (cparams-&gt;do_hash &amp;&amp; cparams-&gt;hash_verify)</div>
<div class="line">                <span class="comment">/* Do not cipher the hash tag */</span></div>
<div class="line">                op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.length = (data_len -</div>
<div class="line">                    cparams-&gt;digest_length) &lt;&lt; 3;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.length = data_len &lt;&lt; 3;</div>
<div class="line"></div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.offset = ipdata_offset;</div>
<div class="line">            <span class="keywordflow">if</span> (cparams-&gt;do_hash &amp;&amp; cparams-&gt;hash_verify)</div>
<div class="line">                <span class="comment">/* Do not cipher the hash tag */</span></div>
<div class="line">                op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.length = data_len -</div>
<div class="line">                    cparams-&gt;digest_length;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;cipher.<a class="code" href="structrte__crypto__sym__op.html#a66133ea951ae78d735cf20aa5db03d29">data</a>.length = data_len;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    op-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;<a class="code" href="structrte__crypto__sym__op.html#af021669494a2806b0569587e2096e88e">m_src</a> = m;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> l2fwd_crypto_enqueue(op, cparams);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="comment">/* Send the burst of packets on an output interface */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_send_burst(<span class="keyword">struct</span> lcore_queue_conf *qconf, <span class="keywordtype">unsigned</span> n,</div>
<div class="line">        uint8_t <a name="_a54"></a><a class="code" href="structport.html">port</a>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> **pkt_buffer;</div>
<div class="line">    <span class="keywordtype">unsigned</span> ret;</div>
<div class="line"></div>
<div class="line">    pkt_buffer = (<span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> **)qconf-&gt;pkt_buf[port].buffer;</div>
<div class="line"></div>
<div class="line">    ret = <a name="a55"></a><a class="code" href="rte__ethdev_8h.html#a8053f1efd106a1d939e77f97566846b0">rte_eth_tx_burst</a>(port, 0, pkt_buffer, (uint16_t)n);</div>
<div class="line">    port_statistics[<a name="a56"></a><a class="code" href="structrte__mbuf.html#a2fa54f9024782843172506fadbee2ac8">port</a>].tx += ret;</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(ret &lt; n)) {</div>
<div class="line">        port_statistics[<a class="code" href="structrte__mbuf.html#a2fa54f9024782843172506fadbee2ac8">port</a>].dropped += (n - ret);</div>
<div class="line">        <span class="keywordflow">do</span> {</div>
<div class="line">            <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkt_buffer[ret]);</div>
<div class="line">        } <span class="keywordflow">while</span> (++ret &lt; n);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Enqueue packets for TX and prepare them to be sent */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_send_packet(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> *m, uint8_t port)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> lcore_id, len;</div>
<div class="line">    <span class="keyword">struct </span>lcore_queue_conf *qconf;</div>
<div class="line"></div>
<div class="line">    lcore_id = <a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>();</div>
<div class="line"></div>
<div class="line">    qconf = &amp;lcore_queue_conf[lcore_id];</div>
<div class="line">    len = qconf-&gt;pkt_buf[port].len;</div>
<div class="line">    qconf-&gt;pkt_buf[port].buffer[len] = m;</div>
<div class="line">    len++;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* enough pkts to be sent */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(len == MAX_PKT_BURST)) {</div>
<div class="line">        l2fwd_send_burst(qconf, MAX_PKT_BURST, port);</div>
<div class="line">        len = 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    qconf-&gt;pkt_buf[port].len = len;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l2fwd_simple_forward(<span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> *m, <span class="keywordtype">unsigned</span> portid)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structether__hdr.html">ether_hdr</a> *eth;</div>
<div class="line">    <span class="keywordtype">void</span> *tmp;</div>
<div class="line">    <span class="keywordtype">unsigned</span> dst_port;</div>
<div class="line"></div>
<div class="line">    dst_port = l2fwd_dst_ports[portid];</div>
<div class="line">    eth = <a class="code" href="rte__mbuf_8h.html#a2a8b10263496c7b580e9d0c7f2a1f073">rte_pktmbuf_mtod</a>(m, <span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a> *);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* 02:00:00:00:00:xx */</span></div>
<div class="line">    tmp = &amp;eth-&gt;<a name="a57"></a><a class="code" href="structether__hdr.html#a48d4fb059dd0fcb99a47a890dc1c10f0">d_addr</a>.<a name="a58"></a><a class="code" href="structether__addr.html#a17e6cc2bacfdff827dfbe413871ee2bc">addr_bytes</a>[0];</div>
<div class="line">    *((uint64_t *)tmp) = 0x000000000002 + ((uint64_t)dst_port &lt;&lt; 40);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* src addr */</span></div>
<div class="line">    <a name="a59"></a><a class="code" href="rte__ether_8h.html#a38a0c494f25e8d352ba382a9e3e806b7">ether_addr_copy</a>(&amp;l2fwd_ports_eth_addr[dst_port], &amp;eth-&gt;<a name="a60"></a><a class="code" href="structether__hdr.html#a10047aa0ea4caae2a392e4d5850deb6f">s_addr</a>);</div>
<div class="line"></div>
<div class="line">    l2fwd_send_packet(m, (uint8_t) dst_port);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">generate_random_key(uint8_t *key, <span class="keywordtype">unsigned</span> length)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; length; i++)</div>
<div class="line">        key[i] = rand() % 0xff;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structrte__cryptodev__sym__session.html">rte_cryptodev_sym_session</a> *</div>
<div class="line">initialize_crypto_session(<span class="keyword">struct</span> l2fwd_crypto_options *options,</div>
<div class="line">        uint8_t cdev_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__crypto__sym__xform.html">rte_crypto_sym_xform</a> *first_xform;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;xform_chain == L2FWD_CRYPTO_CIPHER_HASH) {</div>
<div class="line">        first_xform = &amp;options-&gt;cipher_xform;</div>
<div class="line">        first_xform-&gt;<a name="a61"></a><a class="code" href="structrte__crypto__sym__xform.html#aa8c788b7f832e2a4183a8924ff8dab97">next</a> = &amp;options-&gt;auth_xform;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;xform_chain == L2FWD_CRYPTO_HASH_CIPHER) {</div>
<div class="line">        first_xform = &amp;options-&gt;auth_xform;</div>
<div class="line">        first_xform-&gt;<a class="code" href="structrte__crypto__sym__xform.html#aa8c788b7f832e2a4183a8924ff8dab97">next</a> = &amp;options-&gt;cipher_xform;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;xform_chain == L2FWD_CRYPTO_CIPHER_ONLY) {</div>
<div class="line">        first_xform = &amp;options-&gt;cipher_xform;</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        first_xform = &amp;options-&gt;auth_xform;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Setup Cipher Parameters */</span></div>
<div class="line">    <span class="keywordflow">return</span> <a name="a62"></a><a class="code" href="rte__cryptodev_8h.html#ad1f255e0e068ad74cf55c49605532931">rte_cryptodev_sym_session_create</a>(cdev_id, first_xform);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l2fwd_crypto_options_print(<span class="keyword">struct</span> l2fwd_crypto_options *options);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* main processing loop */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l2fwd_main_loop(<span class="keyword">struct</span> l2fwd_crypto_options *options)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *m, *pkts_burst[MAX_PKT_BURST];</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__crypto__op.html">rte_crypto_op</a> *ops_burst[MAX_PKT_BURST];</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">unsigned</span> lcore_id = <a class="code" href="rte__lcore_8h.html#adfb2b334e7e73f534f25e8888a8a775f">rte_lcore_id</a>();</div>
<div class="line">    uint64_t prev_tsc = 0, diff_tsc, cur_tsc, timer_tsc = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> i, j, portid, nb_rx;</div>
<div class="line">    <span class="keyword">struct </span>lcore_queue_conf *qconf = &amp;lcore_queue_conf[lcore_id];</div>
<div class="line">    <span class="keyword">const</span> uint64_t drain_tsc = (<a name="a63"></a><a class="code" href="rte__cycles_8h.html#ae016e608f344823e677819d8f04264c5">rte_get_tsc_hz</a>() + US_PER_S - 1) /</div>
<div class="line">            US_PER_S * BURST_TX_DRAIN_US;</div>
<div class="line">    <span class="keyword">struct </span>l2fwd_crypto_params *cparams;</div>
<div class="line">    <span class="keyword">struct </span>l2fwd_crypto_params port_cparams[qconf-&gt;nb_crypto_devs];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (qconf-&gt;nb_rx_ports == 0) {</div>
<div class="line">        <a name="a64"></a><a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, L2FWD, <span class="stringliteral">&quot;lcore %u has nothing to do\n&quot;</span>, lcore_id);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, L2FWD, <span class="stringliteral">&quot;entering main loop on lcore %u\n&quot;</span>, lcore_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; qconf-&gt;nb_rx_ports; i++) {</div>
<div class="line"></div>
<div class="line">        portid = qconf-&gt;rx_port_list[i];</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, L2FWD, <span class="stringliteral">&quot; -- lcoreid=%u portid=%u\n&quot;</span>, lcore_id,</div>
<div class="line">            portid);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; qconf-&gt;nb_crypto_devs; i++) {</div>
<div class="line">        port_cparams[i].do_cipher = 0;</div>
<div class="line">        port_cparams[i].do_hash = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span> (options-&gt;xform_chain) {</div>
<div class="line">        <span class="keywordflow">case</span> L2FWD_CRYPTO_CIPHER_HASH:</div>
<div class="line">        <span class="keywordflow">case</span> L2FWD_CRYPTO_HASH_CIPHER:</div>
<div class="line">            port_cparams[i].do_cipher = 1;</div>
<div class="line">            port_cparams[i].do_hash = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> L2FWD_CRYPTO_HASH_ONLY:</div>
<div class="line">            port_cparams[i].do_hash = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> L2FWD_CRYPTO_CIPHER_ONLY:</div>
<div class="line">            port_cparams[i].do_cipher = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        port_cparams[i].dev_id = qconf-&gt;cryptodev_list[i];</div>
<div class="line">        port_cparams[i].qp_id = 0;</div>
<div class="line"></div>
<div class="line">        port_cparams[i].block_size = options-&gt;block_size;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (port_cparams[i].do_hash) {</div>
<div class="line">            port_cparams[i].digest_length =</div>
<div class="line">                    options-&gt;auth_xform.auth.digest_length;</div>
<div class="line">            <span class="keywordflow">if</span> (options-&gt;auth_xform.auth.add_auth_data_length) {</div>
<div class="line">                port_cparams[i].aad.data = options-&gt;aad.data;</div>
<div class="line">                port_cparams[i].aad.length =</div>
<div class="line">                    options-&gt;auth_xform.auth.add_auth_data_length;</div>
<div class="line">                port_cparams[i].aad.phys_addr = options-&gt;aad.phys_addr;</div>
<div class="line">                <span class="keywordflow">if</span> (!options-&gt;aad_param)</div>
<div class="line">                    generate_random_key(port_cparams[i].aad.data,</div>
<div class="line">                        port_cparams[i].aad.length);</div>
<div class="line"></div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (options-&gt;auth_xform.auth.op == <a name="a65"></a><a class="code" href="rte__crypto__sym_8h.html#a8998669d6c958fb1f0e31eeee515dd47a99f910b408b48db113988c3b841972b9">RTE_CRYPTO_AUTH_OP_VERIFY</a>)</div>
<div class="line">                port_cparams[i].hash_verify = 1;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                port_cparams[i].hash_verify = 0;</div>
<div class="line"></div>
<div class="line">            port_cparams[i].auth_algo = options-&gt;auth_xform.auth.algo;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (port_cparams[i].do_cipher) {</div>
<div class="line">            port_cparams[i].iv.data = options-&gt;iv.data;</div>
<div class="line">            port_cparams[i].iv.length = options-&gt;iv.length;</div>
<div class="line">            port_cparams[i].iv.phys_addr = options-&gt;iv.phys_addr;</div>
<div class="line">            <span class="keywordflow">if</span> (!options-&gt;iv_param)</div>
<div class="line">                generate_random_key(port_cparams[i].iv.data,</div>
<div class="line">                        port_cparams[i].iv.length);</div>
<div class="line"></div>
<div class="line">            port_cparams[i].cipher_algo = options-&gt;cipher_xform.cipher.algo;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        port_cparams[i].session = initialize_crypto_session(options,</div>
<div class="line">                port_cparams[i].<a class="code" href="rte__cryptodev_8h.html#a360603720ae8b2c0e4931dd0f648c504">dev_id</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (port_cparams[i].session == NULL)</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        <a class="code" href="rte__log_8h.html#ac23caeb9833fd0fd0665c6c05ec806fe">RTE_LOG</a>(INFO, L2FWD, <span class="stringliteral">&quot; -- lcoreid=%u cryptoid=%u\n&quot;</span>, lcore_id,</div>
<div class="line">                port_cparams[i].<a class="code" href="rte__cryptodev_8h.html#a360603720ae8b2c0e4931dd0f648c504">dev_id</a>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    l2fwd_crypto_options_print(options);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Initialize previous tsc timestamp before the loop,</span></div>
<div class="line"><span class="comment">     * to avoid showing the port statistics immediately,</span></div>
<div class="line"><span class="comment">     * so user can see the crypto information.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    prev_tsc = rte_rdtsc();</div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line"></div>
<div class="line">        cur_tsc = rte_rdtsc();</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * TX burst queue drain</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        diff_tsc = cur_tsc - prev_tsc;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(diff_tsc &gt; drain_tsc)) {</div>
<div class="line">            <span class="keywordflow">for</span> (portid = 0; portid &lt; RTE_MAX_ETHPORTS; portid++) {</div>
<div class="line">                <span class="keywordflow">if</span> (qconf-&gt;pkt_buf[portid].len == 0)</div>
<div class="line">                    <span class="keywordflow">continue</span>;</div>
<div class="line">                l2fwd_send_burst(&amp;lcore_queue_conf[lcore_id],</div>
<div class="line">                         qconf-&gt;pkt_buf[portid].len,</div>
<div class="line">                         (uint8_t) portid);</div>
<div class="line">                qconf-&gt;pkt_buf[portid].len = 0;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* if timer is enabled */</span></div>
<div class="line">            <span class="keywordflow">if</span> (timer_period &gt; 0) {</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* advance the timer */</span></div>
<div class="line">                timer_tsc += diff_tsc;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* if timer has reached its timeout */</span></div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code" href="rte__branch__prediction_8h.html#ac6c45889010c1bd68631771b64f18101">unlikely</a>(timer_tsc &gt;=</div>
<div class="line">                        (uint64_t)timer_period)) {</div>
<div class="line"></div>
<div class="line">                    <span class="comment">/* do this only on master core */</span></div>
<div class="line">                    <span class="keywordflow">if</span> (lcore_id == <a name="a66"></a><a class="code" href="rte__lcore_8h.html#ab99d72ae5d1c5f533625422934283700">rte_get_master_lcore</a>()</div>
<div class="line">                        &amp;&amp; options-&gt;refresh_period) {</div>
<div class="line">                        print_stats();</div>
<div class="line">                        timer_tsc = 0;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            prev_tsc = cur_tsc;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">         * Read packet from RX queues</span></div>
<div class="line"><span class="comment">         */</span></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; qconf-&gt;nb_rx_ports; i++) {</div>
<div class="line">            portid = qconf-&gt;rx_port_list[i];</div>
<div class="line"></div>
<div class="line">            cparams = &amp;port_cparams[i];</div>
<div class="line"></div>
<div class="line">            nb_rx = <a name="a67"></a><a class="code" href="rte__ethdev_8h.html#aee7daffe261e67355a78b106627c4c45">rte_eth_rx_burst</a>((uint8_t) portid, 0,</div>
<div class="line">                         pkts_burst, MAX_PKT_BURST);</div>
<div class="line"></div>
<div class="line">            port_statistics[portid].rx += nb_rx;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (nb_rx) {</div>
<div class="line">                <span class="comment">/*</span></div>
<div class="line"><span class="comment">                 * If we can&#39;t allocate a crypto_ops, then drop</span></div>
<div class="line"><span class="comment">                 * the rest of the burst and dequeue and</span></div>
<div class="line"><span class="comment">                 * process the packets to free offload structs</span></div>
<div class="line"><span class="comment">                 */</span></div>
<div class="line">                <span class="keywordflow">if</span> (<a name="a68"></a><a class="code" href="rte__crypto_8h.html#a31a63194763a5a9e689170becddc3ae6">rte_crypto_op_bulk_alloc</a>(</div>
<div class="line">                        l2fwd_crypto_op_pool,</div>
<div class="line">                        <a name="a69"></a><a class="code" href="rte__crypto_8h.html#ae6cf2c3fcd46c5ef3a43fbcb8b658739a33144a5991d4b9aaa43adb9748a067fc">RTE_CRYPTO_OP_TYPE_SYMMETRIC</a>,</div>
<div class="line">                        ops_burst, nb_rx) !=</div>
<div class="line">                                nb_rx) {</div>
<div class="line">                    <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++)</div>
<div class="line">                        <a class="code" href="rte__mbuf_8h.html#a1215458932900b7cd5192326fa4a6902">rte_pktmbuf_free</a>(pkts_burst[i]);</div>
<div class="line"></div>
<div class="line">                    nb_rx = 0;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Enqueue packets from Crypto device*/</span></div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++) {</div>
<div class="line">                    m = pkts_burst[j];</div>
<div class="line"></div>
<div class="line">                    l2fwd_simple_crypto_enqueue(m,</div>
<div class="line">                            ops_burst[j], cparams);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Dequeue packets from Crypto device */</span></div>
<div class="line">            <span class="keywordflow">do</span> {</div>
<div class="line">                nb_rx = <a name="a70"></a><a class="code" href="rte__cryptodev_8h.html#a0032857587ce7e217b8c10ba392bef56">rte_cryptodev_dequeue_burst</a>(</div>
<div class="line">                        cparams-&gt;dev_id, cparams-&gt;qp_id,</div>
<div class="line">                        ops_burst, MAX_PKT_BURST);</div>
<div class="line"></div>
<div class="line">                crypto_statistics[cparams-&gt;dev_id].dequeued +=</div>
<div class="line">                        nb_rx;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* Forward crypto&#39;d packets */</span></div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt; nb_rx; j++) {</div>
<div class="line">                    m = ops_burst[j]-&gt;<a class="code" href="structrte__crypto__op.html#a37076a0e7a5459e70a4016afa61c046a">sym</a>-&gt;<a class="code" href="structrte__crypto__sym__op.html#af021669494a2806b0569587e2096e88e">m_src</a>;</div>
<div class="line"></div>
<div class="line">                    <a class="code" href="rte__crypto_8h.html#aca76406e3f1ab04ab44dfbe4ff26f4ba">rte_crypto_op_free</a>(ops_burst[j]);</div>
<div class="line">                    l2fwd_simple_forward(m, portid);</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">while</span> (nb_rx == MAX_PKT_BURST);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_launch_one_lcore(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    l2fwd_main_loop((<span class="keyword">struct</span> l2fwd_crypto_options *)arg);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Display command line arguments usage */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l2fwd_crypto_usage(<span class="keyword">const</span> <span class="keywordtype">char</span> *prgname)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;%s [EAL options] --\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -p PORTMASK: hexadecimal bitmask of ports to configure\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -q NQ: number of queue (=ports) per lcore (default is 1)\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -s manage all ports from single lcore\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  -T PERIOD: statistics will be refreshed each PERIOD seconds&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot; (0 to disable, 10 default, 86400 maximum)\n&quot;</span></div>
<div class="line"></div>
<div class="line">        <span class="stringliteral">&quot;  --cdev_type HW / SW / ANY\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --chain HASH_CIPHER / CIPHER_HASH\n&quot;</span></div>
<div class="line"></div>
<div class="line">        <span class="stringliteral">&quot;  --cipher_algo ALGO\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --cipher_op ENCRYPT / DECRYPT\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --cipher_key KEY (bytes separated with \&quot;:\&quot;)\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --cipher_key_random_size SIZE: size of cipher key when generated randomly\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --iv IV (bytes separated with \&quot;:\&quot;)\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --iv_random_size SIZE: size of IV when generated randomly\n&quot;</span></div>
<div class="line"></div>
<div class="line">        <span class="stringliteral">&quot;  --auth_algo ALGO\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --auth_op GENERATE / VERIFY\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --auth_key KEY (bytes separated with \&quot;:\&quot;)\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --auth_key_random_size SIZE: size of auth key when generated randomly\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --aad AAD (bytes separated with \&quot;:\&quot;)\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --aad_random_size SIZE: size of AAD when generated randomly\n&quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;  --digest_size SIZE: size of digest to be generated/verified\n&quot;</span></div>
<div class="line"></div>
<div class="line">        <span class="stringliteral">&quot;  --sessionless\n&quot;</span>,</div>
<div class="line">           prgname);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_cryptodev_type(<span class="keyword">enum</span> cdev_type *type, <span class="keywordtype">char</span> *optarg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;HW&quot;</span>, optarg) == 0) {</div>
<div class="line">        *type = CDEV_TYPE_HW;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;SW&quot;</span>, optarg) == 0) {</div>
<div class="line">        *type = CDEV_TYPE_SW;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;ANY&quot;</span>, optarg) == 0) {</div>
<div class="line">        *type = CDEV_TYPE_ANY;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_crypto_opt_chain(<span class="keyword">struct</span> l2fwd_crypto_options *options, <span class="keywordtype">char</span> *optarg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;CIPHER_HASH&quot;</span>, optarg) == 0) {</div>
<div class="line">        options-&gt;xform_chain = L2FWD_CRYPTO_CIPHER_HASH;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;HASH_CIPHER&quot;</span>, optarg) == 0) {</div>
<div class="line">        options-&gt;xform_chain = L2FWD_CRYPTO_HASH_CIPHER;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;CIPHER_ONLY&quot;</span>, optarg) == 0) {</div>
<div class="line">        options-&gt;xform_chain = L2FWD_CRYPTO_CIPHER_ONLY;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;HASH_ONLY&quot;</span>, optarg) == 0) {</div>
<div class="line">        options-&gt;xform_chain = L2FWD_CRYPTO_HASH_ONLY;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_cipher_algo(<span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75e">rte_crypto_cipher_algorithm</a> *algo, <span class="keywordtype">char</span> *optarg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_CRYPTO_CIPHER_LIST_END; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp(supported_cipher_algo[i], optarg)) {</div>
<div class="line">            *algo = (<span class="keyword">enum</span> <a name="a71"></a><a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75e">rte_crypto_cipher_algorithm</a>)i;</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Cipher algorithm  not supported!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_cipher_op(<span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a3c203be2dfa1c228cc8ccf0644422321">rte_crypto_cipher_operation</a> *op, <span class="keywordtype">char</span> *optarg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;ENCRYPT&quot;</span>, optarg) == 0) {</div>
<div class="line">        *op = <a name="a72"></a><a class="code" href="rte__crypto__sym_8h.html#a3c203be2dfa1c228cc8ccf0644422321a74a31028a7180f96bcbe6c1edc298c5b">RTE_CRYPTO_CIPHER_OP_ENCRYPT</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;DECRYPT&quot;</span>, optarg) == 0) {</div>
<div class="line">        *op = <a name="a73"></a><a class="code" href="rte__crypto__sym_8h.html#a3c203be2dfa1c228cc8ccf0644422321a4ec0ce9be05fae0758c95aadfb03c4ee">RTE_CRYPTO_CIPHER_OP_DECRYPT</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Cipher operation not supported!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_key(uint8_t *data, <span class="keywordtype">char</span> *input_arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> byte_count;</div>
<div class="line">    <span class="keywordtype">char</span> *token;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (byte_count = 0, token = strtok(input_arg, <span class="stringliteral">&quot;:&quot;</span>);</div>
<div class="line">            (byte_count &lt; MAX_KEY_SIZE) &amp;&amp; (token != NULL);</div>
<div class="line">            token = strtok(NULL, <span class="stringliteral">&quot;:&quot;</span>)) {</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> number = (int)strtol(token, NULL, 16);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (errno == EINVAL || errno == ERANGE || number &gt; 0xFF)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">        data[byte_count++] = (uint8_t)number;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> byte_count;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_size(<span class="keywordtype">int</span> *size, <span class="keyword">const</span> <span class="keywordtype">char</span> *q_arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* parse hexadecimal string */</span></div>
<div class="line">    n = strtoul(q_arg, &amp;end, 10);</div>
<div class="line">    <span class="keywordflow">if</span> ((q_arg[0] == <span class="charliteral">&#39;\0&#39;</span>) || (end == NULL) || (*end != <span class="charliteral">&#39;\0&#39;</span>))</div>
<div class="line">        n = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (n == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;invalid size\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *size = n;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_auth_algo(<span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793">rte_crypto_auth_algorithm</a> *algo, <span class="keywordtype">char</span> *optarg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; RTE_CRYPTO_AUTH_LIST_END; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (!strcmp(supported_auth_algo[i], optarg)) {</div>
<div class="line">            *algo = (<span class="keyword">enum</span> <a name="a74"></a><a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793">rte_crypto_auth_algorithm</a>)i;</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Authentication algorithm specified not supported!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_auth_op(<span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a8998669d6c958fb1f0e31eeee515dd47">rte_crypto_auth_operation</a> *op, <span class="keywordtype">char</span> *optarg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;VERIFY&quot;</span>, optarg) == 0) {</div>
<div class="line">        *op = <a class="code" href="rte__crypto__sym_8h.html#a8998669d6c958fb1f0e31eeee515dd47a99f910b408b48db113988c3b841972b9">RTE_CRYPTO_AUTH_OP_VERIFY</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;GENERATE&quot;</span>, optarg) == 0) {</div>
<div class="line">        *op = <a name="a75"></a><a class="code" href="rte__crypto__sym_8h.html#a8998669d6c958fb1f0e31eeee515dd47aa4697c029df30850f9f01b1c641aca32">RTE_CRYPTO_AUTH_OP_GENERATE</a>;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Authentication operation specified not supported!\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_crypto_parse_args_long_options(<span class="keyword">struct</span> l2fwd_crypto_options *options,</div>
<div class="line">        <span class="keyword">struct</span> option *lgopts, <span class="keywordtype">int</span> option_index)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> retval;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;cdev_type&quot;</span>) == 0) {</div>
<div class="line">        retval = parse_cryptodev_type(&amp;options-&gt;type, optarg);</div>
<div class="line">        <span class="keywordflow">if</span> (retval == 0)</div>
<div class="line">            snprintf(options-&gt;string_type, MAX_STR_LEN,</div>
<div class="line">                <span class="stringliteral">&quot;%s&quot;</span>, optarg);</div>
<div class="line">        <span class="keywordflow">return</span> retval;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;chain&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> parse_crypto_opt_chain(options, optarg);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Cipher options */</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;cipher_algo&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> parse_cipher_algo(&amp;options-&gt;cipher_xform.cipher.algo,</div>
<div class="line">                optarg);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;cipher_op&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> parse_cipher_op(&amp;options-&gt;cipher_xform.cipher.op,</div>
<div class="line">                optarg);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;cipher_key&quot;</span>) == 0) {</div>
<div class="line">        options-&gt;ckey_param = 1;</div>
<div class="line">        options-&gt;cipher_xform.cipher.key.length =</div>
<div class="line">            parse_key(options-&gt;cipher_xform.cipher.key.data, optarg);</div>
<div class="line">        <span class="keywordflow">if</span> (options-&gt;cipher_xform.cipher.key.length &gt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;cipher_key_random_size&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> parse_size(&amp;options-&gt;ckey_random_size, optarg);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;iv&quot;</span>) == 0) {</div>
<div class="line">        options-&gt;iv_param = 1;</div>
<div class="line">        options-&gt;iv.length =</div>
<div class="line">            parse_key(options-&gt;iv.data, optarg);</div>
<div class="line">        <span class="keywordflow">if</span> (options-&gt;iv.length &gt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;iv_random_size&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> parse_size(&amp;options-&gt;iv_random_size, optarg);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Authentication options */</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;auth_algo&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">return</span> parse_auth_algo(&amp;options-&gt;auth_xform.auth.algo,</div>
<div class="line">                optarg);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;auth_op&quot;</span>) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> parse_auth_op(&amp;options-&gt;auth_xform.auth.op,</div>
<div class="line">                optarg);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;auth_key&quot;</span>) == 0) {</div>
<div class="line">        options-&gt;akey_param = 1;</div>
<div class="line">        options-&gt;auth_xform.auth.key.length =</div>
<div class="line">            parse_key(options-&gt;auth_xform.auth.key.data, optarg);</div>
<div class="line">        <span class="keywordflow">if</span> (options-&gt;auth_xform.auth.key.length &gt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;auth_key_random_size&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">return</span> parse_size(&amp;options-&gt;akey_random_size, optarg);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;aad&quot;</span>) == 0) {</div>
<div class="line">        options-&gt;aad_param = 1;</div>
<div class="line">        options-&gt;aad.length =</div>
<div class="line">            parse_key(options-&gt;aad.data, optarg);</div>
<div class="line">        <span class="keywordflow">if</span> (options-&gt;aad.length &gt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;aad_random_size&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">return</span> parse_size(&amp;options-&gt;aad_random_size, optarg);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;digest_size&quot;</span>) == 0) {</div>
<div class="line">        <span class="keywordflow">return</span> parse_size(&amp;options-&gt;digest_size, optarg);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(lgopts[option_index].name, <span class="stringliteral">&quot;sessionless&quot;</span>) == 0) {</div>
<div class="line">        options-&gt;sessionless = 1;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_crypto_parse_portmask(<span class="keyword">struct</span> l2fwd_crypto_options *options,</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *q_arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pm;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* parse hexadecimal string */</span></div>
<div class="line">    pm = strtoul(q_arg, &amp;end, 16);</div>
<div class="line">    <span class="keywordflow">if</span> ((pm == <span class="charliteral">&#39;\0&#39;</span>) || (end == NULL) || (*end != <span class="charliteral">&#39;\0&#39;</span>))</div>
<div class="line">        pm = 0;</div>
<div class="line"></div>
<div class="line">    options-&gt;portmask = pm;</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;portmask == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;invalid portmask specified\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> pm;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_crypto_parse_nqueue(<span class="keyword">struct</span> l2fwd_crypto_options *options,</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *q_arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* parse hexadecimal string */</span></div>
<div class="line">    n = strtoul(q_arg, &amp;end, 10);</div>
<div class="line">    <span class="keywordflow">if</span> ((q_arg[0] == <span class="charliteral">&#39;\0&#39;</span>) || (end == NULL) || (*end != <span class="charliteral">&#39;\0&#39;</span>))</div>
<div class="line">        n = 0;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n &gt;= MAX_RX_QUEUE_PER_LCORE)</div>
<div class="line">        n = 0;</div>
<div class="line"></div>
<div class="line">    options-&gt;nb_ports_per_lcore = n;</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;nb_ports_per_lcore == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;invalid number of ports selected\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_crypto_parse_timer_period(<span class="keyword">struct</span> l2fwd_crypto_options *options,</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *q_arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> n;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* parse number string */</span></div>
<div class="line">    n = (unsigned)strtol(q_arg, &amp;end, 10);</div>
<div class="line">    <span class="keywordflow">if</span> ((q_arg[0] == <span class="charliteral">&#39;\0&#39;</span>) || (end == NULL) || (*end != <span class="charliteral">&#39;\0&#39;</span>))</div>
<div class="line">        n = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (n &gt;= MAX_TIMER_PERIOD) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Warning refresh period specified %lu is greater than &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;max value %lu! using max value&quot;</span>,</div>
<div class="line">                n, MAX_TIMER_PERIOD);</div>
<div class="line">        n = MAX_TIMER_PERIOD;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    options-&gt;refresh_period = n * 1000 * TIMER_MILLISECOND;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l2fwd_crypto_default_options(<span class="keyword">struct</span> l2fwd_crypto_options *options)</div>
<div class="line">{</div>
<div class="line">    srand(time(NULL));</div>
<div class="line"></div>
<div class="line">    options-&gt;portmask = 0xffffffff;</div>
<div class="line">    options-&gt;nb_ports_per_lcore = 1;</div>
<div class="line">    options-&gt;refresh_period = 10000;</div>
<div class="line">    options-&gt;single_lcore = 0;</div>
<div class="line">    options-&gt;sessionless = 0;</div>
<div class="line"></div>
<div class="line">    options-&gt;xform_chain = L2FWD_CRYPTO_CIPHER_HASH;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Cipher Data */</span></div>
<div class="line">    options-&gt;cipher_xform.type = <a name="a76"></a><a class="code" href="rte__crypto__sym_8h.html#a46aecd6ebcceea1eba91d16a90e76782ac8a5a68138b7ed7a6a80636dbf7d8b2c">RTE_CRYPTO_SYM_XFORM_CIPHER</a>;</div>
<div class="line">    options-&gt;cipher_xform.next = NULL;</div>
<div class="line">    options-&gt;ckey_param = 0;</div>
<div class="line">    options-&gt;ckey_random_size = -1;</div>
<div class="line">    options-&gt;cipher_xform.cipher.key.length = 0;</div>
<div class="line">    options-&gt;iv_param = 0;</div>
<div class="line">    options-&gt;iv_random_size = -1;</div>
<div class="line">    options-&gt;iv.length = 0;</div>
<div class="line"></div>
<div class="line">    options-&gt;cipher_xform.cipher.algo = <a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75ead9f8e28815f3dd2b77e7ce93b7b8a7ca">RTE_CRYPTO_CIPHER_AES_CBC</a>;</div>
<div class="line">    options-&gt;cipher_xform.cipher.op = <a class="code" href="rte__crypto__sym_8h.html#a3c203be2dfa1c228cc8ccf0644422321a74a31028a7180f96bcbe6c1edc298c5b">RTE_CRYPTO_CIPHER_OP_ENCRYPT</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Authentication Data */</span></div>
<div class="line">    options-&gt;auth_xform.type = <a name="a77"></a><a class="code" href="rte__crypto__sym_8h.html#a46aecd6ebcceea1eba91d16a90e76782a2a1c3a5cdf2efba6f028e2c70ab9c2c9">RTE_CRYPTO_SYM_XFORM_AUTH</a>;</div>
<div class="line">    options-&gt;auth_xform.next = NULL;</div>
<div class="line">    options-&gt;akey_param = 0;</div>
<div class="line">    options-&gt;akey_random_size = -1;</div>
<div class="line">    options-&gt;auth_xform.auth.key.length = 0;</div>
<div class="line">    options-&gt;aad_param = 0;</div>
<div class="line">    options-&gt;aad_random_size = -1;</div>
<div class="line">    options-&gt;aad.length = 0;</div>
<div class="line">    options-&gt;digest_size = -1;</div>
<div class="line"></div>
<div class="line">    options-&gt;auth_xform.auth.algo = <a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793a98921a1d0174e6ec9f252b408dd39d20">RTE_CRYPTO_AUTH_SHA1_HMAC</a>;</div>
<div class="line">    options-&gt;auth_xform.auth.op = <a class="code" href="rte__crypto__sym_8h.html#a8998669d6c958fb1f0e31eeee515dd47aa4697c029df30850f9f01b1c641aca32">RTE_CRYPTO_AUTH_OP_GENERATE</a>;</div>
<div class="line"></div>
<div class="line">    options-&gt;type = CDEV_TYPE_ANY;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">display_cipher_info(<span class="keyword">struct</span> l2fwd_crypto_options *options)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n---- Cipher information ---\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Algorithm: %s\n&quot;</span>,</div>
<div class="line">        supported_cipher_algo[options-&gt;cipher_xform.cipher.algo]);</div>
<div class="line">    <a name="a78"></a><a class="code" href="rte__hexdump_8h.html#ad29a838fbd4c22051204e8055c6593ed">rte_hexdump</a>(stdout, <span class="stringliteral">&quot;Cipher key:&quot;</span>,</div>
<div class="line">            options-&gt;cipher_xform.cipher.key.data,</div>
<div class="line">            options-&gt;cipher_xform.cipher.key.length);</div>
<div class="line">    <a class="code" href="rte__hexdump_8h.html#ad29a838fbd4c22051204e8055c6593ed">rte_hexdump</a>(stdout, <span class="stringliteral">&quot;IV:&quot;</span>, options-&gt;iv.data, options-&gt;iv.length);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">display_auth_info(<span class="keyword">struct</span> l2fwd_crypto_options *options)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;\n---- Authentication information ---\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Algorithm: %s\n&quot;</span>,</div>
<div class="line">        supported_auth_algo[options-&gt;auth_xform.auth.algo]);</div>
<div class="line">    <a class="code" href="rte__hexdump_8h.html#ad29a838fbd4c22051204e8055c6593ed">rte_hexdump</a>(stdout, <span class="stringliteral">&quot;Auth key:&quot;</span>,</div>
<div class="line">            options-&gt;auth_xform.auth.key.data,</div>
<div class="line">            options-&gt;auth_xform.auth.key.length);</div>
<div class="line">    <a class="code" href="rte__hexdump_8h.html#ad29a838fbd4c22051204e8055c6593ed">rte_hexdump</a>(stdout, <span class="stringliteral">&quot;AAD:&quot;</span>, options-&gt;aad.data, options-&gt;aad.length);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">l2fwd_crypto_options_print(<span class="keyword">struct</span> l2fwd_crypto_options *options)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> string_cipher_op[MAX_STR_LEN];</div>
<div class="line">    <span class="keywordtype">char</span> string_auth_op[MAX_STR_LEN];</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;cipher_xform.cipher.op == <a class="code" href="rte__crypto__sym_8h.html#a3c203be2dfa1c228cc8ccf0644422321a74a31028a7180f96bcbe6c1edc298c5b">RTE_CRYPTO_CIPHER_OP_ENCRYPT</a>)</div>
<div class="line">        strcpy(string_cipher_op, <span class="stringliteral">&quot;Encrypt&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        strcpy(string_cipher_op, <span class="stringliteral">&quot;Decrypt&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;auth_xform.auth.op == <a class="code" href="rte__crypto__sym_8h.html#a8998669d6c958fb1f0e31eeee515dd47aa4697c029df30850f9f01b1c641aca32">RTE_CRYPTO_AUTH_OP_GENERATE</a>)</div>
<div class="line">        strcpy(string_auth_op, <span class="stringliteral">&quot;Auth generate&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        strcpy(string_auth_op, <span class="stringliteral">&quot;Auth verify&quot;</span>);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Options:-\nn&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;portmask: %x\n&quot;</span>, options-&gt;portmask);</div>
<div class="line">    printf(<span class="stringliteral">&quot;ports per lcore: %u\n&quot;</span>, options-&gt;nb_ports_per_lcore);</div>
<div class="line">    printf(<span class="stringliteral">&quot;refresh period : %u\n&quot;</span>, options-&gt;refresh_period);</div>
<div class="line">    printf(<span class="stringliteral">&quot;single lcore mode: %s\n&quot;</span>,</div>
<div class="line">            options-&gt;single_lcore ? <span class="stringliteral">&quot;enabled&quot;</span> : <span class="stringliteral">&quot;disabled&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;stats_printing: %s\n&quot;</span>,</div>
<div class="line">            options-&gt;refresh_period == 0 ? <span class="stringliteral">&quot;disabled&quot;</span> : <span class="stringliteral">&quot;enabled&quot;</span>);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;sessionless crypto: %s\n&quot;</span>,</div>
<div class="line">            options-&gt;sessionless ? <span class="stringliteral">&quot;enabled&quot;</span> : <span class="stringliteral">&quot;disabled&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;ckey_param &amp;&amp; (options-&gt;ckey_random_size != -1))</div>
<div class="line">        printf(<span class="stringliteral">&quot;Cipher key already parsed, ignoring size of random key\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;akey_param &amp;&amp; (options-&gt;akey_random_size != -1))</div>
<div class="line">        printf(<span class="stringliteral">&quot;Auth key already parsed, ignoring size of random key\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;iv_param &amp;&amp; (options-&gt;iv_random_size != -1))</div>
<div class="line">        printf(<span class="stringliteral">&quot;IV already parsed, ignoring size of random IV\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;aad_param &amp;&amp; (options-&gt;aad_random_size != -1))</div>
<div class="line">        printf(<span class="stringliteral">&quot;AAD already parsed, ignoring size of random AAD\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\nCrypto chain: &quot;</span>);</div>
<div class="line">    <span class="keywordflow">switch</span> (options-&gt;xform_chain) {</div>
<div class="line">    <span class="keywordflow">case</span> L2FWD_CRYPTO_CIPHER_HASH:</div>
<div class="line">        printf(<span class="stringliteral">&quot;Input --&gt; %s --&gt; %s --&gt; Output\n&quot;</span>,</div>
<div class="line">            string_cipher_op, string_auth_op);</div>
<div class="line">        display_cipher_info(options);</div>
<div class="line">        display_auth_info(options);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> L2FWD_CRYPTO_HASH_CIPHER:</div>
<div class="line">        printf(<span class="stringliteral">&quot;Input --&gt; %s --&gt; %s --&gt; Output\n&quot;</span>,</div>
<div class="line">            string_auth_op, string_cipher_op);</div>
<div class="line">        display_cipher_info(options);</div>
<div class="line">        display_auth_info(options);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> L2FWD_CRYPTO_HASH_ONLY:</div>
<div class="line">        printf(<span class="stringliteral">&quot;Input --&gt; %s --&gt; Output\n&quot;</span>, string_auth_op);</div>
<div class="line">        display_auth_info(options);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> L2FWD_CRYPTO_CIPHER_ONLY:</div>
<div class="line">        printf(<span class="stringliteral">&quot;Input --&gt; %s --&gt; Output\n&quot;</span>, string_cipher_op);</div>
<div class="line">        display_cipher_info(options);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Parse the argument given in the command line of the application */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">l2fwd_crypto_parse_args(<span class="keyword">struct</span> l2fwd_crypto_options *options,</div>
<div class="line">        <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> opt, retval, option_index;</div>
<div class="line">    <span class="keywordtype">char</span> **argvopt = argv, *prgname = argv[0];</div>
<div class="line"></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">struct </span>option lgopts[] = {</div>
<div class="line">            { <span class="stringliteral">&quot;sessionless&quot;</span>, no_argument, 0, 0 },</div>
<div class="line"></div>
<div class="line">            { <span class="stringliteral">&quot;cdev_type&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;chain&quot;</span>, required_argument, 0, 0 },</div>
<div class="line"></div>
<div class="line">            { <span class="stringliteral">&quot;cipher_algo&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;cipher_op&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;cipher_key&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;cipher_key_random_size&quot;</span>, required_argument, 0, 0 },</div>
<div class="line"></div>
<div class="line">            { <span class="stringliteral">&quot;auth_algo&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;auth_op&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;auth_key&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;auth_key_random_size&quot;</span>, required_argument, 0, 0 },</div>
<div class="line"></div>
<div class="line">            { <span class="stringliteral">&quot;iv&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;iv_random_size&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;aad&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;aad_random_size&quot;</span>, required_argument, 0, 0 },</div>
<div class="line">            { <span class="stringliteral">&quot;digest_size&quot;</span>, required_argument, 0, 0 },</div>
<div class="line"></div>
<div class="line">            { <span class="stringliteral">&quot;sessionless&quot;</span>, no_argument, 0, 0 },</div>
<div class="line"></div>
<div class="line">            { NULL, 0, 0, 0 }</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    l2fwd_crypto_default_options(options);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> ((opt = getopt_long(argc, argvopt, <span class="stringliteral">&quot;p:q:st:&quot;</span>, lgopts,</div>
<div class="line">            &amp;option_index)) != EOF) {</div>
<div class="line">        <span class="keywordflow">switch</span> (opt) {</div>
<div class="line">        <span class="comment">/* long options */</span></div>
<div class="line">        <span class="keywordflow">case</span> 0:</div>
<div class="line">            retval = l2fwd_crypto_parse_args_long_options(options,</div>
<div class="line">                    lgopts, option_index);</div>
<div class="line">            <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">                l2fwd_crypto_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* portmask */</span></div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;p&#39;</span>:</div>
<div class="line">            retval = l2fwd_crypto_parse_portmask(options, optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">                l2fwd_crypto_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* nqueue */</span></div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:</div>
<div class="line">            retval = l2fwd_crypto_parse_nqueue(options, optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">                l2fwd_crypto_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* single  */</span></div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div>
<div class="line">            options-&gt;single_lcore = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* timer period */</span></div>
<div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;T&#39;</span>:</div>
<div class="line">            retval = l2fwd_crypto_parse_timer_period(options,</div>
<div class="line">                    optarg);</div>
<div class="line">            <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">                l2fwd_crypto_usage(prgname);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            l2fwd_crypto_usage(prgname);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (optind &gt;= 0)</div>
<div class="line">        argv[optind-1] = prgname;</div>
<div class="line"></div>
<div class="line">    retval = optind-1;</div>
<div class="line">    optind = 0; <span class="comment">/* reset getopt lib */</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> retval;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Check the link status of all ports in up to 9s, and print them finally */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">check_all_ports_link_status(uint8_t port_num, uint32_t port_mask)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define CHECK_INTERVAL 100 </span><span class="comment">/* 100ms */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_CHECK_TIME 90 </span><span class="comment">/* 9s (90 * 100ms) in total */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>    uint8_t portid, count, all_ports_up, print_flag = 0;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a79"></a><a class="code" href="structrte__eth__link.html">rte_eth_link</a> link;</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\nChecking link status&quot;</span>);</div>
<div class="line">    fflush(stdout);</div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt;= MAX_CHECK_TIME; count++) {</div>
<div class="line">        all_ports_up = 1;</div>
<div class="line">        <span class="keywordflow">for</span> (portid = 0; portid &lt; port_num; portid++) {</div>
<div class="line">            <span class="keywordflow">if</span> ((port_mask &amp; (1 &lt;&lt; portid)) == 0)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            memset(&amp;link, 0, <span class="keyword">sizeof</span>(link));</div>
<div class="line">            <a name="a80"></a><a class="code" href="rte__ethdev_8h.html#a6908b1ef94c95ef85af851e6705a5f93">rte_eth_link_get_nowait</a>(portid, &amp;link);</div>
<div class="line">            <span class="comment">/* print link status if flag set */</span></div>
<div class="line">            <span class="keywordflow">if</span> (print_flag == 1) {</div>
<div class="line">                <span class="keywordflow">if</span> (link.link_status)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Port %d Link Up - speed %u &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Mbps - %s\n&quot;</span>, (uint8_t)portid,</div>
<div class="line">                        (<span class="keywordtype">unsigned</span>)link.link_speed,</div>
<div class="line">                (link.link_duplex == <a name="a81"></a><a class="code" href="rte__ethdev_8h.html#a042c83951613bf2db5d3056b967041d6">ETH_LINK_FULL_DUPLEX</a>) ?</div>
<div class="line">                    (<span class="stringliteral">&quot;full-duplex&quot;</span>) : (<span class="stringliteral">&quot;half-duplex\n&quot;</span>));</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    printf(<span class="stringliteral">&quot;Port %d Link Down\n&quot;</span>,</div>
<div class="line">                        (uint8_t)portid);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/* clear all_ports_up flag if any link down */</span></div>
<div class="line">            <span class="keywordflow">if</span> (link.link_status == <a name="a82"></a><a class="code" href="rte__ethdev_8h.html#a08c012f37e07726170ff67daf667d850">ETH_LINK_DOWN</a>) {</div>
<div class="line">                all_ports_up = 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* after finally printing all link status, get out */</span></div>
<div class="line">        <span class="keywordflow">if</span> (print_flag == 1)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (all_ports_up == 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">            fflush(stdout);</div>
<div class="line">            <a name="a83"></a><a class="code" href="rte__cycles_8h.html#af73b844d50b98de74b1a0e1730262f85">rte_delay_ms</a>(CHECK_INTERVAL);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* set the print_flag if all ports up or timeout */</span></div>
<div class="line">        <span class="keywordflow">if</span> (all_ports_up == 1 || count == (MAX_CHECK_TIME - 1)) {</div>
<div class="line">            print_flag = 1;</div>
<div class="line">            printf(<span class="stringliteral">&quot;done\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Check if device has to be HW/SW or any */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">check_type(<span class="keyword">struct</span> l2fwd_crypto_options *options, <span class="keyword">struct</span> <a name="_a84"></a><a class="code" href="structrte__cryptodev__info.html">rte_cryptodev_info</a> *dev_info)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;type == CDEV_TYPE_HW &amp;&amp;</div>
<div class="line">            (dev_info-&gt;<a name="a85"></a><a class="code" href="structrte__cryptodev__info.html#aaccbcc3ce862dbe5af189ee0c3e345b1">feature_flags</a> &amp; <a name="a86"></a><a class="code" href="rte__cryptodev_8h.html#a3b1d740f9da225aebc2dc6762b9758b0">RTE_CRYPTODEV_FF_HW_ACCELERATED</a>))</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;type == CDEV_TYPE_SW &amp;&amp;</div>
<div class="line">            !(dev_info-&gt;<a class="code" href="structrte__cryptodev__info.html#aaccbcc3ce862dbe5af189ee0c3e345b1">feature_flags</a> &amp; <a class="code" href="rte__cryptodev_8h.html#a3b1d740f9da225aebc2dc6762b9758b0">RTE_CRYPTODEV_FF_HW_ACCELERATED</a>))</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;type == CDEV_TYPE_ANY)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span></div>
<div class="line">check_supported_size(uint16_t length, uint16_t min, uint16_t max,</div>
<div class="line">        uint16_t increment)</div>
<div class="line">{</div>
<div class="line">    uint16_t supp_size;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (supp_size = min; supp_size &lt;= max; supp_size += increment) {</div>
<div class="line">        <span class="keywordflow">if</span> (length == supp_size)</div>
<div class="line">            <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">initialize_cryptodevs(<span class="keyword">struct</span> l2fwd_crypto_options *options, <span class="keywordtype">unsigned</span> nb_ports,</div>
<div class="line">        uint8_t *enabled_cdevs)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> i, cdev_id, cdev_count, enabled_cdev_count = 0;</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span><a name="_a87"></a><a class="code" href="structrte__cryptodev__capabilities.html">rte_cryptodev_capabilities</a> *cap;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793">rte_crypto_auth_algorithm</a> cap_auth_algo;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a275814f8c016f661c72b320295d91793">rte_crypto_auth_algorithm</a> opt_auth_algo;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75e">rte_crypto_cipher_algorithm</a> cap_cipher_algo;</div>
<div class="line">    <span class="keyword">enum</span> <a class="code" href="rte__crypto__sym_8h.html#a6e6d5d3329c585088678e9d52b50f75e">rte_crypto_cipher_algorithm</a> opt_cipher_algo;</div>
<div class="line">    <span class="keywordtype">int</span> retval;</div>
<div class="line"></div>
<div class="line">    cdev_count = <a name="a88"></a><a class="code" href="rte__cryptodev_8h.html#a1a0c23adc25339b56bd19242194a002f">rte_cryptodev_count</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (cdev_count == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;No crypto devices available\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (cdev_id = 0; cdev_id &lt; cdev_count &amp;&amp; enabled_cdev_count &lt; nb_ports;</div>
<div class="line">            cdev_id++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a89"></a><a class="code" href="structrte__cryptodev__qp__conf.html">rte_cryptodev_qp_conf</a> qp_conf;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structrte__cryptodev__info.html">rte_cryptodev_info</a> dev_info;</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span><a name="_a90"></a><a class="code" href="structrte__cryptodev__config.html">rte_cryptodev_config</a> conf = {</div>
<div class="line">            .<a name="a91"></a><a class="code" href="structrte__cryptodev__config.html#ab6b5a902514f586f964c368ef5993cd7">nb_queue_pairs</a> = 1,</div>
<div class="line">            .socket_id = <a name="a92"></a><a class="code" href="rte__memory_8h.html#a0307f4470d3f391102b0f489fc7d91b5">SOCKET_ID_ANY</a>,</div>
<div class="line">            .session_mp = {</div>
<div class="line">                .nb_objs = 2048,</div>
<div class="line">                .cache_size = 64</div>
<div class="line">            }</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <a name="a93"></a><a class="code" href="rte__cryptodev_8h.html#aeb677c03cea6fcc48a8caa533e3729f9">rte_cryptodev_info_get</a>(cdev_id, &amp;dev_info);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Set cipher parameters */</span></div>
<div class="line">        <span class="keywordflow">if</span> (options-&gt;xform_chain == L2FWD_CRYPTO_CIPHER_HASH ||</div>
<div class="line">                options-&gt;xform_chain == L2FWD_CRYPTO_HASH_CIPHER ||</div>
<div class="line">                options-&gt;xform_chain == L2FWD_CRYPTO_CIPHER_ONLY) {</div>
<div class="line">            <span class="comment">/* Check if device supports cipher algo */</span></div>
<div class="line">            i = 0;</div>
<div class="line">            opt_cipher_algo = options-&gt;cipher_xform.cipher.algo;</div>
<div class="line">            cap = &amp;dev_info.<a name="a94"></a><a class="code" href="structrte__cryptodev__info.html#a65b9cdbb3719f657c9d8e581ba2a904b">capabilities</a>[i];</div>
<div class="line">            <span class="keywordflow">while</span> (cap-&gt;<a name="a95"></a><a class="code" href="structrte__cryptodev__capabilities.html#a394c79d7e4c59bafe3bc7678dd69c03d">op</a> != <a name="a96"></a><a class="code" href="rte__crypto_8h.html#ae6cf2c3fcd46c5ef3a43fbcb8b658739ad7a72984dd85b1c8b59cad6971b02248">RTE_CRYPTO_OP_TYPE_UNDEFINED</a>) {</div>
<div class="line">                cap_cipher_algo = cap-&gt;<a name="a97"></a><a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a name="a98"></a><a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.algo;</div>
<div class="line">                <span class="keywordflow">if</span> (cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a name="a99"></a><a class="code" href="structrte__cryptodev__symmetric__capability.html#afe276edbba98b3f82f0826d7feaeb82f">xform_type</a> ==</div>
<div class="line">                        <a class="code" href="rte__crypto__sym_8h.html#a46aecd6ebcceea1eba91d16a90e76782ac8a5a68138b7ed7a6a80636dbf7d8b2c">RTE_CRYPTO_SYM_XFORM_CIPHER</a>) {</div>
<div class="line">                    <span class="keywordflow">if</span> (cap_cipher_algo == opt_cipher_algo) {</div>
<div class="line">                        <span class="keywordflow">if</span> (check_type(options, &amp;dev_info) == 0)</div>
<div class="line">                            <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">                cap = &amp;dev_info.<a class="code" href="structrte__cryptodev__info.html#a65b9cdbb3719f657c9d8e581ba2a904b">capabilities</a>[++i];</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a394c79d7e4c59bafe3bc7678dd69c03d">op</a> == <a class="code" href="rte__crypto_8h.html#ae6cf2c3fcd46c5ef3a43fbcb8b658739ad7a72984dd85b1c8b59cad6971b02248">RTE_CRYPTO_OP_TYPE_UNDEFINED</a>) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Algorithm %s not supported by cryptodev %u&quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot; or device not of preferred type (%s)\n&quot;</span>,</div>
<div class="line">                    supported_cipher_algo[opt_cipher_algo],</div>
<div class="line">                    cdev_id,</div>
<div class="line">                    options-&gt;string_type);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            options-&gt;block_size = cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.block_size;</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of provided IV is supported</span></div>
<div class="line"><span class="comment">             * by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            <span class="keywordflow">if</span> (options-&gt;iv_param) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(options-&gt;iv.length,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.iv_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.iv_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.iv_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported IV length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of IV to be randomly generated</span></div>
<div class="line"><span class="comment">             * is supported by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;iv_random_size != -1) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(options-&gt;iv_random_size,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.iv_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.iv_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.iv_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported IV length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                options-&gt;iv.length = options-&gt;iv_random_size;</div>
<div class="line">            <span class="comment">/* No size provided, use minimum size. */</span></div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                options-&gt;iv.length = cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.iv_size.min;</div>
<div class="line"></div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of provided cipher key is supported</span></div>
<div class="line"><span class="comment">             * by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            <span class="keywordflow">if</span> (options-&gt;ckey_param) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(</div>
<div class="line">                        options-&gt;cipher_xform.cipher.key.length,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.key_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.key_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.key_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported cipher key length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of the cipher key to be randomly generated</span></div>
<div class="line"><span class="comment">             * is supported by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;ckey_random_size != -1) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(options-&gt;ckey_random_size,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.key_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.key_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.key_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported cipher key length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                options-&gt;cipher_xform.cipher.key.length =</div>
<div class="line">                            options-&gt;ckey_random_size;</div>
<div class="line">            <span class="comment">/* No size provided, use minimum size. */</span></div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                options-&gt;cipher_xform.cipher.key.length =</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a26c42c4ef46b753ea4fe3a6abe90321d">cipher</a>.key_size.min;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (!options-&gt;ckey_param)</div>
<div class="line">                generate_random_key(</div>
<div class="line">                    options-&gt;cipher_xform.cipher.key.data,</div>
<div class="line">                    options-&gt;cipher_xform.cipher.key.length);</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Set auth parameters */</span></div>
<div class="line">        <span class="keywordflow">if</span> (options-&gt;xform_chain == L2FWD_CRYPTO_CIPHER_HASH ||</div>
<div class="line">                options-&gt;xform_chain == L2FWD_CRYPTO_HASH_CIPHER ||</div>
<div class="line">                options-&gt;xform_chain == L2FWD_CRYPTO_HASH_ONLY) {</div>
<div class="line">            <span class="comment">/* Check if device supports auth algo */</span></div>
<div class="line">            i = 0;</div>
<div class="line">            opt_auth_algo = options-&gt;auth_xform.auth.algo;</div>
<div class="line">            cap = &amp;dev_info.<a class="code" href="structrte__cryptodev__info.html#a65b9cdbb3719f657c9d8e581ba2a904b">capabilities</a>[i];</div>
<div class="line">            <span class="keywordflow">while</span> (cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a394c79d7e4c59bafe3bc7678dd69c03d">op</a> != <a class="code" href="rte__crypto_8h.html#ae6cf2c3fcd46c5ef3a43fbcb8b658739ad7a72984dd85b1c8b59cad6971b02248">RTE_CRYPTO_OP_TYPE_UNDEFINED</a>) {</div>
<div class="line">                cap_auth_algo = cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a name="a100"></a><a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.algo;</div>
<div class="line">                <span class="keywordflow">if</span> ((cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#afe276edbba98b3f82f0826d7feaeb82f">xform_type</a> == <a class="code" href="rte__crypto__sym_8h.html#a46aecd6ebcceea1eba91d16a90e76782a2a1c3a5cdf2efba6f028e2c70ab9c2c9">RTE_CRYPTO_SYM_XFORM_AUTH</a>) &amp;&amp;</div>
<div class="line">                        (cap_auth_algo == opt_auth_algo) &amp;&amp;</div>
<div class="line">                        (check_type(options, &amp;dev_info) == 0)) {</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">                cap = &amp;dev_info.<a class="code" href="structrte__cryptodev__info.html#a65b9cdbb3719f657c9d8e581ba2a904b">capabilities</a>[++i];</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a394c79d7e4c59bafe3bc7678dd69c03d">op</a> == <a class="code" href="rte__crypto_8h.html#ae6cf2c3fcd46c5ef3a43fbcb8b658739ad7a72984dd85b1c8b59cad6971b02248">RTE_CRYPTO_OP_TYPE_UNDEFINED</a>) {</div>
<div class="line">                printf(<span class="stringliteral">&quot;Algorithm %s not supported by cryptodev %u&quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot; or device not of preferred type (%s)\n&quot;</span>,</div>
<div class="line">                    supported_auth_algo[opt_auth_algo],</div>
<div class="line">                    cdev_id,</div>
<div class="line">                    options-&gt;string_type);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            options-&gt;block_size = cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.block_size;</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of provided AAD is supported</span></div>
<div class="line"><span class="comment">             * by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            <span class="keywordflow">if</span> (options-&gt;aad_param) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(options-&gt;aad.length,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.aad_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.aad_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.aad_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported AAD length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of AAD to be randomly generated</span></div>
<div class="line"><span class="comment">             * is supported by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;aad_random_size != -1) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(options-&gt;aad_random_size,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.aad_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.aad_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.aad_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported AAD length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                options-&gt;aad.length = options-&gt;aad_random_size;</div>
<div class="line">            <span class="comment">/* No size provided, use minimum size. */</span></div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                options-&gt;aad.length = cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.aad_size.min;</div>
<div class="line"></div>
<div class="line">            options-&gt;auth_xform.auth.add_auth_data_length =</div>
<div class="line">                        options-&gt;aad.length;</div>
<div class="line"></div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of provided auth key is supported</span></div>
<div class="line"><span class="comment">             * by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            <span class="keywordflow">if</span> (options-&gt;akey_param) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(</div>
<div class="line">                        options-&gt;auth_xform.auth.key.length,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.key_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.key_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.key_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported auth key length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Check if length of the auth key to be randomly generated</span></div>
<div class="line"><span class="comment">             * is supported by the algorithm chosen.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (options-&gt;akey_random_size != -1) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(options-&gt;akey_random_size,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.key_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.key_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.key_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported auth key length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                options-&gt;auth_xform.auth.key.length =</div>
<div class="line">                            options-&gt;akey_random_size;</div>
<div class="line">            <span class="comment">/* No size provided, use minimum size. */</span></div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                options-&gt;auth_xform.auth.key.length =</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.key_size.min;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (!options-&gt;akey_param)</div>
<div class="line">                generate_random_key(</div>
<div class="line">                    options-&gt;auth_xform.auth.key.data,</div>
<div class="line">                    options-&gt;auth_xform.auth.key.length);</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* Check if digest size is supported by the algorithm. */</span></div>
<div class="line">            <span class="keywordflow">if</span> (options-&gt;digest_size != -1) {</div>
<div class="line">                <span class="keywordflow">if</span> (check_supported_size(options-&gt;digest_size,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.digest_size.min,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.digest_size.max,</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.digest_size.increment)</div>
<div class="line">                            != 0) {</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Unsupported digest length\n&quot;</span>);</div>
<div class="line">                    <span class="keywordflow">return</span> -1;</div>
<div class="line">                }</div>
<div class="line">                options-&gt;auth_xform.auth.digest_length =</div>
<div class="line">                            options-&gt;digest_size;</div>
<div class="line">            <span class="comment">/* No size provided, use minimum size. */</span></div>
<div class="line">            } <span class="keywordflow">else</span></div>
<div class="line">                options-&gt;auth_xform.auth.digest_length =</div>
<div class="line">                        cap-&gt;<a class="code" href="structrte__cryptodev__capabilities.html#a632781b6c57a8ece1eb98dd4d06e1e8c">sym</a>.<a class="code" href="structrte__cryptodev__symmetric__capability.html#a99a7e436560918dcb874800f67b2ee7d">auth</a>.digest_size.min;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        retval = <a name="a101"></a><a class="code" href="rte__cryptodev_8h.html#a58207367533ac9e65e4a611ba78090e5">rte_cryptodev_configure</a>(cdev_id, &amp;conf);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Failed to configure cryptodev %u&quot;</span>, cdev_id);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        qp_conf.nb_descriptors = 2048;</div>
<div class="line"></div>
<div class="line">        retval = <a name="a102"></a><a class="code" href="rte__cryptodev_8h.html#ae4388e0326c8789ddf39e32044dc4187">rte_cryptodev_queue_pair_setup</a>(cdev_id, 0, &amp;qp_conf,</div>
<div class="line">                <a class="code" href="rte__memory_8h.html#a0307f4470d3f391102b0f489fc7d91b5">SOCKET_ID_ANY</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Failed to setup queue pair %u on cryptodev %u&quot;</span>,</div>
<div class="line">                    0, cdev_id);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        l2fwd_enabled_crypto_mask |= (1 &lt;&lt; cdev_id);</div>
<div class="line"></div>
<div class="line">        enabled_cdevs[cdev_id] = 1;</div>
<div class="line">        enabled_cdev_count++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> enabled_cdev_count;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">initialize_ports(<span class="keyword">struct</span> l2fwd_crypto_options *options)</div>
<div class="line">{</div>
<div class="line">    uint8_t last_portid, portid;</div>
<div class="line">    <span class="keywordtype">unsigned</span> enabled_portcount = 0;</div>
<div class="line">    <span class="keywordtype">unsigned</span> nb_ports = <a name="a103"></a><a class="code" href="rte__ethdev_8h.html#ac228551f31e57645c7bb5efd1db2e63d">rte_eth_dev_count</a>();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (nb_ports == 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;No Ethernet ports - bye\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (nb_ports &gt; RTE_MAX_ETHPORTS)</div>
<div class="line">        nb_ports = RTE_MAX_ETHPORTS;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Reset l2fwd_dst_ports */</span></div>
<div class="line">    <span class="keywordflow">for</span> (portid = 0; portid &lt; RTE_MAX_ETHPORTS; portid++)</div>
<div class="line">        l2fwd_dst_ports[portid] = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (last_portid = 0, portid = 0; portid &lt; nb_ports; portid++) {</div>
<div class="line">        <span class="keywordtype">int</span> retval;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Skip ports that are not enabled */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((options-&gt;portmask &amp; (1 &lt;&lt; portid)) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* init port */</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Initializing port %u... &quot;</span>, (<span class="keywordtype">unsigned</span>) portid);</div>
<div class="line">        fflush(stdout);</div>
<div class="line">        retval = <a name="a104"></a><a class="code" href="rte__ethdev_8h.html#ac30d075b4b206c7122e200164ce69893">rte_eth_dev_configure</a>(portid, 1, 1, &amp;port_conf);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;Cannot configure device: err=%d, port=%u\n&quot;</span>,</div>
<div class="line">                  retval, (<span class="keywordtype">unsigned</span>) portid);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* init one RX queue */</span></div>
<div class="line">        fflush(stdout);</div>
<div class="line">        retval = <a name="a105"></a><a class="code" href="rte__ethdev_8h.html#a8db38c1bb895250a99b217bb24126d8e">rte_eth_rx_queue_setup</a>(portid, 0, nb_rxd,</div>
<div class="line">                         rte_eth_dev_socket_id(portid),</div>
<div class="line">                         NULL, l2fwd_pktmbuf_pool);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;rte_eth_rx_queue_setup:err=%d, port=%u\n&quot;</span>,</div>
<div class="line">                    retval, (<span class="keywordtype">unsigned</span>) portid);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* init one TX queue on each port */</span></div>
<div class="line">        fflush(stdout);</div>
<div class="line">        retval = <a name="a106"></a><a class="code" href="rte__ethdev_8h.html#af4b9fe682d4487fb3efecc40d08d04a7">rte_eth_tx_queue_setup</a>(portid, 0, nb_txd,</div>
<div class="line">                rte_eth_dev_socket_id(portid),</div>
<div class="line">                NULL);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;rte_eth_tx_queue_setup:err=%d, port=%u\n&quot;</span>,</div>
<div class="line">                retval, (<span class="keywordtype">unsigned</span>) portid);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Start device */</span></div>
<div class="line">        retval = <a name="a107"></a><a class="code" href="rte__ethdev_8h.html#ab6cdec593efa6b9809e711ade3a2fe24">rte_eth_dev_start</a>(portid);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;rte_eth_dev_start:err=%d, port=%u\n&quot;</span>,</div>
<div class="line">                    retval, (<span class="keywordtype">unsigned</span>) portid);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a name="a108"></a><a class="code" href="rte__ethdev_8h.html#aa8064b25aee324bdbbf779ea23d55f49">rte_eth_promiscuous_enable</a>(portid);</div>
<div class="line"></div>
<div class="line">        <a name="a109"></a><a class="code" href="rte__ethdev_8h.html#a5686df2817980236f2c4f1cc72dd2c30">rte_eth_macaddr_get</a>(portid, &amp;l2fwd_ports_eth_addr[portid]);</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Port %u, MAC address: %02X:%02X:%02X:%02X:%02X:%02X\n\n&quot;</span>,</div>
<div class="line">                (<span class="keywordtype">unsigned</span>) portid,</div>
<div class="line">                l2fwd_ports_eth_addr[portid].addr_bytes[0],</div>
<div class="line">                l2fwd_ports_eth_addr[portid].addr_bytes[1],</div>
<div class="line">                l2fwd_ports_eth_addr[portid].addr_bytes[2],</div>
<div class="line">                l2fwd_ports_eth_addr[portid].addr_bytes[3],</div>
<div class="line">                l2fwd_ports_eth_addr[portid].addr_bytes[4],</div>
<div class="line">                l2fwd_ports_eth_addr[portid].addr_bytes[5]);</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* initialize port stats */</span></div>
<div class="line">        memset(&amp;port_statistics, 0, <span class="keyword">sizeof</span>(port_statistics));</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Setup port forwarding table */</span></div>
<div class="line">        <span class="keywordflow">if</span> (enabled_portcount % 2) {</div>
<div class="line">            l2fwd_dst_ports[portid] = last_portid;</div>
<div class="line">            l2fwd_dst_ports[last_portid] = portid;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            last_portid = portid;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        l2fwd_enabled_port_mask |= (1 &lt;&lt; portid);</div>
<div class="line">        enabled_portcount++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (enabled_portcount == 1) {</div>
<div class="line">        l2fwd_dst_ports[last_portid] = last_portid;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (enabled_portcount % 2) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;odd number of ports in portmask- bye\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    check_all_ports_link_status(nb_ports, l2fwd_enabled_port_mask);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> enabled_portcount;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">reserve_key_memory(<span class="keyword">struct</span> l2fwd_crypto_options *options)</div>
<div class="line">{</div>
<div class="line">    options-&gt;cipher_xform.cipher.key.data = <a name="a110"></a><a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(<span class="stringliteral">&quot;crypto key&quot;</span>,</div>
<div class="line">                        MAX_KEY_SIZE, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;cipher_xform.cipher.key.data == NULL)</div>
<div class="line">        <a name="a111"></a><a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Failed to allocate memory for cipher key&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    options-&gt;auth_xform.auth.key.data = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(<span class="stringliteral">&quot;auth key&quot;</span>,</div>
<div class="line">                        MAX_KEY_SIZE, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;auth_xform.auth.key.data == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Failed to allocate memory for auth key&quot;</span>);</div>
<div class="line"></div>
<div class="line">    options-&gt;iv.data = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(<span class="stringliteral">&quot;iv&quot;</span>, MAX_KEY_SIZE, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;iv.data == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Failed to allocate memory for IV&quot;</span>);</div>
<div class="line">    options-&gt;iv.phys_addr = <a name="a112"></a><a class="code" href="rte__malloc_8h.html#abbcef27bc69ed523fa5e46061ebaf656">rte_malloc_virt2phy</a>(options-&gt;iv.data);</div>
<div class="line"></div>
<div class="line">    options-&gt;aad.data = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(<span class="stringliteral">&quot;aad&quot;</span>, MAX_KEY_SIZE, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (options-&gt;aad.data == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Failed to allocate memory for AAD&quot;</span>);</div>
<div class="line">    options-&gt;aad.phys_addr = <a class="code" href="rte__malloc_8h.html#abbcef27bc69ed523fa5e46061ebaf656">rte_malloc_virt2phy</a>(options-&gt;aad.data);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>lcore_queue_conf *qconf;</div>
<div class="line">    <span class="keyword">struct </span>l2fwd_crypto_options options;</div>
<div class="line"></div>
<div class="line">    uint8_t nb_ports, nb_cryptodevs, portid, cdev_id;</div>
<div class="line">    <span class="keywordtype">unsigned</span> lcore_id, rx_lcore_id;</div>
<div class="line">    <span class="keywordtype">int</span> ret, enabled_cdevcount, enabled_portcount;</div>
<div class="line">    uint8_t enabled_cdevs[RTE_CRYPTO_MAX_DEVS] = {0};</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* init EAL */</span></div>
<div class="line">    ret = <a name="a113"></a><a class="code" href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a>(argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Invalid EAL arguments\n&quot;</span>);</div>
<div class="line">    argc -= ret;</div>
<div class="line">    argv += ret;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* reserve memory for Cipher/Auth key and IV */</span></div>
<div class="line">    reserve_key_memory(&amp;options);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* fill out the supported algorithm tables */</span></div>
<div class="line">    fill_supported_algorithm_tables();</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* parse application arguments (after the EAL ones) */</span></div>
<div class="line">    ret = l2fwd_crypto_parse_args(&amp;options, argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (ret &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Invalid L2FWD-CRYPTO arguments\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* create the mbuf pool */</span></div>
<div class="line">    l2fwd_pktmbuf_pool = <a name="a114"></a><a class="code" href="rte__mbuf_8h.html#a593921f13307803b94bbb4e0932db962">rte_pktmbuf_pool_create</a>(<span class="stringliteral">&quot;mbuf_pool&quot;</span>, NB_MBUF, 512,</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__crypto__op.html">rte_crypto_op</a>),</div>
<div class="line">            RTE_MBUF_DEFAULT_BUF_SIZE, <a name="a115"></a><a class="code" href="rte__lcore_8h.html#a2319a4f10ebccbea11e4c2f88e0da54c">rte_socket_id</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (l2fwd_pktmbuf_pool == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot create mbuf pool\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* create crypto op pool */</span></div>
<div class="line">    l2fwd_crypto_op_pool = <a name="a116"></a><a class="code" href="rte__crypto_8h.html#aa3035c7b271a4736dc9654b2eb85d1fd">rte_crypto_op_pool_create</a>(<span class="stringliteral">&quot;crypto_op_pool&quot;</span>,</div>
<div class="line">            <a class="code" href="rte__crypto_8h.html#ae6cf2c3fcd46c5ef3a43fbcb8b658739a33144a5991d4b9aaa43adb9748a067fc">RTE_CRYPTO_OP_TYPE_SYMMETRIC</a>, NB_MBUF, 128, 0,</div>
<div class="line">            <a class="code" href="rte__lcore_8h.html#a2319a4f10ebccbea11e4c2f88e0da54c">rte_socket_id</a>());</div>
<div class="line">    <span class="keywordflow">if</span> (l2fwd_crypto_op_pool == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot create crypto op pool\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Enable Ethernet ports */</span></div>
<div class="line">    enabled_portcount = initialize_ports(&amp;options);</div>
<div class="line">    <span class="keywordflow">if</span> (enabled_portcount &lt; 1)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Failed to initial Ethernet ports\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    nb_ports = <a class="code" href="rte__ethdev_8h.html#ac228551f31e57645c7bb5efd1db2e63d">rte_eth_dev_count</a>();</div>
<div class="line">    <span class="comment">/* Initialize the port/queue configuration of each logical core */</span></div>
<div class="line">    <span class="keywordflow">for</span> (rx_lcore_id = 0, qconf = NULL, portid = 0;</div>
<div class="line">            portid &lt; nb_ports; portid++) {</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* skip ports that are not enabled */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((options.portmask &amp; (1 &lt;&lt; portid)) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (options.single_lcore &amp;&amp; qconf == NULL) {</div>
<div class="line">            <span class="keywordflow">while</span> (<a name="a117"></a><a class="code" href="rte__lcore_8h.html#a076d17802fafc1fb54e168cc37c94c60">rte_lcore_is_enabled</a>(rx_lcore_id) == 0) {</div>
<div class="line">                rx_lcore_id++;</div>
<div class="line">                <span class="keywordflow">if</span> (rx_lcore_id &gt;= RTE_MAX_LCORE)</div>
<div class="line">                    <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                            <span class="stringliteral">&quot;Not enough cores\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!options.single_lcore) {</div>
<div class="line">            <span class="comment">/* get the lcore_id for this port */</span></div>
<div class="line">            <span class="keywordflow">while</span> (<a class="code" href="rte__lcore_8h.html#a076d17802fafc1fb54e168cc37c94c60">rte_lcore_is_enabled</a>(rx_lcore_id) == 0 ||</div>
<div class="line">                   lcore_queue_conf[rx_lcore_id].nb_rx_ports ==</div>
<div class="line">                   options.nb_ports_per_lcore) {</div>
<div class="line">                rx_lcore_id++;</div>
<div class="line">                <span class="keywordflow">if</span> (rx_lcore_id &gt;= RTE_MAX_LCORE)</div>
<div class="line">                    <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                            <span class="stringliteral">&quot;Not enough cores\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Assigned a new logical core in the loop above. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (qconf != &amp;lcore_queue_conf[rx_lcore_id])</div>
<div class="line">            qconf = &amp;lcore_queue_conf[rx_lcore_id];</div>
<div class="line"></div>
<div class="line">        qconf-&gt;rx_port_list[qconf-&gt;nb_rx_ports] = portid;</div>
<div class="line">        qconf-&gt;nb_rx_ports++;</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Lcore %u: RX port %u\n&quot;</span>, rx_lcore_id, (<span class="keywordtype">unsigned</span>)portid);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Enable Crypto devices */</span></div>
<div class="line">    enabled_cdevcount = initialize_cryptodevs(&amp;options, enabled_portcount,</div>
<div class="line">            enabled_cdevs);</div>
<div class="line">    <span class="keywordflow">if</span> (enabled_cdevcount &lt; 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Failed to initialize crypto devices\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (enabled_cdevcount &lt; enabled_portcount)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Number of capable crypto devices (%d) &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;has to be more or equal to number of ports (%d)\n&quot;</span>,</div>
<div class="line">                enabled_cdevcount, enabled_portcount);</div>
<div class="line"></div>
<div class="line">    nb_cryptodevs = <a class="code" href="rte__cryptodev_8h.html#a1a0c23adc25339b56bd19242194a002f">rte_cryptodev_count</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Initialize the port/cryptodev configuration of each logical core */</span></div>
<div class="line">    <span class="keywordflow">for</span> (rx_lcore_id = 0, qconf = NULL, cdev_id = 0;</div>
<div class="line">            cdev_id &lt; nb_cryptodevs &amp;&amp; enabled_cdevcount;</div>
<div class="line">            cdev_id++) {</div>
<div class="line">        <span class="comment">/* Crypto op not supported by crypto device */</span></div>
<div class="line">        <span class="keywordflow">if</span> (!enabled_cdevs[cdev_id])</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (options.single_lcore &amp;&amp; qconf == NULL) {</div>
<div class="line">            <span class="keywordflow">while</span> (<a class="code" href="rte__lcore_8h.html#a076d17802fafc1fb54e168cc37c94c60">rte_lcore_is_enabled</a>(rx_lcore_id) == 0) {</div>
<div class="line">                rx_lcore_id++;</div>
<div class="line">                <span class="keywordflow">if</span> (rx_lcore_id &gt;= RTE_MAX_LCORE)</div>
<div class="line">                    <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                            <span class="stringliteral">&quot;Not enough cores\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!options.single_lcore) {</div>
<div class="line">            <span class="comment">/* get the lcore_id for this port */</span></div>
<div class="line">            <span class="keywordflow">while</span> (<a class="code" href="rte__lcore_8h.html#a076d17802fafc1fb54e168cc37c94c60">rte_lcore_is_enabled</a>(rx_lcore_id) == 0 ||</div>
<div class="line">                   lcore_queue_conf[rx_lcore_id].nb_crypto_devs ==</div>
<div class="line">                   options.nb_ports_per_lcore) {</div>
<div class="line">                rx_lcore_id++;</div>
<div class="line">                <span class="keywordflow">if</span> (rx_lcore_id &gt;= RTE_MAX_LCORE)</div>
<div class="line">                    <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE,</div>
<div class="line">                            <span class="stringliteral">&quot;Not enough cores\n&quot;</span>);</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Assigned a new logical core in the loop above. */</span></div>
<div class="line">        <span class="keywordflow">if</span> (qconf != &amp;lcore_queue_conf[rx_lcore_id])</div>
<div class="line">            qconf = &amp;lcore_queue_conf[rx_lcore_id];</div>
<div class="line"></div>
<div class="line">        qconf-&gt;cryptodev_list[qconf-&gt;nb_crypto_devs] = cdev_id;</div>
<div class="line">        qconf-&gt;nb_crypto_devs++;</div>
<div class="line"></div>
<div class="line">        enabled_cdevcount--;</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;Lcore %u: cryptodev %u\n&quot;</span>, rx_lcore_id,</div>
<div class="line">                (<span class="keywordtype">unsigned</span>)cdev_id);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* launch per-lcore init on every lcore */</span></div>
<div class="line">    <a name="a118"></a><a class="code" href="rte__launch_8h.html#a2f78fc845135fe22c1ba1c870954b60a">rte_eal_mp_remote_launch</a>(l2fwd_launch_one_lcore, (<span class="keywordtype">void</span> *)&amp;options,</div>
<div class="line">            <a name="a119"></a><a class="code" href="rte__launch_8h.html#a83b0efa9e30a74217e7a95956845e2ada39ec34f33f669f99bd28ab7c58a952ac">CALL_MASTER</a>);</div>
<div class="line">    <a name="a120"></a><a class="code" href="rte__lcore_8h.html#a7c9e9927c695ee953c15d64026511919">RTE_LCORE_FOREACH_SLAVE</a>(lcore_id) {</div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a121"></a><a class="code" href="rte__launch_8h.html#a1282dc7cd7e6793afab3ef29239ddf54">rte_eal_wait_lcore</a>(lcore_id) &lt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
