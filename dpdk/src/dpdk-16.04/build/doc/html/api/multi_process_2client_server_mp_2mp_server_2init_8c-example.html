<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: multi_process/client_server_mp/mp_server/init.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">multi_process/client_server_mp/mp_server/init.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2014 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/queue.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdarg.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memory_8h.html">rte_memory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memzone_8h.html">rte_memzone.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__eal_8h.html">rte_eal.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__byteorder_8h.html">rte_byteorder.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__atomic_8h.html">rte_atomic.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__launch_8h.html">rte_launch.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__per__lcore_8h.html">rte_per_lcore.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__lcore_8h.html">rte_lcore.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__branch__prediction_8h.html">rte_branch_prediction.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__debug_8h.html">rte_debug.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ring_8h.html">rte_ring.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__log_8h.html">rte_log.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mempool_8h.html">rte_mempool.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__memcpy_8h.html">rte_memcpy.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__mbuf_8h.html">rte_mbuf.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__interrupts_8h.html">rte_interrupts.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__pci_8h.html">rte_pci.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ether_8h.html">rte_ether.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ethdev_8h.html">rte_ethdev.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__fbk__hash_8h.html">rte_fbk_hash.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__string__fns_8h.html">rte_string_fns.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__cycles_8h.html">rte_cycles.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;common.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;args.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;init.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define MBUFS_PER_CLIENT 1536</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBUFS_PER_PORT 1536</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MBUF_CACHE_SIZE 512</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define RTE_MP_RX_DESC_DEFAULT 512</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define RTE_MP_TX_DESC_DEFAULT 512</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define CLIENT_QUEUE_RINGSIZE 128</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#define NO_FLAGS 0</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/* The mbuf pool for packet rx */</span></div>
<div class="line"><span class="keyword">struct </span><a name="_a0"></a><a class="code" href="structrte__mempool.html">rte_mempool</a> *pktmbuf_pool;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* array of info/queues for clients */</span></div>
<div class="line"><span class="keyword">struct </span>client *clients = NULL;</div>
<div class="line"></div>
<div class="line"><span class="comment">/* the port details */</span></div>
<div class="line"><span class="keyword">struct </span>port_info *ports;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">init_mbuf_pools(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> num_mbufs = (num_clients * MBUFS_PER_CLIENT) \</div>
<div class="line">            + (ports-&gt;num_ports * MBUFS_PER_PORT);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* don&#39;t pass single-producer/single-consumer flags to mbuf create as it</span></div>
<div class="line"><span class="comment">     * seems faster to use a cache instead */</span></div>
<div class="line">    printf(<span class="stringliteral">&quot;Creating mbuf pool &#39;%s&#39; [%u mbufs] ...\n&quot;</span>,</div>
<div class="line">            PKTMBUF_POOL_NAME, num_mbufs);</div>
<div class="line">    pktmbuf_pool = <a name="a1"></a><a class="code" href="rte__mbuf_8h.html#a593921f13307803b94bbb4e0932db962">rte_pktmbuf_pool_create</a>(PKTMBUF_POOL_NAME, num_mbufs,</div>
<div class="line">        MBUF_CACHE_SIZE, 0, RTE_MBUF_DEFAULT_BUF_SIZE, <a name="a2"></a><a class="code" href="rte__lcore_8h.html#a2319a4f10ebccbea11e4c2f88e0da54c">rte_socket_id</a>());</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> pktmbuf_pool == NULL; <span class="comment">/* 0  on success */</span></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">init_port(uint8_t port_num)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* for port configuration all features are off by default */</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span><a name="_a3"></a><a class="code" href="structrte__eth__conf.html">rte_eth_conf</a> port_conf = {</div>
<div class="line">        .<a name="a4"></a><a class="code" href="structrte__eth__conf.html#a346eef99c24f617b74c440c1aa565d01">rxmode</a> = {</div>
<div class="line">            .<a name="a5"></a><a class="code" href="structrte__eth__rxmode.html#aa0562513c4569f1aa53050f1beac6b5d">mq_mode</a> = <a name="a6"></a><a class="code" href="rte__ethdev_8h.html#a586b8e86131b4ec0ccaf464e847ccf3eaa06694239b7ecf1efa3c9243b9e7b4c0">ETH_MQ_RX_RSS</a></div>
<div class="line">        }</div>
<div class="line">    };</div>
<div class="line">    <span class="keyword">const</span> uint16_t rx_rings = 1, tx_rings = num_clients;</div>
<div class="line">    <span class="keyword">const</span> uint16_t rx_ring_size = RTE_MP_RX_DESC_DEFAULT;</div>
<div class="line">    <span class="keyword">const</span> uint16_t tx_ring_size = RTE_MP_TX_DESC_DEFAULT;</div>
<div class="line"></div>
<div class="line">    uint16_t q;</div>
<div class="line">    <span class="keywordtype">int</span> retval;</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;Port %u init ... &quot;</span>, (<span class="keywordtype">unsigned</span>)port_num);</div>
<div class="line">    fflush(stdout);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Standard DPDK port initialisation - config port, then set up</span></div>
<div class="line"><span class="comment">     * rx and tx rings */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((retval = <a name="a7"></a><a class="code" href="rte__ethdev_8h.html#ac30d075b4b206c7122e200164ce69893">rte_eth_dev_configure</a>(port_num, rx_rings, tx_rings,</div>
<div class="line">        &amp;port_conf)) != 0)</div>
<div class="line">        <span class="keywordflow">return</span> retval;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (q = 0; q &lt; rx_rings; q++) {</div>
<div class="line">        retval = <a name="a8"></a><a class="code" href="rte__ethdev_8h.html#a8db38c1bb895250a99b217bb24126d8e">rte_eth_rx_queue_setup</a>(port_num, q, rx_ring_size,</div>
<div class="line">                rte_eth_dev_socket_id(port_num),</div>
<div class="line">                NULL, pktmbuf_pool);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) <span class="keywordflow">return</span> retval;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> ( q = 0; q &lt; tx_rings; q ++ ) {</div>
<div class="line">        retval = <a name="a9"></a><a class="code" href="rte__ethdev_8h.html#af4b9fe682d4487fb3efecc40d08d04a7">rte_eth_tx_queue_setup</a>(port_num, q, tx_ring_size,</div>
<div class="line">                rte_eth_dev_socket_id(port_num),</div>
<div class="line">                NULL);</div>
<div class="line">        <span class="keywordflow">if</span> (retval &lt; 0) <span class="keywordflow">return</span> retval;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a name="a10"></a><a class="code" href="rte__ethdev_8h.html#aa8064b25aee324bdbbf779ea23d55f49">rte_eth_promiscuous_enable</a>(port_num);</div>
<div class="line"></div>
<div class="line">    retval  = <a name="a11"></a><a class="code" href="rte__ethdev_8h.html#ab6cdec593efa6b9809e711ade3a2fe24">rte_eth_dev_start</a>(port_num);</div>
<div class="line">    <span class="keywordflow">if</span> (retval &lt; 0) <span class="keywordflow">return</span> retval;</div>
<div class="line"></div>
<div class="line">    printf( <span class="stringliteral">&quot;done: \n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">init_shm_rings(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> i;</div>
<div class="line">    <span class="keywordtype">unsigned</span> socket_id;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * q_name;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> ringsize = CLIENT_QUEUE_RINGSIZE;</div>
<div class="line"></div>
<div class="line">    clients = <a name="a12"></a><a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(<span class="stringliteral">&quot;client details&quot;</span>,</div>
<div class="line">        <span class="keyword">sizeof</span>(*clients) * num_clients, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (clients == NULL)</div>
<div class="line">        <a name="a13"></a><a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot allocate memory for client program details\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; num_clients; i++) {</div>
<div class="line">        <span class="comment">/* Create an RX queue for each client */</span></div>
<div class="line">        socket_id = <a class="code" href="rte__lcore_8h.html#a2319a4f10ebccbea11e4c2f88e0da54c">rte_socket_id</a>();</div>
<div class="line">        q_name = get_rx_queue_name(i);</div>
<div class="line">        clients[i].rx_q = <a name="a14"></a><a class="code" href="rte__ring_8h.html#a5556487d8ec76cacfc059b66d8b77c98">rte_ring_create</a>(q_name,</div>
<div class="line">                ringsize, socket_id,</div>
<div class="line">                <a name="a15"></a><a class="code" href="rte__ring_8h.html#a127c66adbeab4653a47649993b94f35b">RING_F_SP_ENQ</a> | <a name="a16"></a><a class="code" href="rte__ring_8h.html#a421a61b2f94cdf65b3a6ac146c492fb9">RING_F_SC_DEQ</a> ); <span class="comment">/* single prod, single cons */</span></div>
<div class="line">        <span class="keywordflow">if</span> (clients[i].rx_q == NULL)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot create rx ring queue for client %u\n&quot;</span>, i);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Check the link status of all ports in up to 9s, and print them finally */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">check_all_ports_link_status(uint8_t port_num, uint32_t port_mask)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define CHECK_INTERVAL 100 </span><span class="comment">/* 100ms */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAX_CHECK_TIME 90 </span><span class="comment">/* 9s (90 * 100ms) in total */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor"></span>    uint8_t portid, count, all_ports_up, print_flag = 0;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a17"></a><a class="code" href="structrte__eth__link.html">rte_eth_link</a> link;</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\nChecking link status&quot;</span>);</div>
<div class="line">    fflush(stdout);</div>
<div class="line">    <span class="keywordflow">for</span> (count = 0; count &lt;= MAX_CHECK_TIME; count++) {</div>
<div class="line">        all_ports_up = 1;</div>
<div class="line">        <span class="keywordflow">for</span> (portid = 0; portid &lt; port_num; portid++) {</div>
<div class="line">            <span class="keywordflow">if</span> ((port_mask &amp; (1 &lt;&lt; ports-&gt;id[portid])) == 0)</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            memset(&amp;link, 0, <span class="keyword">sizeof</span>(link));</div>
<div class="line">            <a name="a18"></a><a class="code" href="rte__ethdev_8h.html#a6908b1ef94c95ef85af851e6705a5f93">rte_eth_link_get_nowait</a>(ports-&gt;id[portid], &amp;link);</div>
<div class="line">            <span class="comment">/* print link status if flag set */</span></div>
<div class="line">            <span class="keywordflow">if</span> (print_flag == 1) {</div>
<div class="line">                <span class="keywordflow">if</span> (link.link_status)</div>
<div class="line">                    printf(<span class="stringliteral">&quot;Port %d Link Up - speed %u &quot;</span></div>
<div class="line">                        <span class="stringliteral">&quot;Mbps - %s\n&quot;</span>, ports-&gt;id[portid],</div>
<div class="line">                        (<span class="keywordtype">unsigned</span>)link.link_speed,</div>
<div class="line">                (link.link_duplex == <a name="a19"></a><a class="code" href="rte__ethdev_8h.html#a042c83951613bf2db5d3056b967041d6">ETH_LINK_FULL_DUPLEX</a>) ?</div>
<div class="line">                    (<span class="stringliteral">&quot;full-duplex&quot;</span>) : (<span class="stringliteral">&quot;half-duplex\n&quot;</span>));</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                    printf(<span class="stringliteral">&quot;Port %d Link Down\n&quot;</span>,</div>
<div class="line">                        (uint8_t)ports-&gt;id[portid]);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line">            <span class="comment">/* clear all_ports_up flag if any link down */</span></div>
<div class="line">            <span class="keywordflow">if</span> (link.link_status == <a name="a20"></a><a class="code" href="rte__ethdev_8h.html#a08c012f37e07726170ff67daf667d850">ETH_LINK_DOWN</a>) {</div>
<div class="line">                all_ports_up = 0;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* after finally printing all link status, get out */</span></div>
<div class="line">        <span class="keywordflow">if</span> (print_flag == 1)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (all_ports_up == 0) {</div>
<div class="line">            printf(<span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line">            fflush(stdout);</div>
<div class="line">            <a name="a21"></a><a class="code" href="rte__cycles_8h.html#af73b844d50b98de74b1a0e1730262f85">rte_delay_ms</a>(CHECK_INTERVAL);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* set the print_flag if all ports up or timeout */</span></div>
<div class="line">        <span class="keywordflow">if</span> (all_ports_up == 1 || count == (MAX_CHECK_TIME - 1)) {</div>
<div class="line">            print_flag = 1;</div>
<div class="line">            printf(<span class="stringliteral">&quot;done\n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">init(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> retval;</div>
<div class="line">    <span class="keyword">const</span> <span class="keyword">struct </span><a name="_a22"></a><a class="code" href="structrte__memzone.html">rte_memzone</a> *mz;</div>
<div class="line">    uint8_t i, total_ports;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* init EAL, parsing EAL args */</span></div>
<div class="line">    retval = <a name="a23"></a><a class="code" href="rte__eal_8h.html#a5c3f4dddc25e38c5a186ecd8a69260e3">rte_eal_init</a>(argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (retval &lt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    argc -= retval;</div>
<div class="line">    argv += retval;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* get total number of ports */</span></div>
<div class="line">    total_ports = <a name="a24"></a><a class="code" href="rte__ethdev_8h.html#ac228551f31e57645c7bb5efd1db2e63d">rte_eth_dev_count</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* set up array for port data */</span></div>
<div class="line">    mz = <a name="a25"></a><a class="code" href="rte__memzone_8h.html#a3ccbea77ccab608c6e683817a3eb170f">rte_memzone_reserve</a>(MZ_PORT_INFO, <span class="keyword">sizeof</span>(*ports),</div>
<div class="line">                <a class="code" href="rte__lcore_8h.html#a2319a4f10ebccbea11e4c2f88e0da54c">rte_socket_id</a>(), NO_FLAGS);</div>
<div class="line">    <span class="keywordflow">if</span> (mz == NULL)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot reserve memory zone for port information\n&quot;</span>);</div>
<div class="line">    memset(mz-&gt;<a name="a26"></a><a class="code" href="structrte__memzone.html#ae5bd6c22dbf0f6b5b0ae0233f8eb3704">addr</a>, 0, <span class="keyword">sizeof</span>(*ports));</div>
<div class="line">    ports = mz-&gt;<a class="code" href="structrte__memzone.html#ae5bd6c22dbf0f6b5b0ae0233f8eb3704">addr</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* parse additional, application arguments */</span></div>
<div class="line">    retval = parse_app_args(total_ports, argc, argv);</div>
<div class="line">    <span class="keywordflow">if</span> (retval != 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* initialise mbuf pools */</span></div>
<div class="line">    retval = init_mbuf_pools();</div>
<div class="line">    <span class="keywordflow">if</span> (retval != 0)</div>
<div class="line">        <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot create needed mbuf pools\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* now initialise the ports we will use */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; ports-&gt;num_ports; i++) {</div>
<div class="line">        retval = init_port(ports-&gt;id[i]);</div>
<div class="line">        <span class="keywordflow">if</span> (retval != 0)</div>
<div class="line">            <a class="code" href="rte__common_8h.html#ae2e5522e2b4921a751675e4a4d167fb4">rte_exit</a>(EXIT_FAILURE, <span class="stringliteral">&quot;Cannot initialise port %u\n&quot;</span>,</div>
<div class="line">                    (<span class="keywordtype">unsigned</span>)i);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    check_all_ports_link_status(ports-&gt;num_ports, (~0x0));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* initialise the client queues/rings for inter-eu comms */</span></div>
<div class="line">    init_shm_rings();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
