<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/pipeline/pipeline_flow_classification_be.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/pipeline/pipeline_flow_classification_be.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2016 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__table__hash_8h.html">rte_table_hash.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__byteorder_8h.html">rte_byteorder.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;pipeline.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_flow_classification_be.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_actions_common.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;parser.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;hash_func.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_flow_classification {</div>
<div class="line">    <span class="keyword">struct </span>pipeline p;</div>
<div class="line">    pipeline_msg_req_handler custom_handlers[PIPELINE_FC_MSG_REQS];</div>
<div class="line"></div>
<div class="line">    uint32_t n_flows;</div>
<div class="line">    uint32_t key_size;</div>
<div class="line">    uint32_t flow_id;</div>
<div class="line"></div>
<div class="line">    uint32_t key_offset;</div>
<div class="line">    uint32_t hash_offset;</div>
<div class="line">    uint8_t key_mask[PIPELINE_FC_FLOW_KEY_MAX_SIZE];</div>
<div class="line">    uint32_t key_mask_present;</div>
<div class="line">    uint32_t flow_id_offset;</div>
<div class="line"></div>
<div class="line">} <a name="a0"></a><a class="code" href="rte__memory_8h.html#a1a29b3bf8655b79e8dca721c5e815aa4">__rte_cache_aligned</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_custom_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> pipeline_msg_req_handler handlers[] = {</div>
<div class="line">    [PIPELINE_MSG_REQ_PING] =</div>
<div class="line">        pipeline_msg_req_ping_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_PORT_IN] =</div>
<div class="line">        pipeline_msg_req_stats_port_in_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_PORT_OUT] =</div>
<div class="line">        pipeline_msg_req_stats_port_out_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_TABLE] =</div>
<div class="line">        pipeline_msg_req_stats_table_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_PORT_IN_ENABLE] =</div>
<div class="line">        pipeline_msg_req_port_in_enable_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_PORT_IN_DISABLE] =</div>
<div class="line">        pipeline_msg_req_port_in_disable_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_CUSTOM] =</div>
<div class="line">        pipeline_fc_msg_req_custom_handler,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_add_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_add_bulk_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_del_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_add_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_del_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> pipeline_msg_req_handler custom_handlers[] = {</div>
<div class="line">    [PIPELINE_FC_MSG_REQ_FLOW_ADD] =</div>
<div class="line">        pipeline_fc_msg_req_add_handler,</div>
<div class="line">    [PIPELINE_FC_MSG_REQ_FLOW_ADD_BULK] =</div>
<div class="line">        pipeline_fc_msg_req_add_bulk_handler,</div>
<div class="line">    [PIPELINE_FC_MSG_REQ_FLOW_DEL] =</div>
<div class="line">        pipeline_fc_msg_req_del_handler,</div>
<div class="line">    [PIPELINE_FC_MSG_REQ_FLOW_ADD_DEFAULT] =</div>
<div class="line">        pipeline_fc_msg_req_add_default_handler,</div>
<div class="line">    [PIPELINE_FC_MSG_REQ_FLOW_DEL_DEFAULT] =</div>
<div class="line">        pipeline_fc_msg_req_del_default_handler,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow table</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span>flow_table_entry {</div>
<div class="line">    <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> head;</div>
<div class="line"></div>
<div class="line">    uint32_t flow_id;</div>
<div class="line">    uint32_t pad;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a name="a2"></a><a class="code" href="rte__table__hash_8h.html#a2b9cf2fd12b34cb416174eabcd443cca">rte_table_hash_op_hash</a> hash_func[] = {</div>
<div class="line">    hash_default_key8,</div>
<div class="line">    hash_default_key16,</div>
<div class="line">    hash_default_key24,</div>
<div class="line">    hash_default_key32,</div>
<div class="line">    hash_default_key40,</div>
<div class="line">    hash_default_key48,</div>
<div class="line">    hash_default_key56,</div>
<div class="line">    hash_default_key64</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Flow table AH - Write flow_id to packet meta-data</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line">pkt_work_flow_id(</div>
<div class="line">    <span class="keyword">struct</span> <a name="_a3"></a><a class="code" href="structrte__mbuf.html">rte_mbuf</a> *pkt,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *table_entry,</div>
<div class="line">    <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_flow_classification *p_fc = arg;</div>
<div class="line">    uint32_t *flow_id_ptr =</div>
<div class="line">        <a name="a4"></a><a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkt, p_fc-&gt;flow_id_offset);</div>
<div class="line">    <span class="keyword">struct </span>flow_table_entry *entry =</div>
<div class="line">        (<span class="keyword">struct </span>flow_table_entry *) table_entry;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read */</span></div>
<div class="line">    uint32_t flow_id = entry-&gt;flow_id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Compute */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Write */</span></div>
<div class="line">    *flow_id_ptr = flow_id;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div>
<div class="line">pkt4_work_flow_id(</div>
<div class="line">    <span class="keyword">struct</span> <a class="code" href="structrte__mbuf.html">rte_mbuf</a> **pkts,</div>
<div class="line">    <span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **table_entries,</div>
<div class="line">    <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_flow_classification *p_fc = arg;</div>
<div class="line"></div>
<div class="line">    uint32_t *flow_id_ptr0 =</div>
<div class="line">        <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[0], p_fc-&gt;flow_id_offset);</div>
<div class="line">    uint32_t *flow_id_ptr1 =</div>
<div class="line">        <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[1], p_fc-&gt;flow_id_offset);</div>
<div class="line">    uint32_t *flow_id_ptr2 =</div>
<div class="line">        <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[2], p_fc-&gt;flow_id_offset);</div>
<div class="line">    uint32_t *flow_id_ptr3 =</div>
<div class="line">        <a class="code" href="rte__port_8h.html#aea4ec54c3c7fbb57e611499ad81609d0">RTE_MBUF_METADATA_UINT32_PTR</a>(pkts[3], p_fc-&gt;flow_id_offset);</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>flow_table_entry *entry0 =</div>
<div class="line">        (<span class="keyword">struct </span>flow_table_entry *) table_entries[0];</div>
<div class="line">    <span class="keyword">struct </span>flow_table_entry *entry1 =</div>
<div class="line">        (<span class="keyword">struct </span>flow_table_entry *) table_entries[1];</div>
<div class="line">    <span class="keyword">struct </span>flow_table_entry *entry2 =</div>
<div class="line">        (<span class="keyword">struct </span>flow_table_entry *) table_entries[2];</div>
<div class="line">    <span class="keyword">struct </span>flow_table_entry *entry3 =</div>
<div class="line">        (<span class="keyword">struct </span>flow_table_entry *) table_entries[3];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read */</span></div>
<div class="line">    uint32_t flow_id0 = entry0-&gt;flow_id;</div>
<div class="line">    uint32_t flow_id1 = entry1-&gt;flow_id;</div>
<div class="line">    uint32_t flow_id2 = entry2-&gt;flow_id;</div>
<div class="line">    uint32_t flow_id3 = entry3-&gt;flow_id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Compute */</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Write */</span></div>
<div class="line">    *flow_id_ptr0 = flow_id0;</div>
<div class="line">    *flow_id_ptr1 = flow_id1;</div>
<div class="line">    *flow_id_ptr2 = flow_id2;</div>
<div class="line">    *flow_id_ptr3 = flow_id3;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">PIPELINE_TABLE_AH_HIT(fc_table_ah_hit,</div>
<div class="line">        pkt_work_flow_id, pkt4_work_flow_id);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <a name="a5"></a><a class="code" href="rte__pipeline_8h.html#a690cec4a2e911968eb8036b333396f7f">rte_pipeline_table_action_handler_hit</a></div>
<div class="line">get_fc_table_ah_hit(<span class="keyword">struct</span> pipeline_flow_classification *p)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;flow_id)</div>
<div class="line">        <span class="keywordflow">return</span> fc_table_ah_hit;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> NULL;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Argument parsing</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_fc_parse_args(<span class="keyword">struct</span> pipeline_flow_classification *p,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_params *params)</div>
<div class="line">{</div>
<div class="line">    uint32_t n_flows_present = 0;</div>
<div class="line">    uint32_t key_offset_present = 0;</div>
<div class="line">    uint32_t key_size_present = 0;</div>
<div class="line">    uint32_t hash_offset_present = 0;</div>
<div class="line">    uint32_t key_mask_present = 0;</div>
<div class="line">    uint32_t flow_id_offset_present = 0;</div>
<div class="line"></div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">char</span> key_mask_str[PIPELINE_FC_FLOW_KEY_MAX_SIZE * 2];</div>
<div class="line"></div>
<div class="line">    p-&gt;hash_offset = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* default values */</span></div>
<div class="line">    p-&gt;flow_id = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params-&gt;n_args; i++) {</div>
<div class="line">        <span class="keywordtype">char</span> *arg_name = params-&gt;args_name[i];</div>
<div class="line">        <span class="keywordtype">char</span> *arg_value = params-&gt;args_value[i];</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* n_flows */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;n_flows&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                n_flows_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            n_flows_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;n_flows,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL(((status != -EINVAL) &amp;&amp;</div>
<div class="line">                (p-&gt;n_flows != 0)), params-&gt;name,</div>
<div class="line">                arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* key_offset */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;key_offset&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                key_offset_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            key_offset_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;key_offset,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL((status != -EINVAL),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* key_size */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;key_size&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                key_size_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            key_size_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;key_size,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL(((status != -EINVAL) &amp;&amp;</div>
<div class="line">                (p-&gt;key_size != 0) &amp;&amp;</div>
<div class="line">                (p-&gt;key_size % 8 == 0)),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG(((status != -ERANGE) &amp;&amp;</div>
<div class="line">                (p-&gt;key_size &lt;=</div>
<div class="line">                PIPELINE_FC_FLOW_KEY_MAX_SIZE)),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* key_mask */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;key_mask&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> mask_str_len = strlen(arg_value);</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                key_mask_present == 0,</div>
<div class="line">                params-&gt;name, arg_name);</div>
<div class="line">            key_mask_present = 1;</div>
<div class="line"></div>
<div class="line">            PIPELINE_ARG_CHECK((mask_str_len &lt;</div>
<div class="line">                (PIPELINE_FC_FLOW_KEY_MAX_SIZE * 2)),</div>
<div class="line">                <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: entry &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;\&quot;%s\&quot; is too long&quot;</span>, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line"></div>
<div class="line">            snprintf(key_mask_str, <span class="keyword">sizeof</span>(key_mask_str), <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line">                arg_value);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* hash_offset */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;hash_offset&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                hash_offset_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            hash_offset_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;hash_offset,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL((status != -EINVAL),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* flow_id_offset */</span></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;flowid_offset&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                flow_id_offset_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            flow_id_offset_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;flow_id_offset,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL((status != -EINVAL),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line"></div>
<div class="line">            p-&gt;flow_id = 1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Unknown argument */</span></div>
<div class="line">        PIPELINE_PARSE_ERR_INV_ENT(0, params-&gt;name, arg_name);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check that mandatory arguments are present */</span></div>
<div class="line">    PIPELINE_PARSE_ERR_MANDATORY((n_flows_present), params-&gt;name,</div>
<div class="line">        <span class="stringliteral">&quot;n_flows&quot;</span>);</div>
<div class="line">    PIPELINE_PARSE_ERR_MANDATORY((key_offset_present), params-&gt;name,</div>
<div class="line">        <span class="stringliteral">&quot;key_offset&quot;</span>);</div>
<div class="line">    PIPELINE_PARSE_ERR_MANDATORY((key_size_present), params-&gt;name,</div>
<div class="line">        <span class="stringliteral">&quot;key_size&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (key_mask_present) {</div>
<div class="line">        uint32_t key_size = p-&gt;key_size;</div>
<div class="line">        <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">        PIPELINE_ARG_CHECK(((key_size == 8) || (key_size == 16)),</div>
<div class="line">            <span class="stringliteral">&quot;Parse error in section \&quot;%s\&quot;: entry key_mask &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;only allowed for key_size of 8 or 16 bytes&quot;</span>,</div>
<div class="line">            params-&gt;name);</div>
<div class="line"></div>
<div class="line">        PIPELINE_ARG_CHECK((strlen(key_mask_str) ==</div>
<div class="line">            (key_size * 2)), <span class="stringliteral">&quot;Parse error in section &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;\&quot;%s\&quot;: key_mask should have exactly %u hex &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;digits&quot;</span>, params-&gt;name, (key_size * 2));</div>
<div class="line"></div>
<div class="line">        PIPELINE_ARG_CHECK((hash_offset_present == 0), <span class="stringliteral">&quot;Parse &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;error in section \&quot;%s\&quot;: entry hash_offset only &quot;</span></div>
<div class="line">            <span class="stringliteral">&quot;allowed when key_mask is not present&quot;</span>,</div>
<div class="line">            params-&gt;name);</div>
<div class="line"></div>
<div class="line">        status = parse_hex_string(key_mask_str, p-&gt;key_mask,</div>
<div class="line">            &amp;p-&gt;key_size);</div>
<div class="line"></div>
<div class="line">        PIPELINE_PARSE_ERR_INV_VAL(((status == 0) &amp;&amp;</div>
<div class="line">            (key_size == p-&gt;key_size)), params-&gt;name,</div>
<div class="line">            <span class="stringliteral">&quot;key_mask&quot;</span>, key_mask_str);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    p-&gt;key_mask_present = key_mask_present;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *pipeline_fc_init(<span class="keyword">struct</span> pipeline_params *params,</div>
<div class="line">    <a name="a6"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_flow_classification *p_fc;</div>
<div class="line">    uint32_t size, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (params == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Memory allocation */</span></div>
<div class="line">    size = <a name="a7"></a><a class="code" href="rte__memory_8h.html#a30eec128f3d71add687a1cbfe48abcbb">RTE_CACHE_LINE_ROUNDUP</a>(</div>
<div class="line">        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_flow_classification));</div>
<div class="line">    p = <a name="a8"></a><a class="code" href="rte__malloc_8h.html#a58042061ad622f028aa2b97e8cb73a41">rte_zmalloc</a>(NULL, size, RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    p_fc = (<span class="keyword">struct </span>pipeline_flow_classification *) p;</div>
<div class="line"></div>
<div class="line">    strcpy(p-&gt;name, params-&gt;name);</div>
<div class="line">    p-&gt;log_level = params-&gt;log_level;</div>
<div class="line"></div>
<div class="line">    PLOG(p, HIGH, <span class="stringliteral">&quot;Flow classification&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Parse arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pipeline_fc_parse_args(p_fc, params))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Pipeline */</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a9"></a><a class="code" href="structrte__pipeline__params.html">rte_pipeline_params</a> pipeline_params = {</div>
<div class="line">            .<a name="a10"></a><a class="code" href="structrte__pipeline__params.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = params-&gt;name,</div>
<div class="line">            .socket_id = params-&gt;socket_id,</div>
<div class="line">            .offset_port_id = 0,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        p-&gt;p = <a name="a11"></a><a class="code" href="rte__pipeline_8h.html#ad650149ed178057bfb54bda0b6e39e05">rte_pipeline_create</a>(&amp;pipeline_params);</div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;p == NULL) {</div>
<div class="line">            <a name="a12"></a><a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Input ports */</span></div>
<div class="line">    p-&gt;n_ports_in = params-&gt;n_ports_in;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a13"></a><a class="code" href="structrte__pipeline__port__in__params.html">rte_pipeline_port_in_params</a> port_params = {</div>
<div class="line">            .<a name="a14"></a><a class="code" href="structrte__pipeline__port__in__params.html#ad8c92480b58ad5e6b7917c16b5ea7b3d">ops</a> = pipeline_port_in_params_get_ops(</div>
<div class="line">                &amp;params-&gt;port_in[i]),</div>
<div class="line">            .arg_create = pipeline_port_in_params_convert(</div>
<div class="line">                &amp;params-&gt;port_in[i]),</div>
<div class="line">            .f_action = NULL,</div>
<div class="line">            .arg_ah = NULL,</div>
<div class="line">            .burst_size = params-&gt;port_in[i].burst_size,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a15"></a><a class="code" href="rte__pipeline_8h.html#ab0c0f093519ccc9fbb76e7c5696fd266">rte_pipeline_port_in_create</a>(p-&gt;p,</div>
<div class="line">            &amp;port_params,</div>
<div class="line">            &amp;p-&gt;port_in_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a name="a16"></a><a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Output ports */</span></div>
<div class="line">    p-&gt;n_ports_out = params-&gt;n_ports_out;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_out; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a17"></a><a class="code" href="structrte__pipeline__port__out__params.html">rte_pipeline_port_out_params</a> port_params = {</div>
<div class="line">            .<a class="code" href="structrte__pipeline__port__in__params.html#ad8c92480b58ad5e6b7917c16b5ea7b3d">ops</a> = pipeline_port_out_params_get_ops(</div>
<div class="line">                &amp;params-&gt;port_out[i]),</div>
<div class="line">            .arg_create = pipeline_port_out_params_convert(</div>
<div class="line">                &amp;params-&gt;port_out[i]),</div>
<div class="line">            .f_action = NULL,</div>
<div class="line">            .arg_ah = NULL,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a18"></a><a class="code" href="rte__pipeline_8h.html#a247f58fe13cba38922ccf5c60a2f86bb">rte_pipeline_port_out_create</a>(p-&gt;p,</div>
<div class="line">            &amp;port_params,</div>
<div class="line">            &amp;p-&gt;port_out_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Tables */</span></div>
<div class="line">    p-&gt;n_tables = 1;</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a19"></a><a class="code" href="structrte__table__hash__key8__ext__params.html">rte_table_hash_key8_ext_params</a></div>
<div class="line">            table_hash_key8_params = {</div>
<div class="line">            .<a name="a20"></a><a class="code" href="structrte__table__hash__key8__ext__params.html#aafba5a1f8ad65b41148894026098cad7">n_entries</a> = p_fc-&gt;n_flows,</div>
<div class="line">            .n_entries_ext = p_fc-&gt;n_flows,</div>
<div class="line">            .signature_offset = p_fc-&gt;hash_offset,</div>
<div class="line">            .key_offset = p_fc-&gt;key_offset,</div>
<div class="line">            .f_hash = hash_func[(p_fc-&gt;key_size / 8) - 1],</div>
<div class="line">            .<a name="a21"></a><a class="code" href="structrte__table__hash__key8__ext__params.html#a9520dc6e47b2381d5e38213b09db5b6f">key_mask</a> = (p_fc-&gt;key_mask_present) ?</div>
<div class="line">                p_fc-&gt;key_mask : NULL,</div>
<div class="line">            .seed = 0,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span><a name="_a22"></a><a class="code" href="structrte__table__hash__key16__ext__params.html">rte_table_hash_key16_ext_params</a></div>
<div class="line">            table_hash_key16_params = {</div>
<div class="line">            .<a name="a23"></a><a class="code" href="structrte__table__hash__key16__ext__params.html#aafba5a1f8ad65b41148894026098cad7">n_entries</a> = p_fc-&gt;n_flows,</div>
<div class="line">            .n_entries_ext = p_fc-&gt;n_flows,</div>
<div class="line">            .signature_offset = p_fc-&gt;hash_offset,</div>
<div class="line">            .key_offset = p_fc-&gt;key_offset,</div>
<div class="line">            .f_hash = hash_func[(p_fc-&gt;key_size / 8) - 1],</div>
<div class="line">            .<a name="a24"></a><a class="code" href="structrte__table__hash__key16__ext__params.html#a9520dc6e47b2381d5e38213b09db5b6f">key_mask</a> = (p_fc-&gt;key_mask_present) ?</div>
<div class="line">                p_fc-&gt;key_mask : NULL,</div>
<div class="line">            .seed = 0,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span><a name="_a25"></a><a class="code" href="structrte__table__hash__ext__params.html">rte_table_hash_ext_params</a></div>
<div class="line">            table_hash_params = {</div>
<div class="line">            .<a name="a26"></a><a class="code" href="structrte__table__hash__ext__params.html#a83844a351f4b92ad62ba71b38733aa04">key_size</a> = p_fc-&gt;key_size,</div>
<div class="line">            .n_keys = p_fc-&gt;n_flows,</div>
<div class="line">            .n_buckets = p_fc-&gt;n_flows / 4,</div>
<div class="line">            .n_buckets_ext = p_fc-&gt;n_flows / 4,</div>
<div class="line">            .f_hash = hash_func[(p_fc-&gt;key_size / 8) - 1],</div>
<div class="line">            .<a name="a27"></a><a class="code" href="structrte__table__hash__ext__params.html#a13dfa5fcb8e1184f1f7756e717fd2807">seed</a> = 0,</div>
<div class="line">            .<a name="a28"></a><a class="code" href="structrte__table__hash__ext__params.html#a255e199334632db5019afe0eb166a05a">signature_offset</a> = p_fc-&gt;hash_offset,</div>
<div class="line">            .key_offset = p_fc-&gt;key_offset,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span><a name="_a29"></a><a class="code" href="structrte__pipeline__table__params.html">rte_pipeline_table_params</a> table_params = {</div>
<div class="line">            .<a name="a30"></a><a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> = NULL, <span class="comment">/* set below */</span></div>
<div class="line">            .arg_create = NULL, <span class="comment">/* set below */</span></div>
<div class="line">            .f_action_hit = get_fc_table_ah_hit(p_fc),</div>
<div class="line">            .f_action_miss = NULL,</div>
<div class="line">            .arg_ah = p_fc,</div>
<div class="line">            .action_data_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>flow_table_entry) -</div>
<div class="line">                sizeof(struct <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a>),</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span> (p_fc-&gt;key_size) {</div>
<div class="line">        <span class="keywordflow">case</span> 8:</div>
<div class="line">            <span class="keywordflow">if</span> (p_fc-&gt;hash_offset != 0) {</div>
<div class="line">                table_params.<a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> =</div>
<div class="line">                    &amp;<a name="a31"></a><a class="code" href="rte__table__hash_8h.html#aeea4db38125897454fcfe2eb6100c329">rte_table_hash_key8_ext_ops</a>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                table_params.<a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> =</div>
<div class="line">                    &amp;<a name="a32"></a><a class="code" href="rte__table__hash_8h.html#ad0c1c0da2ab6107aeb9d7e865f3dff96">rte_table_hash_key8_ext_dosig_ops</a>;</div>
<div class="line">            }</div>
<div class="line">            table_params.<a name="a33"></a><a class="code" href="structrte__pipeline__table__params.html#ab34a217f23d1f5a27ae00e3fbbba445c">arg_create</a> = &amp;table_hash_key8_params;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">case</span> 16:</div>
<div class="line">            <span class="keywordflow">if</span> (p_fc-&gt;hash_offset != 0) {</div>
<div class="line">                table_params.<a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> =</div>
<div class="line">                    &amp;<a name="a34"></a><a class="code" href="rte__table__hash_8h.html#ac269e0bcf50c9af8feffe44e57101a55">rte_table_hash_key16_ext_ops</a>;</div>
<div class="line">            } <span class="keywordflow">else</span> {</div>
<div class="line">                table_params.<a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> =</div>
<div class="line">                    &amp;<a name="a35"></a><a class="code" href="rte__table__hash_8h.html#a327b6daac80589152b77d0c8f97b9ea4">rte_table_hash_key16_ext_dosig_ops</a>;</div>
<div class="line">            }</div>
<div class="line">            table_params.<a class="code" href="structrte__pipeline__table__params.html#ab34a217f23d1f5a27ae00e3fbbba445c">arg_create</a> = &amp;table_hash_key16_params;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            table_params.<a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> = &amp;<a name="a36"></a><a class="code" href="rte__table__hash_8h.html#ad7d24416b687345b68e9820d65e7e5d2">rte_table_hash_ext_ops</a>;</div>
<div class="line">            table_params.<a class="code" href="structrte__pipeline__table__params.html#ab34a217f23d1f5a27ae00e3fbbba445c">arg_create</a> = &amp;table_hash_params;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        status = <a name="a37"></a><a class="code" href="rte__pipeline_8h.html#af1cb4d7ac4516443e6f9d82a4beebed6">rte_pipeline_table_create</a>(p-&gt;p,</div>
<div class="line">            &amp;table_params,</div>
<div class="line">            &amp;p-&gt;table_id[0]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Connecting input ports to tables */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a38"></a><a class="code" href="rte__pipeline_8h.html#adc4634b81c75f146f3afac17dbbe727c">rte_pipeline_port_in_connect_to_table</a>(p-&gt;p,</div>
<div class="line">            p-&gt;port_in_id[i],</div>
<div class="line">            p-&gt;table_id[0]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Enable input ports */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a39"></a><a class="code" href="rte__pipeline_8h.html#af8a48f99a99731883005dfe93c5406e6">rte_pipeline_port_in_enable</a>(p-&gt;p,</div>
<div class="line">            p-&gt;port_in_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check pipeline consistency */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a40"></a><a class="code" href="rte__pipeline_8h.html#ada72ecd95a1a181d1d555dd699f95475">rte_pipeline_check</a>(p-&gt;p) &lt; 0) {</div>
<div class="line">        <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message queues */</span></div>
<div class="line">    p-&gt;n_msgq = params-&gt;n_msgq;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_msgq; i++)</div>
<div class="line">        p-&gt;msgq_in[i] = params-&gt;msgq_in[i];</div>
<div class="line">    for (i = 0; i &lt; p-&gt;n_msgq; i++)</div>
<div class="line">        p-&gt;msgq_out[i] = params-&gt;msgq_out[i];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message handlers */</span></div>
<div class="line">    memcpy(p-&gt;handlers, handlers, <span class="keyword">sizeof</span>(p-&gt;handlers));</div>
<div class="line">    memcpy(p_fc-&gt;custom_handlers,</div>
<div class="line">        custom_handlers,</div>
<div class="line">        <span class="keyword">sizeof</span>(p_fc-&gt;custom_handlers));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> p;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_fc_free(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free resources */</span></div>
<div class="line">    <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_fc_track(<span class="keywordtype">void</span> *pipeline,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> uint32_t port_in,</div>
<div class="line">    uint32_t *port_out)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((p == NULL) ||</div>
<div class="line">        (port_in &gt;= p-&gt;n_ports_in) ||</div>
<div class="line">        (port_out == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;n_ports_in == 1) {</div>
<div class="line">        *port_out = 0;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_fc_timer(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    pipeline_msg_req_handle(p);</div>
<div class="line">    <a name="a41"></a><a class="code" href="rte__pipeline_8h.html#ac26447a6b0c4b1ec218a9133d790fef1">rte_pipeline_flush</a>(p-&gt;p);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_custom_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_flow_classification *p_fc =</div>
<div class="line">            (<span class="keyword">struct </span>pipeline_flow_classification *) p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_custom_msg_req *req = msg;</div>
<div class="line">    pipeline_msg_req_handler f_handle;</div>
<div class="line"></div>
<div class="line">    f_handle = (req-&gt;subtype &lt; PIPELINE_FC_MSG_REQS) ?</div>
<div class="line">        p_fc-&gt;custom_handlers[req-&gt;subtype] :</div>
<div class="line">        pipeline_msg_req_invalid_handler;</div>
<div class="line"></div>
<div class="line">    if (f_handle == NULL)</div>
<div class="line">        f_handle = pipeline_msg_req_invalid_handler;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> f_handle(p, req);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_add_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_add_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_add_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>flow_table_entry entry = {</div>
<div class="line">        .head = {</div>
<div class="line">            .action = <a name="a42"></a><a class="code" href="rte__pipeline_8h.html#a6376b240935404d998f003d113651572ac8c58609785d844989b7d9eb1e6db8aa">RTE_PIPELINE_ACTION_PORT</a>,</div>
<div class="line">            {.port_id = p-&gt;port_out_id[req-&gt;port_id]},</div>
<div class="line">        },</div>
<div class="line">        .flow_id = req-&gt;flow_id,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a43"></a><a class="code" href="rte__pipeline_8h.html#a0e90e4a54b6467deb9b449bf8bd5cab4">rte_pipeline_table_entry_add</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        &amp;req-&gt;key,</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *) &amp;entry,</div>
<div class="line">        &amp;rsp-&gt;key_found,</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **) &amp;rsp-&gt;entry_ptr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_add_bulk_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_add_bulk_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_add_bulk_msg_rsp *rsp = msg;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; req-&gt;n_keys; i++) {</div>
<div class="line">        <span class="keyword">struct </span>pipeline_fc_add_bulk_flow_req *flow_req = &amp;req-&gt;req[i];</div>
<div class="line">        <span class="keyword">struct </span>pipeline_fc_add_bulk_flow_rsp *flow_rsp = &amp;req-&gt;rsp[i];</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span>flow_table_entry entry = {</div>
<div class="line">            .head = {</div>
<div class="line">                .action = <a class="code" href="rte__pipeline_8h.html#a6376b240935404d998f003d113651572ac8c58609785d844989b7d9eb1e6db8aa">RTE_PIPELINE_ACTION_PORT</a>,</div>
<div class="line">                {.port_id = p-&gt;port_out_id[flow_req-&gt;port_id]},</div>
<div class="line">            },</div>
<div class="line">            .flow_id = flow_req-&gt;flow_id,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a class="code" href="rte__pipeline_8h.html#a0e90e4a54b6467deb9b449bf8bd5cab4">rte_pipeline_table_entry_add</a>(p-&gt;p,</div>
<div class="line">            p-&gt;table_id[0],</div>
<div class="line">            &amp;flow_req-&gt;key,</div>
<div class="line">            (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *) &amp;entry,</div>
<div class="line">            &amp;flow_rsp-&gt;key_found,</div>
<div class="line">            (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **)</div>
<div class="line">                &amp;flow_rsp-&gt;entry_ptr);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status)</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    rsp-&gt;n_keys = i;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_del_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_del_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_del_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a44"></a><a class="code" href="rte__pipeline_8h.html#a946f0d5610d152c1e6f641928c4f0743">rte_pipeline_table_entry_delete</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        &amp;req-&gt;key,</div>
<div class="line">        &amp;rsp-&gt;key_found,</div>
<div class="line">        NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_add_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_add_default_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_add_default_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>flow_table_entry default_entry = {</div>
<div class="line">        .head = {</div>
<div class="line">            .action = <a class="code" href="rte__pipeline_8h.html#a6376b240935404d998f003d113651572ac8c58609785d844989b7d9eb1e6db8aa">RTE_PIPELINE_ACTION_PORT</a>,</div>
<div class="line">            {.port_id = p-&gt;port_out_id[req-&gt;port_id]},</div>
<div class="line">        },</div>
<div class="line"></div>
<div class="line">        .flow_id = 0,</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a45"></a><a class="code" href="rte__pipeline_8h.html#a8980fbc2a51d6dc8041b798ea5172318">rte_pipeline_table_default_entry_add</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *) &amp;default_entry,</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **) &amp;rsp-&gt;entry_ptr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_fc_msg_req_del_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_fc_del_default_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a46"></a><a class="code" href="rte__pipeline_8h.html#ac83e9cacb91301a7425694f32249e050">rte_pipeline_table_default_entry_delete</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_be_ops pipeline_flow_classification_be_ops = {</div>
<div class="line">    .f_init = pipeline_fc_init,</div>
<div class="line">    .f_free = pipeline_fc_free,</div>
<div class="line">    .f_run = NULL,</div>
<div class="line">    .f_timer = pipeline_fc_timer,</div>
<div class="line">    .f_track = pipeline_fc_track,</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
