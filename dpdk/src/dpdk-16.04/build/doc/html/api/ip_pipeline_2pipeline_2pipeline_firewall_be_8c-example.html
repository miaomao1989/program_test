<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/pipeline/pipeline_firewall_be.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/pipeline/pipeline_firewall_be.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2016 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ether_8h.html">rte_ether.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__ip_8h.html">rte_ip.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__tcp_8h.html">rte_tcp.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__byteorder_8h.html">rte_byteorder.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__table__acl_8h.html">rte_table_acl.h</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_firewall_be.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;parser.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_firewall {</div>
<div class="line">    <span class="keyword">struct </span>pipeline p;</div>
<div class="line">    pipeline_msg_req_handler custom_handlers[PIPELINE_FIREWALL_MSG_REQS];</div>
<div class="line"></div>
<div class="line">    uint32_t n_rules;</div>
<div class="line">    uint32_t n_rule_fields;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a0"></a><a class="code" href="structrte__acl__field__def.html">rte_acl_field_def</a> *field_format;</div>
<div class="line">    uint32_t field_format_size;</div>
<div class="line">} <a name="a1"></a><a class="code" href="rte__memory_8h.html#a1a29b3bf8655b79e8dca721c5e815aa4">__rte_cache_aligned</a>;</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_custom_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> pipeline_msg_req_handler handlers[] = {</div>
<div class="line">    [PIPELINE_MSG_REQ_PING] =</div>
<div class="line">        pipeline_msg_req_ping_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_PORT_IN] =</div>
<div class="line">        pipeline_msg_req_stats_port_in_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_PORT_OUT] =</div>
<div class="line">        pipeline_msg_req_stats_port_out_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_STATS_TABLE] =</div>
<div class="line">        pipeline_msg_req_stats_table_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_PORT_IN_ENABLE] =</div>
<div class="line">        pipeline_msg_req_port_in_enable_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_PORT_IN_DISABLE] =</div>
<div class="line">        pipeline_msg_req_port_in_disable_handler,</div>
<div class="line">    [PIPELINE_MSG_REQ_CUSTOM] =</div>
<div class="line">        pipeline_firewall_msg_req_custom_handler,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_add_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_del_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_add_bulk_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_del_bulk_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_add_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_del_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> pipeline_msg_req_handler custom_handlers[] = {</div>
<div class="line">    [PIPELINE_FIREWALL_MSG_REQ_ADD] =</div>
<div class="line">        pipeline_firewall_msg_req_add_handler,</div>
<div class="line">    [PIPELINE_FIREWALL_MSG_REQ_DEL] =</div>
<div class="line">        pipeline_firewall_msg_req_del_handler,</div>
<div class="line">    [PIPELINE_FIREWALL_MSG_REQ_ADD_BULK] =</div>
<div class="line">        pipeline_firewall_msg_req_add_bulk_handler,</div>
<div class="line">    [PIPELINE_FIREWALL_MSG_REQ_DEL_BULK] =</div>
<div class="line">        pipeline_firewall_msg_req_del_bulk_handler,</div>
<div class="line">    [PIPELINE_FIREWALL_MSG_REQ_ADD_DEFAULT] =</div>
<div class="line">        pipeline_firewall_msg_req_add_default_handler,</div>
<div class="line">    [PIPELINE_FIREWALL_MSG_REQ_DEL_DEFAULT] =</div>
<div class="line">        pipeline_firewall_msg_req_del_default_handler,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Firewall table</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span>firewall_table_entry {</div>
<div class="line">    <span class="keyword">struct </span><a name="_a2"></a><a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> head;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structrte__acl__field__def.html">rte_acl_field_def</a> field_format_ipv4[] = {</div>
<div class="line">    <span class="comment">/* Protocol */</span></div>
<div class="line">    [0] = {</div>
<div class="line">        .<a name="a3"></a><a class="code" href="structrte__acl__field__def.html#a1d127017fb298b889f4ba24752d08b8e">type</a> = RTE_ACL_FIELD_TYPE_BITMASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint8_t),</div>
<div class="line">        .<a name="a4"></a><a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 0,</div>
<div class="line">        .<a name="a5"></a><a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 0,</div>
<div class="line">        .<a name="a6"></a><a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a name="_a7"></a><a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            <a name="a8"></a><a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a name="_a9"></a><a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, next_proto_id),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Source IP address (IPv4) */</span></div>
<div class="line">    [1] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 1,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 1,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, src_addr),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Destination IP address (IPv4) */</span></div>
<div class="line">    [2] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 2,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 2,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, dst_addr),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Source Port */</span></div>
<div class="line">    [3] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint16_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 3,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 3,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structipv4__hdr.html">ipv4_hdr</a>) +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(struct <a name="_a10"></a><a class="code" href="structtcp__hdr.html">tcp_hdr</a>, src_port),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Destination Port */</span></div>
<div class="line">    [4] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint16_t),</div>
<div class="line">        .field_index = 4,</div>
<div class="line">        .input_index = 4,</div>
<div class="line">        .offset = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structipv4__hdr.html">ipv4_hdr</a>) +</div>
<div class="line">            offsetof(struct <a class="code" href="structtcp__hdr.html">tcp_hdr</a>, dst_port),</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define SIZEOF_VLAN_HDR                          4</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structrte__acl__field__def.html">rte_acl_field_def</a> field_format_vlan_ipv4[] = {</div>
<div class="line">    <span class="comment">/* Protocol */</span></div>
<div class="line">    [0] = {</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a1d127017fb298b889f4ba24752d08b8e">type</a> = RTE_ACL_FIELD_TYPE_BITMASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint8_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 0,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 0,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_VLAN_HDR +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, next_proto_id),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Source IP address (IPv4) */</span></div>
<div class="line">    [1] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 1,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 1,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_VLAN_HDR +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, src_addr),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Destination IP address (IPv4) */</span></div>
<div class="line">    [2] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 2,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 2,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_VLAN_HDR +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, dst_addr),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Source Port */</span></div>
<div class="line">    [3] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint16_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 3,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 3,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_VLAN_HDR +</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structipv4__hdr.html">ipv4_hdr</a>) +</div>
<div class="line">            offsetof(struct <a class="code" href="structtcp__hdr.html">tcp_hdr</a>, src_port),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Destination Port */</span></div>
<div class="line">    [4] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint16_t),</div>
<div class="line">        .field_index = 4,</div>
<div class="line">        .input_index = 4,</div>
<div class="line">        .offset = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_VLAN_HDR +</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structipv4__hdr.html">ipv4_hdr</a>) +</div>
<div class="line">            offsetof(struct <a class="code" href="structtcp__hdr.html">tcp_hdr</a>, dst_port),</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define SIZEOF_QINQ_HEADER                       8</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structrte__acl__field__def.html">rte_acl_field_def</a> field_format_qinq_ipv4[] = {</div>
<div class="line">    <span class="comment">/* Protocol */</span></div>
<div class="line">    [0] = {</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a1d127017fb298b889f4ba24752d08b8e">type</a> = RTE_ACL_FIELD_TYPE_BITMASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint8_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 0,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 0,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_QINQ_HEADER +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, next_proto_id),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Source IP address (IPv4) */</span></div>
<div class="line">    [1] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 1,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 1,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_QINQ_HEADER +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, src_addr),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Destination IP address (IPv4) */</span></div>
<div class="line">    [2] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 2,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 2,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_QINQ_HEADER +</div>
<div class="line">            <a class="code" href="rte__common_8h.html#a276e8a32e0bbf024aadd9420b8f2d3b3">offsetof</a>(<span class="keyword">struct</span> <a class="code" href="structipv4__hdr.html">ipv4_hdr</a>, dst_addr),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Source Port */</span></div>
<div class="line">    [3] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint16_t),</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#aa63bd1fe49046f2c9ef0478a050b7c3a">field_index</a> = 3,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a92f339699e74f468bf5355e4d76f6a79">input_index</a> = 3,</div>
<div class="line">        .<a class="code" href="structrte__acl__field__def.html#a894bdfa2d603d8343f8ef01dda6fcd23">offset</a> = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_QINQ_HEADER +</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structipv4__hdr.html">ipv4_hdr</a>) +</div>
<div class="line">            offsetof(struct <a class="code" href="structtcp__hdr.html">tcp_hdr</a>, src_port),</div>
<div class="line">    },</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Destination Port */</span></div>
<div class="line">    [4] = {</div>
<div class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</div>
<div class="line">        .size = <span class="keyword">sizeof</span>(uint16_t),</div>
<div class="line">        .field_index = 4,</div>
<div class="line">        .input_index = 4,</div>
<div class="line">        .offset = <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structether__hdr.html">ether_hdr</a>) +</div>
<div class="line">            SIZEOF_QINQ_HEADER +</div>
<div class="line">            <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structipv4__hdr.html">ipv4_hdr</a>) +</div>
<div class="line">            offsetof(struct <a class="code" href="structtcp__hdr.html">tcp_hdr</a>, dst_port),</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_firewall_parse_args(<span class="keyword">struct</span> pipeline_firewall *p,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_params *params)</div>
<div class="line">{</div>
<div class="line">    uint32_t n_rules_present = 0;</div>
<div class="line">    uint32_t pkt_type_present = 0;</div>
<div class="line">    uint32_t i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* defaults */</span></div>
<div class="line">    p-&gt;n_rules = 4 * 1024;</div>
<div class="line">    p-&gt;n_rule_fields = <a name="a11"></a><a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(field_format_ipv4);</div>
<div class="line">    p-&gt;field_format = field_format_ipv4;</div>
<div class="line">    p-&gt;field_format_size = <span class="keyword">sizeof</span>(field_format_ipv4);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params-&gt;n_args; i++) {</div>
<div class="line">        <span class="keywordtype">char</span> *arg_name = params-&gt;args_name[i];</div>
<div class="line">        <span class="keywordtype">char</span> *arg_value = params-&gt;args_value[i];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;n_rules&quot;</span>) == 0) {</div>
<div class="line">            <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                n_rules_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            n_rules_present = 1;</div>
<div class="line"></div>
<div class="line">            status = parser_read_uint32(&amp;p-&gt;n_rules,</div>
<div class="line">                arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL((status != -EINVAL),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            PIPELINE_PARSE_ERR_OUT_RNG((status != -ERANGE),</div>
<div class="line">                params-&gt;name, arg_name, arg_value);</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(arg_name, <span class="stringliteral">&quot;pkt_type&quot;</span>) == 0) {</div>
<div class="line">            PIPELINE_PARSE_ERR_DUPLICATE(</div>
<div class="line">                pkt_type_present == 0, params-&gt;name,</div>
<div class="line">                arg_name);</div>
<div class="line">            pkt_type_present = 1;</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* ipv4 */</span></div>
<div class="line">            <span class="keywordflow">if</span> (strcmp(arg_value, <span class="stringliteral">&quot;ipv4&quot;</span>) == 0) {</div>
<div class="line">                p-&gt;n_rule_fields = <a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(field_format_ipv4);</div>
<div class="line">                p-&gt;field_format = field_format_ipv4;</div>
<div class="line">                p-&gt;field_format_size =</div>
<div class="line">                    <span class="keyword">sizeof</span>(field_format_ipv4);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* vlan_ipv4 */</span></div>
<div class="line">            <span class="keywordflow">if</span> (strcmp(arg_value, <span class="stringliteral">&quot;vlan_ipv4&quot;</span>) == 0) {</div>
<div class="line">                p-&gt;n_rule_fields =</div>
<div class="line">                    <a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(field_format_vlan_ipv4);</div>
<div class="line">                p-&gt;field_format = field_format_vlan_ipv4;</div>
<div class="line">                p-&gt;field_format_size =</div>
<div class="line">                    <span class="keyword">sizeof</span>(field_format_vlan_ipv4);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* qinq_ipv4 */</span></div>
<div class="line">            <span class="keywordflow">if</span> (strcmp(arg_value, <span class="stringliteral">&quot;qinq_ipv4&quot;</span>) == 0) {</div>
<div class="line">                p-&gt;n_rule_fields =</div>
<div class="line">                    <a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(field_format_qinq_ipv4);</div>
<div class="line">                p-&gt;field_format = field_format_qinq_ipv4;</div>
<div class="line">                p-&gt;field_format_size =</div>
<div class="line">                    <span class="keyword">sizeof</span>(field_format_qinq_ipv4);</div>
<div class="line">                <span class="keywordflow">continue</span>;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">/* other */</span></div>
<div class="line">            PIPELINE_PARSE_ERR_INV_VAL(0, params-&gt;name,</div>
<div class="line">                arg_name, arg_value);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* other */</span></div>
<div class="line">        PIPELINE_PARSE_ERR_INV_ENT(0, params-&gt;name, arg_name);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_init(<span class="keyword">struct</span> pipeline_params *params,</div>
<div class="line">    <a name="a12"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall *p_fw;</div>
<div class="line">    uint32_t size, i;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((params == NULL) ||</div>
<div class="line">        (params-&gt;n_ports_in == 0) ||</div>
<div class="line">        (params-&gt;n_ports_out == 0))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Memory allocation */</span></div>
<div class="line">    size = <a name="a13"></a><a class="code" href="rte__memory_8h.html#a30eec128f3d71add687a1cbfe48abcbb">RTE_CACHE_LINE_ROUNDUP</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_firewall));</div>
<div class="line">    p = <a name="a14"></a><a class="code" href="rte__malloc_8h.html#a58042061ad622f028aa2b97e8cb73a41">rte_zmalloc</a>(NULL, size, RTE_CACHE_LINE_SIZE);</div>
<div class="line">    p_fw = (<span class="keyword">struct </span>pipeline_firewall *) p;</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    strcpy(p-&gt;name, params-&gt;name);</div>
<div class="line">    p-&gt;log_level = params-&gt;log_level;</div>
<div class="line"></div>
<div class="line">    PLOG(p, HIGH, <span class="stringliteral">&quot;Firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Parse arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pipeline_firewall_parse_args(p_fw, params))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Pipeline */</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a15"></a><a class="code" href="structrte__pipeline__params.html">rte_pipeline_params</a> pipeline_params = {</div>
<div class="line">            .<a name="a16"></a><a class="code" href="structrte__pipeline__params.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = params-&gt;name,</div>
<div class="line">            .socket_id = params-&gt;socket_id,</div>
<div class="line">            .offset_port_id = 0,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        p-&gt;p = <a name="a17"></a><a class="code" href="rte__pipeline_8h.html#ad650149ed178057bfb54bda0b6e39e05">rte_pipeline_create</a>(&amp;pipeline_params);</div>
<div class="line">        <span class="keywordflow">if</span> (p-&gt;p == NULL) {</div>
<div class="line">            <a name="a18"></a><a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Input ports */</span></div>
<div class="line">    p-&gt;n_ports_in = params-&gt;n_ports_in;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a19"></a><a class="code" href="structrte__pipeline__port__in__params.html">rte_pipeline_port_in_params</a> port_params = {</div>
<div class="line">            .<a name="a20"></a><a class="code" href="structrte__pipeline__port__in__params.html#ad8c92480b58ad5e6b7917c16b5ea7b3d">ops</a> = pipeline_port_in_params_get_ops(</div>
<div class="line">                &amp;params-&gt;port_in[i]),</div>
<div class="line">            .arg_create = pipeline_port_in_params_convert(</div>
<div class="line">                &amp;params-&gt;port_in[i]),</div>
<div class="line">            .f_action = NULL,</div>
<div class="line">            .arg_ah = NULL,</div>
<div class="line">            .burst_size = params-&gt;port_in[i].burst_size,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a21"></a><a class="code" href="rte__pipeline_8h.html#ab0c0f093519ccc9fbb76e7c5696fd266">rte_pipeline_port_in_create</a>(p-&gt;p,</div>
<div class="line">            &amp;port_params,</div>
<div class="line">            &amp;p-&gt;port_in_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a name="a22"></a><a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Output ports */</span></div>
<div class="line">    p-&gt;n_ports_out = params-&gt;n_ports_out;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_out; i++) {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a23"></a><a class="code" href="structrte__pipeline__port__out__params.html">rte_pipeline_port_out_params</a> port_params = {</div>
<div class="line">            .<a class="code" href="structrte__pipeline__port__in__params.html#ad8c92480b58ad5e6b7917c16b5ea7b3d">ops</a> = pipeline_port_out_params_get_ops(</div>
<div class="line">                &amp;params-&gt;port_out[i]),</div>
<div class="line">            .arg_create = pipeline_port_out_params_convert(</div>
<div class="line">                &amp;params-&gt;port_out[i]),</div>
<div class="line">            .f_action = NULL,</div>
<div class="line">            .arg_ah = NULL,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a24"></a><a class="code" href="rte__pipeline_8h.html#a247f58fe13cba38922ccf5c60a2f86bb">rte_pipeline_port_out_create</a>(p-&gt;p,</div>
<div class="line">            &amp;port_params,</div>
<div class="line">            &amp;p-&gt;port_out_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Tables */</span></div>
<div class="line">    p-&gt;n_tables = 1;</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">struct </span><a name="_a25"></a><a class="code" href="structrte__table__acl__params.html">rte_table_acl_params</a> table_acl_params = {</div>
<div class="line">            .<a name="a26"></a><a class="code" href="structrte__table__acl__params.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = params-&gt;name,</div>
<div class="line">            .n_rules = p_fw-&gt;n_rules,</div>
<div class="line">            .n_rule_fields = p_fw-&gt;n_rule_fields,</div>
<div class="line">        };</div>
<div class="line"></div>
<div class="line">        <span class="keyword">struct </span><a name="_a27"></a><a class="code" href="structrte__pipeline__table__params.html">rte_pipeline_table_params</a> table_params = {</div>
<div class="line">                .<a name="a28"></a><a class="code" href="structrte__pipeline__table__params.html#ad1966fbeee5c7e1923a4e567b5bcd77d">ops</a> = &amp;<a name="a29"></a><a class="code" href="rte__table__acl_8h.html#a1ec0bc8eb1f77d82a87814f0b429b486">rte_table_acl_ops</a>,</div>
<div class="line">                .arg_create = &amp;table_acl_params,</div>
<div class="line">                .f_action_hit = NULL,</div>
<div class="line">                .f_action_miss = NULL,</div>
<div class="line">                .arg_ah = NULL,</div>
<div class="line">                .action_data_size =</div>
<div class="line">                    <span class="keyword">sizeof</span>(<span class="keyword">struct </span>firewall_table_entry) -</div>
<div class="line">                    sizeof(struct <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a>),</div>
<div class="line">            };</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">        memcpy(table_acl_params.<a name="a30"></a><a class="code" href="structrte__table__acl__params.html#a715458ced092daff109be5ed0504c374">field_format</a>,</div>
<div class="line">            p_fw-&gt;field_format,</div>
<div class="line">            p_fw-&gt;field_format_size);</div>
<div class="line"></div>
<div class="line">        status = <a name="a31"></a><a class="code" href="rte__pipeline_8h.html#af1cb4d7ac4516443e6f9d82a4beebed6">rte_pipeline_table_create</a>(p-&gt;p,</div>
<div class="line">            &amp;table_params,</div>
<div class="line">            &amp;p-&gt;table_id[0]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Connecting input ports to tables */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a32"></a><a class="code" href="rte__pipeline_8h.html#adc4634b81c75f146f3afac17dbbe727c">rte_pipeline_port_in_connect_to_table</a>(p-&gt;p,</div>
<div class="line">            p-&gt;port_in_id[i],</div>
<div class="line">            p-&gt;table_id[0]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Enable input ports */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_ports_in; i++) {</div>
<div class="line">        <span class="keywordtype">int</span> status = <a name="a33"></a><a class="code" href="rte__pipeline_8h.html#af8a48f99a99731883005dfe93c5406e6">rte_pipeline_port_in_enable</a>(p-&gt;p,</div>
<div class="line">            p-&gt;port_in_id[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (status) {</div>
<div class="line">            <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">            <span class="keywordflow">return</span> NULL;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check pipeline consistency */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a34"></a><a class="code" href="rte__pipeline_8h.html#ada72ecd95a1a181d1d555dd699f95475">rte_pipeline_check</a>(p-&gt;p) &lt; 0) {</div>
<div class="line">        <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message queues */</span></div>
<div class="line">    p-&gt;n_msgq = params-&gt;n_msgq;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;n_msgq; i++)</div>
<div class="line">        p-&gt;msgq_in[i] = params-&gt;msgq_in[i];</div>
<div class="line">    for (i = 0; i &lt; p-&gt;n_msgq; i++)</div>
<div class="line">        p-&gt;msgq_out[i] = params-&gt;msgq_out[i];</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message handlers */</span></div>
<div class="line">    memcpy(p-&gt;handlers, handlers, <span class="keyword">sizeof</span>(p-&gt;handlers));</div>
<div class="line">    memcpy(p_fw-&gt;custom_handlers,</div>
<div class="line">        custom_handlers,</div>
<div class="line">        <span class="keyword">sizeof</span>(p_fw-&gt;custom_handlers));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> p;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_firewall_free(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free resources */</span></div>
<div class="line">    <a class="code" href="rte__pipeline_8h.html#a85ce2e4661092748a84409a1d6eae14c">rte_pipeline_free</a>(p-&gt;p);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_firewall_track(<span class="keywordtype">void</span> *pipeline,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> uint32_t port_in,</div>
<div class="line">    uint32_t *port_out)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((p == NULL) ||</div>
<div class="line">        (port_in &gt;= p-&gt;n_ports_in) ||</div>
<div class="line">        (port_out == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;n_ports_in == 1) {</div>
<div class="line">        *port_out = 0;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">pipeline_firewall_timer(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline *p = (<span class="keyword">struct </span>pipeline *) pipeline;</div>
<div class="line"></div>
<div class="line">    pipeline_msg_req_handle(p);</div>
<div class="line">    <a name="a35"></a><a class="code" href="rte__pipeline_8h.html#ac26447a6b0c4b1ec218a9133d790fef1">rte_pipeline_flush</a>(p-&gt;p);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_custom_handler(<span class="keyword">struct</span> pipeline *p,</div>
<div class="line">    <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall *p_fw = (<span class="keyword">struct </span>pipeline_firewall *) p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_custom_msg_req *req = msg;</div>
<div class="line">    pipeline_msg_req_handler f_handle;</div>
<div class="line"></div>
<div class="line">    f_handle = (req-&gt;subtype &lt; PIPELINE_FIREWALL_MSG_REQS) ?</div>
<div class="line">        p_fw-&gt;custom_handlers[req-&gt;subtype] :</div>
<div class="line">        pipeline_msg_req_invalid_handler;</div>
<div class="line"></div>
<div class="line">    if (f_handle == NULL)</div>
<div class="line">        f_handle = pipeline_msg_req_invalid_handler;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> f_handle(p, req);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_add_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span><a name="_a36"></a><a class="code" href="structrte__table__acl__rule__add__params.html">rte_table_acl_rule_add_params</a> params;</div>
<div class="line">    <span class="keyword">struct </span>firewall_table_entry entry = {</div>
<div class="line">        .head = {</div>
<div class="line">            .action = <a name="a37"></a><a class="code" href="rte__pipeline_8h.html#a6376b240935404d998f003d113651572ac8c58609785d844989b7d9eb1e6db8aa">RTE_PIPELINE_ACTION_PORT</a>,</div>
<div class="line">            {.port_id = p-&gt;port_out_id[req-&gt;port_id]},</div>
<div class="line">        },</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    memset(&amp;params, 0, <span class="keyword">sizeof</span>(params));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (req-&gt;key.type) {</div>
<div class="line">    <span class="keywordflow">case</span> PIPELINE_FIREWALL_IPV4_5TUPLE:</div>
<div class="line">        params.priority = req-&gt;priority;</div>
<div class="line">        params.field_value[0].value.u8 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.proto;</div>
<div class="line">        params.field_value[0].mask_range.u8 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.proto_mask;</div>
<div class="line">        params.field_value[1].value.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_ip;</div>
<div class="line">        params.field_value[1].mask_range.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_ip_mask;</div>
<div class="line">        params.field_value[2].value.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_ip;</div>
<div class="line">        params.field_value[2].mask_range.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_ip_mask;</div>
<div class="line">        params.field_value[3].value.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_port_from;</div>
<div class="line">        params.field_value[3].mask_range.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_port_to;</div>
<div class="line">        params.field_value[4].value.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_port_from;</div>
<div class="line">        params.field_value[4].mask_range.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_port_to;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        rsp-&gt;status = -1; <span class="comment">/* Error */</span></div>
<div class="line">        <span class="keywordflow">return</span> rsp;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a38"></a><a class="code" href="rte__pipeline_8h.html#a0e90e4a54b6467deb9b449bf8bd5cab4">rte_pipeline_table_entry_add</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        &amp;params,</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *) &amp;entry,</div>
<div class="line">        &amp;rsp-&gt;key_found,</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **) &amp;rsp-&gt;entry_ptr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_del_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span><a name="_a39"></a><a class="code" href="structrte__table__acl__rule__delete__params.html">rte_table_acl_rule_delete_params</a> params;</div>
<div class="line"></div>
<div class="line">    memset(&amp;params, 0, <span class="keyword">sizeof</span>(params));</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (req-&gt;key.type) {</div>
<div class="line">    <span class="keywordflow">case</span> PIPELINE_FIREWALL_IPV4_5TUPLE:</div>
<div class="line">        params.field_value[0].value.u8 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.proto;</div>
<div class="line">        params.field_value[0].mask_range.u8 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.proto_mask;</div>
<div class="line">        params.field_value[1].value.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_ip;</div>
<div class="line">        params.field_value[1].mask_range.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_ip_mask;</div>
<div class="line">        params.field_value[2].value.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_ip;</div>
<div class="line">        params.field_value[2].mask_range.u32 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_ip_mask;</div>
<div class="line">        params.field_value[3].value.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_port_from;</div>
<div class="line">        params.field_value[3].mask_range.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.src_port_to;</div>
<div class="line">        params.field_value[4].value.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_port_from;</div>
<div class="line">        params.field_value[4].mask_range.u16 =</div>
<div class="line">            req-&gt;key.key.ipv4_5tuple.dst_port_to;</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        rsp-&gt;status = -1; <span class="comment">/* Error */</span></div>
<div class="line">        <span class="keywordflow">return</span> rsp;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a40"></a><a class="code" href="rte__pipeline_8h.html#a946f0d5610d152c1e6f641928c4f0743">rte_pipeline_table_entry_delete</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        &amp;params,</div>
<div class="line">        &amp;rsp-&gt;key_found,</div>
<div class="line">        NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_add_bulk_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_bulk_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_bulk_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__table__acl__rule__add__params.html">rte_table_acl_rule_add_params</a> *params[req-&gt;n_keys];</div>
<div class="line">    <span class="keyword">struct </span>firewall_table_entry *entries[req-&gt;n_keys];</div>
<div class="line"></div>
<div class="line">    uint32_t i, n_keys;</div>
<div class="line"></div>
<div class="line">    n_keys = req-&gt;n_keys;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        entries[i] = <a name="a41"></a><a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> firewall_table_entry),</div>
<div class="line">                RTE_CACHE_LINE_SIZE);</div>
<div class="line">        <span class="keywordflow">if</span> (entries[i] == NULL) {</div>
<div class="line">            rsp-&gt;status = -1;</div>
<div class="line">            <span class="keywordflow">return</span> rsp;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        params[i] = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__table__acl__rule__add__params.html">rte_table_acl_rule_add_params</a>),</div>
<div class="line">                RTE_CACHE_LINE_SIZE);</div>
<div class="line">        <span class="keywordflow">if</span> (params[i] == NULL) {</div>
<div class="line">            rsp-&gt;status = -1;</div>
<div class="line">            <span class="keywordflow">return</span> rsp;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        entries[i]-&gt;head.action = <a class="code" href="rte__pipeline_8h.html#a6376b240935404d998f003d113651572ac8c58609785d844989b7d9eb1e6db8aa">RTE_PIPELINE_ACTION_PORT</a>;</div>
<div class="line">        entries[i]-&gt;head.port_id = p-&gt;port_out_id[req-&gt;port_ids[i]];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span> (req-&gt;keys[i].type) {</div>
<div class="line">        <span class="keywordflow">case</span> PIPELINE_FIREWALL_IPV4_5TUPLE:</div>
<div class="line">            params[i]-&gt;<a name="a42"></a><a class="code" href="structrte__table__acl__rule__add__params.html#a41b7c4ba47c44a632d5903b1f1338ad0">priority</a> = req-&gt;priorities[i];</div>
<div class="line">            params[i]-&gt;<a name="a43"></a><a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[0].<a name="a44"></a><a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u8 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.proto;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[0].<a name="a45"></a><a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u8 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.proto_mask;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[1].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_ip;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[1].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_ip_mask;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[2].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_ip;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[2].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_ip_mask;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[3].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_port_from;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[3].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_port_to;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[4].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_port_from;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__add__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[4].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_port_to;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            rsp-&gt;status = -1; <span class="comment">/* Error */</span></div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries[i]);</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(params[i]);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> rsp;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a46"></a><a class="code" href="rte__pipeline_8h.html#a95cffe0cc5ee976c84d57af72b570523">rte_pipeline_table_entry_add_bulk</a>(p-&gt;p, p-&gt;table_id[0],</div>
<div class="line">            (<span class="keywordtype">void</span> *)params, (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **)entries,</div>
<div class="line">            n_keys, req-&gt;keys_found,</div>
<div class="line">            (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **)req-&gt;entries_ptr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries[i]);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(params[i]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_del_bulk_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_bulk_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_bulk_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structrte__table__acl__rule__delete__params.html">rte_table_acl_rule_delete_params</a> *params[req-&gt;n_keys];</div>
<div class="line"></div>
<div class="line">    uint32_t i, n_keys;</div>
<div class="line"></div>
<div class="line">    n_keys = req-&gt;n_keys;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        params[i] = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__table__acl__rule__delete__params.html">rte_table_acl_rule_delete_params</a>),</div>
<div class="line">                RTE_CACHE_LINE_SIZE);</div>
<div class="line">        <span class="keywordflow">if</span> (params[i] == NULL) {</div>
<div class="line">            rsp-&gt;status = -1;</div>
<div class="line">            <span class="keywordflow">return</span> rsp;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span> (req-&gt;keys[i].type) {</div>
<div class="line">        <span class="keywordflow">case</span> PIPELINE_FIREWALL_IPV4_5TUPLE:</div>
<div class="line">            params[i]-&gt;<a name="a47"></a><a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[0].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u8 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.proto;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[0].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u8 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.proto_mask;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[1].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_ip;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[1].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_ip_mask;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[2].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_ip;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[2].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u32 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_ip_mask;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[3].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_port_from;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[3].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.src_port_to;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[4].<a class="code" href="structrte__acl__field.html#ab397ea159dd9289ea3f71c67f938257a">value</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_port_from;</div>
<div class="line">            params[i]-&gt;<a class="code" href="structrte__table__acl__rule__delete__params.html#abe9119683c49ea1a0dca0e47ea78555d">field_value</a>[4].<a class="code" href="structrte__acl__field.html#a7250bdac559be0f98d3aeb2397605a13">mask_range</a>.u16 =</div>
<div class="line">                req-&gt;keys[i].key.ipv4_5tuple.dst_port_to;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            rsp-&gt;status = -1; <span class="comment">/* Error */</span></div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++)</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(params[i]);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">return</span> rsp;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a48"></a><a class="code" href="rte__pipeline_8h.html#a20c2e2a595e117cd9ae797fee6ab253a">rte_pipeline_table_entry_delete_bulk</a>(p-&gt;p, p-&gt;table_id[0],</div>
<div class="line">            (<span class="keywordtype">void</span> **)&amp;params, n_keys, req-&gt;keys_found, NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++)</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(params[i]);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_add_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_default_msg_req *req = msg;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_default_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>firewall_table_entry default_entry = {</div>
<div class="line">        .head = {</div>
<div class="line">            .action = <a class="code" href="rte__pipeline_8h.html#a6376b240935404d998f003d113651572ac8c58609785d844989b7d9eb1e6db8aa">RTE_PIPELINE_ACTION_PORT</a>,</div>
<div class="line">            {.port_id = p-&gt;port_out_id[req-&gt;port_id]},</div>
<div class="line">        },</div>
<div class="line">    };</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a49"></a><a class="code" href="rte__pipeline_8h.html#a8980fbc2a51d6dc8041b798ea5172318">rte_pipeline_table_default_entry_add</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *) &amp;default_entry,</div>
<div class="line">        (<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> **) &amp;rsp-&gt;entry_ptr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> *</div>
<div class="line">pipeline_firewall_msg_req_del_default_handler(<span class="keyword">struct</span> pipeline *p, <span class="keywordtype">void</span> *msg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_default_msg_rsp *rsp = msg;</div>
<div class="line"></div>
<div class="line">    rsp-&gt;status = <a name="a50"></a><a class="code" href="rte__pipeline_8h.html#ac83e9cacb91301a7425694f32249e050">rte_pipeline_table_default_entry_delete</a>(p-&gt;p,</div>
<div class="line">        p-&gt;table_id[0],</div>
<div class="line">        NULL);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> rsp;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_be_ops pipeline_firewall_be_ops = {</div>
<div class="line">    .f_init = pipeline_firewall_init,</div>
<div class="line">    .f_free = pipeline_firewall_free,</div>
<div class="line">    .f_run = NULL,</div>
<div class="line">    .f_timer = pipeline_firewall_timer,</div>
<div class="line">    .f_track = pipeline_firewall_track,</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
