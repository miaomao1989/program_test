<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/pipeline/pipeline_routing.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/pipeline/pipeline_routing.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2015 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_num.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_ipaddr.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_etheraddr.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;app.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_common_fe.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_routing.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_routing_route {</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_data data;</div>
<div class="line">    <span class="keywordtype">void</span> *entry_ptr;</div>
<div class="line"></div>
<div class="line">    TAILQ_ENTRY(app_pipeline_routing_route) node;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_routing_arp_entry {</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_key key;</div>
<div class="line">    <span class="keyword">struct </span><a name="_a0"></a><a class="code" href="structether__addr.html">ether_addr</a> macaddr;</div>
<div class="line">    <span class="keywordtype">void</span> *entry_ptr;</div>
<div class="line"></div>
<div class="line">    TAILQ_ENTRY(app_pipeline_routing_arp_entry) node;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">struct pipeline_routing {</div>
<div class="line">    <span class="comment">/* Parameters */</span></div>
<div class="line">    uint32_t n_ports_in;</div>
<div class="line">    uint32_t n_ports_out;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Routes */</span></div>
<div class="line">    <a name="a1"></a><a class="code" href="rte__dev_8h.html#a6ded4e1869262353a8700cdc4d453b82">TAILQ_HEAD</a>(, app_pipeline_routing_route) routes;</div>
<div class="line">    uint32_t n_routes;</div>
<div class="line"></div>
<div class="line">    uint32_t default_route_present;</div>
<div class="line">    uint32_t default_route_port_id;</div>
<div class="line">    <span class="keywordtype">void</span> *default_route_entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* ARP entries */</span></div>
<div class="line">    <a class="code" href="rte__dev_8h.html#a6ded4e1869262353a8700cdc4d453b82">TAILQ_HEAD</a>(, app_pipeline_routing_arp_entry) arp_entries;</div>
<div class="line">    uint32_t n_arp_entries;</div>
<div class="line"></div>
<div class="line">    uint32_t default_arp_entry_present;</div>
<div class="line">    uint32_t default_arp_entry_port_id;</div>
<div class="line">    <span class="keywordtype">void</span> *default_arp_entry_ptr;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">static <span class="keywordtype">void</span> *</div>
<div class="line">pipeline_routing_init(struct pipeline_params *params,</div>
<div class="line">    <a name="a2"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line">    uint32_t size;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((params == NULL) ||</div>
<div class="line">        (params-&gt;n_ports_in == 0) ||</div>
<div class="line">        (params-&gt;n_ports_out == 0))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Memory allocation */</span></div>
<div class="line">    size = <a name="a3"></a><a class="code" href="rte__memory_8h.html#a30eec128f3d71add687a1cbfe48abcbb">RTE_CACHE_LINE_ROUNDUP</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_routing));</div>
<div class="line">    p = <a name="a4"></a><a class="code" href="rte__malloc_8h.html#a58042061ad622f028aa2b97e8cb73a41">rte_zmalloc</a>(NULL, size, RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Initialization */</span></div>
<div class="line">    p-&gt;n_ports_in = params-&gt;n_ports_in;</div>
<div class="line">    p-&gt;n_ports_out = params-&gt;n_ports_out;</div>
<div class="line"></div>
<div class="line">    TAILQ_INIT(&amp;p-&gt;routes);</div>
<div class="line">    p-&gt;n_routes = 0;</div>
<div class="line"></div>
<div class="line">    TAILQ_INIT(&amp;p-&gt;arp_entries);</div>
<div class="line">    p-&gt;n_arp_entries = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> p;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_free(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p = pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free resources */</span></div>
<div class="line">    <span class="keywordflow">while</span> (!TAILQ_EMPTY(&amp;p-&gt;routes)) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_routing_route *route;</div>
<div class="line"></div>
<div class="line">        route = TAILQ_FIRST(&amp;p-&gt;routes);</div>
<div class="line">        TAILQ_REMOVE(&amp;p-&gt;routes, route, node);</div>
<div class="line">        <a name="a5"></a><a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(route);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span> (!TAILQ_EMPTY(&amp;p-&gt;arp_entries)) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_routing_arp_entry *arp_entry;</div>
<div class="line"></div>
<div class="line">        arp_entry = TAILQ_FIRST(&amp;p-&gt;arp_entries);</div>
<div class="line">        TAILQ_REMOVE(&amp;p-&gt;arp_entries, arp_entry, node);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(arp_entry);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>app_pipeline_routing_route *</div>
<div class="line">app_pipeline_routing_find_route(<span class="keyword">struct</span> pipeline_routing *p,</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">struct</span> pipeline_routing_route_key *key)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_route *it, *found;</div>
<div class="line"></div>
<div class="line">    found = NULL;</div>
<div class="line">    TAILQ_FOREACH(it, &amp;p-&gt;routes, node) {</div>
<div class="line">        <span class="keywordflow">if</span> ((key-&gt;type == it-&gt;key.type) &amp;&amp;</div>
<div class="line">            (key-&gt;key.ipv4.ip == it-&gt;key.key.ipv4.ip) &amp;&amp;</div>
<div class="line">            (key-&gt;key.ipv4.depth == it-&gt;key.key.ipv4.depth)) {</div>
<div class="line">            found = it;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> found;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>app_pipeline_routing_arp_entry *</div>
<div class="line">app_pipeline_routing_find_arp_entry(<span class="keyword">struct</span> pipeline_routing *p,</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">struct</span> pipeline_routing_arp_key *key)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_arp_entry *it, *found;</div>
<div class="line"></div>
<div class="line">    found = NULL;</div>
<div class="line">    TAILQ_FOREACH(it, &amp;p-&gt;arp_entries, node) {</div>
<div class="line">        <span class="keywordflow">if</span> ((key-&gt;type == it-&gt;key.type) &amp;&amp;</div>
<div class="line">            (key-&gt;key.ipv4.port_id == it-&gt;key.key.ipv4.port_id) &amp;&amp;</div>
<div class="line">            (key-&gt;key.ipv4.ip == it-&gt;key.key.ipv4.ip)) {</div>
<div class="line">            found = it;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> found;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_route(<span class="keyword">const</span> <span class="keyword">struct</span> app_pipeline_routing_route *route)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (route-&gt;key.type == PIPELINE_ROUTING_ROUTE_IPV4) {</div>
<div class="line">        <span class="keyword">const</span> <span class="keyword">struct </span>pipeline_routing_route_key_ipv4 *key =</div>
<div class="line">                &amp;route-&gt;key.key.ipv4;</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;IP Prefix = %&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32</div>
<div class="line">            <span class="stringliteral">&quot;.%&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32 <span class="stringliteral">&quot;/%&quot;</span> PRIu32</div>
<div class="line">            <span class="stringliteral">&quot; =&gt; (Port = %&quot;</span> PRIu32,</div>
<div class="line"></div>
<div class="line">            (key-&gt;ip &gt;&gt; 24) &amp; 0xFF,</div>
<div class="line">            (key-&gt;ip &gt;&gt; 16) &amp; 0xFF,</div>
<div class="line">            (key-&gt;ip &gt;&gt; 8) &amp; 0xFF,</div>
<div class="line">            key-&gt;ip &amp; 0xFF,</div>
<div class="line"></div>
<div class="line">            key-&gt;depth,</div>
<div class="line">            route-&gt;data.port_id);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (route-&gt;data.flags &amp; PIPELINE_ROUTING_ROUTE_ARP)</div>
<div class="line">            printf(</div>
<div class="line">                <span class="stringliteral">&quot;, Next Hop IP = %&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32</div>
<div class="line">                <span class="stringliteral">&quot;.%&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32,</div>
<div class="line"></div>
<div class="line">                (route-&gt;data.ethernet.ip &gt;&gt; 24) &amp; 0xFF,</div>
<div class="line">                (route-&gt;data.ethernet.ip &gt;&gt; 16) &amp; 0xFF,</div>
<div class="line">                (route-&gt;data.ethernet.ip &gt;&gt; 8) &amp; 0xFF,</div>
<div class="line">                route-&gt;data.ethernet.ip &amp; 0xFF);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            printf(</div>
<div class="line">                <span class="stringliteral">&quot;, Next Hop HWaddress = %02&quot;</span> PRIx32</div>
<div class="line">                <span class="stringliteral">&quot;:%02&quot;</span> PRIx32 <span class="stringliteral">&quot;:%02&quot;</span> PRIx32</div>
<div class="line">                <span class="stringliteral">&quot;:%02&quot;</span> PRIx32 <span class="stringliteral">&quot;:%02&quot;</span> PRIx32</div>
<div class="line">                <span class="stringliteral">&quot;:%02&quot;</span> PRIx32,</div>
<div class="line"></div>
<div class="line">                route-&gt;data.ethernet.macaddr.addr_bytes[0],</div>
<div class="line">                route-&gt;data.ethernet.macaddr.addr_bytes[1],</div>
<div class="line">                route-&gt;data.ethernet.macaddr.addr_bytes[2],</div>
<div class="line">                route-&gt;data.ethernet.macaddr.addr_bytes[3],</div>
<div class="line">                route-&gt;data.ethernet.macaddr.addr_bytes[4],</div>
<div class="line">                route-&gt;data.ethernet.macaddr.addr_bytes[5]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (route-&gt;data.flags &amp; PIPELINE_ROUTING_ROUTE_QINQ)</div>
<div class="line">            printf(<span class="stringliteral">&quot;, QinQ SVLAN = %&quot;</span> PRIu32 <span class="stringliteral">&quot; CVLAN = %&quot;</span> PRIu32,</div>
<div class="line">                route-&gt;data.l2.qinq.svlan,</div>
<div class="line">                route-&gt;data.l2.qinq.cvlan);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (route-&gt;data.flags &amp; PIPELINE_ROUTING_ROUTE_MPLS) {</div>
<div class="line">            uint32_t i;</div>
<div class="line"></div>
<div class="line">            printf(<span class="stringliteral">&quot;, MPLS labels&quot;</span>);</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; route-&gt;data.l2.mpls.n_labels; i++)</div>
<div class="line">                printf(<span class="stringliteral">&quot; %&quot;</span> PRIu32,</div>
<div class="line">                    route-&gt;data.l2.mpls.labels[i]);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;)\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_arp_entry(<span class="keyword">const</span> <span class="keyword">struct</span> app_pipeline_routing_arp_entry *entry)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;(Port = %&quot;</span> PRIu32 <span class="stringliteral">&quot;, IP = %&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32</div>
<div class="line">        <span class="stringliteral">&quot;.%&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32</div>
<div class="line">        <span class="stringliteral">&quot;) =&gt; HWaddress = %02&quot;</span> PRIx32 <span class="stringliteral">&quot;:%02&quot;</span> PRIx32 <span class="stringliteral">&quot;:%02&quot;</span> PRIx32</div>
<div class="line">        <span class="stringliteral">&quot;:%02&quot;</span> PRIx32 <span class="stringliteral">&quot;:%02&quot;</span> PRIx32 <span class="stringliteral">&quot;:%02&quot;</span> PRIx32 <span class="stringliteral">&quot;\n&quot;</span>,</div>
<div class="line"></div>
<div class="line">        entry-&gt;key.key.ipv4.port_id,</div>
<div class="line">        (entry-&gt;key.key.ipv4.ip &gt;&gt; 24) &amp; 0xFF,</div>
<div class="line">        (entry-&gt;key.key.ipv4.ip &gt;&gt; 16) &amp; 0xFF,</div>
<div class="line">        (entry-&gt;key.key.ipv4.ip &gt;&gt; 8) &amp; 0xFF,</div>
<div class="line">        entry-&gt;key.key.ipv4.ip &amp; 0xFF,</div>
<div class="line"></div>
<div class="line">        entry-&gt;macaddr.addr_bytes[0],</div>
<div class="line">        entry-&gt;macaddr.addr_bytes[1],</div>
<div class="line">        entry-&gt;macaddr.addr_bytes[2],</div>
<div class="line">        entry-&gt;macaddr.addr_bytes[3],</div>
<div class="line">        entry-&gt;macaddr.addr_bytes[4],</div>
<div class="line">        entry-&gt;macaddr.addr_bytes[5]);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_route_ls(<span class="keyword">struct</span> app_params *app, uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_route *it;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"></div>
<div class="line">    TAILQ_FOREACH(it, &amp;p-&gt;routes, node)</div>
<div class="line">        print_route(it);</div>
<div class="line"></div>
<div class="line">    if (p-&gt;default_route_present)</div>
<div class="line">        printf(&quot;Default route: <a name="_a6"></a><a class="code" href="structport.html">port</a> %&quot; PRIu32 &quot; (entry ptr = %p)\n&quot;,</div>
<div class="line">                p-&gt;default_route_port_id,</div>
<div class="line">                p-&gt;default_route_entry_ptr);</div>
<div class="line">    else</div>
<div class="line">        printf(&quot;Default: DROP\n&quot;);</div>
<div class="line"></div>
<div class="line">    return 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_add_route(struct app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    struct pipeline_routing_route_key *key,</div>
<div class="line">    struct pipeline_routing_route_data *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_add_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_add_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_route *entry;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> new_entry;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (key == NULL) ||</div>
<div class="line">        (data == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (key-&gt;type) {</div>
<div class="line">    <span class="keywordflow">case</span> PIPELINE_ROUTING_ROUTE_IPV4:</div>
<div class="line">    {</div>
<div class="line">        uint32_t depth = key-&gt;key.ipv4.depth;</div>
<div class="line">        uint32_t netmask;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* key */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((depth == 0) || (depth &gt; 32))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">        netmask = (~0U) &lt;&lt; (32 - depth);</div>
<div class="line">        key-&gt;key.ipv4.ip &amp;= netmask;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* data */</span></div>
<div class="line">        <span class="keywordflow">if</span> (data-&gt;port_id &gt;= p-&gt;n_ports_out)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Find existing rule or allocate new rule */</span></div>
<div class="line">    entry = app_pipeline_routing_find_route(p, key);</div>
<div class="line">    new_entry = (entry == NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (entry == NULL) {</div>
<div class="line">        entry = <a name="a7"></a><a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL, <span class="keyword">sizeof</span>(*entry), RTE_CACHE_LINE_SIZE);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (entry == NULL)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_entry)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ROUTE_ADD;</div>
<div class="line">    memcpy(&amp;req-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line">    memcpy(&amp;req-&gt;data, data, <span class="keyword">sizeof</span>(*data));</div>
<div class="line"></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_entry)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write entry */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status ||</div>
<div class="line">        (rsp-&gt;entry_ptr == NULL) ||</div>
<div class="line">        ((new_entry == 0) &amp;&amp; (rsp-&gt;key_found == 0)) ||</div>
<div class="line">        ((new_entry == 1) &amp;&amp; (rsp-&gt;key_found == 1))) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">if</span> (new_entry)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memcpy(&amp;entry-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line">    memcpy(&amp;entry-&gt;data, data, <span class="keyword">sizeof</span>(*data));</div>
<div class="line">    entry-&gt;entry_ptr = rsp-&gt;entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit entry */</span></div>
<div class="line">    <span class="keywordflow">if</span> (new_entry) {</div>
<div class="line">        TAILQ_INSERT_TAIL(&amp;p-&gt;routes, entry, node);</div>
<div class="line">        p-&gt;n_routes++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    print_route(entry);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message buffer free */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_delete_route(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_routing_route_key *key)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_delete_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_delete_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_route *entry;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (key == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (key-&gt;type) {</div>
<div class="line">    <span class="keywordflow">case</span> PIPELINE_ROUTING_ROUTE_IPV4:</div>
<div class="line">    {</div>
<div class="line">        uint32_t depth = key-&gt;key.ipv4.depth;</div>
<div class="line">        uint32_t netmask;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* key */</span></div>
<div class="line">        <span class="keywordflow">if</span> ((depth == 0) || (depth &gt; 32))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">        netmask = (~0U) &lt;&lt; (32 - depth);</div>
<div class="line">        key-&gt;key.ipv4.ip &amp;= netmask;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Find rule */</span></div>
<div class="line">    entry = app_pipeline_routing_find_route(p, key);</div>
<div class="line">    <span class="keywordflow">if</span> (entry == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ROUTE_DEL;</div>
<div class="line">    memcpy(&amp;req-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line"></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status || !rsp-&gt;key_found) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Remove route */</span></div>
<div class="line">    TAILQ_REMOVE(&amp;p-&gt;routes, entry, node);</div>
<div class="line">    p-&gt;n_routes--;</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_add_default_route(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    uint32_t port_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_add_default_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_add_default_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (port_id &gt;= p-&gt;n_ports_out)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ROUTE_ADD_DEFAULT;</div>
<div class="line">    req-&gt;port_id = port_id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write route */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status || (rsp-&gt;entry_ptr == NULL)) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    p-&gt;default_route_port_id = port_id;</div>
<div class="line">    p-&gt;default_route_entry_ptr = rsp-&gt;entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit route */</span></div>
<div class="line">    p-&gt;default_route_present = 1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_delete_default_route(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_delete_default_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_delete_default_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ROUTE_DEL_DEFAULT;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write route */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit route */</span></div>
<div class="line">    p-&gt;default_route_present = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_arp_ls(<span class="keyword">struct</span> app_params *app, uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_arp_entry *it;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"></div>
<div class="line">    TAILQ_FOREACH(it, &amp;p-&gt;arp_entries, node)</div>
<div class="line">        print_arp_entry(it);</div>
<div class="line"></div>
<div class="line">    if (p-&gt;default_arp_entry_present)</div>
<div class="line">        printf(&quot;Default entry: <a class="code" href="structport.html">port</a> %&quot; PRIu32 &quot; (entry ptr = %p)\n&quot;,</div>
<div class="line">                p-&gt;default_arp_entry_port_id,</div>
<div class="line">                p-&gt;default_arp_entry_ptr);</div>
<div class="line">    else</div>
<div class="line">        printf(&quot;Default: DROP\n&quot;);</div>
<div class="line"></div>
<div class="line">    return 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_add_arp_entry(struct app_params *app, uint32_t pipeline_id,</div>
<div class="line">        struct pipeline_routing_arp_key *key,</div>
<div class="line">        struct <a class="code" href="structether__addr.html">ether_addr</a> *macaddr)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_add_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_add_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_arp_entry *entry;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> new_entry;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (key == NULL) ||</div>
<div class="line">        (macaddr == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (key-&gt;type) {</div>
<div class="line">    <span class="keywordflow">case</span> PIPELINE_ROUTING_ARP_IPV4:</div>
<div class="line">    {</div>
<div class="line">        uint32_t port_id = key-&gt;key.ipv4.port_id;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* key */</span></div>
<div class="line">        <span class="keywordflow">if</span> (port_id &gt;= p-&gt;n_ports_out)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Find existing entry or allocate new */</span></div>
<div class="line">    entry = app_pipeline_routing_find_arp_entry(p, key);</div>
<div class="line">    new_entry = (entry == NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (entry == NULL) {</div>
<div class="line">        entry = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL, <span class="keyword">sizeof</span>(*entry), RTE_CACHE_LINE_SIZE);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (entry == NULL)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message buffer allocation */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_entry)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ARP_ADD;</div>
<div class="line">    memcpy(&amp;req-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line">    <a name="a8"></a><a class="code" href="rte__ether_8h.html#a38a0c494f25e8d352ba382a9e3e806b7">ether_addr_copy</a>(macaddr, &amp;req-&gt;macaddr);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_entry)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write entry */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status ||</div>
<div class="line">        (rsp-&gt;entry_ptr == NULL) ||</div>
<div class="line">        ((new_entry == 0) &amp;&amp; (rsp-&gt;key_found == 0)) ||</div>
<div class="line">        ((new_entry == 1) &amp;&amp; (rsp-&gt;key_found == 1))) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">if</span> (new_entry)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memcpy(&amp;entry-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line">    <a class="code" href="rte__ether_8h.html#a38a0c494f25e8d352ba382a9e3e806b7">ether_addr_copy</a>(macaddr, &amp;entry-&gt;macaddr);</div>
<div class="line">    entry-&gt;entry_ptr = rsp-&gt;entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit entry */</span></div>
<div class="line">    <span class="keywordflow">if</span> (new_entry) {</div>
<div class="line">        TAILQ_INSERT_TAIL(&amp;p-&gt;arp_entries, entry, node);</div>
<div class="line">        p-&gt;n_arp_entries++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    print_arp_entry(entry);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Message buffer free */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_delete_arp_entry(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_routing_arp_key *key)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_delete_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_delete_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_routing_arp_entry *entry;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (key == NULL))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> (key-&gt;type) {</div>
<div class="line">    <span class="keywordflow">case</span> PIPELINE_ROUTING_ARP_IPV4:</div>
<div class="line">    {</div>
<div class="line">        uint32_t port_id = key-&gt;key.ipv4.port_id;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* key */</span></div>
<div class="line">        <span class="keywordflow">if</span> (port_id &gt;= p-&gt;n_ports_out)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Find rule */</span></div>
<div class="line">    entry = app_pipeline_routing_find_arp_entry(p, key);</div>
<div class="line">    <span class="keywordflow">if</span> (entry == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ARP_DEL;</div>
<div class="line">    memcpy(&amp;req-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line"></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status || !rsp-&gt;key_found) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Remove entry */</span></div>
<div class="line">    TAILQ_REMOVE(&amp;p-&gt;arp_entries, entry, node);</div>
<div class="line">    p-&gt;n_arp_entries--;</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entry);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_add_default_arp_entry(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">        uint32_t pipeline_id,</div>
<div class="line">        uint32_t port_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_add_default_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_add_default_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (port_id &gt;= p-&gt;n_ports_out)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ARP_ADD_DEFAULT;</div>
<div class="line">    req-&gt;port_id = port_id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write entry */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status || rsp-&gt;entry_ptr == NULL) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    p-&gt;default_arp_entry_port_id = port_id;</div>
<div class="line">    p-&gt;default_arp_entry_ptr = rsp-&gt;entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit entry */</span></div>
<div class="line">    p-&gt;default_arp_entry_present = 1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_routing_delete_default_arp_entry(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_delete_default_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_delete_default_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -EINVAL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -ENOMEM;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_ROUTING_MSG_REQ_ARP_DEL_DEFAULT;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -ETIMEDOUT;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write entry */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> rsp-&gt;status;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit entry */</span></div>
<div class="line">    p-&gt;default_arp_entry_present = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">parse_labels(<span class="keywordtype">char</span> *<span class="keywordtype">string</span>, uint32_t *labels, uint32_t *n_labels)</div>
<div class="line">{</div>
<div class="line">    uint32_t n_max_labels = *n_labels, count = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check for void list of labels */</span></div>
<div class="line">    <span class="keywordflow">if</span> (strcmp(<span class="keywordtype">string</span>, <span class="stringliteral">&quot;&lt;void&gt;&quot;</span>) == 0) {</div>
<div class="line">        *n_labels = 0;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* At least one label should be present */</span></div>
<div class="line">    <span class="keywordflow">for</span> ( ; (*<span class="keywordtype">string</span> != <span class="charliteral">&#39;\0&#39;</span>); ) {</div>
<div class="line">        <span class="keywordtype">char</span> *next;</div>
<div class="line">        <span class="keywordtype">int</span> value;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (count &gt;= n_max_labels)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (count &gt; 0) {</div>
<div class="line">            <span class="keywordflow">if</span> (<span class="keywordtype">string</span>[0] != <span class="charliteral">&#39;:&#39;</span>)</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">            <span class="keywordtype">string</span>++;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        value = strtol(<span class="keywordtype">string</span>, &amp;next, 10);</div>
<div class="line">        <span class="keywordflow">if</span> (next == <span class="keywordtype">string</span>)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        <span class="keywordtype">string</span> = next;</div>
<div class="line"></div>
<div class="line">        labels[count++] = (uint32_t) value;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *n_labels = count;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route add (mpls = no, qinq = no, arp = no)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_add1_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line">    cmdline_fixed_string_t port_string;</div>
<div class="line">    uint32_t <a class="code" href="structport.html">port</a>;</div>
<div class="line">    cmdline_fixed_string_t ether_string;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structether__addr.html">ether_addr</a> macaddr;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_add1_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_add1_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_data route_data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create route */</span></div>
<div class="line">    key.type = PIPELINE_ROUTING_ROUTE_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a name="a9"></a><a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.depth = params-&gt;depth;</div>
<div class="line"></div>
<div class="line">    route_data.flags = 0;</div>
<div class="line">    route_data.port_id = params-&gt;port;</div>
<div class="line">    route_data.ethernet.macaddr = params-&gt;macaddr;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_route(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        &amp;key,</div>
<div class="line">        &amp;route_data);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add1_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add1_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add1_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, route_string,</div>
<div class="line">    <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add1_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, add_string,</div>
<div class="line">    <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add1_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add1_depth =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, depth, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add1_port_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, port_string,</div>
<div class="line">    <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add1_port =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, <a class="code" href="structport.html">port</a>, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add1_ether_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, ether_string,</div>
<div class="line">    <span class="stringliteral">&quot;ether&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_etheraddr_t cmd_route_add1_macaddr =</div>
<div class="line">    TOKEN_ETHERADDR_INITIALIZER(<span class="keyword">struct</span> cmd_route_add1_result, macaddr);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_add1 = {</div>
<div class="line">    .f = cmd_route_add1_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route add (mpls = no, qinq = no, arp = no)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_depth,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_port_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_port,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_ether_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add1_macaddr,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route add (mpls = no, qinq = no, arp = yes)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_add2_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line">    cmdline_fixed_string_t port_string;</div>
<div class="line">    uint32_t <a class="code" href="structport.html">port</a>;</div>
<div class="line">    cmdline_fixed_string_t ether_string;</div>
<div class="line">    cmdline_ipaddr_t nh_ip;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_add2_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_add2_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_data route_data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create route */</span></div>
<div class="line">    key.type = PIPELINE_ROUTING_ROUTE_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.depth = params-&gt;depth;</div>
<div class="line"></div>
<div class="line">    route_data.flags = PIPELINE_ROUTING_ROUTE_ARP;</div>
<div class="line">    route_data.port_id = params-&gt;port;</div>
<div class="line">    route_data.ethernet.ip =</div>
<div class="line">        <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;nh_ip.addr.ipv4.s_addr);</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_route(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        &amp;key,</div>
<div class="line">        &amp;route_data);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add2_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add2_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add2_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, route_string,</div>
<div class="line">    <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add2_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, add_string,</div>
<div class="line">    <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add2_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add2_depth =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, depth, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add2_port_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, port_string,</div>
<div class="line">    <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add2_port =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, <a class="code" href="structport.html">port</a>, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add2_ether_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, ether_string,</div>
<div class="line">    <span class="stringliteral">&quot;ether&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add2_nh_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add2_result, nh_ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_add2 = {</div>
<div class="line">    .f = cmd_route_add2_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route add (mpls = no, qinq = no, arp = yes)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_depth,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_port_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_port,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_ether_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add2_nh_ip,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route add (mpls = no, qinq = yes, arp = no)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_add3_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line">    cmdline_fixed_string_t port_string;</div>
<div class="line">    uint32_t <a class="code" href="structport.html">port</a>;</div>
<div class="line">    cmdline_fixed_string_t ether_string;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structether__addr.html">ether_addr</a> macaddr;</div>
<div class="line">    cmdline_fixed_string_t qinq_string;</div>
<div class="line">    uint32_t svlan;</div>
<div class="line">    uint32_t cvlan;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_add3_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_add3_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_data route_data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create route */</span></div>
<div class="line">    key.type = PIPELINE_ROUTING_ROUTE_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.depth = params-&gt;depth;</div>
<div class="line"></div>
<div class="line">    route_data.flags = PIPELINE_ROUTING_ROUTE_QINQ;</div>
<div class="line">    route_data.port_id = params-&gt;port;</div>
<div class="line">    route_data.ethernet.macaddr = params-&gt;macaddr;</div>
<div class="line">    route_data.l2.qinq.svlan = params-&gt;svlan;</div>
<div class="line">    route_data.l2.qinq.cvlan = params-&gt;cvlan;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_route(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        &amp;key,</div>
<div class="line">        &amp;route_data);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add3_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add3_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add3_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, route_string,</div>
<div class="line">    <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add3_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, add_string,</div>
<div class="line">    <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add3_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add3_depth =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, depth, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add3_port_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, port_string,</div>
<div class="line">    <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add3_port =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, <a class="code" href="structport.html">port</a>, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add3_ether_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, ether_string,</div>
<div class="line">    <span class="stringliteral">&quot;ether&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_etheraddr_t cmd_route_add3_macaddr =</div>
<div class="line">    TOKEN_ETHERADDR_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, macaddr);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add3_qinq_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, qinq_string,</div>
<div class="line">    <span class="stringliteral">&quot;qinq&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add3_svlan =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, svlan, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add3_cvlan =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add3_result, cvlan, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_add3 = {</div>
<div class="line">    .f = cmd_route_add3_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route add (qinq = yes, arp = no)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_depth,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_port_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_port,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_ether_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_macaddr,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_qinq_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_svlan,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add3_cvlan,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route add (mpls = no, qinq = yes, arp = yes)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_add4_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line">    cmdline_fixed_string_t port_string;</div>
<div class="line">    uint32_t <a class="code" href="structport.html">port</a>;</div>
<div class="line">    cmdline_fixed_string_t ether_string;</div>
<div class="line">    cmdline_ipaddr_t nh_ip;</div>
<div class="line">    cmdline_fixed_string_t qinq_string;</div>
<div class="line">    uint32_t svlan;</div>
<div class="line">    uint32_t cvlan;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_add4_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_add4_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_data route_data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create route */</span></div>
<div class="line">    key.type = PIPELINE_ROUTING_ROUTE_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.depth = params-&gt;depth;</div>
<div class="line"></div>
<div class="line">    route_data.flags = PIPELINE_ROUTING_ROUTE_QINQ |</div>
<div class="line">        PIPELINE_ROUTING_ROUTE_ARP;</div>
<div class="line">    route_data.port_id = params-&gt;port;</div>
<div class="line">    route_data.ethernet.ip =</div>
<div class="line">        <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;nh_ip.addr.ipv4.s_addr);</div>
<div class="line">    route_data.l2.qinq.svlan = params-&gt;svlan;</div>
<div class="line">    route_data.l2.qinq.cvlan = params-&gt;cvlan;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_route(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        &amp;key,</div>
<div class="line">        &amp;route_data);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add4_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add4_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add4_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, route_string,</div>
<div class="line">    <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add4_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, add_string,</div>
<div class="line">    <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add4_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add4_depth =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, depth, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add4_port_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, port_string,</div>
<div class="line">    <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add4_port =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, <a class="code" href="structport.html">port</a>, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add4_ether_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, ether_string,</div>
<div class="line">    <span class="stringliteral">&quot;ether&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add4_nh_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, nh_ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add4_qinq_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, qinq_string,</div>
<div class="line">    <span class="stringliteral">&quot;qinq&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add4_svlan =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, svlan, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add4_cvlan =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add4_result, cvlan, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_add4 = {</div>
<div class="line">    .f = cmd_route_add4_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route add (qinq = yes, arp = yes)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_depth,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_port_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_port,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_ether_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_nh_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_qinq_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_svlan,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add4_cvlan,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route add (mpls = yes, qinq = no, arp = no)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_add5_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line">    cmdline_fixed_string_t port_string;</div>
<div class="line">    uint32_t <a class="code" href="structport.html">port</a>;</div>
<div class="line">    cmdline_fixed_string_t ether_string;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structether__addr.html">ether_addr</a> macaddr;</div>
<div class="line">    cmdline_fixed_string_t mpls_string;</div>
<div class="line">    cmdline_fixed_string_t mpls_labels;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_add5_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_add5_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_data route_data;</div>
<div class="line">    uint32_t mpls_labels[PIPELINE_ROUTING_MPLS_LABELS_MAX];</div>
<div class="line">    uint32_t n_labels = <a name="a10"></a><a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(mpls_labels);</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Parse MPLS labels */</span></div>
<div class="line">    status = parse_labels(params-&gt;mpls_labels, mpls_labels, &amp;n_labels);</div>
<div class="line">    <span class="keywordflow">if</span> (status) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;MPLS labels parse error\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create route */</span></div>
<div class="line">    key.type = PIPELINE_ROUTING_ROUTE_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.depth = params-&gt;depth;</div>
<div class="line"></div>
<div class="line">    route_data.flags = PIPELINE_ROUTING_ROUTE_MPLS;</div>
<div class="line">    route_data.port_id = params-&gt;port;</div>
<div class="line">    route_data.ethernet.macaddr = params-&gt;macaddr;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_labels; i++)</div>
<div class="line">        route_data.l2.mpls.labels[i] = mpls_labels[i];</div>
<div class="line">    route_data.l2.mpls.n_labels = n_labels;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_route(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        &amp;key,</div>
<div class="line">        &amp;route_data);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add5_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add5_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add5_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, route_string,</div>
<div class="line">    <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add5_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, add_string,</div>
<div class="line">    <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add5_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add5_depth =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, depth, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add5_port_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, port_string,</div>
<div class="line">    <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add5_port =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, <a class="code" href="structport.html">port</a>, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add5_ether_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, ether_string,</div>
<div class="line">    <span class="stringliteral">&quot;ether&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_etheraddr_t cmd_route_add5_macaddr =</div>
<div class="line">    TOKEN_ETHERADDR_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, macaddr);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add5_mpls_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, mpls_string,</div>
<div class="line">    <span class="stringliteral">&quot;mpls&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add5_mpls_labels =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add5_result, mpls_labels,</div>
<div class="line">    NULL);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_add5 = {</div>
<div class="line">    .f = cmd_route_add5_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route add (mpls = yes, arp = no)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_depth,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_port_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_port,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_ether_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_macaddr,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_mpls_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add5_mpls_labels,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route add (mpls = yes, qinq = no, arp = yes)</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_add6_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line">    cmdline_fixed_string_t port_string;</div>
<div class="line">    uint32_t <a class="code" href="structport.html">port</a>;</div>
<div class="line">    cmdline_fixed_string_t ether_string;</div>
<div class="line">    cmdline_ipaddr_t nh_ip;</div>
<div class="line">    cmdline_fixed_string_t mpls_string;</div>
<div class="line">    cmdline_fixed_string_t mpls_labels;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_add6_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_add6_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_data route_data;</div>
<div class="line">    uint32_t mpls_labels[PIPELINE_ROUTING_MPLS_LABELS_MAX];</div>
<div class="line">    uint32_t n_labels = <a class="code" href="rte__common_8h.html#ac963da91b35efa4700b73a1f4eb1d8a6">RTE_DIM</a>(mpls_labels);</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Parse MPLS labels */</span></div>
<div class="line">    status = parse_labels(params-&gt;mpls_labels, mpls_labels, &amp;n_labels);</div>
<div class="line">    <span class="keywordflow">if</span> (status) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;MPLS labels parse error\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create route */</span></div>
<div class="line">    key.type = PIPELINE_ROUTING_ROUTE_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.depth = params-&gt;depth;</div>
<div class="line"></div>
<div class="line">    route_data.flags = PIPELINE_ROUTING_ROUTE_MPLS |</div>
<div class="line">        PIPELINE_ROUTING_ROUTE_ARP;</div>
<div class="line">    route_data.port_id = params-&gt;port;</div>
<div class="line">    route_data.ethernet.ip =</div>
<div class="line">        <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;nh_ip.addr.ipv4.s_addr);</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_labels; i++)</div>
<div class="line">        route_data.l2.mpls.labels[i] = mpls_labels[i];</div>
<div class="line">    route_data.l2.mpls.n_labels = n_labels;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_route(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        &amp;key,</div>
<div class="line">        &amp;route_data);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add6_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add6_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add6_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, route_string,</div>
<div class="line">    <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add6_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, add_string,</div>
<div class="line">    <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add6_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add6_depth =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, depth, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add6_port_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, port_string,</div>
<div class="line">    <span class="stringliteral">&quot;port&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add6_port =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, <a class="code" href="structport.html">port</a>, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add6_ether_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, ether_string,</div>
<div class="line">    <span class="stringliteral">&quot;ether&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_add6_nh_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, nh_ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add6_mpls_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, mpls_string,</div>
<div class="line">    <span class="stringliteral">&quot;mpls&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add6_mpls_labels =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add6_result, mpls_labels,</div>
<div class="line">    NULL);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_add6 = {</div>
<div class="line">    .f = cmd_route_add6_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route add (mpls = yes, arp = yes)&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_depth,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_port_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_port,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_ether_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_nh_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_mpls_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add6_mpls_labels,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route del</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_del_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t del_string;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    uint32_t depth;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_del_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_del_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_route_key key;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Create route */</span></div>
<div class="line">    key.type = PIPELINE_ROUTING_ROUTE_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>((uint32_t) params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.depth = params-&gt;depth;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_delete_route(app, params-&gt;p, &amp;key);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_del_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_del_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_del_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_result, route_string,</div>
<div class="line">    <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_del_del_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_result, del_string,</div>
<div class="line">    <span class="stringliteral">&quot;del&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_route_del_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_del_depth =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_result, depth, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_del = {</div>
<div class="line">    .f = cmd_route_del_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route delete&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_del_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_depth,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route add default</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_add_default_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_fixed_string_t default_string;</div>
<div class="line">    uint32_t <a class="code" href="structport.html">port</a>;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_add_default_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_add_default_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_default_route(app, params-&gt;p,</div>
<div class="line">            params-&gt;port);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_add_default_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add_default_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_add_default_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add_default_result, p, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_route_add_default_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add_default_result,</div>
<div class="line">        route_string, <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_route_add_default_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add_default_result,</div>
<div class="line">        add_string, <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_route_add_default_default_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_add_default_result,</div>
<div class="line">    default_string, <span class="stringliteral">&quot;default&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_route_add_default_port =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_add_default_result,</div>
<div class="line">        <a class="code" href="structport.html">port</a>, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_route_add_default = {</div>
<div class="line">    .f = cmd_route_add_default_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route default set&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add_default_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add_default_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add_default_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add_default_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add_default_default_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_add_default_port,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route del default</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_del_default_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t del_string;</div>
<div class="line">    cmdline_fixed_string_t default_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_del_default_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">     <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_del_default_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_delete_default_route(app, params-&gt;p);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_del_default_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_default_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_del_default_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_default_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_del_default_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_default_result,</div>
<div class="line">        route_string, <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_del_default_del_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_default_result,</div>
<div class="line">        del_string, <span class="stringliteral">&quot;del&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_del_default_default_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_del_default_result,</div>
<div class="line">    default_string, <span class="stringliteral">&quot;default&quot;</span>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_del_default = {</div>
<div class="line">    .f = cmd_route_del_default_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route default clear&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_default_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_default_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_default_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_default_del_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_del_default_default_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * route ls</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_route_ls_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t route_string;</div>
<div class="line">    cmdline_fixed_string_t ls_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_route_ls_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_route_ls_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_route_ls(app, params-&gt;p);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_ls_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_ls_result, p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_route_ls_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_route_ls_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_ls_route_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_ls_result,</div>
<div class="line">    route_string, <span class="stringliteral">&quot;route&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_route_ls_ls_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_route_ls_result, ls_string,</div>
<div class="line">    <span class="stringliteral">&quot;ls&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_route_ls = {</div>
<div class="line">    .f = cmd_route_ls_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Route list&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_ls_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_ls_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_ls_route_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_route_ls_ls_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * arp add</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_arp_add_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t arp_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    uint32_t port_id;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structether__addr.html">ether_addr</a> macaddr;</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_arp_add_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_arp_add_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_key key;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    key.type = PIPELINE_ROUTING_ARP_IPV4;</div>
<div class="line">    key.key.ipv4.port_id = params-&gt;port_id;</div>
<div class="line">    key.key.ipv4.ip = <a name="a11"></a><a class="code" href="rte__byteorder_8h.html#a7d62fcf485a335a6c1307763a150895c">rte_cpu_to_be_32</a>(params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_arp_entry(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        &amp;key,</div>
<div class="line">        &amp;params-&gt;macaddr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_add_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_add_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_add_arp_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_result, arp_string, <span class="stringliteral">&quot;arp&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_add_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_result, add_string, <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_add_port_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_result, port_id, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_arp_add_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_etheraddr_t cmd_arp_add_macaddr =</div>
<div class="line">    TOKEN_ETHERADDR_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_result, macaddr);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_arp_add = {</div>
<div class="line">    .f = cmd_arp_add_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;ARP add&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_arp_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_port_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_macaddr,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * arp del</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_arp_del_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t arp_string;</div>
<div class="line">    cmdline_fixed_string_t del_string;</div>
<div class="line">    uint32_t port_id;</div>
<div class="line">    cmdline_ipaddr_t ip;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_arp_del_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_arp_del_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing_arp_key key;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    key.type = PIPELINE_ROUTING_ARP_IPV4;</div>
<div class="line">    key.key.ipv4.ip = <a class="code" href="rte__byteorder_8h.html#a7d62fcf485a335a6c1307763a150895c">rte_cpu_to_be_32</a>(params-&gt;ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4.port_id = params-&gt;port_id;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_delete_arp_entry(app, params-&gt;p, &amp;key);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_del_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_del_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_del_arp_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_result, arp_string, <span class="stringliteral">&quot;arp&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_del_del_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_result, del_string, <span class="stringliteral">&quot;del&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_del_port_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_result, port_id, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_ipaddr_t cmd_arp_del_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_result, ip);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_arp_del = {</div>
<div class="line">    .f = cmd_arp_del_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;ARP delete&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_arp_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_del_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_port_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_ip,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * arp add default</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_arp_add_default_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t arp_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_fixed_string_t default_string;</div>
<div class="line">    uint32_t port_id;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_arp_add_default_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_arp_add_default_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_add_default_arp_entry(app,</div>
<div class="line">        params-&gt;p,</div>
<div class="line">        params-&gt;port_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_add_default_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_default_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_add_default_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_default_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_add_default_arp_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_default_result, arp_string,</div>
<div class="line">    <span class="stringliteral">&quot;arp&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_add_default_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_default_result, add_string,</div>
<div class="line">    <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_add_default_default_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_default_result,</div>
<div class="line">        default_string, <span class="stringliteral">&quot;default&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_add_default_port_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_add_default_result, port_id,</div>
<div class="line">    UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_arp_add_default = {</div>
<div class="line">    .f = cmd_arp_add_default_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;ARP add default&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_default_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_default_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_default_arp_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_default_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_default_default_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_add_default_port_id,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * arp del default</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_arp_del_default_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t arp_string;</div>
<div class="line">    cmdline_fixed_string_t del_string;</div>
<div class="line">    cmdline_fixed_string_t default_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_arp_del_default_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_arp_del_default_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_routing_delete_default_arp_entry(app, params-&gt;p);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_del_default_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_default_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_del_default_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_default_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_del_default_arp_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_default_result, arp_string,</div>
<div class="line">    <span class="stringliteral">&quot;arp&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_del_default_del_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_default_result, del_string,</div>
<div class="line">    <span class="stringliteral">&quot;del&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_del_default_default_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_del_default_result,</div>
<div class="line">        default_string, <span class="stringliteral">&quot;default&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_arp_del_default = {</div>
<div class="line">    .f = cmd_arp_del_default_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;ARP delete default&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_default_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_default_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_default_arp_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_default_del_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_del_default_default_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * arp ls</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_arp_ls_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t p;</div>
<div class="line">    cmdline_fixed_string_t arp_string;</div>
<div class="line">    cmdline_fixed_string_t ls_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_arp_ls_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    <a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_arp_ls_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_routing *p;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, params-&gt;p, &amp;pipeline_routing);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    app_pipeline_routing_arp_ls(app, params-&gt;p);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_ls_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_ls_result, p_string,</div>
<div class="line">    <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_num_t cmd_arp_ls_p =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_arp_ls_result, p, UINT32);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_ls_arp_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_ls_result, arp_string,</div>
<div class="line">    <span class="stringliteral">&quot;arp&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_token_string_t cmd_arp_ls_ls_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_arp_ls_result, ls_string,</div>
<div class="line">    <span class="stringliteral">&quot;ls&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_inst_t cmd_arp_ls = {</div>
<div class="line">    .f = cmd_arp_ls_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;ARP list&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_ls_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_ls_p,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_ls_arp_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *)&amp;cmd_arp_ls_ls_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_ctx_t pipeline_cmds[] = {</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_add1,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_add2,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_add3,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_add4,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_add5,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_add6,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_del,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_add_default,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_del_default,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_route_ls,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_arp_add,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_arp_del,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_arp_add_default,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_arp_del_default,</div>
<div class="line">    (cmdline_parse_inst_t *)&amp;cmd_arp_ls,</div>
<div class="line">    NULL,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>pipeline_fe_ops pipeline_routing_fe_ops = {</div>
<div class="line">    .f_init = pipeline_routing_init,</div>
<div class="line">    .f_free = app_pipeline_routing_free,</div>
<div class="line">    .cmds = pipeline_cmds,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_type pipeline_routing = {</div>
<div class="line">    .name = <span class="stringliteral">&quot;ROUTING&quot;</span>,</div>
<div class="line">    .be_ops = &amp;pipeline_routing_be_ops,</div>
<div class="line">    .fe_ops = &amp;pipeline_routing_fe_ops,</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
