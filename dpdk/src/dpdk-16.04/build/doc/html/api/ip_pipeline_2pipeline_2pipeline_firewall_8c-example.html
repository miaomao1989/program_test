<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DPDK: ip_pipeline/pipeline/pipeline_firewall.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DPDK
   &#160;<span id="projectnumber">16.04.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ip_pipeline/pipeline/pipeline_firewall.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*-</span></div>
<div class="line"><span class="comment"> *   BSD LICENSE</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Copyright(c) 2010-2015 Intel Corporation. All rights reserved.</span></div>
<div class="line"><span class="comment"> *   All rights reserved.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   Redistribution and use in source and binary forms, with or without</span></div>
<div class="line"><span class="comment"> *   modification, are permitted provided that the following conditions</span></div>
<div class="line"><span class="comment"> *   are met:</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *     * Redistributions of source code must retain the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer.</span></div>
<div class="line"><span class="comment"> *     * Redistributions in binary form must reproduce the above copyright</span></div>
<div class="line"><span class="comment"> *       notice, this list of conditions and the following disclaimer in</span></div>
<div class="line"><span class="comment"> *       the documentation and/or other materials provided with the</span></div>
<div class="line"><span class="comment"> *       distribution.</span></div>
<div class="line"><span class="comment"> *     * Neither the name of Intel Corporation nor the names of its</span></div>
<div class="line"><span class="comment"> *       contributors may be used to endorse or promote products derived</span></div>
<div class="line"><span class="comment"> *       from this software without specific prior written permission.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></div>
<div class="line"><span class="comment"> *   &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></div>
<div class="line"><span class="comment"> *   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span></div>
<div class="line"><span class="comment"> *   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span></div>
<div class="line"><span class="comment"> *   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span></div>
<div class="line"><span class="comment"> *   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span></div>
<div class="line"><span class="comment"> *   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span></div>
<div class="line"><span class="comment"> *   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span></div>
<div class="line"><span class="comment"> *   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span></div>
<div class="line"><span class="comment"> *   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/queue.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;netinet/in.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__common_8h.html">rte_common.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__hexdump_8h.html">rte_hexdump.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="rte__malloc_8h.html">rte_malloc.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_rdline.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_num.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_ipaddr.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_parse_etheraddr.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cmdline_socket.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;app.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_common_fe.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;pipeline_firewall.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#define BUF_SIZE        1024</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_firewall_rule {</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_key key;</div>
<div class="line">    int32_t priority;</div>
<div class="line">    uint32_t port_id;</div>
<div class="line">    <span class="keywordtype">void</span> *entry_ptr;</div>
<div class="line"></div>
<div class="line">    TAILQ_ENTRY(app_pipeline_firewall_rule) node;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_firewall {</div>
<div class="line">    <span class="comment">/* parameters */</span></div>
<div class="line">    uint32_t n_ports_in;</div>
<div class="line">    uint32_t n_ports_out;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* rules */</span></div>
<div class="line">    <a name="a0"></a><a class="code" href="rte__dev_8h.html#a6ded4e1869262353a8700cdc4d453b82">TAILQ_HEAD</a>(, app_pipeline_firewall_rule) rules;</div>
<div class="line">    uint32_t n_rules;</div>
<div class="line">    uint32_t default_rule_present;</div>
<div class="line">    uint32_t default_rule_port_id;</div>
<div class="line">    <span class="keywordtype">void</span> *default_rule_entry_ptr;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">struct app_pipeline_add_bulk_params {</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_key *keys;</div>
<div class="line">    uint32_t n_keys;</div>
<div class="line">    uint32_t *priorities;</div>
<div class="line">    uint32_t *port_ids;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>app_pipeline_del_bulk_params {</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_key *keys;</div>
<div class="line">    uint32_t n_keys;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">print_firewall_ipv4_rule(<span class="keyword">struct</span> app_pipeline_firewall_rule *rule)</div>
<div class="line">{</div>
<div class="line">    printf(<span class="stringliteral">&quot;Prio = %&quot;</span> PRId32 <span class="stringliteral">&quot; (SA = %&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32</div>
<div class="line">        <span class="stringliteral">&quot;.%&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32 <span class="stringliteral">&quot;/%&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;DA = %&quot;</span> PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32</div>
<div class="line">        <span class="stringliteral">&quot;.%&quot;</span>PRIu32 <span class="stringliteral">&quot;.%&quot;</span> PRIu32 <span class="stringliteral">&quot;/%&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;SP = %&quot;</span> PRIu32 <span class="stringliteral">&quot;-%&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;DP = %&quot;</span> PRIu32 <span class="stringliteral">&quot;-%&quot;</span> PRIu32 <span class="stringliteral">&quot;, &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;Proto = %&quot;</span> PRIu32 <span class="stringliteral">&quot; / 0x%&quot;</span> PRIx32 <span class="stringliteral">&quot;) =&gt; &quot;</span></div>
<div class="line">        <span class="stringliteral">&quot;Port = %&quot;</span> PRIu32 <span class="stringliteral">&quot; (entry ptr = %p)\n&quot;</span>,</div>
<div class="line"></div>
<div class="line">        rule-&gt;priority,</div>
<div class="line"></div>
<div class="line">        (rule-&gt;key.key.ipv4_5tuple.src_ip &gt;&gt; 24) &amp; 0xFF,</div>
<div class="line">        (rule-&gt;key.key.ipv4_5tuple.src_ip &gt;&gt; 16) &amp; 0xFF,</div>
<div class="line">        (rule-&gt;key.key.ipv4_5tuple.src_ip &gt;&gt; 8) &amp; 0xFF,</div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.src_ip &amp; 0xFF,</div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.src_ip_mask,</div>
<div class="line"></div>
<div class="line">        (rule-&gt;key.key.ipv4_5tuple.dst_ip &gt;&gt; 24) &amp; 0xFF,</div>
<div class="line">        (rule-&gt;key.key.ipv4_5tuple.dst_ip &gt;&gt; 16) &amp; 0xFF,</div>
<div class="line">        (rule-&gt;key.key.ipv4_5tuple.dst_ip &gt;&gt; 8) &amp; 0xFF,</div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.dst_ip &amp; 0xFF,</div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.dst_ip_mask,</div>
<div class="line"></div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.src_port_from,</div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.src_port_to,</div>
<div class="line"></div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.dst_port_from,</div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.dst_port_to,</div>
<div class="line"></div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.proto,</div>
<div class="line">        rule-&gt;key.key.ipv4_5tuple.proto_mask,</div>
<div class="line"></div>
<div class="line">        rule-&gt;port_id,</div>
<div class="line">        rule-&gt;entry_ptr);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>app_pipeline_firewall_rule *</div>
<div class="line">app_pipeline_firewall_rule_find(<span class="keyword">struct</span> app_pipeline_firewall *p,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_firewall_key *key)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall_rule *r;</div>
<div class="line"></div>
<div class="line">    TAILQ_FOREACH(r, &amp;p-&gt;rules, node)</div>
<div class="line">        if (memcmp(key,</div>
<div class="line">            &amp;r-&gt;key,</div>
<div class="line">            sizeof(struct pipeline_firewall_key)) == 0)</div>
<div class="line">            return r;</div>
<div class="line"></div>
<div class="line">    return NULL;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">static <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_ls(</div>
<div class="line">    struct app_params *app,</div>
<div class="line">    uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall_rule *rule;</div>
<div class="line">    uint32_t n_rules;</div>
<div class="line">    <span class="keywordtype">int</span> priority;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_firewall);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    n_rules = p-&gt;n_rules;</div>
<div class="line">    <span class="keywordflow">for</span> (priority = 0; n_rules; priority++)</div>
<div class="line">        TAILQ_FOREACH(rule, &amp;p-&gt;rules, node)</div>
<div class="line">            <span class="keywordflow">if</span> (rule-&gt;priority == priority) {</div>
<div class="line">                print_firewall_ipv4_rule(rule);</div>
<div class="line">                n_rules--;</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (p-&gt;default_rule_present)</div>
<div class="line">        printf(<span class="stringliteral">&quot;Default rule: port %&quot;</span> PRIu32 <span class="stringliteral">&quot; (entry ptr = %p)\n&quot;</span>,</div>
<div class="line">            p-&gt;default_rule_port_id,</div>
<div class="line">            p-&gt;default_rule_entry_ptr);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        printf(<span class="stringliteral">&quot;Default rule: DROP\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    printf(<span class="stringliteral">&quot;\n&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>*</div>
<div class="line">app_pipeline_firewall_init(<span class="keyword">struct</span> pipeline_params *params,</div>
<div class="line">    <a name="a1"></a><a class="code" href="rte__common_8h.html#ae1a7c8799cb57669ae2ddf367b21533f">__rte_unused</a> <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    uint32_t size;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((params == NULL) ||</div>
<div class="line">        (params-&gt;n_ports_in == 0) ||</div>
<div class="line">        (params-&gt;n_ports_out == 0))</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Memory allocation */</span></div>
<div class="line">    size = <a name="a2"></a><a class="code" href="rte__memory_8h.html#a30eec128f3d71add687a1cbfe48abcbb">RTE_CACHE_LINE_ROUNDUP</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> app_pipeline_firewall));</div>
<div class="line">    p = <a name="a3"></a><a class="code" href="rte__malloc_8h.html#a58042061ad622f028aa2b97e8cb73a41">rte_zmalloc</a>(NULL, size, RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> NULL;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Initialization */</span></div>
<div class="line">    p-&gt;n_ports_in = params-&gt;n_ports_in;</div>
<div class="line">    p-&gt;n_ports_out = params-&gt;n_ports_out;</div>
<div class="line"></div>
<div class="line">    TAILQ_INIT(&amp;p-&gt;rules);</div>
<div class="line">    p-&gt;n_rules = 0;</div>
<div class="line">    p-&gt;default_rule_present = 0;</div>
<div class="line">    p-&gt;default_rule_port_id = 0;</div>
<div class="line">    p-&gt;default_rule_entry_ptr = NULL;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *) p;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_free(<span class="keywordtype">void</span> *pipeline)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p = pipeline;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free resources */</span></div>
<div class="line">    <span class="keywordflow">while</span> (!TAILQ_EMPTY(&amp;p-&gt;rules)) {</div>
<div class="line">        <span class="keyword">struct </span>app_pipeline_firewall_rule *rule;</div>
<div class="line"></div>
<div class="line">        rule = TAILQ_FIRST(&amp;p-&gt;rules);</div>
<div class="line">        TAILQ_REMOVE(&amp;p-&gt;rules, rule, node);</div>
<div class="line">        <a name="a4"></a><a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rule);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(p);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_key_check_and_normalize(<span class="keyword">struct</span> pipeline_firewall_key *key)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (key-&gt;type) {</div>
<div class="line">    <span class="keywordflow">case</span> PIPELINE_FIREWALL_IPV4_5TUPLE:</div>
<div class="line">    {</div>
<div class="line">        uint32_t src_ip_depth = key-&gt;key.ipv4_5tuple.src_ip_mask;</div>
<div class="line">        uint32_t dst_ip_depth = key-&gt;key.ipv4_5tuple.dst_ip_mask;</div>
<div class="line">        uint16_t src_port_from = key-&gt;key.ipv4_5tuple.src_port_from;</div>
<div class="line">        uint16_t src_port_to = key-&gt;key.ipv4_5tuple.src_port_to;</div>
<div class="line">        uint16_t dst_port_from = key-&gt;key.ipv4_5tuple.dst_port_from;</div>
<div class="line">        uint16_t dst_port_to = key-&gt;key.ipv4_5tuple.dst_port_to;</div>
<div class="line"></div>
<div class="line">        uint32_t src_ip_netmask = 0;</div>
<div class="line">        uint32_t dst_ip_netmask = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ((src_ip_depth &gt; 32) ||</div>
<div class="line">            (dst_ip_depth &gt; 32) ||</div>
<div class="line">            (src_port_from &gt; src_port_to) ||</div>
<div class="line">            (dst_port_from &gt; dst_port_to))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (src_ip_depth)</div>
<div class="line">            src_ip_netmask = (~0U) &lt;&lt; (32 - src_ip_depth);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (dst_ip_depth)</div>
<div class="line">            dst_ip_netmask = ((~0U) &lt;&lt; (32 - dst_ip_depth));</div>
<div class="line"></div>
<div class="line">        key-&gt;key.ipv4_5tuple.src_ip &amp;= src_ip_netmask;</div>
<div class="line">        key-&gt;key.ipv4_5tuple.dst_ip &amp;= dst_ip_netmask;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_add_bulk_parse_file(<span class="keywordtype">char</span> *filename,</div>
<div class="line">        <span class="keyword">struct</span> app_pipeline_add_bulk_params *params)</div>
<div class="line">{</div>
<div class="line">    FILE *f;</div>
<div class="line">    <span class="keywordtype">char</span> file_buf[BUF_SIZE];</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status = 0;</div>
<div class="line"></div>
<div class="line">    f = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (f == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    params-&gt;n_keys = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (fgets(file_buf, BUF_SIZE, f) != NULL)</div>
<div class="line">        params-&gt;n_keys++;</div>
<div class="line">    rewind(f);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;n_keys == 0) {</div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    params-&gt;keys = <a name="a5"></a><a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            params-&gt;n_keys * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_firewall_key),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;keys == NULL) {</div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    params-&gt;priorities = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            params-&gt;n_keys * <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;priorities == NULL) {</div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    params-&gt;port_ids = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            params-&gt;n_keys * <span class="keyword">sizeof</span>(uint32_t),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;port_ids == NULL) {</div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    i = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (fgets(file_buf, BUF_SIZE, f) != NULL) {</div>
<div class="line">        <span class="keywordtype">char</span> *str;</div>
<div class="line"></div>
<div class="line">        str = strtok(file_buf, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;priorities[i] = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip = atoi(str)&lt;&lt;24;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip |= atoi(str)&lt;&lt;16;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip |= atoi(str)&lt;&lt;8;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip |= atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip_mask = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip = atoi(str)&lt;&lt;24;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip |= atoi(str)&lt;&lt;16;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip |= atoi(str)&lt;&lt;8;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip |= atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip_mask = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_port_from = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_port_to = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_port_from = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_port_to = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.proto = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* Need to add 2 to str to skip leading 0x */</span></div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.proto_mask = strtol(str+2, NULL, 16);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;port_ids[i] = atoi(str);</div>
<div class="line">        params-&gt;keys[i].type = PIPELINE_FIREWALL_IPV4_5TUPLE;</div>
<div class="line"></div>
<div class="line">        i++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">end:</div>
<div class="line">    fclose(f);</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">app_pipeline_del_bulk_parse_file(<span class="keywordtype">char</span> *filename,</div>
<div class="line">        <span class="keyword">struct</span> app_pipeline_del_bulk_params *params)</div>
<div class="line">{</div>
<div class="line">    FILE *f;</div>
<div class="line">    <span class="keywordtype">char</span> file_buf[BUF_SIZE];</div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status = 0;</div>
<div class="line"></div>
<div class="line">    f = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (f == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    params-&gt;n_keys = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (fgets(file_buf, BUF_SIZE, f) != NULL)</div>
<div class="line">        params-&gt;n_keys++;</div>
<div class="line">    rewind(f);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;n_keys == 0) {</div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    params-&gt;keys = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            params-&gt;n_keys * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> pipeline_firewall_key),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (params-&gt;keys == NULL) {</div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    i = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (fgets(file_buf, BUF_SIZE, f) != NULL) {</div>
<div class="line">        <span class="keywordtype">char</span> *str;</div>
<div class="line"></div>
<div class="line">        str = strtok(file_buf, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip = atoi(str)&lt;&lt;24;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip |= atoi(str)&lt;&lt;16;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip |= atoi(str)&lt;&lt;8;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip |= atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_ip_mask = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip = atoi(str)&lt;&lt;24;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip |= atoi(str)&lt;&lt;16;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip |= atoi(str)&lt;&lt;8;</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; .&quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip |= atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_ip_mask = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_port_from = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.src_port_to = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_port_from = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.dst_port_to = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.proto = atoi(str);</div>
<div class="line"></div>
<div class="line">        str = strtok(NULL, <span class="stringliteral">&quot; &quot;</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (str == NULL) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* Need to add 2 to str to skip leading 0x */</span></div>
<div class="line">        params-&gt;keys[i].key.ipv4_5tuple.proto_mask = strtol(str+2, NULL, 16);</div>
<div class="line"></div>
<div class="line">        params-&gt;keys[i].type = PIPELINE_FIREWALL_IPV4_5TUPLE;</div>
<div class="line"></div>
<div class="line">        i++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; params-&gt;n_keys; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (app_pipeline_firewall_key_check_and_normalize(&amp;params-&gt;keys[i]) != 0) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> end;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">end:</div>
<div class="line">    fclose(f);</div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_add_rule(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_firewall_key *key,</div>
<div class="line">    uint32_t priority,</div>
<div class="line">    uint32_t port_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall_rule *rule;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_msg_rsp *rsp;</div>
<div class="line">    <span class="keywordtype">int</span> new_rule;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (key == NULL) ||</div>
<div class="line">        (key-&gt;type != PIPELINE_FIREWALL_IPV4_5TUPLE))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_firewall);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (port_id &gt;= p-&gt;n_ports_out)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app_pipeline_firewall_key_check_and_normalize(key) != 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Find existing rule or allocate new rule */</span></div>
<div class="line">    rule = app_pipeline_firewall_rule_find(p, key);</div>
<div class="line">    new_rule = (rule == NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (rule == NULL) {</div>
<div class="line">        rule = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL, <span class="keyword">sizeof</span>(*rule), RTE_CACHE_LINE_SIZE);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (rule == NULL)</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_rule)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rule);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FIREWALL_MSG_REQ_ADD;</div>
<div class="line">    memcpy(&amp;req-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line">    req-&gt;priority = priority;</div>
<div class="line">    req-&gt;port_id = port_id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL) {</div>
<div class="line">        <span class="keywordflow">if</span> (new_rule)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rule);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write rule */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status ||</div>
<div class="line">        (rsp-&gt;entry_ptr == NULL) ||</div>
<div class="line">        ((new_rule == 0) &amp;&amp; (rsp-&gt;key_found == 0)) ||</div>
<div class="line">        ((new_rule == 1) &amp;&amp; (rsp-&gt;key_found == 1))) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">if</span> (new_rule)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rule);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    memcpy(&amp;rule-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line">    rule-&gt;priority = priority;</div>
<div class="line">    rule-&gt;port_id = port_id;</div>
<div class="line">    rule-&gt;entry_ptr = rsp-&gt;entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit rule */</span></div>
<div class="line">    <span class="keywordflow">if</span> (new_rule) {</div>
<div class="line">        TAILQ_INSERT_TAIL(&amp;p-&gt;rules, rule, node);</div>
<div class="line">        p-&gt;n_rules++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    print_firewall_ipv4_rule(rule);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_delete_rule(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_firewall_key *key)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall_rule *rule;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> ((app == NULL) ||</div>
<div class="line">        (key == NULL) ||</div>
<div class="line">        (key-&gt;type != PIPELINE_FIREWALL_IPV4_5TUPLE))</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_firewall);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (app_pipeline_firewall_key_check_and_normalize(key) != 0)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Find rule */</span></div>
<div class="line">    rule = app_pipeline_firewall_rule_find(p, key);</div>
<div class="line">    <span class="keywordflow">if</span> (rule == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FIREWALL_MSG_REQ_DEL;</div>
<div class="line">    memcpy(&amp;req-&gt;key, key, <span class="keyword">sizeof</span>(*key));</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status || !rsp-&gt;key_found) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Remove rule */</span></div>
<div class="line">    TAILQ_REMOVE(&amp;p-&gt;rules, rule, node);</div>
<div class="line">    p-&gt;n_rules--;</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rule);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_add_bulk(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">        uint32_t pipeline_id,</div>
<div class="line">        <span class="keyword">struct</span> pipeline_firewall_key *keys,</div>
<div class="line">        uint32_t n_keys,</div>
<div class="line">        uint32_t *priorities,</div>
<div class="line">        uint32_t *port_ids)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_bulk_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_bulk_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall_rule **rules;</div>
<div class="line">    <span class="keywordtype">int</span> *new_rules;</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> *keys_found;</div>
<div class="line">    <span class="keywordtype">void</span> **entries_ptr;</div>
<div class="line"></div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_firewall);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    rules = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            n_keys * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> app_pipeline_firewall_rule *),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (rules == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    new_rules = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            n_keys * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (new_rules == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* check data integrity and add to rule list */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (port_ids[i]  &gt;= p-&gt;n_ports_out) {</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (app_pipeline_firewall_key_check_and_normalize(&amp;keys[i]) != 0) {</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        rules[i] = app_pipeline_firewall_rule_find(p, &amp;keys[i]);</div>
<div class="line">        new_rules[i] = (rules[i] == NULL);</div>
<div class="line">        <span class="keywordflow">if</span> (rules[i] == NULL) {</div>
<div class="line">            rules[i] = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL, <span class="keyword">sizeof</span>(*rules[i]),</div>
<div class="line">                    RTE_CACHE_LINE_SIZE);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span> (rules[i] == NULL) {</div>
<div class="line">                uint32_t j;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">for</span> (j = 0; j &lt;= i; j++)</div>
<div class="line">                    <span class="keywordflow">if</span> (new_rules[j])</div>
<div class="line">                        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[j]);</div>
<div class="line"></div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    keys_found = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            n_keys * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (keys_found == NULL) {</div>
<div class="line">        uint32_t j;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; n_keys; j++)</div>
<div class="line">            <span class="keywordflow">if</span> (new_rules[j])</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[j]);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    entries_ptr = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            n_keys * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a name="_a6"></a><a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a> *),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (entries_ptr == NULL) {</div>
<div class="line">        uint32_t j;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; n_keys; j++)</div>
<div class="line">            <span class="keywordflow">if</span> (new_rules[j])</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[j]);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        entries_ptr[i] = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structrte__pipeline__table__entry.html">rte_pipeline_table_entry</a>),</div>
<div class="line">                RTE_CACHE_LINE_SIZE);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> (entries_ptr[i] == NULL) {</div>
<div class="line">            uint32_t j;</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt; n_keys; j++)</div>
<div class="line">                <span class="keywordflow">if</span> (new_rules[j])</div>
<div class="line">                    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[j]);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (j = 0; j &lt;= i; j++)</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr[j]);</div>
<div class="line"></div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr);</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL) {</div>
<div class="line">        uint32_t j;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; n_keys; j++)</div>
<div class="line">            <span class="keywordflow">if</span> (new_rules[j])</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[j]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; n_keys; j++)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr[j]);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FIREWALL_MSG_REQ_ADD_BULK;</div>
<div class="line"></div>
<div class="line">    req-&gt;keys = keys;</div>
<div class="line">    req-&gt;n_keys = n_keys;</div>
<div class="line">    req-&gt;port_ids = port_ids;</div>
<div class="line">    req-&gt;priorities = priorities;</div>
<div class="line">    req-&gt;keys_found = keys_found;</div>
<div class="line">    req-&gt;entries_ptr = entries_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL) {</div>
<div class="line">        uint32_t j;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; n_keys; j++)</div>
<div class="line">            <span class="keywordflow">if</span> (new_rules[j])</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[j]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; n_keys; j++)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr[j]);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status) {</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++)</div>
<div class="line">            <span class="keywordflow">if</span> (new_rules[i])</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[i]);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++)</div>
<div class="line">            <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr[i]);</div>
<div class="line"></div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (entries_ptr[i] == NULL ||</div>
<div class="line">            ((new_rules[i] == 0) &amp;&amp; (keys_found[i] == 0)) ||</div>
<div class="line">            ((new_rules[i] == 1) &amp;&amp; (keys_found[i] == 1))) {</div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++)</div>
<div class="line">                <span class="keywordflow">if</span> (new_rules[i])</div>
<div class="line">                    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[i]);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++)</div>
<div class="line">                <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr[i]);</div>
<div class="line"></div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        memcpy(&amp;rules[i]-&gt;key, &amp;keys[i], <span class="keyword">sizeof</span>(keys[i]));</div>
<div class="line">        rules[i]-&gt;priority = priorities[i];</div>
<div class="line">        rules[i]-&gt;port_id = port_ids[i];</div>
<div class="line">        rules[i]-&gt;entry_ptr = entries_ptr[i];</div>
<div class="line"></div>
<div class="line">        <span class="comment">/* Commit rule */</span></div>
<div class="line">        <span class="keywordflow">if</span> (new_rules[i]) {</div>
<div class="line">            TAILQ_INSERT_TAIL(&amp;p-&gt;rules, rules[i], node);</div>
<div class="line">            p-&gt;n_rules++;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        print_firewall_ipv4_rule(rules[i]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">cleanup:</div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(new_rules);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(entries_ptr);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_delete_bulk(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    <span class="keyword">struct</span> pipeline_firewall_key *keys,</div>
<div class="line">    uint32_t n_keys)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_bulk_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_bulk_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall_rule **rules;</div>
<div class="line">    <span class="keywordtype">int</span> *keys_found;</div>
<div class="line"></div>
<div class="line">    uint32_t i;</div>
<div class="line">    <span class="keywordtype">int</span> status = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_firewall);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    rules = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            n_keys * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> app_pipeline_firewall_rule *),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (rules == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (app_pipeline_firewall_key_check_and_normalize(&amp;keys[i]) != 0) {</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        rules[i] = app_pipeline_firewall_rule_find(p, &amp;keys[i]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    keys_found = <a class="code" href="rte__malloc_8h.html#afb7316a4ec228ed9b8ffc1864b03d85b">rte_malloc</a>(NULL,</div>
<div class="line">            n_keys * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>),</div>
<div class="line">            RTE_CACHE_LINE_SIZE);</div>
<div class="line">    <span class="keywordflow">if</span> (keys_found == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FIREWALL_MSG_REQ_DEL_BULK;</div>
<div class="line"></div>
<div class="line">    req-&gt;keys = keys;</div>
<div class="line">    req-&gt;n_keys = n_keys;</div>
<div class="line">    req-&gt;keys_found = keys_found;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL) {</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status) {</div>
<div class="line">        status = -1;</div>
<div class="line">        <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (keys_found[i] == 0) {</div>
<div class="line">            status = -1;</div>
<div class="line">            <span class="keywordflow">goto</span> cleanup;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; n_keys; i++) {</div>
<div class="line">        TAILQ_REMOVE(&amp;p-&gt;rules, rules[i], node);</div>
<div class="line">        p-&gt;n_rules--;</div>
<div class="line">        <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules[i]);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">cleanup:</div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(rules);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(keys_found);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> status;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_add_default_rule(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id,</div>
<div class="line">    uint32_t port_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_default_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_add_default_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_firewall);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (port_id &gt;= p-&gt;n_ports_out)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FIREWALL_MSG_REQ_ADD_DEFAULT;</div>
<div class="line">    req-&gt;port_id = port_id;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write rule */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status || (rsp-&gt;entry_ptr == NULL)) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    p-&gt;default_rule_port_id = port_id;</div>
<div class="line">    p-&gt;default_rule_entry_ptr = rsp-&gt;entry_ptr;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit rule */</span></div>
<div class="line">    p-&gt;default_rule_present = 1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">app_pipeline_firewall_delete_default_rule(<span class="keyword">struct</span> app_params *app,</div>
<div class="line">    uint32_t pipeline_id)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_firewall *p;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_default_msg_req *req;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_del_default_msg_rsp *rsp;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Check input arguments */</span></div>
<div class="line">    <span class="keywordflow">if</span> (app == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    p = app_pipeline_data_fe(app, pipeline_id, &amp;pipeline_firewall);</div>
<div class="line">    <span class="keywordflow">if</span> (p == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Allocate and write request */</span></div>
<div class="line">    req = app_msg_alloc(app);</div>
<div class="line">    <span class="keywordflow">if</span> (req == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    req-&gt;type = PIPELINE_MSG_REQ_CUSTOM;</div>
<div class="line">    req-&gt;subtype = PIPELINE_FIREWALL_MSG_REQ_DEL_DEFAULT;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Send request and wait for response */</span></div>
<div class="line">    rsp = app_msg_send_recv(app, pipeline_id, req, MSG_TIMEOUT_DEFAULT);</div>
<div class="line">    <span class="keywordflow">if</span> (rsp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Read response and write rule */</span></div>
<div class="line">    <span class="keywordflow">if</span> (rsp-&gt;status) {</div>
<div class="line">        app_msg_free(app, rsp);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Commit rule */</span></div>
<div class="line">    p-&gt;default_rule_present = 0;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Free response */</span></div>
<div class="line">    app_msg_free(app, rsp);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * p firewall add ipv4</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_firewall_add_ipv4_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t firewall_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_fixed_string_t ipv4_string;</div>
<div class="line">    int32_t priority;</div>
<div class="line">    cmdline_ipaddr_t src_ip;</div>
<div class="line">    uint32_t src_ip_mask;</div>
<div class="line">    cmdline_ipaddr_t dst_ip;</div>
<div class="line">    uint32_t dst_ip_mask;</div>
<div class="line">    uint16_t src_port_from;</div>
<div class="line">    uint16_t src_port_to;</div>
<div class="line">    uint16_t dst_port_from;</div>
<div class="line">    uint16_t dst_port_to;</div>
<div class="line">    uint8_t proto;</div>
<div class="line">    uint8_t proto_mask;</div>
<div class="line">    uint8_t port_id;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_firewall_add_ipv4_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_firewall_add_ipv4_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_key key;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    key.type = PIPELINE_FIREWALL_IPV4_5TUPLE;</div>
<div class="line">    key.key.ipv4_5tuple.src_ip = <a name="a7"></a><a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(</div>
<div class="line">        (uint32_t) params-&gt;src_ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4_5tuple.src_ip_mask = params-&gt;src_ip_mask;</div>
<div class="line">    key.key.ipv4_5tuple.dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(</div>
<div class="line">        (uint32_t) params-&gt;dst_ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4_5tuple.dst_ip_mask = params-&gt;dst_ip_mask;</div>
<div class="line">    key.key.ipv4_5tuple.src_port_from = params-&gt;src_port_from;</div>
<div class="line">    key.key.ipv4_5tuple.src_port_to = params-&gt;src_port_to;</div>
<div class="line">    key.key.ipv4_5tuple.dst_port_from = params-&gt;dst_port_from;</div>
<div class="line">    key.key.ipv4_5tuple.dst_port_to = params-&gt;dst_port_to;</div>
<div class="line">    key.key.ipv4_5tuple.proto = params-&gt;proto;</div>
<div class="line">    key.key.ipv4_5tuple.proto_mask = params-&gt;proto_mask;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_firewall_add_rule(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        &amp;key,</div>
<div class="line">        params-&gt;priority,</div>
<div class="line">        params-&gt;port_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_ipv4_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result, p_string,</div>
<div class="line">        <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result, pipeline_id,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_ipv4_firewall_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        firewall_string, <span class="stringliteral">&quot;firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_ipv4_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        add_string, <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_ipv4_ipv4_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        ipv4_string, <span class="stringliteral">&quot;ipv4&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_priority =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result, priority,</div>
<div class="line">        INT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_ipaddr_t cmd_firewall_add_ipv4_src_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result, src_ip);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_src_ip_mask =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result, src_ip_mask,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_ipaddr_t cmd_firewall_add_ipv4_dst_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result, dst_ip);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_dst_ip_mask =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result, dst_ip_mask,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_src_port_from =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        src_port_from, UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_src_port_to =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        src_port_to, UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_dst_port_from =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        dst_port_from, UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_dst_port_to =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        dst_port_to, UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_proto =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        proto, UINT8);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_proto_mask =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        proto_mask, UINT8);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_ipv4_port_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_ipv4_result,</div>
<div class="line">        port_id, UINT8);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_firewall_add_ipv4 = {</div>
<div class="line">    .f = cmd_firewall_add_ipv4_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Firewall rule add&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_firewall_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_ipv4_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_priority,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_src_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_src_ip_mask,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_dst_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_dst_ip_mask,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_src_port_from,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_src_port_to,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_dst_port_from,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_dst_port_to,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_proto,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_proto_mask,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_ipv4_port_id,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * p firewall del ipv4</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_firewall_del_ipv4_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t firewall_string;</div>
<div class="line">    cmdline_fixed_string_t del_string;</div>
<div class="line">    cmdline_fixed_string_t ipv4_string;</div>
<div class="line">    cmdline_ipaddr_t src_ip;</div>
<div class="line">    uint32_t src_ip_mask;</div>
<div class="line">    cmdline_ipaddr_t dst_ip;</div>
<div class="line">    uint32_t dst_ip_mask;</div>
<div class="line">    uint16_t src_port_from;</div>
<div class="line">    uint16_t src_port_to;</div>
<div class="line">    uint16_t dst_port_from;</div>
<div class="line">    uint16_t dst_port_to;</div>
<div class="line">    uint8_t proto;</div>
<div class="line">    uint8_t proto_mask;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_firewall_del_ipv4_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_firewall_del_ipv4_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keyword">struct </span>pipeline_firewall_key key;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    key.type = PIPELINE_FIREWALL_IPV4_5TUPLE;</div>
<div class="line">    key.key.ipv4_5tuple.src_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(</div>
<div class="line">        (uint32_t) params-&gt;src_ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4_5tuple.src_ip_mask = params-&gt;src_ip_mask;</div>
<div class="line">    key.key.ipv4_5tuple.dst_ip = <a class="code" href="rte__byteorder_8h.html#aa1ddd507bcc0a87bbcfc5fdd9113094a">rte_bswap32</a>(</div>
<div class="line">        (uint32_t) params-&gt;dst_ip.addr.ipv4.s_addr);</div>
<div class="line">    key.key.ipv4_5tuple.dst_ip_mask = params-&gt;dst_ip_mask;</div>
<div class="line">    key.key.ipv4_5tuple.src_port_from = params-&gt;src_port_from;</div>
<div class="line">    key.key.ipv4_5tuple.src_port_to = params-&gt;src_port_to;</div>
<div class="line">    key.key.ipv4_5tuple.dst_port_from = params-&gt;dst_port_from;</div>
<div class="line">    key.key.ipv4_5tuple.dst_port_to = params-&gt;dst_port_to;</div>
<div class="line">    key.key.ipv4_5tuple.proto = params-&gt;proto;</div>
<div class="line">    key.key.ipv4_5tuple.proto_mask = params-&gt;proto_mask;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_firewall_delete_rule(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        &amp;key);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_ipv4_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, p_string,</div>
<div class="line">        <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, pipeline_id,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_ipv4_firewall_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result,</div>
<div class="line">        firewall_string, <span class="stringliteral">&quot;firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_ipv4_del_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result,</div>
<div class="line">        del_string, <span class="stringliteral">&quot;del&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_ipv4_ipv4_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result,</div>
<div class="line">        ipv4_string, <span class="stringliteral">&quot;ipv4&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_ipaddr_t cmd_firewall_del_ipv4_src_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, src_ip);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_src_ip_mask =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, src_ip_mask,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_ipaddr_t cmd_firewall_del_ipv4_dst_ip =</div>
<div class="line">    TOKEN_IPV4_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, dst_ip);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_dst_ip_mask =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, dst_ip_mask,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_src_port_from =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result,</div>
<div class="line">        src_port_from, UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_src_port_to =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, src_port_to,</div>
<div class="line">        UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_dst_port_from =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result,</div>
<div class="line">        dst_port_from, UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_dst_port_to =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result,</div>
<div class="line">        dst_port_to, UINT16);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_proto =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result,</div>
<div class="line">        proto, UINT8);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_ipv4_proto_mask =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_ipv4_result, proto_mask,</div>
<div class="line">        UINT8);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_firewall_del_ipv4 = {</div>
<div class="line">    .f = cmd_firewall_del_ipv4_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Firewall rule delete&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_firewall_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_del_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_ipv4_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_src_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_src_ip_mask,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_dst_ip,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_dst_ip_mask,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_src_port_from,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_src_port_to,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_dst_port_from,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_dst_port_to,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_proto,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_ipv4_proto_mask,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * p firewall add bulk</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_firewall_add_bulk_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t firewall_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_fixed_string_t bulk_string;</div>
<div class="line">    cmdline_fixed_string_t file_path;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_firewall_add_bulk_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_firewall_add_bulk_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_add_bulk_params add_bulk_params;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_add_bulk_parse_file(params-&gt;file_path, &amp;add_bulk_params);</div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_firewall_add_bulk(app, params-&gt;pipeline_id, add_bulk_params.keys,</div>
<div class="line">            add_bulk_params.n_keys, add_bulk_params.priorities, add_bulk_params.port_ids);</div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">end:</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(add_bulk_params.keys);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(add_bulk_params.priorities);</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(add_bulk_params.port_ids);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_bulk_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_bulk_result, p_string,</div>
<div class="line">        <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_bulk_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_bulk_result, pipeline_id,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_bulk_firewall_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_bulk_result,</div>
<div class="line">        firewall_string, <span class="stringliteral">&quot;firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_bulk_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_bulk_result,</div>
<div class="line">        add_string, <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_bulk_bulk_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_bulk_result,</div>
<div class="line">        bulk_string, <span class="stringliteral">&quot;bulk&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_bulk_file_path_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_bulk_result,</div>
<div class="line">        file_path, NULL);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_firewall_add_bulk = {</div>
<div class="line">    .f = cmd_firewall_add_bulk_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Firewall rule add bulk&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_bulk_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_bulk_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_bulk_firewall_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_bulk_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_bulk_bulk_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_bulk_file_path_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * p firewall del bulk</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_firewall_del_bulk_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t firewall_string;</div>
<div class="line">    cmdline_fixed_string_t del_string;</div>
<div class="line">    cmdline_fixed_string_t bulk_string;</div>
<div class="line">    cmdline_fixed_string_t file_path;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_firewall_del_bulk_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_firewall_del_bulk_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    <span class="keyword">struct </span>app_pipeline_del_bulk_params del_bulk_params;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_del_bulk_parse_file(params-&gt;file_path, &amp;del_bulk_params);</div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_firewall_delete_bulk(app, params-&gt;pipeline_id,</div>
<div class="line">            del_bulk_params.keys, del_bulk_params.n_keys);</div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">goto</span> end;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">end:</div>
<div class="line">    <a class="code" href="rte__malloc_8h.html#a0bc2d94a40f12074f57ecfd83e07bb7c">rte_free</a>(del_bulk_params.keys);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_bulk_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_bulk_result, p_string,</div>
<div class="line">        <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_bulk_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_bulk_result, pipeline_id,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_bulk_firewall_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_bulk_result,</div>
<div class="line">        firewall_string, <span class="stringliteral">&quot;firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_bulk_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_bulk_result,</div>
<div class="line">        del_string, <span class="stringliteral">&quot;del&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_bulk_bulk_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_bulk_result,</div>
<div class="line">        bulk_string, <span class="stringliteral">&quot;bulk&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_bulk_file_path_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_bulk_result,</div>
<div class="line">        file_path, NULL);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_firewall_del_bulk = {</div>
<div class="line">    .f = cmd_firewall_del_bulk_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Firewall rule del bulk&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_bulk_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_bulk_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_bulk_firewall_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_bulk_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_bulk_bulk_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_bulk_file_path_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * p firewall add default</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_firewall_add_default_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t firewall_string;</div>
<div class="line">    cmdline_fixed_string_t add_string;</div>
<div class="line">    cmdline_fixed_string_t default_string;</div>
<div class="line">    uint8_t port_id;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_firewall_add_default_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_firewall_add_default_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_firewall_add_default_rule(app,</div>
<div class="line">        params-&gt;pipeline_id,</div>
<div class="line">        params-&gt;port_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_default_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_default_result,</div>
<div class="line">        p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_default_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_default_result,</div>
<div class="line">        pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_default_firewall_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_default_result,</div>
<div class="line">    firewall_string, <span class="stringliteral">&quot;firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_default_add_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_default_result,</div>
<div class="line">    add_string, <span class="stringliteral">&quot;add&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_add_default_default_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_default_result,</div>
<div class="line">        default_string, <span class="stringliteral">&quot;default&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_add_default_port_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_add_default_result, port_id,</div>
<div class="line">        UINT8);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_firewall_add_default = {</div>
<div class="line">    .f = cmd_firewall_add_default_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Firewall default rule add&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_default_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_default_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_default_firewall_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_default_add_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_default_default_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_add_default_port_id,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * p firewall del default</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">struct </span>cmd_firewall_del_default_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t firewall_string;</div>
<div class="line">    cmdline_fixed_string_t del_string;</div>
<div class="line">    cmdline_fixed_string_t default_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_firewall_del_default_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_firewall_del_default_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_firewall_delete_default_rule(app,</div>
<div class="line">        params-&gt;pipeline_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_default_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_default_result,</div>
<div class="line">        p_string, <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_del_default_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_default_result,</div>
<div class="line">        pipeline_id, UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_default_firewall_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_default_result,</div>
<div class="line">    firewall_string, <span class="stringliteral">&quot;firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_default_del_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_default_result,</div>
<div class="line">        del_string, <span class="stringliteral">&quot;del&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_del_default_default_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_del_default_result,</div>
<div class="line">        default_string, <span class="stringliteral">&quot;default&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_firewall_del_default = {</div>
<div class="line">    .f = cmd_firewall_del_default_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Firewall default rule delete&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_default_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_default_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_default_firewall_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_default_del_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_del_default_default_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * p firewall ls</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>cmd_firewall_ls_result {</div>
<div class="line">    cmdline_fixed_string_t p_string;</div>
<div class="line">    uint32_t pipeline_id;</div>
<div class="line">    cmdline_fixed_string_t firewall_string;</div>
<div class="line">    cmdline_fixed_string_t ls_string;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">cmd_firewall_ls_parsed(</div>
<div class="line">    <span class="keywordtype">void</span> *parsed_result,</div>
<div class="line">    __attribute__((unused)) <span class="keyword">struct</span> cmdline *cl,</div>
<div class="line">    <span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>cmd_firewall_ls_result *params = parsed_result;</div>
<div class="line">    <span class="keyword">struct </span>app_params *app = data;</div>
<div class="line">    <span class="keywordtype">int</span> status;</div>
<div class="line"></div>
<div class="line">    status = app_pipeline_firewall_ls(app, params-&gt;pipeline_id);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (status != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Command failed\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_ls_p_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_ls_result, p_string,</div>
<div class="line">        <span class="stringliteral">&quot;p&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_num_t cmd_firewall_ls_pipeline_id =</div>
<div class="line">    TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_ls_result, pipeline_id,</div>
<div class="line">        UINT32);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_ls_firewall_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_ls_result,</div>
<div class="line">    firewall_string, <span class="stringliteral">&quot;firewall&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_token_string_t cmd_firewall_ls_ls_string =</div>
<div class="line">    TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_firewall_ls_result, ls_string,</div>
<div class="line">    <span class="stringliteral">&quot;ls&quot;</span>);</div>
<div class="line"></div>
<div class="line">cmdline_parse_inst_t cmd_firewall_ls = {</div>
<div class="line">    .f = cmd_firewall_ls_parsed,</div>
<div class="line">    .data = NULL,</div>
<div class="line">    .help_str = <span class="stringliteral">&quot;Firewall rule list&quot;</span>,</div>
<div class="line">    .tokens = {</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_ls_p_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_ls_pipeline_id,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_ls_firewall_string,</div>
<div class="line">        (<span class="keywordtype">void</span> *) &amp;cmd_firewall_ls_ls_string,</div>
<div class="line">        NULL,</div>
<div class="line">    },</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> cmdline_parse_ctx_t pipeline_cmds[] = {</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_firewall_add_ipv4,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_firewall_del_ipv4,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_firewall_add_bulk,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_firewall_del_bulk,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_firewall_add_default,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_firewall_del_default,</div>
<div class="line">    (cmdline_parse_inst_t *) &amp;cmd_firewall_ls,</div>
<div class="line">    NULL,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>pipeline_fe_ops pipeline_firewall_fe_ops = {</div>
<div class="line">    .f_init = app_pipeline_firewall_init,</div>
<div class="line">    .f_free = app_pipeline_firewall_free,</div>
<div class="line">    .cmds = pipeline_cmds,</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>pipeline_type pipeline_firewall = {</div>
<div class="line">    .name = <span class="stringliteral">&quot;FIREWALL&quot;</span>,</div>
<div class="line">    .be_ops = &amp;pipeline_firewall_be_ops,</div>
<div class="line">    .fe_ops = &amp;pipeline_firewall_fe_ops,</div>
<div class="line">};</div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
