

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5. Enabling Additional Functionality &mdash; Data Plane Development Kit 16.04.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Data Plane Development Kit 16.04.0 documentation" href="../index.html"/>
        <link rel="up" title="Getting Started Guide for Linux" href="index.html"/>
        <link rel="next" title="6. Quick Start Setup Script" href="quick_start.html"/>
        <link rel="prev" title="4. Compiling and Running Sample Applications" href="build_sample_apps.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Data Plane Development Kit
          

          
            
            <img src="../_static/DPDK_logo_vertical_rev_small.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                16.04.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started Guide for Linux</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="sys_reqs.html">2. System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_dpdk.html">3. Compiling the DPDK Target from Source</a></li>
<li class="toctree-l2"><a class="reference internal" href="build_sample_apps.html">4. Compiling and Running Sample Applications</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5. Enabling Additional Functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#high-precision-event-timer-hpet-functionality">5.1. High Precision Event Timer HPET) Functionality</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bios-support">5.1.1. BIOS Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#linux-kernel-support">5.1.2. Linux Kernel Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enabling-hpet-in-the-dpdk">5.1.3. Enabling HPET in the DPDK</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#running-dpdk-applications-without-root-privileges">5.2. Running DPDK Applications Without Root Privileges</a></li>
<li class="toctree-l3"><a class="reference internal" href="#power-management-and-power-saving-functionality">5.3. Power Management and Power Saving Functionality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-linux-core-isolation-to-reduce-context-switches">5.4. Using Linux Core Isolation to Reduce Context Switches</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-the-dpdk-kni-kernel-module">5.5. Loading the DPDK KNI Kernel Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-linux-iommu-pass-through-to-run-dpdk-with-intel-vt-d">5.6. Using Linux IOMMU Pass-Through to Run DPDK with IntelÂ® VT-d</a></li>
<li class="toctree-l3"><a class="reference internal" href="#high-performance-of-small-packets-on-40g-nic">5.7. High Performance of Small Packets on 40G NIC</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enabling-extended-tag">5.7.1. Enabling Extended Tag</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-16-bytes-rx-descriptor-size">5.7.2. Use 16 Bytes RX Descriptor Size</a></li>
<li class="toctree-l4"><a class="reference internal" href="#high-performance-and-per-packet-latency-tradeoff">5.7.3. High Performance and per Packet Latency Tradeoff</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quick_start.html">6. Quick Start Setup Script</a></li>
<li class="toctree-l2"><a class="reference internal" href="nic_perf_intel_platform.html">7. How to get best performance with NICs on Intel platforms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../freebsd_gsg/index.html">Getting Started Guide for FreeBSD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../xen/index.html">Xen Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prog_guide/index.html">Programmer&#8217;s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nics/index.html">Network Interface Controller Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cryptodevs/index.html">Crypto Device Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_app_ug/index.html">Sample Applications User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../testpmd_app_ug/index.html">Testpmd Application User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rel_notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributor&#8217;s Guidelines</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Data Plane Development Kit</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Getting Started Guide for Linux</a> &raquo;</li>
      
    <li>5. Enabling Additional Functionality</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/linux_gsg/enable_func.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="enabling-additional-functionality">
<span id="id1"></span><h1>5. Enabling Additional Functionality</h1>
<div class="section" id="high-precision-event-timer-hpet-functionality">
<span id="high-precision-event-timer"></span><h2>5.1. High Precision Event Timer HPET) Functionality</h2>
<div class="section" id="bios-support">
<h3>5.1.1. BIOS Support</h3>
<p>The High Precision Timer (HPET) must be enabled in the platform BIOS if the HPET is to be used.
Otherwise, the Time Stamp Counter (TSC) is used by default.
The BIOS is typically accessed by pressing F2 while the platform is starting up.
The user can then navigate to the HPET option. On the Crystal Forest platform BIOS, the path is:
<strong>Advanced -&gt; PCH-IO Configuration -&gt; High Precision Timer -&gt;</strong> (Change from Disabled to Enabled if necessary).</p>
<p>On a system that has already booted, the following command can be issued to check if HPET is enabled:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>grep hpet /proc/timer_list
</pre></div>
</div>
<p>If no entries are returned, HPET must be enabled in the BIOS (as per the instructions above) and the system rebooted.</p>
</div>
<div class="section" id="linux-kernel-support">
<h3>5.1.2. Linux Kernel Support</h3>
<p>The DPDK makes use of the platform HPET timer by mapping the timer counter into the process address space, and as such,
requires that the <code class="docutils literal"><span class="pre">HPET_MMAP</span></code> kernel configuration option be enabled.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">On Fedora, and other common distributions such as Ubuntu, the <code class="docutils literal"><span class="pre">HPET_MMAP</span></code> kernel option is not enabled by default.
To recompile the Linux kernel with this option enabled, please consult the distributions documentation for the relevant instructions.</p>
</div>
</div>
<div class="section" id="enabling-hpet-in-the-dpdk">
<h3>5.1.3. Enabling HPET in the DPDK</h3>
<p>By default, HPET support is disabled in the DPDK build configuration files.
To use HPET, the <code class="docutils literal"><span class="pre">CONFIG_RTE_LIBEAL_USE_HPET</span></code> setting should be changed to <code class="docutils literal"><span class="pre">y</span></code>, which will enable the HPET settings at compile time.</p>
<p>For an application to use the <code class="docutils literal"><span class="pre">rte_get_hpet_cycles()</span></code> and <code class="docutils literal"><span class="pre">rte_get_hpet_hz()</span></code> API calls,
and optionally to make the HPET the default time source for the rte_timer library,
the new <code class="docutils literal"><span class="pre">rte_eal_hpet_init()</span></code> API call should be called at application initialization.
This API call will ensure that the HPET is accessible, returning an error to the application if it is not,
for example, if <code class="docutils literal"><span class="pre">HPET_MMAP</span></code> is not enabled in the kernel.
The application can then determine what action to take, if any, if the HPET is not available at run-time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For applications that require timing APIs, but not the HPET timer specifically,
it is recommended that the <code class="docutils literal"><span class="pre">rte_get_timer_cycles()</span></code> and <code class="docutils literal"><span class="pre">rte_get_timer_hz()</span></code> API calls be used instead of the HPET-specific APIs.
These generic APIs can work with either TSC or HPET time sources, depending on what is requested by an application call to <code class="docutils literal"><span class="pre">rte_eal_hpet_init()</span></code>,
if any, and on what is available on the system at runtime.</p>
</div>
</div>
</div>
<div class="section" id="running-dpdk-applications-without-root-privileges">
<h2>5.2. Running DPDK Applications Without Root Privileges</h2>
<p>Although applications using the DPDK use network ports and other hardware resources directly,
with a number of small permission adjustments it is possible to run these applications as a user other than &#8220;root&#8221;.
To do so, the ownership, or permissions, on the following Linux file system objects should be adjusted to ensure that
the Linux user account being used to run the DPDK application has access to them:</p>
<ul>
<li><p class="first">All directories which serve as hugepage mount points, for example,   <code class="docutils literal"><span class="pre">/mnt/huge</span></code></p>
</li>
<li><p class="first">The userspace-io device files in  <code class="docutils literal"><span class="pre">/dev</span></code>, for example,  <code class="docutils literal"><span class="pre">/dev/uio0</span></code>, <code class="docutils literal"><span class="pre">/dev/uio1</span></code>, and so on</p>
</li>
<li><p class="first">The userspace-io sysfs config and resource files, for example for <code class="docutils literal"><span class="pre">uio0</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>/sys/class/uio/uio0/device/config
/sys/class/uio/uio0/device/resource*
</pre></div>
</div>
</li>
<li><p class="first">If the HPET is to be used,  <code class="docutils literal"><span class="pre">/dev/hpet</span></code></p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On some Linux installations, <code class="docutils literal"><span class="pre">/dev/hugepages</span></code>  is also a hugepage mount point created by default.</p>
</div>
</div>
<div class="section" id="power-management-and-power-saving-functionality">
<h2>5.3. Power Management and Power Saving Functionality</h2>
<p>Enhanced Intel SpeedStepÂ® Technology must be enabled in the platform BIOS if the power management feature of DPDK is to be used.
Otherwise, the sys file folder <code class="docutils literal"><span class="pre">/sys/devices/system/cpu/cpu0/cpufreq</span></code> will not exist, and the CPU frequency- based power management cannot be used.
Consult the relevant BIOS documentation to determine how these settings can be accessed.</p>
<p>For example, on some Intel reference platform BIOS variants, the path to Enhanced Intel SpeedStepÂ® Technology is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Advanced
  -&gt; Processor Configuration
  -&gt; Enhanced Intel SpeedStepÂ® Tech
</pre></div>
</div>
<p>In addition, C3 and C6 should be enabled as well for power management. The path of C3 and C6 on the same platform BIOS is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>Advanced
  -&gt; Processor Configuration
  -&gt; Processor C3 Advanced
  -&gt; Processor Configuration
  -&gt; Processor C6
</pre></div>
</div>
</div>
<div class="section" id="using-linux-core-isolation-to-reduce-context-switches">
<h2>5.4. Using Linux Core Isolation to Reduce Context Switches</h2>
<p>While the threads used by an DPDK application are pinned to logical cores on the system,
it is possible for the Linux scheduler to run other tasks on those cores also.
To help prevent additional workloads from running on those cores,
it is possible to use the <code class="docutils literal"><span class="pre">isolcpus</span></code> Linux kernel parameter to isolate them from the general Linux scheduler.</p>
<p>For example, if DPDK applications are to run on logical cores 2, 4 and 6,
the following should be added to the kernel parameter list:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">isolcpus=2,4,6</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-the-dpdk-kni-kernel-module">
<h2>5.5. Loading the DPDK KNI Kernel Module</h2>
<p>To run the DPDK Kernel NIC Interface (KNI) sample application, an extra kernel module (the kni module) must be loaded into the running kernel.
The module is found in the kmod sub-directory of the DPDK target directory.
Similar to the loading of the <code class="docutils literal"><span class="pre">igb_uio</span></code> module, this module should be loaded using the insmod command as shown below
(assuming that the current directory is the DPDK target directory):</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">insmod kmod/rte_kni.ko</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See the &#8220;Kernel NIC Interface Sample Application&#8221; chapter in the <em>DPDK Sample Applications User Guide</em> for more details.</p>
</div>
</div>
<div class="section" id="using-linux-iommu-pass-through-to-run-dpdk-with-intel-vt-d">
<h2>5.6. Using Linux IOMMU Pass-Through to Run DPDK with IntelÂ® VT-d</h2>
<p>To enable IntelÂ® VT-d in a Linux kernel, a number of kernel configuration options must be set. These include:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">IOMMU_SUPPORT</span></code></li>
<li><code class="docutils literal"><span class="pre">IOMMU_API</span></code></li>
<li><code class="docutils literal"><span class="pre">INTEL_IOMMU</span></code></li>
</ul>
<p>In addition, to run the DPDK with IntelÂ® VT-d, the <code class="docutils literal"><span class="pre">iommu=pt</span></code> kernel parameter must be used when using <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
This results in pass-through of the DMAR (DMA Remapping) lookup in the host.
Also, if <code class="docutils literal"><span class="pre">INTEL_IOMMU_DEFAULT_ON</span></code> is not set in the kernel, the <code class="docutils literal"><span class="pre">intel_iommu=on</span></code> kernel parameter must be used too.
This ensures that the Intel IOMMU is being initialized as expected.</p>
<p>Please note that while using <code class="docutils literal"><span class="pre">iommu=pt</span></code> is compulsory for <code class="docutils literal"><span class="pre">igb_uio</span> <span class="pre">driver</span></code>, the <code class="docutils literal"><span class="pre">vfio-pci</span></code> driver can actually work with both <code class="docutils literal"><span class="pre">iommu=pt</span></code> and <code class="docutils literal"><span class="pre">iommu=on</span></code>.</p>
</div>
<div class="section" id="high-performance-of-small-packets-on-40g-nic">
<h2>5.7. High Performance of Small Packets on 40G NIC</h2>
<p>As there might be firmware fixes for performance enhancement in latest version
of firmware image, the firmware update might be needed for getting high performance.
Check with the local Intel&#8217;s Network Division application engineers for firmware updates.
The base driver to support firmware version of FVL3E will be integrated in the next
DPDK release, so currently the validated firmware version is 4.2.6.</p>
<div class="section" id="enabling-extended-tag">
<h3>5.7.1. Enabling Extended Tag</h3>
<p>PCI configuration of <code class="docutils literal"><span class="pre">extended_tag</span></code> has big impact on small packet size
performance of 40G ports. Enabling <code class="docutils literal"><span class="pre">extended_tag</span></code> can help 40G port to
achieve the best performance, especially for small packet size.</p>
<ul class="simple">
<li>Disabling/enabling <code class="docutils literal"><span class="pre">extended_tag</span></code> can be done in some BIOS implementations.</li>
<li>If BIOS does not enable it, and does not support changing it, tools
(e.g. <code class="docutils literal"><span class="pre">setpci</span></code> on Linux) can be used to enable or disable <code class="docutils literal"><span class="pre">extended_tag</span></code>.</li>
<li>From release 16.04, <code class="docutils literal"><span class="pre">extended_tag</span></code> is enabled by default during port
initialization, users don&#8217;t need to care about that anymore.</li>
</ul>
</div>
<div class="section" id="use-16-bytes-rx-descriptor-size">
<h3>5.7.2. Use 16 Bytes RX Descriptor Size</h3>
<p>As i40e PMD supports both 16 and 32 bytes RX descriptor sizes, and 16 bytes size can provide helps to high performance of small packets.
Configuration of <code class="docutils literal"><span class="pre">CONFIG_RTE_LIBRTE_I40E_16BYTE_RX_DESC</span></code> in config files can be changed to use 16 bytes size RX descriptors.</p>
</div>
<div class="section" id="high-performance-and-per-packet-latency-tradeoff">
<h3>5.7.3. High Performance and per Packet Latency Tradeoff</h3>
<p>Due to the hardware design, the interrupt signal inside NIC is needed for per
packet descriptor write-back. The minimum interval of interrupts could be set
at compile time by <code class="docutils literal"><span class="pre">CONFIG_RTE_LIBRTE_I40E_ITR_INTERVAL</span></code> in configuration files.
Though there is a default configuration, the interval could be tuned by the
users with that configuration item depends on what the user cares about more,
performance or per packet latency.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="quick_start.html" class="btn btn-neutral float-right" title="6. Quick Start Setup Script" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="build_sample_apps.html" class="btn btn-neutral" title="4. Compiling and Running Sample Applications" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'16.04.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>